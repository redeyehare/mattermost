{"version":3,"file":"9527.ac6883feaa5f446fe004.js","mappings":"mQASO,MAAMA,EAA0BA,CAACC,EAAoBC,KACxD,MAAMC,GAAoBC,EAAAA,EAAAA,IAAiBH,EAAOC,GAC5CG,GAAUC,EAAAA,EAAAA,GAAWL,EAAOC,GAElC,OAD2BK,QAAQF,IAAYA,EAAQG,OAASC,EAAAA,GAAQC,cAAgBL,EAAQG,OAASC,EAAAA,GAAQE,oBACpFC,EAAAA,EAAAA,GAAqBT,EAAkB,E,2DCSxE,MAAMU,EAA2D,CAC7DC,YAAY,EACZC,kBAAkB,GAOP,SAASC,EAAaC,GAAqB,IAApB,UAACf,GAAiBe,EACpD,MAAMd,GAAoBe,EAAAA,EAAAA,cAAajB,IAAuBG,EAAAA,EAAAA,IAAiBH,EAAOC,KAChFiB,GAAUD,EAAAA,EAAAA,aAAYE,EAAAA,IACtBC,GAAiBC,EAAAA,EAAAA,IAAmCH,GACpDI,GAA0BL,EAAAA,EAAAA,cAAajB,GAAuBD,EAAwBC,EAAOC,KAC7FsB,EAAoBH,GAAkBE,EACtCE,GAAmBC,EAAAA,EAAAA,QAAwB,OAC1CC,EAAeC,GAAoBC,IAAAA,UAAwB,IAElEC,EAAAA,EAAAA,YAAU,KACN,IAAKL,EAAiBM,QAClB,OAGJ,MAAMC,EAA4BP,EAAiBM,QAAQE,YAAcR,EAAiBM,QAAQG,YAC5FC,EAA0BV,EAAiBM,QAAQK,aAAeX,EAAiBM,QAAQM,aAEjGT,EAAiBI,GAA6BG,EAAwB,GACvE,CAAChC,aAAiB,EAAjBA,EAAmBmC,OAEvB,MACMC,GADOC,EAAAA,EAAAA,WAC2BC,cAAc,CAACC,GAAI,4BAA6BC,eAAgB,wBAElGC,EACFf,IAAAA,cAACgB,EAAAA,EAAQ,CACLC,QAAS3C,aAAiB,EAAjBA,EAAmBmC,KAC5BS,QAASlC,IAIXmC,GAAqBC,EAAAA,EAAAA,UAAQ,KACxB,CACHC,gBAAiB/C,aAAiB,EAAjBA,EAAmBgD,oBAEzC,CAAChD,IAEEiD,GAAyBH,EAAAA,EAAAA,UAAQ,KAEnC,IAAK9C,IAAsBA,EAAkBgD,iBACzC,MAAO,CAAC,EAGZ,MAAME,GAAQC,EAAAA,EAAAA,IAA0BnD,EAAkBgD,kBAM1D,MAAO,CACHE,QACA,8BAA+BA,EAClC,GACF,CAAClD,IAEJ,OAAKA,GAAsBqB,EAKvBK,IAAAA,cAAC0B,EAAAA,EAAW,CACRC,MAAOZ,EACPa,UAAU,uBACVC,YAAY,EACZC,gBAAgB,SAChBC,UAAWjC,GAEXE,IAAAA,cAAA,OACI4B,UAAU,iBACV,cAAY,2BACZI,MAAOb,GAEPnB,IAAAA,cAAA,QACI,cAAY,sBACZ4B,UAAU,sBACV,aAAYlB,EACZsB,MAAOT,EACPU,IAAKrC,GAEJmB,KAvBN,IA4Bf,CAAC5B,EAAA+C,UAAA,CAtFG7D,UAAS8D,IAAAA,OAAAC,W,gBCxBbC,EAAQ,EACR,SAA8BC,GAC1B,QAAKA,IAGE5D,QAAQ4D,EAAOC,UAAY7D,QAAQ4D,EAAO7B,OAAS/B,QAAQ4D,EAAOhB,kBAC7E,C","sources":["webpack://mattermost-webapp/./src/packages/mattermost-redux/src/selectors/entities/channel_banner.ts","webpack://mattermost-webapp/./src/components/channel_banner/channel_banner.tsx","webpack://mattermost-webapp/../platform/types/lib/channels.js"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {channelBannerEnabled} from '@mattermost/types/channels';\r\nimport type {GlobalState} from '@mattermost/types/store';\r\n\r\nimport {General} from 'mattermost-redux/constants';\r\nimport {getChannel, getChannelBanner} from 'mattermost-redux/selectors/entities/channels';\r\n\r\nexport const selectShowChannelBanner = (state: GlobalState, channelId: string): boolean => {\r\n    const channelBannerInfo = getChannelBanner(state, channelId);\r\n    const channel = getChannel(state, channelId);\r\n    const isValidChannelType = Boolean(channel && (channel.type === General.OPEN_CHANNEL || channel.type === General.PRIVATE_CHANNEL));\r\n    return isValidChannelType && channelBannerEnabled(channelBannerInfo);\r\n};\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useEffect, useMemo, useRef} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport {selectShowChannelBanner} from 'mattermost-redux/selectors/entities/channel_banner';\r\nimport {getChannelBanner} from 'mattermost-redux/selectors/entities/channels';\r\nimport {getLicense} from 'mattermost-redux/selectors/entities/general';\r\nimport {getContrastingSimpleColor} from 'mattermost-redux/utils/theme_utils';\r\n\r\nimport Markdown from 'components/markdown';\r\nimport WithTooltip from 'components/with_tooltip';\r\n\r\nimport {isMinimumEnterpriseAdvancedLicense} from 'utils/license_utils';\r\nimport type {TextFormattingOptions} from 'utils/text_formatting';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\nimport './style.scss';\r\n\r\nconst markdownRenderingOptions: Partial<TextFormattingOptions> = {\r\n    singleline: true,\r\n    mentionHighlight: false,\r\n};\r\n\r\ntype Props = {\r\n    channelId: string;\r\n}\r\n\r\nexport default function ChannelBanner({channelId}: Props) {\r\n    const channelBannerInfo = useSelector((state: GlobalState) => getChannelBanner(state, channelId));\r\n    const license = useSelector(getLicense);\r\n    const licenseEnabled = isMinimumEnterpriseAdvancedLicense(license);\r\n    const channelBannerConfigured = useSelector((state: GlobalState) => selectShowChannelBanner(state, channelId));\r\n    const showChannelBanner = licenseEnabled && channelBannerConfigured;\r\n    const textContainerRef = useRef<HTMLSpanElement>(null);\r\n    const [tooltipNeeded, setTooltipNeeded] = React.useState<boolean>(false);\r\n\r\n    useEffect(() => {\r\n        if (!textContainerRef.current) {\r\n            return;\r\n        }\r\n\r\n        const isOverflowingHorizontally = textContainerRef.current.offsetWidth < textContainerRef.current.scrollWidth;\r\n        const isOverflowingVertically = textContainerRef.current.offsetHeight < textContainerRef.current.scrollHeight;\r\n\r\n        setTooltipNeeded(isOverflowingHorizontally || isOverflowingVertically);\r\n    }, [channelBannerInfo?.text]);\r\n\r\n    const intl = useIntl();\r\n    const channelBannerTextAriaLabel = intl.formatMessage({id: 'channel_banner.aria_label', defaultMessage: 'Channel banner text'});\r\n\r\n    const content = (\r\n        <Markdown\r\n            message={channelBannerInfo?.text}\r\n            options={markdownRenderingOptions}\r\n        />\r\n    );\r\n\r\n    const channelBannerStyle = useMemo(() => {\r\n        return {\r\n            backgroundColor: channelBannerInfo?.background_color,\r\n        };\r\n    }, [channelBannerInfo]);\r\n\r\n    const channelBannerTextStyle = useMemo(() => {\r\n        // this is just to satisfy type checks.\r\n        if (!channelBannerInfo || !channelBannerInfo.background_color) {\r\n            return {};\r\n        }\r\n\r\n        const color = getContrastingSimpleColor(channelBannerInfo.background_color);\r\n\r\n        // The CSS variable is declared here, and is being used in the stylesheet being imported in this component.\r\n        // This is needed because if the user sets background color a share of blue similar to the default link color,\r\n        // the markdown link will become almost invisible. So, the CSS variable declared here is used\r\n        // to set the color of the text in anchor tag in the stylesheet.\r\n        return {\r\n            color,\r\n            '--channel-banner-text-color': color,\r\n        };\r\n    }, [channelBannerInfo]);\r\n\r\n    if (!channelBannerInfo || !showChannelBanner) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <WithTooltip\r\n            title={content}\r\n            className='channelBannerTooltip'\r\n            delayClose={true}\r\n            forcedPlacement='bottom'\r\n            disabled={!tooltipNeeded}\r\n        >\r\n            <div\r\n                className='channel_banner'\r\n                data-testid='channel_banner_container'\r\n                style={channelBannerStyle}\r\n            >\r\n                <span\r\n                    data-testid='channel_banner_text'\r\n                    className='channel_banner_text'\r\n                    aria-label={channelBannerTextAriaLabel}\r\n                    style={channelBannerTextStyle}\r\n                    ref={textContainerRef}\r\n                >\r\n                    {content}\r\n                </span>\r\n            </div>\r\n        </WithTooltip>\r\n    );\r\n}\r\n","\"use strict\";\n// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.channelBannerEnabled = channelBannerEnabled;\nfunction channelBannerEnabled(banner) {\n    if (!banner) {\n        return false;\n    }\n    return Boolean(banner.enabled) && Boolean(banner.text) && Boolean(banner.background_color);\n}\n"],"names":["selectShowChannelBanner","state","channelId","channelBannerInfo","getChannelBanner","channel","getChannel","Boolean","type","General","OPEN_CHANNEL","PRIVATE_CHANNEL","channelBannerEnabled","markdownRenderingOptions","singleline","mentionHighlight","ChannelBanner","_ref","useSelector","license","getLicense","licenseEnabled","isMinimumEnterpriseAdvancedLicense","channelBannerConfigured","showChannelBanner","textContainerRef","useRef","tooltipNeeded","setTooltipNeeded","React","useEffect","current","isOverflowingHorizontally","offsetWidth","scrollWidth","isOverflowingVertically","offsetHeight","scrollHeight","text","channelBannerTextAriaLabel","useIntl","formatMessage","id","defaultMessage","content","Markdown","message","options","channelBannerStyle","useMemo","backgroundColor","background_color","channelBannerTextStyle","color","getContrastingSimpleColor","WithTooltip","title","className","delayClose","forcedPlacement","disabled","style","ref","propTypes","_pt","isRequired","exports","banner","enabled"],"sourceRoot":""}