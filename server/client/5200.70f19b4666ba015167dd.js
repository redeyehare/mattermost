"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[5200,9163],{83469:(e,t,s)=>{s.d(t,{OA:()=>o,_D:()=>n,n:()=>r});var a=s(17085),i=s(7430);function n(e){return(t,s)=>{const n=(0,i.WR)(s());return t(a.BX(n,!0,e))}}function r(){return(e,t)=>{const s=(0,i.WR)(t());return e(a.BX(s,!1))}}function o(){return(e,t)=>{const s=(0,i.WR)(t());return e(a.OA(s))}}},61295:(e,t,s)=>{s.d(t,{A:()=>d});var a=s(62688),i=s.n(a),n=(s(4290),s(36418)),r=s.n(n),o=s(47011),l=s(11038);function c(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class d extends r().PureComponent{constructor(e){super(e),c(this,"checkClick",(e=>{this.colorPicker.current&&this.colorPicker.current.contains(e.target)||this.setState({isOpened:!1})})),c(this,"togglePicker",(()=>{!this.state.isOpened&&this.colorInput.current&&this.colorInput.current.focus(),this.setState({isOpened:!this.state.isOpened})})),c(this,"handleColorChange",(e=>{this.setState({focused:!1}),this.props.onChange(e.hex)})),c(this,"onChange",(e=>{const t=e.target.value,s=(0,l.A)(t),a="#"+s.toHex();s.isValid()&&this.props.onChange(a),this.setState({value:t})})),c(this,"onFocus",(e=>{this.setState({focused:!0}),e.target&&e.target.setSelectionRange(1,e.target.value.length)})),c(this,"onBlur",(()=>{const e=this.state.value,t=(0,l.A)(e),s="#"+t.toHex();t.isValid()?(this.props.onChange(s),this.setState({value:s})):this.setState({value:this.props.value}),this.setState({focused:!1})})),c(this,"onKeyDown",(e=>{"Enter"!==e.key&&" "!==e.key||this.togglePicker()})),this.colorPicker=r().createRef(),this.colorInput=r().createRef(),this.state={focused:!1,isOpened:!1,value:e.value}}static getDerivedStateFromProps(e,t){return t.focused||e.value===t.value?null:{value:e.value}}componentDidUpdate(e,t){const{isOpened:s}=t,{isOpened:a}=this.state;a!==s&&(a?document.addEventListener("click",this.checkClick,{capture:!0}):document.removeEventListener("click",this.checkClick))}render(){const{id:e}=this.props,{isOpened:t,value:s}=this.state;return r().createElement("div",{className:"color-input input-group"},r().createElement("input",{id:"".concat(e,"-inputColorValue"),ref:this.colorInput,className:"form-control",type:"text",value:s,onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,onKeyDown:this.onKeyDown,maxLength:7,disabled:this.props.isDisabled,"data-testid":"color-inputColorValue"}),!this.props.isDisabled&&r().createElement("span",{id:"".concat(e,"-squareColorIcon"),className:"input-group-addon color-pad",onClick:this.togglePicker},r().createElement("i",{id:"".concat(e,"-squareColorIconValue"),className:"color-icon",style:{backgroundColor:s}})),t&&r().createElement("div",{ref:this.colorPicker,className:"color-popover",id:"".concat(e,"-ChromePickerModal")},r().createElement(o.xk,{color:s,onChange:this.handleColorChange,disableAlpha:!0})))}}c(d,"propTypes",{id:i().string.isRequired,onChange:i().func.isRequired,value:i().string.isRequired,isDisabled:i().bool})},61544:(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});var a=s(37270),i=s(7380),n=s(62688),r=s.n(n),o=(s(17046),s(4290),s(71633)),l=s.n(o),c=s(36418),d=s.n(c),u=s(14778),m=s(78451),p=s(19513);function h(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class g extends d().PureComponent{constructor(e){super(e),h(this,"handleClick",((e,t)=>{var s;t.preventDefault(),this.props.updateTab(e.name),null===(s=t.target.closest(".settings-modal"))||void 0===s||s.classList.add("display--content")})),h(this,"handleKeyDown",((e,t)=>{if(!(0,p.e)(t,m.Ay.KeyCodes.UP)&&!(0,p.e)(t,m.Ay.KeyCodes.DOWN))return;t.preventDefault();const s=this.getVisibleTabs();if(0===s.length)return;const a=s.findIndex((t=>t.name===e.name));if(-1===a)return;let i;i=(0,p.e)(t,m.Ay.KeyCodes.UP)?a>0?a-1:s.length-1:a<s.length-1?a+1:0;const n=s[i];this.props.updateTab(n.name);const r=this.buttonRefs.get(n.name);r&&r.focus()})),this.buttonRefs=new Map}getVisibleTabs(){var e;return[...this.props.tabs.filter((e=>!1!==e.display)),...(null===(e=this.props.pluginTabs)||void 0===e?void 0:e.filter((e=>!1!==e.display)))||[]]}renderTab(e){const t="".concat(e.name,"_li"),s=this.props.activeTab===e.name;let a;return a="string"==typeof e.icon?d().createElement("i",{className:e.icon,title:e.iconTitle}):d().createElement("img",{src:e.icon.url,alt:e.iconTitle,className:"icon"}),d().createElement(d().Fragment,{key:t},e.newGroup&&d().createElement("hr",null),d().createElement("button",{"data-testid":"".concat(e.name,"-tab-button"),ref:t=>{t?this.buttonRefs.set(e.name,t):this.buttonRefs.delete(e.name)},id:"".concat(e.name,"Button"),className:l()("cursor--pointer style--none nav-pills__tab",{active:s}),onClick:this.handleClick.bind(null,e),onKeyDown:this.handleKeyDown.bind(null,e),"aria-label":e.uiName.toLowerCase(),role:"tab","aria-selected":s,tabIndex:s||this.props.isMobileView?0:-1,"aria-controls":"".concat(e.name,"Settings")},a,e.uiName))}render(){var e;const t=this.props.tabs.filter((e=>!1!==e.display)).map((e=>this.renderTab(e)));let s;if(null!==(e=this.props.pluginTabs)&&void 0!==e&&e.length){const e=this.props.pluginTabs.filter((e=>!1!==e.display));e.length&&(s=d().createElement(d().Fragment,null,d().createElement("hr",null),d().createElement("div",{role:"group","aria-labelledby":"userSettingsModal.pluginPreferences.header"},d().createElement("div",{key:"plugin preferences heading",role:"heading",className:"header","aria-level":3,id:"userSettingsModal_pluginPreferences_header"},d().createElement(u.FormattedMessage,{id:"userSettingsModal.pluginPreferences.header",defaultMessage:"PLUGIN PREFERENCES"})),e.map((e=>this.renderTab(e))))))}return d().createElement("div",{id:"tabList",className:"nav nav-pills nav-stacked",role:"tablist","aria-orientation":"vertical"},d().createElement("div",{role:"group"},t),s)}}h(g,"propTypes",{activeTab:r().string,tabs:r().arrayOf(r().shape({icon:r().oneOfType([r().string,r().shape({url:r().string.isRequired})]).isRequired,iconTitle:r().string.isRequired,name:r().string.isRequired,uiName:r().string.isRequired,newGroup:r().bool,display:r().bool})).isRequired,pluginTabs:r().arrayOf(r().shape({icon:r().oneOfType([r().string,r().shape({url:r().string.isRequired})]).isRequired,iconTitle:r().string.isRequired,name:r().string.isRequired,uiName:r().string.isRequired,newGroup:r().bool,display:r().bool})),updateTab:r().func.isRequired,isMobileView:r().bool.isRequired});const f=(0,a.connect)((function(e){return{isMobileView:(0,i.w3)(e)}}))(g)},15330:(e,t,s)=>{s.r(t),s.d(t,{default:()=>qs});var a=s(62688),i=s.n(a),n=(s(12401),s(4290),s(36418)),r=s.n(n),o=s(40140),l=s.n(o),c=s(14778),d=s(14696),u=s(17461),m=s(61544),p=(s(10844),s(37270)),h=s(32446),g=s(35631),f=s(17085),E=s(26614),v=s(77440),S=s(7430),b=s(78451),y=(s(43813),s(91767)),M=s(48729),A=s(98362),T=s(4715),_=s(85873),C=s(57898),w=s(94112);function N(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class P extends r().PureComponent{constructor(e){super(e),N(this,"handleOnChange",(e=>{const t=e.currentTarget.value;this.setState({joinLeaveState:t}),(0,_.b6)(e.currentTarget)})),N(this,"handleUpdateSection",(e=>{e||this.setState({joinLeaveState:this.props.joinLeave}),this.props.onUpdateSection(e)})),N(this,"handleSubmit",(()=>{const{actions:e,userId:t,onUpdateSection:s}=this.props,a={category:C.pm.CATEGORY_ADVANCED_SETTINGS,user_id:t,name:C.pm.ADVANCED_FILTER_JOIN_LEAVE,value:this.state.joinLeaveState};e.savePreferences(t,[a]),s()})),this.state={joinLeaveState:e.joinLeave},this.minRef=r().createRef()}focusEditButton(){var e;null===(e=this.minRef.current)||void 0===e||e.focus()}componentDidUpdate(e){e.active&&!this.props.active&&this.props.areAllSectionsInactive&&this.focusEditButton()}render(){const{joinLeaveState:e}=this.state;return this.props.active?r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),inputs:[r().createElement("fieldset",{key:"joinLeaveSetting"},r().createElement("legend",{className:"form-legend hidden-label"},r().createElement(c.FormattedMessage,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"})),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"joinLeaveOn",type:"radio",value:"true",name:b.bo.JOIN_LEAVE,checked:"true"===e,onChange:this.handleOnChange}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})),r().createElement("br",null)),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"joinLeaveOff",type:"radio",value:"false",name:b.bo.JOIN_LEAVE,checked:"false"===e,onChange:this.handleOnChange}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),r().createElement("br",null)),r().createElement("div",{className:"mt-5"},r().createElement(c.FormattedMessage,{id:"user.settings.advance.joinLeaveDesc",defaultMessage:'When "On", System Messages saying a user has joined or left a channel will be visible. When "Off", the System Messages about joining or leaving a channel will be hidden. A message will still show up when you are added to a channel, so you can receive a notification.'})))],setting:b.bo.JOIN_LEAVE,submit:this.handleSubmit,saving:this.state.isSaving,serverError:this.state.serverError,updateSection:this.handleUpdateSection}):r().createElement(w.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),describe:this.props.renderOnOffLabel(e),section:b.bo.JOIN_LEAVE,updateSection:this.handleUpdateSection,ref:this.minRef})}}const k=(0,p.connect)((function(e,t){const s="true"===(0,E.zj)(e).EnableJoinLeaveMessageByDefault,a=t.adminMode&&t.userPreferences?t.userPreferences:void 0;return{userId:t.adminMode?t.userId:(0,S.WR)(e),joinLeave:(0,v.Jt)(e,C.pm.CATEGORY_ADVANCED_SETTINGS,C.pm.ADVANCED_FILTER_JOIN_LEAVE,s.toString(),a)}}),(function(e){return{actions:(0,h.zH)({savePreferences:g.SF},e)}}))(P);function O(e){const t=(0,n.useRef)(null),s=(0,n.useRef)(!1);if((0,n.useEffect)((()=>{var a;s.current&&!e.active&&e.areAllSectionsInactive&&(null===(a=t.current)||void 0===a||a.focus())})),(0,n.useEffect)((()=>{s.current=e.active}),[e.active]),!e.performanceDebuggingEnabled)return null;let a;return a=e.active?r().createElement(I,e):r().createElement(R,Object.assign({},e,{ref:t})),r().createElement(r().Fragment,null,a,r().createElement("div",{className:"divider-light"}))}s(29206),s(17046),O.propTypes={adminMode:i().bool,userId:i().string.isRequired,active:i().bool.isRequired,areAllSectionsInactive:i().bool.isRequired,onUpdateSection:i().func.isRequired};const R=r().forwardRef(((e,t)=>{let s,a=0;return e.disableClientPlugins&&(a+=1),e.disableTypingMessages&&(a+=1),s=0===a?r().createElement(c.FormattedMessage,{id:"user.settings.advance.performance.noneEnabled",defaultMessage:"No settings enabled"}):r().createElement(c.FormattedMessage,{id:"user.settings.advance.performance.settingsEnabled",defaultMessage:"{count, number} {count, plural, one {setting} other {settings}} enabled",values:{count:a}}),r().createElement(w.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.performance.title",defaultMessage:"Performance Debugging"}),describe:s,section:b.bo.PERFORMANCE_DEBUGGING,updateSection:e.onUpdateSection,ref:t})}));function I(e){const[t,s]=(0,n.useState)(e.disableClientPlugins),[a,i]=(0,n.useState)(e.disableTypingMessages),o=(0,n.useCallback)((()=>{if(!e.userId)return;const s=[];t!==e.disableClientPlugins&&s.push({user_id:e.userId,category:C.pm.CATEGORY_PERFORMANCE_DEBUGGING,name:C.pm.NAME_DISABLE_CLIENT_PLUGINS,value:t.toString()}),a!==e.disableTypingMessages&&s.push({user_id:e.userId,category:C.pm.CATEGORY_PERFORMANCE_DEBUGGING,name:C.pm.NAME_DISABLE_TYPING_MESSAGES,value:a.toString()}),0!==s.length&&e.userId&&e.savePreferences(e.userId,s),e.onUpdateSection("")}),[e.userId,e.onUpdateSection,e.savePreferences,t,a]);return r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.performance.title",defaultMessage:"Performance Debugging"}),inputs:[r().createElement("fieldset",{key:"settings"},r().createElement("div",{className:"checkbox"},r().createElement("label",null,r().createElement("input",{type:"checkbox",checked:t,onChange:e=>{s(e.target.checked)}}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.performance.disableClientPlugins",defaultMessage:"Disable Client-side Plugins"}))),r().createElement("div",{className:"checkbox"},r().createElement("label",null,r().createElement("input",{type:"checkbox",checked:a,onChange:e=>{i(e.target.checked)}}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.performance.disableTypingMessages",defaultMessage:'Disable "User is typing..." messages'}))),r().createElement("div",{className:"mt-5"},r().createElement(c.FormattedMessage,{id:"user.settings.advance.performance.info1",defaultMessage:"You may enable these settings temporarily to help isolate performance issues while debugging. We don't recommend leaving these settings enabled for an extended period of time as they can negatively impact your user experience."}),r().createElement("br",null),r().createElement("br",null),r().createElement(c.FormattedMessage,{id:"user.settings.advance.performance.info2",defaultMessage:"You may need to refresh the page before these settings take effect."})))],submit:o,updateSection:e.onUpdateSection})}R.propTypes={adminMode:i().bool,userId:i().string.isRequired,active:i().bool.isRequired,areAllSectionsInactive:i().bool.isRequired,onUpdateSection:i().func.isRequired},I.propTypes={adminMode:i().bool,userId:i().string.isRequired,active:i().bool.isRequired,areAllSectionsInactive:i().bool.isRequired,onUpdateSection:i().func.isRequired};const D={savePreferences:g.SF},L=(0,p.connect)((function(e,t){const s=t.adminMode&&t.userId?(0,v.oE)(e,t.userId):void 0;return{userId:t.adminMode?t.userId:(0,S.WR)(e),disableClientPlugins:(0,v.Jz)(e,C.pm.CATEGORY_PERFORMANCE_DEBUGGING,C.pm.NAME_DISABLE_CLIENT_PLUGINS,void 0,s),disableTypingMessages:(0,v.Jz)(e,C.pm.CATEGORY_PERFORMANCE_DEBUGGING,C.pm.NAME_DISABLE_TYPING_MESSAGES,void 0,s),performanceDebuggingEnabled:(0,E.iy)(e)}}),D)(O);var F=s(93247),x=s(98113);function U(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function j(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?U(Object(s),!0).forEach((function(t){q(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):U(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function q(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class B extends r().PureComponent{constructor(e){super(e),q(this,"getStateFromProps",(()=>({settings:{send_on_ctrl_enter:this.props.sendOnCtrlEnter,code_block_ctrl_enter:this.props.codeBlockOnCtrlEnter,formatting:this.props.formatting,join_leave:this.props.joinLeave,sync_drafts:this.props.syncDrafts,[b.pm.UNREAD_SCROLL_POSITION]:this.props.unreadScrollPosition},isSaving:!1,showDeactivateAccountModal:!1,serverError:""}))),q(this,"updateSetting",((e,t,s)=>{const a=this.state.settings;a[e]=t,this.setState((e=>j(j({},e),a))),(0,_.b6)(null==s?void 0:s.currentTarget)})),q(this,"handleSubmit",(async e=>{if(!this.props.user)return;const t=[],{actions:s,user:a}=this.props,i=a.id;(Array.isArray(e)?e:[e]).forEach((e=>{t.push({user_id:i,category:b.Ay.Preferences.CATEGORY_ADVANCED_SETTINGS,name:e,value:this.state.settings[e]})})),this.setState({isSaving:!0}),await s.savePreferences(i,t),this.handleUpdateSection("")})),q(this,"handleDeactivateAccountSubmit",(async()=>{const e=this.props.user.id;this.setState({isSaving:!0}),this.props.actions.updateUserActive(e,!1).then((e=>{let{error:t}=e;t&&this.setState({serverError:t.message})}));const{data:t,error:s}=await this.props.actions.revokeAllSessionsForUser(e);t?(0,y.BN)():s&&this.setState({serverError:s.message})})),q(this,"handleShowDeactivateAccountModal",(()=>{this.setState({showDeactivateAccountModal:!0})})),q(this,"handleHideDeactivateAccountModal",(()=>{this.setState({showDeactivateAccountModal:!1})})),q(this,"handleUpdateSection",(e=>{e||this.setState(this.getStateFromProps()),this.setState({isSaving:!1}),this.props.updateSection(e)})),q(this,"getCtrlSendText",(()=>{const e=(0,c.defineMessages)({default:{id:"user.settings.advance.sendDesc",defaultMessage:"When enabled, CTRL + ENTER will send the message and ENTER inserts a new line."},mac:{id:"user.settings.advance.sendDesc.mac",defaultMessage:"When enabled, ⌘ + ENTER will send the message and ENTER inserts a new line."}}),t=(0,c.defineMessages)({default:{id:"user.settings.advance.sendTitle",defaultMessage:"Send Messages on CTRL+ENTER"},mac:{id:"user.settings.advance.sendTitle.mac",defaultMessage:"Send Messages on ⌘+ENTER"}});return(0,T.cX)()?{ctrlSendTitle:t.mac,ctrlSendDesc:e.mac}:{ctrlSendTitle:t.default,ctrlSendDesc:e.default}})),q(this,"renderFormattingSection",(()=>{const e="formatting"===this.props.activeSection;let t=null;return e&&(t=r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),inputs:[r().createElement("fieldset",{key:"formattingSetting"},r().createElement("legend",{className:"form-legend hidden-label"},r().createElement(c.FormattedMessage,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"})),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"postFormattingOn",type:"radio",name:"formatting",checked:"false"!==this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","true")}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})),r().createElement("br",null)),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"postFormattingOff",type:"radio",name:"formatting",checked:"false"===this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","false")}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),r().createElement("br",null)),r().createElement("div",{className:"mt-5"},r().createElement(c.FormattedMessage,{id:"user.settings.advance.formattingDesc",defaultMessage:"If enabled, posts will be formatted to create links, show emoji, style the text, and add line breaks. By default, this setting is enabled."})))],submit:this.handleSubmit.bind(this,["formatting"]),saving:this.state.isSaving,serverError:this.state.serverError,updateSection:this.handleUpdateSection})),r().createElement(M.A,{active:e,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),describe:this.renderOnOffLabel(this.state.settings.formatting),section:"formatting",updateSection:this.handleUpdateSection,max:t})})),q(this,"renderUnreadScrollPositionSection",(()=>{const e=this.props.activeSection===b.pm.UNREAD_SCROLL_POSITION;let t=null;return e&&(t=r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.unreadScrollPositionTitle",defaultMessage:"Scroll position when viewing an unread channel"}),inputs:[r().createElement("fieldset",{key:"unreadScrollPositionSetting"},r().createElement("legend",{className:"form-legend hidden-label"},r().createElement(c.FormattedMessage,{id:"user.settings.advance.unreadScrollPositionTitle",defaultMessage:"Scroll position when viewing an unread channel"})),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"unreadPositionStartFromLeftOff",type:"radio",name:"unreadScrollPosition",checked:this.state.settings.unread_scroll_position===b.pm.UNREAD_SCROLL_POSITION_START_FROM_LEFT,onChange:this.updateSetting.bind(this,b.pm.UNREAD_SCROLL_POSITION,b.pm.UNREAD_SCROLL_POSITION_START_FROM_LEFT)}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.startFromLeftOff",defaultMessage:"Start me where I left off"})),r().createElement("br",null)),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"unreadPositionStartFromNewest",type:"radio",name:"unreadScrollPosition",checked:this.state.settings.unread_scroll_position===b.pm.UNREAD_SCROLL_POSITION_START_FROM_NEWEST,onChange:this.updateSetting.bind(this,b.pm.UNREAD_SCROLL_POSITION,b.pm.UNREAD_SCROLL_POSITION_START_FROM_NEWEST)}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.startFromNewest",defaultMessage:"Start me at the newest message"})),r().createElement("br",null)),r().createElement("div",{className:"mt-5"},r().createElement(c.FormattedMessage,{id:"user.settings.advance.unreadScrollPositionDesc",defaultMessage:"Choose your scroll position when you view an unread channel. Channels will always be marked as read when viewed."})))],submit:this.handleSubmit.bind(this,[b.pm.UNREAD_SCROLL_POSITION]),saving:this.state.isSaving,serverError:this.state.serverError,updateSection:this.handleUpdateSection})),r().createElement(M.A,{active:e,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.unreadScrollPositionTitle",defaultMessage:"Scroll position when viewing an unread channel"}),describe:this.renderUnreadScrollPositionLabel(this.state.settings[b.pm.UNREAD_SCROLL_POSITION]),section:b.pm.UNREAD_SCROLL_POSITION,updateSection:this.handleUpdateSection,max:t})})),q(this,"renderSyncDraftsSection",(()=>{const e=this.props.activeSection===b.bo.SYNC_DRAFTS;let t=null;return e&&(t=r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.syncDrafts.Title",defaultMessage:"Allow message drafts to sync with the server"}),inputs:[r().createElement("fieldset",{key:"syncDraftsSetting"},r().createElement("legend",{className:"form-legend hidden-label"},r().createElement(c.FormattedMessage,{id:"user.settings.advance.syncDrafts.Title",defaultMessage:"Allow message drafts to sync with the server"})),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"syncDraftsOn",type:"radio",name:"syncDrafts",checked:"false"!==this.state.settings.sync_drafts,onChange:this.updateSetting.bind(this,"sync_drafts","true")}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})),r().createElement("br",null)),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"syncDraftsOff",type:"radio",name:"syncDrafts",checked:"false"===this.state.settings.sync_drafts,onChange:this.updateSetting.bind(this,"sync_drafts","false")}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),r().createElement("br",null)),r().createElement("div",{className:"mt-5"},r().createElement(c.FormattedMessage,{id:"user.settings.advance.syncDrafts.Desc",defaultMessage:"When enabled, message drafts are synced with the server so they can be accessed from any device. When disabled, message drafts are only saved locally on the device where they are composed."})))],setting:b.bo.SYNC_DRAFTS,submit:this.handleSubmit.bind(this,["sync_drafts"]),saving:this.state.isSaving,serverError:this.state.serverError,updateSection:this.handleUpdateSection})),r().createElement(M.A,{active:e,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.syncDrafts.Title",defaultMessage:"Allow message drafts to sync with the server"}),describe:this.renderOnOffLabel(this.state.settings.sync_drafts),section:b.bo.SYNC_DRAFTS,updateSection:this.handleUpdateSection,max:t})})),q(this,"renderCtrlSendSection",(()=>{const e="advancedCtrlSend"===this.props.activeSection,t=this.state.serverError||null,{ctrlSendTitle:s,ctrlSendDesc:a}=this.getCtrlSendText();let i=null;if(e){const e=["true"===this.state.settings.send_on_ctrl_enter,"false"===this.state.settings.send_on_ctrl_enter&&"true"===this.state.settings.code_block_ctrl_enter,"false"===this.state.settings.send_on_ctrl_enter&&"false"===this.state.settings.code_block_ctrl_enter],n=[r().createElement("fieldset",{key:"ctrlSendSetting"},r().createElement("legend",{className:"form-legend hidden-label"},r().createElement(c.FormattedMessage,s)),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"ctrlSendOn",type:"radio",name:"sendOnCtrlEnter",checked:e[0],onChange:e=>{this.updateSetting("send_on_ctrl_enter","true"),this.updateSetting("code_block_ctrl_enter","true"),(0,_.b6)(e.currentTarget)}}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.onForAllMessages",defaultMessage:"On for all messages"})),r().createElement("br",null)),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"ctrlSendOnForCode",type:"radio",name:"sendOnCtrlEnter",checked:e[1],onChange:e=>{this.updateSetting("send_on_ctrl_enter","false"),this.updateSetting("code_block_ctrl_enter","true"),(0,_.b6)(e.currentTarget)}}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.onForCode",defaultMessage:"On only for code blocks starting with ```"})),r().createElement("br",null)),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:"ctrlSendOff",type:"radio",name:"sendOnCtrlEnter",checked:e[2],onChange:e=>{this.updateSetting("send_on_ctrl_enter","false"),this.updateSetting("code_block_ctrl_enter","false"),(0,_.b6)(e.currentTarget)}}),r().createElement(c.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),r().createElement("br",null)),r().createElement("div",null,r().createElement("br",null),r().createElement(c.FormattedMessage,a)))];i=r().createElement(A.A,{title:r().createElement(c.FormattedMessage,s),inputs:n,submit:this.handleSubmit.bind(this,["send_on_ctrl_enter","code_block_ctrl_enter"]),saving:this.state.isSaving,serverError:t,updateSection:this.handleUpdateSection})}return r().createElement(M.A,{active:e,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,s),describe:this.renderCtrlEnterLabel(),section:"advancedCtrlSend",updateSection:this.handleUpdateSection,max:i})})),this.state=this.getStateFromProps()}renderOnOffLabel(e){return"false"===e?r().createElement(c.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"}):r().createElement(c.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})}renderUnreadScrollPositionLabel(e){return e===b.pm.UNREAD_SCROLL_POSITION_START_FROM_LEFT?r().createElement(c.FormattedMessage,{id:"user.settings.advance.startFromLeftOff",defaultMessage:"Start me where I left off"}):r().createElement(c.FormattedMessage,{id:"user.settings.advance.startFromNewest",defaultMessage:"Start me at the newest message"})}renderCtrlEnterLabel(){const e=this.state.settings.send_on_ctrl_enter,t=this.state.settings.code_block_ctrl_enter;return"false"===e&&"false"===t?r().createElement(c.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"}):"true"===e&&"true"===t?r().createElement(c.FormattedMessage,{id:"user.settings.advance.onForAllMessages",defaultMessage:"On for all messages"}):r().createElement(c.FormattedMessage,{id:"user.settings.advance.onForCode",defaultMessage:"On only for code blocks starting with ```"})}render(){const e=this.renderCtrlSendSection(),t=this.renderFormattingSection();let s=null;t&&(s=r().createElement("div",{className:"divider-light"}));let a="",i="";if(""===this.props.user.auth_service&&this.props.enableUserDeactivation&&!this.props.adminMode){const e="deactivateAccount"===this.props.activeSection;let t=null;e&&(t=r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.deactivateAccountTitle",defaultMessage:"Deactivate Account"}),inputs:[r().createElement("div",{key:"formattingSetting"},r().createElement("div",null,r().createElement("br",null),r().createElement(c.FormattedMessage,{id:"user.settings.advance.deactivateDesc",defaultMessage:"Deactivating your account removes your ability to log in to this server and disables all email and mobile notifications. To reactivate your account, contact your System Administrator."})))],saveButtonText:"Deactivate",saveButtonClassName:"btn-danger",setting:"deactivateAccount",submit:this.handleShowDeactivateAccountModal,saving:this.state.isSaving,serverError:this.state.serverError,updateSection:this.handleUpdateSection})),a=r().createElement(M.A,{active:e,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.deactivateAccountTitle",defaultMessage:"Deactivate Account"}),describe:r().createElement(c.FormattedMessage,{id:"user.settings.advance.deactivateDescShort",defaultMessage:"Click 'Edit' to deactivate your account"}),section:"deactivateAccount",updateSection:this.handleUpdateSection,max:t});const s="btn btn-danger",n=r().createElement(c.FormattedMessage,{id:"user.settings.advance.deactivate_member_modal.deactivateButton",defaultMessage:"Yes, deactivate my account"});i=r().createElement(u.A,{show:this.state.showDeactivateAccountModal,title:r().createElement(c.FormattedMessage,{id:"user.settings.advance.confirmDeactivateAccountTitle",defaultMessage:"Confirm Deactivation"}),message:r().createElement(c.FormattedMessage,{id:"user.settings.advance.confirmDeactivateDesc",defaultMessage:"Are you sure you want to deactivate your account? This can only be reversed by your System Administrator."}),confirmButtonClass:s,confirmButtonText:n,onConfirm:this.handleDeactivateAccountSubmit,onCancel:this.handleHideDeactivateAccountModal})}const n=this.renderUnreadScrollPositionSection();let o=null;n&&(o=r().createElement("div",{className:"divider-light"}));let l=null,d=null;return this.props.syncedDraftsAreAllowed&&(l=this.renderSyncDraftsSection(),l&&(d=r().createElement("div",{className:"divider-light"}))),r().createElement("div",{id:"advancedSettings","aria-labelledby":"advancedButton",role:"tabpanel"},r().createElement(x.A,{closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,text:r().createElement(c.FormattedMessage,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"})}),r().createElement("div",{className:"user-settings"},r().createElement(F.A,{text:r().createElement(c.FormattedMessage,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"})}),r().createElement("div",{className:"divider-dark first"}),e,s,t,r().createElement("div",{className:"divider-light"}),r().createElement(k,{active:this.props.activeSection===b.bo.JOIN_LEAVE,areAllSectionsInactive:""===this.props.activeSection,onUpdateSection:this.handleUpdateSection,renderOnOffLabel:this.renderOnOffLabel,adminMode:this.props.adminMode,userPreferences:this.props.userPreferences,userId:this.props.user.id}),r().createElement(L,{active:this.props.activeSection===b.bo.PERFORMANCE_DEBUGGING,onUpdateSection:this.handleUpdateSection,areAllSectionsInactive:""===this.props.activeSection,adminMode:this.props.adminMode,userId:this.props.user.id}),o,n,d,l,s,a,r().createElement("div",{className:"divider-dark"}),i))}}const G=(0,v.dI)("getAdvancedSettingsCategory",b.pm.CATEGORY_ADVANCED_SETTINGS),z=(0,p.connect)((function(){const e=(0,v.cK)("getAdvancedSettingsCategory",b.pm.CATEGORY_ADVANCED_SETTINGS);return(t,s)=>{const a=(0,E.zj)(t),i="true"===a.EnableUserDeactivation,n="true"===a.EnableJoinLeaveMessageByDefault,r=s.adminMode&&s.userPreferences?s.userPreferences:void 0;return{advancedSettingsCategory:r?e(t,s.user.id):G(t),sendOnCtrlEnter:(0,v.Jt)(t,b.pm.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter","false",r),codeBlockOnCtrlEnter:(0,v.Jt)(t,b.pm.CATEGORY_ADVANCED_SETTINGS,"code_block_ctrl_enter","true",r),formatting:(0,v.Jt)(t,b.pm.CATEGORY_ADVANCED_SETTINGS,"formatting","true",r),joinLeave:(0,v.Jt)(t,b.pm.CATEGORY_ADVANCED_SETTINGS,"join_leave",n.toString(),r),syncDrafts:(0,v.Jt)(t,b.pm.CATEGORY_ADVANCED_SETTINGS,"sync_drafts","true",r),user:s.adminMode&&s.user?s.user:(0,S.HW)(t),unreadScrollPosition:(0,v.z0)(t,r),enableUserDeactivation:i,syncedDraftsAreAllowed:(0,v.p2)(t)}}}),(function(e){return{actions:(0,h.zH)({savePreferences:g.SF,updateUserActive:f.tS,revokeAllSessionsForUser:f.V_},e)}}))(B);var Y=s(56121),V=s(83604),H=s(90926),W=s(90239),J=s(24994),K=s(90478),X=s(62757),Q=s.n(X),Z=s(14776),$=s(79751),ee=s(17518),te=s(63324),se=s(87131),ae=s(61295);function ie(e){return r().createElement(r().Fragment,null,r().createElement("label",{className:"custom-label",htmlFor:"".concat(e.id,"-inputColorValue")},e.label),r().createElement(ae.A,{id:e.id,value:e.value,onChange:t=>{var s;null===(s=e.onChange)||void 0===s||s.call(e,e.id,t)}}))}function ne(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function re(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(s),!0).forEach((function(t){oe(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ne(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function oe(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}ie.propTypes={id:i().string.isRequired,label:i().node.isRequired,value:i().string.isRequired,onChange:i().func};const le=(0,c.defineMessages)({sidebarBg:{id:"user.settings.custom_theme.sidebarBg",defaultMessage:"Sidebar BG"},sidebarText:{id:"user.settings.custom_theme.sidebarText",defaultMessage:"Sidebar Text"},sidebarHeaderBg:{id:"user.settings.custom_theme.sidebarHeaderBg",defaultMessage:"Sidebar Header BG"},sidebarTeamBarBg:{id:"user.settings.custom_theme.sidebarTeamBarBg",defaultMessage:"Team Sidebar BG"},sidebarHeaderTextColor:{id:"user.settings.custom_theme.sidebarHeaderTextColor",defaultMessage:"Sidebar Header Text"},sidebarUnreadText:{id:"user.settings.custom_theme.sidebarUnreadText",defaultMessage:"Sidebar Unread Text"},sidebarTextHoverBg:{id:"user.settings.custom_theme.sidebarTextHoverBg",defaultMessage:"Sidebar Text Hover BG"},sidebarTextActiveBorder:{id:"user.settings.custom_theme.sidebarTextActiveBorder",defaultMessage:"Sidebar Text Active Border"},sidebarTextActiveColor:{id:"user.settings.custom_theme.sidebarTextActiveColor",defaultMessage:"Sidebar Text Active Color"},onlineIndicator:{id:"user.settings.custom_theme.onlineIndicator",defaultMessage:"Online Indicator"},awayIndicator:{id:"user.settings.custom_theme.awayIndicator",defaultMessage:"Away Indicator"},dndIndicator:{id:"user.settings.custom_theme.dndIndicator",defaultMessage:"Do Not Disturb Indicator"},mentionBg:{id:"user.settings.custom_theme.mentionBg",defaultMessage:"Mention Jewel BG"},mentionColor:{id:"user.settings.custom_theme.mentionColor",defaultMessage:"Mention Jewel Text"},centerChannelBg:{id:"user.settings.custom_theme.centerChannelBg",defaultMessage:"Center Channel BG"},centerChannelColor:{id:"user.settings.custom_theme.centerChannelColor",defaultMessage:"Center Channel Text"},newMessageSeparator:{id:"user.settings.custom_theme.newMessageSeparator",defaultMessage:"New Message Separator"},linkColor:{id:"user.settings.custom_theme.linkColor",defaultMessage:"Link Color"},buttonBg:{id:"user.settings.custom_theme.buttonBg",defaultMessage:"Button BG"},buttonColor:{id:"user.settings.custom_theme.buttonColor",defaultMessage:"Button Text"},errorTextColor:{id:"user.settings.custom_theme.errorTextColor",defaultMessage:"Error Text Color"},mentionHighlightBg:{id:"user.settings.custom_theme.mentionHighlightBg",defaultMessage:"Mention Highlight BG"},mentionHighlightLink:{id:"user.settings.custom_theme.mentionHighlightLink",defaultMessage:"Mention Highlight Link"},codeTheme:{id:"user.settings.custom_theme.codeTheme",defaultMessage:"Code Theme"}});class ce extends r().PureComponent{constructor(e){super(e),oe(this,"handleColorChange",((e,t)=>{const{updateTheme:s,theme:a}=this.props;if(a[e]!==t){const i=re(re({},a),{},{type:"custom",[e]:t});"mentionBg"===e&&(i.mentionBj=t),s(i);const n=this.setCopyTheme(i);this.setState({copyTheme:n})}})),oe(this,"pasteBoxChange",(e=>{let t,s="";if(s=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):e.clipboardData.getData("Text"),0!==s.length){try{t=JSON.parse(s)}catch(e){return}t=(0,te._1)(t),this.setState({copyTheme:JSON.stringify(t)}),t.type="custom",this.props.updateTheme(t)}})),oe(this,"onChangeHandle",(e=>e.stopPropagation())),oe(this,"selectTheme",(()=>{var e,t;null===(e=this.textareaRef.current)||void 0===e||e.focus(),null===(t=this.textareaRef.current)||void 0===t||t.setSelectionRange(0,this.state.copyTheme.length)})),oe(this,"toggleSidebarStyles",(e=>{var t,s,a;e.preventDefault(),null===(t=this.sidebarStylesHeaderRef.current)||void 0===t||t.classList.toggle("open");const i=null===(s=this.sidebarStylesHeaderRef.current)||void 0===s?void 0:s.classList.contains("open");null===(a=this.sidebarStylesHeaderRef.current)||void 0===a||a.setAttribute("aria-expanded","".concat(i)),this.toggleSection(this.sidebarStylesRef.current)})),oe(this,"toggleCenterChannelStyles",(e=>{var t,s,a;e.preventDefault(),null===(t=this.centerChannelStylesHeaderRef.current)||void 0===t||t.classList.toggle("open");const i=null===(s=this.centerChannelStylesHeaderRef.current)||void 0===s?void 0:s.classList.contains("open");null===(a=this.centerChannelStylesHeaderRef.current)||void 0===a||a.setAttribute("aria-expanded","".concat(i)),this.toggleSection(this.centerChannelStylesRef.current)})),oe(this,"toggleLinkAndButtonStyles",(e=>{var t,s,a;e.preventDefault(),null===(t=this.linkAndButtonStylesHeaderRef.current)||void 0===t||t.classList.toggle("open");const i=null===(s=this.linkAndButtonStylesHeaderRef.current)||void 0===s?void 0:s.classList.contains("open");null===(a=this.linkAndButtonStylesHeaderRef.current)||void 0===a||a.setAttribute("aria-expanded","".concat(i)),this.toggleSection(this.linkAndButtonStylesRef.current)})),oe(this,"onCodeThemeChange",(e=>{const t=re(re({},this.props.theme),{},{type:"custom",codeTheme:e.target.value});this.props.updateTheme(t)})),oe(this,"copyTheme",(()=>{this.selectTheme(),document.execCommand("copy"),this.showCopySuccess()})),oe(this,"showCopySuccess",(()=>{const e=document.querySelector(".copy-theme-success");e&&(e.style.display="inline-block",setTimeout((()=>{e.style.display="none"}),3e3))})),this.textareaRef=(0,n.createRef)(),this.sidebarStylesHeaderRef=(0,n.createRef)(),this.centerChannelStylesHeaderRef=(0,n.createRef)(),this.linkAndButtonStylesHeaderRef=(0,n.createRef)(),this.sidebarStylesRef=(0,n.createRef)(),this.centerChannelStylesRef=(0,n.createRef)(),this.linkAndButtonStylesRef=(0,n.createRef)();const t=this.setCopyTheme(this.props.theme);this.state={copyTheme:t}}setCopyTheme(e){const t=Object.assign({},e);return delete t.type,delete t.image,JSON.stringify(t)}toggleSection(e){e&&(e.classList.toggle("open"),e.ontransitionend=()=>{e.classList.contains("open")?e.style.overflowY="inherit":e.style.overflowY="hidden"})}render(){const{intl:e,theme:t}=this.props,s=[],a=[],i=[];b.Ay.THEME_ELEMENTS.forEach(((e,n)=>{if("codeTheme"===e.id){var o;const s=[];let i="";null===(o=e.themes)||void 0===o||o.forEach(((a,n)=>{a.id===t[e.id]&&(i=a.iconURL),s.push(r().createElement("option",{key:"code-theme-key"+n,value:a.id},a.uiName))})),a.push(r().createElement("div",{className:"col-sm-6 form-group",key:"custom-theme-key"+n},r().createElement("label",{className:"custom-label",htmlFor:"codeThemeSelect"},r().createElement(c.FormattedMessage,le[e.id])),r().createElement("div",{className:"input-group theme-group group--code dropdown",id:e.id},r().createElement("select",{id:"codeThemeSelect",className:"form-control",defaultValue:t[e.id],onChange:this.onCodeThemeChange},s),r().createElement(se.A,{title:r().createElement("div",{className:"code-popover"},r().createElement("img",{width:"200",alt:"code theme image",src:i}))},r().createElement("span",{className:"input-group-addon"},r().createElement("img",{alt:"code theme image",src:i}))))))}else if("centerChannelElements"===e.group)a.push(r().createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+n},r().createElement(ie,{id:e.id,label:r().createElement(c.FormattedMessage,le[e.id]),value:t[e.id]||"",onChange:this.handleColorChange})));else if("sidebarElements"===e.group){let a=t[e.id];a||"mentionBg"!==e.id||(a=t.mentionBj),s.push(r().createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+n},r().createElement(ie,{id:e.id,label:r().createElement(c.FormattedMessage,le[e.id]),value:a||"",onChange:this.handleColorChange})))}else i.push(r().createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+n},r().createElement(ie,{id:e.id,label:r().createElement(c.FormattedMessage,le[e.id]),value:t[e.id]||"",onChange:this.handleColorChange})))}));const n=r().createElement("div",{className:"col-sm-12"},r().createElement("label",{className:"custom-label",htmlFor:"pasteBox"},r().createElement(c.FormattedMessage,{id:"user.settings.custom_theme.copyPaste",defaultMessage:"Copy to share or paste theme colors here:"})),r().createElement("textarea",{ref:this.textareaRef,className:"form-control",id:"pasteBox",value:this.state.copyTheme,onCopy:this.showCopySuccess,onPaste:this.pasteBoxChange,onChange:this.onChangeHandle,onClick:this.selectTheme}),r().createElement("div",{className:"mt-3"},r().createElement("button",{className:"btn btn-tertiary",onClick:this.copyTheme},r().createElement(c.FormattedMessage,{id:"user.settings.custom_theme.copyThemeColors",defaultMessage:"Copy Theme Colors"})),r().createElement("span",{className:"alert alert-success copy-theme-success",role:"alert",style:{display:"none"}},r().createElement(c.FormattedMessage,{id:"user.settings.custom_theme.copied",defaultMessage:"✔ Copied"}))));return r().createElement("div",{id:"customThemesSection",className:"appearance-section pt-2","aria-labelledby":"customThemes"},r().createElement("div",{className:"theme-elements row"},r().createElement("h4",{className:"theme-elements__header"},r().createElement("button",{ref:this.sidebarStylesHeaderRef,id:"sidebarStylesAccordion",onClick:this.toggleSidebarStyles,"aria-expanded":!1,"aria-controls":"sidebarStylesSection",className:"theme-elements__header"},r().createElement(c.FormattedMessage,{id:"user.settings.custom_theme.sidebarTitle",defaultMessage:"Sidebar Styles"}),r().createElement("div",{className:"header__icon"},r().createElement("i",{className:"fa fa-plus","aria-hidden":!0,title:e.formatMessage({id:"generic_icons.expand",defaultMessage:"Expand Icon"})}),r().createElement("i",{className:"fa fa-minus","aria-hidden":!0,title:e.formatMessage({id:"generic_icons.collapse",defaultMessage:"Collapse Icon"})})))),r().createElement("div",{ref:this.sidebarStylesRef,id:"sidebarStylesSection","aria-labelledby":"sidebarStylesAccordion",className:"theme-elements__body"},s)),r().createElement("div",{className:"theme-elements row"},r().createElement("h4",{className:"theme-elements__header"},r().createElement("button",{ref:this.centerChannelStylesHeaderRef,id:"centerChannelStylesAccordion",onClick:this.toggleCenterChannelStyles,"aria-expanded":!1,"aria-controls":"centerChannelStylesSection",className:"theme-elements__header"},r().createElement(c.FormattedMessage,{id:"user.settings.custom_theme.centerChannelTitle",defaultMessage:"Center Channel Styles"}),r().createElement("div",{className:"header__icon"},r().createElement("i",{className:"fa fa-plus","aria-hidden":!0,title:e.formatMessage({id:"generic_icons.expand",defaultMessage:"Expand Icon"})}),r().createElement("i",{className:"fa fa-minus","aria-hidden":!0,title:e.formatMessage({id:"generic_icons.collapse",defaultMessage:"Collapse Icon"})})))),r().createElement("div",{ref:this.centerChannelStylesRef,id:"centerChannelStylesSection",className:"theme-elements__body","aria-labelledby":"centerChannelStylesAccordion"},a)),r().createElement("div",{className:"theme-elements row"},r().createElement("h4",{className:"theme-elements__header"},r().createElement("button",{ref:this.linkAndButtonStylesHeaderRef,id:"linkAndButtonsStylesAccordion",onClick:this.toggleLinkAndButtonStyles,"aria-expanded":!1,"aria-controls":"linkAndButtonsStylesSection",className:"theme-elements__header"},r().createElement(c.FormattedMessage,{id:"user.settings.custom_theme.linkButtonTitle",defaultMessage:"Link and Button Styles"}),r().createElement("div",{className:"header__icon"},r().createElement("i",{className:"fa fa-plus","aria-hidden":!0,title:e.formatMessage({id:"generic_icons.expand",defaultMessage:"Expand Icon"})}),r().createElement("i",{className:"fa fa-minus","aria-hidden":!0,title:e.formatMessage({id:"generic_icons.collapse",defaultMessage:"Collapse Icon"})})))),r().createElement("div",{id:"linkAndButtonsStylesSection",ref:this.linkAndButtonStylesRef,className:"theme-elements__body","aria-labelledby":"linkAndButtonsStylesAccordion"},i)),r().createElement("div",{className:"row mt-3"},n))}}const de=(0,c.injectIntl)(ce);function ue(e){let{themeName:t,themeKey:s,sidebarBg:a="#174AB5",sidebarText:i="#86A1D9",sidebarUnreadText:n="white",onlineIndicator:o="#3DB887",awayIndicator:l="#FFBC1F",dndIndicator:c="#D24B4E",centerChannelColor:d="#E0E1E3",centerChannelBg:u="white",newMessageSeparator:m="#1C58D9",buttonBg:p="#15B7B7"}=e;return r().createElement("svg",{width:"112",height:"86",viewBox:"0 0 112 86",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"".concat(s,"-theme-icon"),role:"img"},r().createElement("title",{id:"".concat(s,"-theme-icon")},"".concat(t," theme icon")),r().createElement("rect",{style:{fill:u},x:"0",y:"0",width:"112",height:"86"}),r().createElement("g",null,r().createElement("rect",{style:{fill:u},x:"50",y:"-1",width:"63",height:"88"}),r().createElement("g",null,r().createElement("rect",{style:{fill:d},x:"55",y:"75",width:"52",height:"6",rx:"3"}),r().createElement("rect",{style:{fill:u},x:"56",y:"76",width:"50",height:"4",rx:"2"})),r().createElement("rect",{style:{fill:p},x:"71",y:"65",width:"22",height:"5",rx:"2.5"}),r().createElement("rect",{style:{fill:m},x:"50",y:"32",width:"62",height:"1"}),r().createElement("g",{style:{fill:d}},r().createElement("rect",{x:"55",y:"5",width:"52",height:"4",rx:"2"}),r().createElement("rect",{x:"55",y:"14",width:"52",height:"4",rx:"2"}),r().createElement("rect",{x:"55",y:"23",width:"52",height:"4",rx:"2"}),r().createElement("rect",{x:"55",y:"38",width:"52",height:"4",rx:"2"}),r().createElement("rect",{x:"55",y:"47",width:"52",height:"4",rx:"2"}),r().createElement("rect",{x:"55",y:"56",width:"52",height:"4",rx:"2"}))),r().createElement("g",null,r().createElement("rect",{style:{fill:a},x:"-1",y:"-1",width:"51",height:"88"}),r().createElement("g",{style:{fill:i}},r().createElement("circle",{cx:"7",cy:"61",r:"2"}),r().createElement("circle",{cx:"7",cy:"70",r:"2"}),r().createElement("circle",{cx:"7",cy:"43",r:"2"}),r().createElement("circle",{cx:"7",cy:"34",r:"2"}),r().createElement("circle",{cx:"7",cy:"16",r:"2"}),r().createElement("circle",{cx:"7",cy:"7",r:"2"}),r().createElement("rect",{x:"11",y:"5",width:"28",height:"4",rx:"2"}),r().createElement("rect",{x:"11",y:"14",width:"28",height:"4",rx:"2"}),r().createElement("rect",{x:"11",y:"32",width:"28",height:"4",rx:"2"}),r().createElement("rect",{x:"11",y:"41",width:"28",height:"4",rx:"2"}),r().createElement("rect",{x:"11",y:"50",width:"28",height:"4",rx:"2"}),r().createElement("rect",{x:"11",y:"59",width:"28",height:"4",rx:"2"}),r().createElement("rect",{x:"11",y:"68",width:"28",height:"4",rx:"2"}),r().createElement("rect",{x:"11",y:"77",width:"28",height:"4",rx:"2"})),r().createElement("circle",{style:{fill:c},cx:"7",cy:"79",r:"2"}),r().createElement("circle",{style:{fill:l},cx:"7",cy:"52",r:"2"}),r().createElement("circle",{style:{fill:o},cx:"7",cy:"25",r:"2"}),r().createElement("g",{style:{fill:n}},r().createElement("circle",{cx:"43",cy:"25",r:"2"}),r().createElement("rect",{x:"11",y:"23",width:"28",height:"4",rx:"2"}))))}s(76685),s(3188),s(59297),ue.propTypes={themeName:i().string,themeKey:i().string.isRequired,sidebarBg:i().string.isRequired,sidebarText:i().string.isRequired,sidebarUnreadText:i().string.isRequired,onlineIndicator:i().string.isRequired,awayIndicator:i().string.isRequired,dndIndicator:i().string.isRequired,centerChannelColor:i().string.isRequired,centerChannelBg:i().string.isRequired,newMessageSeparator:i().string.isRequired,buttonBg:i().string.isRequired};const me=ue,pe=e=>{let{theme:t,updateTheme:s,allowedThemes:a=[]}=e;const i=[],n=a.length>1||a[0]&&a[0].trim().length>0;for(const e in C.pm.THEMES)if(Object.hasOwn(C.pm.THEMES,e)){var o;if(n&&a.indexOf(e)<0)continue;const l=Object.assign({},C.pm.THEMES[e]);let c="";l.type===t.type&&(c="active"),i.push(r().createElement("div",{className:"col-xs-6 col-sm-3 premade-themes",key:"premade-theme-key"+e},r().createElement("button",{id:"premadeTheme".concat(null===(o=l.type)||void 0===o?void 0:o.replace(" ","")),className:"premadeThemeButton ".concat(c),onClick:()=>s(l)},r().createElement("label",null,r().createElement(me,{themeKey:e,themeName:l.type,sidebarBg:l.sidebarBg,sidebarText:(0,te.Q)(l.sidebarText,.48),sidebarUnreadText:l.sidebarUnreadText,onlineIndicator:l.onlineIndicator,awayIndicator:l.awayIndicator,dndIndicator:l.dndIndicator,centerChannelColor:(0,te.Q)(l.centerChannelColor,.16),centerChannelBg:l.centerChannelBg,newMessageSeparator:l.newMessageSeparator,buttonBg:l.buttonBg}),r().createElement("div",{className:"theme-label"},(0,_.Sn)(l.type||""))))))}return r().createElement("div",{id:"premadeThemesSection",className:"row appearance-section","aria-labelledby":"standardThemes"},r().createElement("div",{className:"clearfix"},i))};pe.propTypes={updateTheme:i().func.isRequired,allowedThemes:i().arrayOf(i().string).isRequired};const he=pe,ge=(0,p.connect)((function(e){const t=(0,E.zj)(e);return{allowedThemes:t.AllowedThemes&&t.AllowedThemes.split(",")||[]}}))(he);function fe(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function Ee(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(s),!0).forEach((function(t){ve(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):fe(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function ve(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Se extends r().PureComponent{constructor(e){super(e),ve(this,"submitTheme",(async()=>{var e,t;const s=this.state.applyToAllTeams?"":this.props.currentTeamId;this.setState({isSaving:!0}),await this.props.actions.saveTheme(s,this.state.theme),this.state.applyToAllTeams&&await this.props.actions.deleteTeamSpecificThemes(),null===(e=(t=this.props).setRequireConfirm)||void 0===e||e.call(t,!1),this.originalTheme=Object.assign({},this.state.theme),this.props.updateSection(""),this.setState({isSaving:!1})})),ve(this,"updateTheme",(e=>{var t,s;let a=this.state.theme.length===e.length;if(!a)for(const t in e)if(Object.hasOwn(e,t)&&this.state.theme[t]!==e[t]){a=!0;break}null===(t=(s=this.props).setRequireConfirm)||void 0===t||t.call(s,a),this.setState({theme:e}),(0,_.AZ)(e)})),ve(this,"updateType",(e=>this.setState({type:e}))),ve(this,"resetFields",(()=>{var e,t;const s=this.getStateFromProps();s.serverError="",this.setState(s),(0,_.AZ)(s.theme),null===(e=(t=this.props).setRequireConfirm)||void 0===e||e.call(t,!1)})),ve(this,"handleUpdateSection",(e=>this.props.updateSection(e))),this.state=Ee(Ee({},this.getStateFromProps(e)),{},{isSaving:!1,serverError:""}),this.originalTheme=Object.assign({},this.state.theme),this.minRef=r().createRef()}componentDidUpdate(e){e.selected&&!this.props.selected&&this.resetFields(),e.selected&&!this.props.selected&&this.props.areAllSectionsInactive&&this.focusEditButton()}componentWillUnmount(){this.props.selected&&(0,_.AZ)(this.props.theme)}getStateFromProps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;const t=Ee({},e.theme);return t.codeTheme||(t.codeTheme=b.YM.DEFAULT_CODE_THEME),{theme:t,type:t.type||"premade",showAllTeamsCheckbox:e.showAllTeamsCheckbox,applyToAllTeams:e.applyToAllTeams,serverError:"",isSaving:!1}}focusEditButton(){var e;null===(e=this.minRef.current)||void 0===e||e.focus()}render(){let e;this.state.serverError&&(e=this.state.serverError);const t="custom"===this.state.type;let s,a,i;if(t&&this.props.allowCustomThemes?s=r().createElement("div",{key:"customThemeChooser"},r().createElement(de,{theme:this.state.theme,updateTheme:this.updateTheme})):a=r().createElement("div",{key:"premadeThemeChooser"},r().createElement("br",null),r().createElement(ge,{theme:this.state.theme,updateTheme:this.updateTheme})),this.props.selected){const n=[];this.props.allowCustomThemes&&(n.push(r().createElement("div",{key:"premadeCustom",className:"user-settings__radio-group-inline"},r().createElement("div",{className:"radio radio-inline"},r().createElement("label",null,r().createElement("input",{id:"standardThemes",type:"radio",name:"theme",checked:!t,onChange:this.updateType.bind(this,"premade")}),r().createElement(c.FormattedMessage,{id:"user.settings.display.theme.premadeThemes",defaultMessage:"Premade Themes"}))),r().createElement("div",{className:"radio radio-inline"},r().createElement("label",null,r().createElement("input",{id:"customThemes",type:"radio",name:"theme",checked:t,onChange:this.updateType.bind(this,"custom")}),r().createElement(c.FormattedMessage,{id:"user.settings.display.theme.customTheme",defaultMessage:"Custom Theme"}))))),n.push(a,s),n.push(r().createElement("div",{key:"otherThemes"},r().createElement("br",null),r().createElement(ee.A,{id:"otherThemes",href:"http://docs.mattermost.com/help/settings/theme-colors.html#custom-theme-examples",location:"user_settings_theme"},r().createElement(c.FormattedMessage,{id:"user.settings.display.theme.otherThemes",defaultMessage:"See other themes"})))));let o=null;this.state.showAllTeamsCheckbox&&(o=r().createElement("div",{className:"checkbox user-settings__submit-checkbox"},r().createElement("label",null,r().createElement("input",{id:"applyThemeToAllTeams",type:"checkbox",checked:this.state.applyToAllTeams,onChange:e=>this.setState({applyToAllTeams:e.target.checked})}),r().createElement(c.FormattedMessage,{id:"user.settings.display.theme.applyToAllTeams",defaultMessage:"Apply new theme to all my teams"})))),i=r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.display.theme.title",defaultMessage:"Theme"}),inputs:r().createElement("fieldset",null,r().createElement("legend",{className:"hidden-label"},r().createElement(c.FormattedMessage,{id:"user.settings.display.theme.title",defaultMessage:"Theme"})),r().createElement("div",null,n)),submitExtra:o,submit:this.submitTheme,disableEnterSubmit:!0,saving:this.state.isSaving,serverError:e,isFullWidth:!0,updateSection:this.handleUpdateSection})}else i=r().createElement(w.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.display.theme.title",defaultMessage:"Theme"}),describe:r().createElement(c.FormattedMessage,{id:"user.settings.display.theme.describe",defaultMessage:"Open to manage your theme"}),section:"theme",updateSection:this.handleUpdateSection,ref:this.minRef});return i}}const be=(0,p.connect)((function(e){return{currentTeamId:(0,Z.Sy)(e),theme:(0,v.O4)(e),applyToAllTeams:(0,v.m3)(e).length<=1,showAllTeamsCheckbox:(0,Z.aw)(e)>1}}),(function(e){return{actions:(0,h.zH)({saveTheme:g.hy,deleteTeamSpecificThemes:g.Hp,openModal:$.q},e)}}))(Se);var ye=s(90327),Me=(s(74883),s(7481)),Ae=s(19513);function Te(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function _e(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(s),!0).forEach((function(t){Ce(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Te(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function Ce(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class we extends r().PureComponent{constructor(e){super(e),Ce(this,"handleContainerKeyDown",(e=>{const t=document.querySelector(".modal-body");(0,Ae.e)(e,b.Ay.KeyCodes.ESCAPE)&&this.state.openMenu&&(null==t||t.classList.remove("no-scroll"),this.setState({openMenu:!1}),e.stopPropagation())})),Ce(this,"handleKeyDown",(e=>{const t=document.querySelector(".modal-body");(0,Ae.e)(e,b.Ay.KeyCodes.ENTER)&&(null==t||t.classList.add("no-scroll"),this.setState({openMenu:!0}))})),Ce(this,"setLanguage",(e=>{e&&"value"in e&&this.setState({locale:e.value,selectedOption:e})})),Ce(this,"changeLanguage",(()=>{this.props.user.locale===this.state.locale?this.props.updateSection(""):this.submitUser(_e(_e({},this.props.user),{},{locale:this.state.locale}))})),Ce(this,"submitUser",(e=>{this.setState({isSaving:!0}),(this.props.adminMode?this.props.actions.patchUser:this.props.actions.updateMe)(e).then((e=>{if("data"in e)this.setState({isSaving:!1});else if("error"in e){let t;const{error:s}=e;t=s instanceof Error?s.message:s,this.setState({serverError:t,isSaving:!1})}}))})),Ce(this,"handleMenuClose",(()=>{const e=document.querySelector(".modal-body");e&&e.classList.remove("no-scroll"),this.setState({openMenu:!1})})),Ce(this,"handleMenuOpen",(()=>{const e=document.querySelector(".modal-body");e&&e.classList.add("no-scroll"),this.setState({openMenu:!0})}));const t=e.locale,s={value:e.locales[t].value,label:e.locales[t].name};this.reactSelectContainer=r().createRef(),this.state={locale:e.locale,selectedOption:s,isSaving:!1,openMenu:!1}}componentDidMount(){const e=this.reactSelectContainer.current;e&&e.addEventListener("keydown",this.handleContainerKeyDown)}componentWillUnmount(){this.reactSelectContainer.current&&this.reactSelectContainer.current.removeEventListener("keydown",this.handleContainerKeyDown)}render(){const{intl:e,locales:t}=this.props;let s;this.state.serverError&&(s=r().createElement("label",{className:"has-error"},this.state.serverError));const a=[];Object.keys(t).map((e=>({value:t[e].value,name:t[e].name,order:t[e].order}))).sort(((e,t)=>e.order-t.order)).forEach((e=>{a.push({value:e.value,label:e.name})}));const i={menuPortal:e=>_e(_e({},e),{},{zIndex:9999})},n=e.formatMessage({id:"user.settings.languages.dropdown.arialabel",defaultMessage:"Dropdown selector to change the interface language"}),o=r().createElement("div",{key:"changeLanguage"},r().createElement("br",null),r().createElement("label",{"aria-label":n,className:"control-label",id:"changeInterfaceLanguageLabel",htmlFor:"displayLanguage"},r().createElement(c.FormattedMessage,{id:"user.settings.languages.change",defaultMessage:"Change interface language"})),r().createElement("div",{ref:this.reactSelectContainer,className:"pt-2"},r().createElement(Me.Ay,{className:"react-select react-select-top",classNamePrefix:"react-select",ariaLiveMessages:{onFocus:e=>{let{focused:t}=e;return"option ".concat(t.label," focused")},onChange:e=>"option ".concat(e.label," selected")},id:"displayLanguage",menuIsOpen:this.state.openMenu,menuPortalTarget:document.body,styles:i,options:a,isClearable:!1,onChange:this.setLanguage,onKeyDown:this.handleKeyDown,value:this.state.selectedOption,onMenuClose:this.handleMenuClose,onMenuOpen:this.handleMenuOpen,"aria-labelledby":"changeInterfaceLanguageLabel","aria-live":"assertive"}),s),r().createElement("div",null,r().createElement("br",null),r().createElement(c.FormattedMessage,{id:"user.settings.languages.promote1",defaultMessage:"Select which language Mattermost displays in the user interface."}),r().createElement("p",null),r().createElement(c.FormattedMessage,{id:"user.settings.languages.promote2",defaultMessage:"Would you like to help with translations? Join the <link>Mattermost Translation Server</link> to contribute.",values:{link:e=>r().createElement(ee.A,{href:"http://translate.mattermost.com",location:"manage_languages"},e)}})));return r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.display.language",defaultMessage:"Language"}),submit:this.changeLanguage,saving:this.state.isSaving,inputs:[o],updateSection:this.props.updateSection,disableEnterSubmit:!0})}}Ce(we,"propTypes",{locale:i().string.isRequired,updateSection:i().func.isRequired,actions:i().shape({updateMe:i().func.isRequired,patchUser:i().func.isRequired}).isRequired,adminMode:i().bool});const Ne=(0,c.injectIntl)(we),Pe=(0,p.connect)((function(e){return{locales:(0,K.kG)(e)}}),(function(e){return{actions:(0,h.zH)({updateMe:f.Me,patchUser:f.WJ},e)}}))(Ne);function ke(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function Oe(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(s),!0).forEach((function(t){Re(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ke(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function Re(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Ie extends r().PureComponent{constructor(e){super(e),Re(this,"onChange",(e=>{e&&"value"in e&&this.setState({manualTimezone:e.value,selectedOption:e})})),Re(this,"timezoneNotChanged",(()=>{const{useAutomaticTimezone:e,automaticTimezone:t,manualTimezone:s}=this.state,{useAutomaticTimezone:a,automaticTimezone:i,manualTimezone:n}=this.props;return e===a&&t===i&&s===n})),Re(this,"changeTimezone",(()=>{this.timezoneNotChanged()?this.props.updateSection(""):this.submitUser()})),Re(this,"submitUser",(()=>{const{user:e}=this.props,{useAutomaticTimezone:t,automaticTimezone:s,manualTimezone:a}=this.state,i={useAutomaticTimezone:t.toString(),automaticTimezone:s,manualTimezone:a},n=Oe(Oe({},e),{},{timezone:i});(this.props.adminMode?this.props.actions.patchUser:this.props.actions.updateMe)(n).then((e=>{if("data"in e)this.props.updateSection("");else if("error"in e){const{error:t}=e;let s;s=t instanceof Error?t.message:t,this.setState({serverError:s,isSaving:!1})}}))})),Re(this,"handleAutomaticTimezone",(e=>{const t=e.target.checked;let s,a,i="";t?(i=(0,ye.C7)(),s=(0,J.Ug)(this.props.timezones,i),a=i):(s=(0,J.Ug)(this.props.timezones,(0,ye.C7)()),a=(0,ye.C7)(),this.setState({manualTimezone:(0,ye.C7)()})),this.setState({useAutomaticTimezone:t,automaticTimezone:i,selectedOption:{label:s,value:a}})})),this.state={useAutomaticTimezone:e.useAutomaticTimezone,automaticTimezone:e.automaticTimezone,manualTimezone:e.manualTimezone,isSaving:!1,openMenu:!1,selectedOption:{label:e.timezoneLabel,value:e.useAutomaticTimezone?e.automaticTimezone:e.manualTimezone}}}render(){const{timezones:e}=this.props,{useAutomaticTimezone:t}=this.state;let s,a=0;const i=this.props.timezones.map((e=>{var t;return e.utc[a]===(null===(t=s)||void 0===t?void 0:t.utc[a])?a++:a=0===a?a:0,s=e,{value:e.utc[a],label:e.text}}));let n;this.state.serverError&&(n=r().createElement("label",{className:"has-error"},this.state.serverError));const o=[],l={menuPortal:e=>Oe(Oe({},e),{},{zIndex:9999})},d=0===e.length,u=r().createElement("div",{className:"checkbox",key:1},r().createElement("label",null,r().createElement("input",{id:"automaticTimezoneInput",type:"checkbox",checked:t,onChange:this.handleAutomaticTimezone,disabled:d}),r().createElement(c.FormattedMessage,{id:"user.settings.timezones.automatic",defaultMessage:"Automatic"}))),m=r().createElement("div",{className:"pt-2",key:2},r().createElement(Me.Ay,{className:"react-select react-select-top",classNamePrefix:"react-select",id:"displayTimezone",menuPortalTarget:document.body,styles:l,options:i,isClearable:!1,onChange:this.onChange,value:this.state.selectedOption,"aria-labelledby":"changeInterfaceTimezoneLabel",isDisabled:t}),n);return o.push(u),o.push(m),o.push(r().createElement("div",{key:3},r().createElement("br",null),r().createElement(c.FormattedMessage,{id:"user.settings.timezones.promote",defaultMessage:"Select the time zone used for timestamps in the user interface and email notifications."}))),r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.display.timezone",defaultMessage:"Timezone"}),containerStyle:"timezone-container",submit:this.changeTimezone,saving:this.state.isSaving,inputs:o,updateSection:this.props.updateSection,disableEnterSubmit:!0})}}Re(Ie,"propTypes",{updateSection:i().func.isRequired,useAutomaticTimezone:i().bool.isRequired,automaticTimezone:i().string.isRequired,manualTimezone:i().string.isRequired,timezones:i().array.isRequired,timezoneLabel:i().string.isRequired,actions:i().shape({updateMe:i().func.isRequired,patchUser:i().func.isRequired}).isRequired,adminMode:i().bool});const De=(0,p.connect)((function(e){const t=(0,W.nQ)(e);return{timezones:Y,timezoneLabel:t}}),(function(e){return{actions:(0,h.zH)({updateMe:f.Me,patchUser:f.WJ},e)}}))(Ie),Le=e=>{let{user:t,renderEmoticonsAsEmoji:s,updateSection:a,actions:i}=e;const[o,l]=(0,n.useState)(s),[d,u]=(0,n.useState)(!1),m=(0,n.useCallback)((e=>{l(e.currentTarget.value)}),[]),p=(0,n.useCallback)((()=>{u(!0);const e={user_id:t.id,category:C.pm.CATEGORY_DISPLAY_SETTINGS,name:C.pm.RENDER_EMOTICONS_AS_EMOJI,value:o};i.savePreferences(t.id,[e]),u(!1),a("")}),[t.id,a,i,o]),h=(0,n.useCallback)((()=>{o!==s?p():a("")}),[s,a,o,p]),g=r().createElement("fieldset",{key:"renderEmoticonsAsEmojiSetting"},r().createElement("legend",{className:"form-legend hidden-label"},r().createElement(c.FormattedMessage,{id:"user.settings.display.renderEmoticonsAsEmojiTitle",defaultMessage:"Render emoticons as emojis"})),[{option:"true",inputId:"renderEmoticonsAsEmojiOn",messageId:"user.settings.advance.on",defaultMessage:"On"},{option:"false",inputId:"renderEmoticonsAsEmojiOff",messageId:"user.settings.advance.off",defaultMessage:"Off"}].map((e=>{let{option:t,inputId:s,messageId:a,defaultMessage:i}=e;return r().createElement("div",{className:"radio",key:t},r().createElement("label",null,r().createElement("input",{id:s,type:"radio",name:"renderEmoticonsAsEmoji",value:t,checked:o===t,onChange:m}),r().createElement(c.FormattedMessage,{id:a,defaultMessage:i})),r().createElement("br",null))})),r().createElement("div",{className:"mt-5"},r().createElement(c.FormattedMessage,{id:"user.settings.display.renderEmoticonsAsEmojiDesc",defaultMessage:"When enabled, text emoticons in messages will be rendered as emojis (For example :D as 😄)"})));return r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.display.renderEmoticonsAsEmojiTitle",defaultMessage:"Render emoticons as emojis"}),inputs:[g],submit:h,saving:d,updateSection:a,disableEnterSubmit:!0})};Le.propTypes={updateSection:i().func.isRequired,adminMode:i().bool,renderEmoticonsAsEmoji:i().string.isRequired,actions:i().shape({savePreferences:i().func.isRequired}).isRequired};const Fe=Le,xe=(0,p.connect)(null,(function(e){return{actions:(0,h.zH)({savePreferences:g.SF},e)}}))(Fe);function Ue(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function je(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(s),!0).forEach((function(t){qe(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ue(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function qe(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Be=b.Ay.Preferences;function Ge(e){return{militaryTime:e.militaryTime,teammateNameDisplay:e.teammateNameDisplay,availabilityStatusOnPosts:e.availabilityStatusOnPosts,channelDisplayMode:e.channelDisplayMode,messageDisplay:e.messageDisplay,colorizeUsernames:e.colorizeUsernames,collapseDisplay:e.collapseDisplay,collapsedReplyThreads:e.collapsedReplyThreads,linkPreviewDisplay:e.linkPreviewDisplay,lastActiveDisplay:e.lastActiveDisplay.toString(),oneClickReactionsOnPosts:e.oneClickReactionsOnPosts,clickToReply:e.clickToReply}}class ze extends r().PureComponent{constructor(e){super(e),qe(this,"submitLastActive",(()=>{const{user:e,actions:t}=this.props,{lastActiveDisplay:s}=this.state,a=je(je({},e),{},{props:je(je({},e.props),{},{show_last_active:s})});(this.props.adminMode?t.patchUser:t.updateMe)(a).then((e=>{if("data"in e)this.props.updateSection("");else if("error"in e){const{error:t}=e;let s;s=t instanceof Error?t.message:t,this.setState({serverError:s,isSaving:!1})}}))})),qe(this,"handleSubmit",(async()=>{const e=this.props.user.id,t={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.USE_MILITARY_TIME,value:this.state.militaryTime},s={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.AVAILABILITY_STATUS_ON_POSTS,value:this.state.availabilityStatusOnPosts},a={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.NAME_NAME_FORMAT,value:this.state.teammateNameDisplay},i={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.CHANNEL_DISPLAY_MODE,value:this.state.channelDisplayMode},n={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.MESSAGE_DISPLAY,value:this.state.messageDisplay},r={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.COLORIZE_USERNAMES,value:this.state.colorizeUsernames},o={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.COLLAPSE_DISPLAY,value:this.state.collapseDisplay},l={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.COLLAPSED_REPLY_THREADS,value:this.state.collapsedReplyThreads},c={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.LINK_PREVIEW_DISPLAY,value:this.state.linkPreviewDisplay},d={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.ONE_CLICK_REACTIONS_ENABLED,value:this.state.oneClickReactionsOnPosts},u={user_id:e,category:Be.CATEGORY_DISPLAY_SETTINGS,name:Be.CLICK_TO_REPLY,value:this.state.clickToReply};this.setState({isSaving:!0});const m=[t,i,n,l,u,o,c,a,s,d,r];await this.props.actions.savePreferences(e,m),this.updateSection("")})),qe(this,"handleClockRadio",(e=>{this.setState({militaryTime:e})})),qe(this,"handleTeammateNameDisplayRadio",(e=>{this.setState({teammateNameDisplay:e})})),qe(this,"handleAvailabilityStatusRadio",(e=>{this.setState({availabilityStatusOnPosts:e})})),qe(this,"handleOneClickReactionsRadio",(e=>{this.setState({oneClickReactionsOnPosts:e})})),qe(this,"handleClickToReplyRadio",(e=>{this.setState({clickToReply:e})})),qe(this,"updateSection",(e=>{this.updateState(),this.props.updateSection(e)})),qe(this,"updateState",(()=>{const e=Ge(this.props);Q()(e,this.state)||this.setState(e),this.setState({isSaving:!1})})),this.state=je(je({},Ge(e)),{},{isSaving:!1}),this.prevSections={theme:"dummySectionName",clock:"theme",linkpreview:"clock",message_display:"linkpreview",channel_display_mode:"message_display",languages:"channel_display_mode"}}componentDidMount(){const{actions:e,shouldAutoUpdateTimezone:t}=this.props;t&&e.autoUpdateTimezone((0,ye.C7)())}componentDidUpdate(e){this.props.teammateNameDisplay!==e.teammateNameDisplay&&this.updateState()}handleChannelDisplayModeRadio(e){this.setState({channelDisplayMode:e})}handlemessageDisplayRadio(e){this.setState({messageDisplay:e})}handleCollapseRadio(e){this.setState({collapseDisplay:e})}handleCollapseReplyThreadsRadio(e){this.setState({collapsedReplyThreads:e})}handleLastActiveRadio(e){this.setState({lastActiveDisplay:e})}handleLinkPreviewRadio(e){this.setState({linkPreviewDisplay:e})}handleOnChange(e,t){this.setState(je({},t)),(0,_.b6)(e.currentTarget)}createSection(e){var t,s;const{section:a,display:i,value:n,title:o,firstOption:l,secondOption:d,thirdOption:u,description:m,disabled:p,onSubmit:h}=e;let g=null,f=h||this.handleSubmit;const E=r().createElement(c.FormattedMessage,{id:l.radionButtonText.label.id,defaultMessage:l.radionButtonText.label.defaultMessage});let v,S;null!==(t=l.radionButtonText.more)&&void 0!==t&&t.id&&(v=": ",S=r().createElement("span",{className:"font-weight--normal"},r().createElement(c.FormattedMessage,{id:l.radionButtonText.more.id,defaultMessage:l.radionButtonText.more.defaultMessage})));const b=r().createElement(c.FormattedMessage,{id:d.radionButtonText.label.id,defaultMessage:d.radionButtonText.label.defaultMessage});let y,T;null!==(s=d.radionButtonText.more)&&void 0!==s&&s.id&&(y=r().createElement("span",{className:"font-weight--normal"},r().createElement(c.FormattedMessage,{id:d.radionButtonText.more.id,defaultMessage:d.radionButtonText.more.defaultMessage}))),u&&(T=r().createElement(c.FormattedMessage,{id:u.radionButtonText.label.id,defaultMessage:u.radionButtonText.label.defaultMessage}));const _=r().createElement(c.FormattedMessage,{id:o.id,defaultMessage:o.defaultMessage}),C=r().createElement(c.FormattedMessage,{id:m.id,defaultMessage:m.defaultMessage}),w=this.props.activeSection===a;let N,P=null;if(w){const e=[!1,!1,!1];let t;n===l.value?(e[0]=!0,t=l.childOption):n===d.value?(e[1]=!0,t=d.childOption):(e[2]=!0,u&&(t=u.childOption));const s=a+"Format",o=a+"UserDisplay",m={[i]:l.value},h={[i]:d.value};let M,w;if(u&&T){const t={[i]:u.value};M=r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:s+"C",type:"radio",name:s,checked:e[2],onChange:e=>this.handleOnChange(e,t)}),T),r().createElement("br",null))}if(t){const e=t.display;w=r().createElement("div",{className:"checkbox"},r().createElement("hr",null),r().createElement("label",null,r().createElement("input",{id:s+"childOption",type:"checkbox",name:t.label.id,checked:"true"===t.value,onChange:t=>{this.handleOnChange(t,{[e]:t.target.checked?"true":"false"})}}),r().createElement(c.FormattedMessage,{id:t.label.id,defaultMessage:t.label.defaultMessage}),v,r().createElement("span",{className:"font-weight--normal"},r().createElement(c.FormattedMessage,{id:t.more.id,defaultMessage:t.more.defaultMessage}))),r().createElement("br",null))}let N=[r().createElement("fieldset",{key:o},r().createElement("legend",{className:"form-legend hidden-label"},_),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:s+"A",type:"radio",name:s,checked:e[0],onChange:e=>this.handleOnChange(e,m)}),E,v,S),r().createElement("br",null)),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{id:s+"B",type:"radio",name:s,checked:e[1],onChange:e=>this.handleOnChange(e,h)}),b,v,y),r().createElement("br",null)),M,r().createElement("div",null,r().createElement("br",null),C),w)];"teammateNameDisplay"===i&&p&&(g=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.display.teammateNameDisplay",defaultMessage:"This field is handled through your System Administrator. If you want to change it, you need to do so through your System Administrator."})),f=null,N=[]),P=r().createElement(A.A,{title:_,inputs:N,submit:f,saving:this.state.isSaving,serverError:this.state.serverError,extraInfo:g,updateSection:this.updateSection})}return N=n===l.value?E:n===d.value?b:T,r().createElement("div",null,r().createElement(M.A,{active:w,areAllSectionsInactive:""===this.props.activeSection,title:_,describe:N,section:a,updateSection:this.updateSection,max:P}),r().createElement("div",{className:"divider-dark"}))}render(){const e=this.createSection({section:"collapse",display:"collapseDisplay",value:this.state.collapseDisplay,defaultDisplay:"false",title:(0,c.defineMessage)({id:"user.settings.display.collapseDisplay",defaultMessage:"Default Appearance of Image Previews"}),firstOption:{value:"false",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.collapseOn",defaultMessage:"Expanded"})}},secondOption:{value:"true",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.collapseOff",defaultMessage:"Collapsed"})}},description:(0,c.defineMessage)({id:"user.settings.display.collapseDesc",defaultMessage:"Set whether previews of image links and image attachment thumbnails show as expanded or collapsed by default. This setting can also be controlled using the slash commands /expand and /collapse."})});let t=null;this.props.enableLinkPreviews?(t=this.createSection({section:"linkpreview",display:"linkPreviewDisplay",value:this.state.linkPreviewDisplay,defaultDisplay:"true",title:(0,c.defineMessage)({id:"user.settings.display.linkPreviewDisplay",defaultMessage:"Website Link Previews"}),firstOption:{value:"true",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.linkPreviewOn",defaultMessage:"On"})}},secondOption:{value:"false",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.linkPreviewOff",defaultMessage:"Off"})}},description:(0,c.defineMessage)({id:"user.settings.display.linkPreviewDesc",defaultMessage:"When available, the first web link in a message will show a preview of the website content below the message."})}),this.prevSections.message_display="linkpreview"):this.prevSections.message_display=this.prevSections.linkpreview;let s=null;this.props.lastActiveTimeEnabled&&(s=this.createSection({section:"lastactive",display:"lastActiveDisplay",value:this.state.lastActiveDisplay,defaultDisplay:"true",title:(0,c.defineMessage)({id:"user.settings.display.lastActiveDisplay",defaultMessage:"Share last active time"}),firstOption:{value:"true",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.lastActiveOn",defaultMessage:"On"})}},secondOption:{value:"false",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.lastActiveOff",defaultMessage:"Off"})}},description:(0,c.defineMessage)({id:"user.settings.display.lastActiveDesc",defaultMessage:"When enabled, other users will see when you were last active."}),onSubmit:this.submitLastActive}));const a=this.createSection({section:"clock",display:"militaryTime",value:this.state.militaryTime,defaultDisplay:"false",title:(0,c.defineMessage)({id:"user.settings.display.clockDisplay",defaultMessage:"Clock Display"}),firstOption:{value:"false",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.normalClock",defaultMessage:"12-hour clock (example: 4:00 PM)"})}},secondOption:{value:"true",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.militaryClock",defaultMessage:"24-hour clock (example: 16:00)"})}},description:(0,c.defineMessage)({id:"user.settings.display.preferTime",defaultMessage:"Select how you prefer time displayed."})}),i=this.createSection({section:Be.NAME_NAME_FORMAT,display:"teammateNameDisplay",value:this.props.lockTeammateNameDisplay?this.props.configTeammateNameDisplay:this.state.teammateNameDisplay,defaultDisplay:this.props.configTeammateNameDisplay,title:(0,c.defineMessage)({id:"user.settings.display.teammateNameDisplayTitle",defaultMessage:"Teammate Name Display"}),firstOption:{value:b.Ay.TEAMMATE_NAME_DISPLAY.SHOW_USERNAME,radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.teammateNameDisplayUsername",defaultMessage:"Show username"})}},secondOption:{value:b.Ay.TEAMMATE_NAME_DISPLAY.SHOW_NICKNAME_FULLNAME,radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.teammateNameDisplayNicknameFullname",defaultMessage:"Show nickname if one exists, otherwise show first and last name"})}},thirdOption:{value:b.Ay.TEAMMATE_NAME_DISPLAY.SHOW_FULLNAME,radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.teammateNameDisplayFullname",defaultMessage:"Show first and last name"})}},description:(0,c.defineMessage)({id:"user.settings.display.teammateNameDisplayDescription",defaultMessage:"Set how to display other user's names in posts and the Direct Messages list."}),disabled:this.props.lockTeammateNameDisplay}),n=this.createSection({section:"availabilityStatus",display:"availabilityStatusOnPosts",value:this.state.availabilityStatusOnPosts,defaultDisplay:"true",title:(0,c.defineMessage)({id:"user.settings.display.availabilityStatusOnPostsTitle",defaultMessage:"Show user availability on posts"}),firstOption:{value:"true",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.sidebar.on",defaultMessage:"On"})}},secondOption:{value:"false",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.sidebar.off",defaultMessage:"Off"})}},description:(0,c.defineMessage)({id:"user.settings.display.availabilityStatusOnPostsDescription",defaultMessage:"When enabled, online availability is displayed on profile images in the message list."})});let o;if(!this.props.shouldAutoUpdateTimezone){const e=this.props.userTimezone,t="timezone"===this.props.activeSection;let s=null;t&&(s=r().createElement(De,{user:this.props.user,useAutomaticTimezone:Boolean(e.useAutomaticTimezone),automaticTimezone:e.automaticTimezone,manualTimezone:e.manualTimezone,updateSection:this.updateSection,adminMode:this.props.adminMode})),o=r().createElement("div",null,r().createElement(M.A,{active:t,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,{id:"user.settings.display.timezone",defaultMessage:"Timezone"}),describe:this.props.timezoneLabel,section:"timezone",updateSection:this.updateSection,max:s}),r().createElement("div",{className:"divider-dark"}))}const l=this.createSection({section:Be.MESSAGE_DISPLAY,display:"messageDisplay",value:this.state.messageDisplay,defaultDisplay:Be.MESSAGE_DISPLAY_CLEAN,title:(0,c.defineMessage)({id:"user.settings.display.messageDisplayTitle",defaultMessage:"Message Display"}),firstOption:{value:Be.MESSAGE_DISPLAY_CLEAN,radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.messageDisplayClean",defaultMessage:"Standard"}),more:(0,c.defineMessage)({id:"user.settings.display.messageDisplayCleanDes",defaultMessage:"Easy to scan and read."})}},secondOption:{value:Be.MESSAGE_DISPLAY_COMPACT,radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.messageDisplayCompact",defaultMessage:"Compact"}),more:(0,c.defineMessage)({id:"user.settings.display.messageDisplayCompactDes",defaultMessage:"Fit as many messages on the screen as we can."})},childOption:{label:(0,c.defineMessage)({id:"user.settings.display.colorize",defaultMessage:"Colorize usernames"}),value:this.state.colorizeUsernames,display:"colorizeUsernames",more:(0,c.defineMessage)({id:"user.settings.display.colorizeDes",defaultMessage:"Use colors to distinguish users in compact mode"})}},description:(0,c.defineMessage)({id:"user.settings.display.messageDisplayDescription",defaultMessage:"Select how messages in a channel should be displayed."})});let d;this.props.collapsedReplyThreadsAllowUserPreference&&(d=this.createSection({section:Be.COLLAPSED_REPLY_THREADS,display:"collapsedReplyThreads",value:this.state.collapsedReplyThreads,defaultDisplay:Be.COLLAPSED_REPLY_THREADS_FALLBACK_DEFAULT,title:(0,c.defineMessage)({id:"user.settings.display.collapsedReplyThreadsTitle",defaultMessage:"Threaded Discussions"}),firstOption:{value:Be.COLLAPSED_REPLY_THREADS_ON,radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.collapsedReplyThreadsOn",defaultMessage:"On"})}},secondOption:{value:Be.COLLAPSED_REPLY_THREADS_OFF,radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.collapsedReplyThreadsOff",defaultMessage:"Off"})}},description:(0,c.defineMessage)({id:"user.settings.display.collapsedReplyThreadsDescription",defaultMessage:"When enabled, reply messages are not shown in the channel and you'll be notified about threads you're following in the \"Threads\" view."})}));const u=this.createSection({section:Be.CLICK_TO_REPLY,display:"clickToReply",value:this.state.clickToReply,defaultDisplay:"true",title:(0,c.defineMessage)({id:"user.settings.display.clickToReply",defaultMessage:"Click to open threads"}),firstOption:{value:"true",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.sidebar.on",defaultMessage:"On"})}},secondOption:{value:"false",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.sidebar.off",defaultMessage:"Off"})}},description:(0,c.defineMessage)({id:"user.settings.display.clickToReplyDescription",defaultMessage:"When enabled, click anywhere on a message to open the reply thread."})}),m=this.createSection({section:Be.CHANNEL_DISPLAY_MODE,display:"channelDisplayMode",value:this.state.channelDisplayMode,defaultDisplay:Be.CHANNEL_DISPLAY_MODE_FULL_SCREEN,title:(0,c.defineMessage)({id:"user.settings.display.channelDisplayTitle",defaultMessage:"Channel Display"}),firstOption:{value:Be.CHANNEL_DISPLAY_MODE_FULL_SCREEN,radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.fullScreen",defaultMessage:"Full width"})}},secondOption:{value:Be.CHANNEL_DISPLAY_MODE_CENTERED,radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.display.fixedWidthCentered",defaultMessage:"Fixed width, centered"})}},description:(0,c.defineMessage)({id:"user.settings.display.channeldisplaymode",defaultMessage:"Select the width of the center channel."})});let p;const h=this.props.userLocale,g=(0,K.vL)(h).name;let f,E;p=r().createElement("div",null,r().createElement(M.A,{active:"languages"===this.props.activeSection,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,{id:"user.settings.display.language",defaultMessage:"Language"}),describe:g,section:"languages",updateSection:this.updateSection,max:r().createElement(Pe,{user:this.props.user,locale:h,updateSection:this.updateSection,adminMode:this.props.adminMode})}),r().createElement("div",{className:"divider-dark"})),1===Object.keys(this.props.locales).length&&(p=null),this.props.enableThemeSelection&&!this.props.adminMode&&(f=r().createElement("div",null,r().createElement(be,{selected:"theme"===this.props.activeSection,areAllSectionsInactive:""===this.props.activeSection,updateSection:this.updateSection,setRequireConfirm:this.props.setRequireConfirm,allowCustomThemes:this.props.allowCustomThemes}),r().createElement("div",{className:"divider-dark"}))),this.props.emojiPickerEnabled&&(E=this.createSection({section:Be.ONE_CLICK_REACTIONS_ENABLED,display:"oneClickReactionsOnPosts",value:this.state.oneClickReactionsOnPosts,defaultDisplay:"true",title:(0,c.defineMessage)({id:"user.settings.display.oneClickReactionsOnPostsTitle",defaultMessage:"Quick reactions on messages"}),firstOption:{value:"true",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.sidebar.on",defaultMessage:"On"})}},secondOption:{value:"false",radionButtonText:{label:(0,c.defineMessage)({id:"user.settings.sidebar.off",defaultMessage:"Off"})}},description:(0,c.defineMessage)({id:"user.settings.display.oneClickReactionsOnPostsDescription",defaultMessage:"When enabled, you can react in one-click with recently used reactions when hovering over a message."})}));const v=r().createElement("div",null,r().createElement(M.A,{active:"renderEmoticonsAsEmoji"===this.props.activeSection,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,{id:"user.settings.display.renderEmoticonsAsEmojiTitle",defaultMessage:"Render emoticons as emojis"}),describe:"true"===this.props.renderEmoticonsAsEmoji?r().createElement(c.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"}):r().createElement(c.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"}),section:"renderEmoticonsAsEmoji",updateSection:this.updateSection,max:r().createElement(xe,{renderEmoticonsAsEmoji:this.props.renderEmoticonsAsEmoji,user:this.props.user,updateSection:this.updateSection,adminMode:this.props.adminMode,userPreferences:this.props.userPreferences})}),r().createElement("div",{className:"divider-dark"}));return r().createElement("div",{id:"displaySettings","aria-labelledby":"displayButton",role:"tabpanel"},r().createElement(x.A,{closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,text:r().createElement(c.FormattedMessage,{id:"user.settings.display.title",defaultMessage:"Display Settings"})}),r().createElement("div",{className:"user-settings"},r().createElement(F.A,{id:"displaySettingsTitle",text:r().createElement(c.FormattedMessage,{id:"user.settings.display.title",defaultMessage:"Display Settings"})}),r().createElement("div",{className:"divider-dark first"}),f,d,a,i,n,s,o,t,e,l,u,m,E,v,p))}}qe(ze,"propTypes",{adminMode:i().bool,updateSection:i().func.isRequired,activeSection:i().string,closeModal:i().func.isRequired,collapseModal:i().func.isRequired,setRequireConfirm:i().func,timezones:i().array.isRequired,allowCustomThemes:i().bool.isRequired,enableLinkPreviews:i().bool.isRequired,userLocale:i().string.isRequired,enableThemeSelection:i().bool.isRequired,configTeammateNameDisplay:i().string.isRequired,shouldAutoUpdateTimezone:i().oneOfType([i().bool,i().string]).isRequired,lockTeammateNameDisplay:i().bool.isRequired,militaryTime:i().string.isRequired,teammateNameDisplay:i().string.isRequired,availabilityStatusOnPosts:i().string.isRequired,channelDisplayMode:i().string.isRequired,messageDisplay:i().string.isRequired,colorizeUsernames:i().string.isRequired,collapseDisplay:i().string.isRequired,collapsedReplyThreads:i().string.isRequired,collapsedReplyThreadsAllowUserPreference:i().bool.isRequired,clickToReply:i().string.isRequired,linkPreviewDisplay:i().string.isRequired});const Ye=(0,p.connect)((function(){return(e,t)=>{var s;const a=(0,E.zj)(e),i=(0,S.WR)(e),n=t.adminMode?(0,W.zx)(t.user):(0,W.GR)(e),r=n&&n.useAutomaticTimezone&&!n.automaticTimezone,o=!n||r,l=t.adminMode?(0,W.YU)((0,J.os)(n)):(0,W.nQ)(e),c="true"===a.AllowCustomThemes,d="true"===a.EnableLinkPreviews,u="true"===a.EnableThemeSelection,m="true"===(0,E.Ay)(e).LockTeammateNameDisplay&&"true"===a.LockTeammateNameDisplay,p=a.TeammateNameDisplay,h="true"===a.EnableEmojiPicker,g="true"===a.EnableLastActiveTime,f=t.adminMode&&t.userPreferences?t.userPreferences:void 0;let y=!0;"false"===(null===(s=(t.adminMode?t.user:(0,S.wz)(e,i)).props)||void 0===s?void 0:s.show_last_active)&&(y=!1);let M=t.user.locale;return(0,K.IU)(e,M)||(M=a.DefaultClientLocale),{lockTeammateNameDisplay:m,allowCustomThemes:c,configTeammateNameDisplay:p,enableLinkPreviews:d,locales:(0,K.kG)(e),userLocale:M,enableThemeSelection:u,timezones:Y,timezoneLabel:l,userTimezone:n,shouldAutoUpdateTimezone:o,availabilityStatusOnPosts:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.AVAILABILITY_STATUS_ON_POSTS,b.pm.AVAILABILITY_STATUS_ON_POSTS_DEFAULT,f),militaryTime:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.USE_MILITARY_TIME,b.pm.USE_MILITARY_TIME_DEFAULT,f),teammateNameDisplay:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.NAME_NAME_FORMAT,p,f),channelDisplayMode:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.CHANNEL_DISPLAY_MODE,b.pm.CHANNEL_DISPLAY_MODE_DEFAULT,f),messageDisplay:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.MESSAGE_DISPLAY,b.pm.MESSAGE_DISPLAY_DEFAULT,f),colorizeUsernames:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.COLORIZE_USERNAMES,b.pm.COLORIZE_USERNAMES_DEFAULT,f),collapseDisplay:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.COLLAPSE_DISPLAY,b.pm.COLLAPSE_DISPLAY_DEFAULT,f),collapsedReplyThreadsAllowUserPreference:(0,v.Vu)(e)&&(0,E.zj)(e).CollapsedThreads!==V.$I.ALWAYS_ON,collapsedReplyThreads:(0,v.QD)(e),clickToReply:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.CLICK_TO_REPLY,b.pm.CLICK_TO_REPLY_DEFAULT,f),linkPreviewDisplay:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.LINK_PREVIEW_DISPLAY,b.pm.LINK_PREVIEW_DISPLAY_DEFAULT,f),oneClickReactionsOnPosts:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.ONE_CLICK_REACTIONS_ENABLED,b.pm.ONE_CLICK_REACTIONS_ENABLED_DEFAULT,f),renderEmoticonsAsEmoji:(0,v.Jt)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.RENDER_EMOTICONS_AS_EMOJI,b.pm.RENDER_EMOTICONS_AS_EMOJI_DEFAULT,f),emojiPickerEnabled:h,lastActiveDisplay:y,lastActiveTimeEnabled:g}}}),(function(e){return{actions:(0,h.zH)({autoUpdateTimezone:H.o,savePreferences:g.SF,updateMe:f.Me,patchUser:f.WJ},e)}}))(ze);s(83931);var Ve=s(1418),He=s(7380),We=s(52231),Je=(s(57406),s(55448),s(1112),s(78546)),Ke=(s(60473),s(36169),s(85990)),Xe=s(55476),Qe=s(68124);function Ze(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function $e(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class et extends n.Component{constructor(e){super(e),$e(this,"handleCancel",(e=>{var t,s;this.setState({removeSrc:!1,setDefaultSrc:!1}),null===(t=(s=this.props).updateSection)||void 0===t||t.call(s,e)})),$e(this,"handleFileSelected",(()=>{this.confirmButton.current&&this.confirmButton.current.focus()})),$e(this,"handleSave",(e=>{var t,s;if(e.preventDefault(),!this.props.loadingPicture)if(this.state.removeSrc)null===(t=(s=this.props).onRemove)||void 0===t||t.call(s);else if(this.state.setDefaultSrc){var a,i;null===(a=(i=this.props).onSetDefault)||void 0===a||a.call(i)}else{var n,r;null===(n=(r=this.props).onSubmit)||void 0===n||n.call(r)}})),$e(this,"handleRemoveSrc",(e=>{e.preventDefault(),this.setState({removeSrc:!0}),this.focusFirstElement()})),$e(this,"handleSetDefaultSrc",(e=>{e.preventDefault(),this.setState({setDefaultSrc:!0}),this.focusFirstElement()})),$e(this,"handleFileChange",(e=>{var t,s;this.setState({removeSrc:!1,setDefaultSrc:!1}),null===(t=(s=this.props).onFileChange)||void 0===t||t.call(s,e)})),$e(this,"handleInputFile",(()=>{this.selectInput.current&&(this.selectInput.current.value="",this.selectInput.current.click())})),$e(this,"setPicture",(e=>{if(e){this.previewBlob=URL.createObjectURL(e);const t=new FileReader;t.onload=e=>{const t=Qe.hM(e.target.result),s=Qe.R6(t);this.setState({image:this.previewBlob,orientationStyles:s})},t.readAsArrayBuffer(e)}})),$e(this,"renderImg",(()=>{const e=this.props.imageContext;if(this.props.file){const t=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(s),!0).forEach((function(t){$e(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ze(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({backgroundImage:"url("+this.state.image+")"},this.state.orientationStyles);return r().createElement("div",{className:"".concat(e,"-img-preview")},r().createElement("div",{className:"img-preview__image"},r().createElement("div",{style:t,className:"".concat(e,"-img-preview")})))}if(this.state.setDefaultSrc)return r().createElement("img",{className:"".concat(e,"-img"),alt:"".concat(e," image"),src:this.props.defaultImageSrc});if(this.props.src&&!this.state.removeSrc){var t;const s=r().createElement("img",{className:"".concat(e,"-img"),alt:"".concat(e," image"),src:this.props.src});if(!this.props.onRemove&&!this.props.onSetDefault)return s;let a,i;return this.props.onRemove?(a=r().createElement(c.FormattedMessage,{id:"setting_picture.remove",defaultMessage:"Remove This Icon"}),i=this.handleRemoveSrc):this.props.onSetDefault&&(a=r().createElement(c.FormattedMessage,{id:"setting_picture.remove_profile_picture",defaultMessage:"Remove Profile Picture"}),i=this.handleSetDefaultSrc),r().createElement("div",{className:"".concat(e,"-img__container")},r().createElement("div",{className:"img-preview__image","aria-hidden":!0},s),r().createElement(se.A,{title:null!==(t=a)&&void 0!==t?t:"",disabled:!a},r().createElement("button",{"data-testid":"removeSettingPicture",className:"".concat(e,"-img__remove"),onClick:i},r().createElement("span",{"aria-hidden":!0},"×"),r().createElement("span",{className:"sr-only"},a))))}return null})),this.settingList=(0,n.createRef)(),this.selectInput=(0,n.createRef)(),this.confirmButton=(0,n.createRef)(),this.previewBlob=null,this.state={image:null,removeSrc:!1,setDefaultSrc:!1}}focusFirstElement(){var e;null===(e=this.settingList.current)||void 0===e||e.focus()}componentDidMount(){this.focusFirstElement(),this.selectInput.current&&this.selectInput.current.addEventListener("input",this.handleFileSelected)}componentDidUpdate(e){this.props.file&&e.file!==this.props.file&&this.setPicture(this.props.file)}componentWillUnmount(){this.previewBlob&&URL.revokeObjectURL(this.previewBlob),this.selectInput.current&&this.selectInput.current.removeEventListener("input",this.handleFileSelected)}render(){const e=this.renderImg();let t,s,a="btn",i=!1;return this.props.submitActive||this.state.removeSrc||this.state.setDefaultSrc?a+=" btn-primary":(a+=" btn-inactive disabled",i=!0),e&&(t=r().createElement("li",{className:"setting-list-item",role:"presentation"},e)),this.props.onSubmit&&(s=r().createElement("span",null,r().createElement("input",{"data-testid":"uploadPicture",ref:this.selectInput,className:"hidden",accept:b.YM.ACCEPT_STATIC_IMAGE,type:"file",onChange:this.handleFileChange,disabled:this.props.loadingPicture,"aria-hidden":!0,tabIndex:-1}),r().createElement("button",{"data-testid":"inputSettingPictureButton",className:"btn btn-primary btn-file",disabled:this.props.loadingPicture,onClick:this.handleInputFile,"aria-label":(0,_.Vw)({id:"setting_picture.select",defaultMessage:"Select"})},r().createElement(c.FormattedMessage,{id:"setting_picture.select",defaultMessage:"Select"})),r().createElement("button",{tabIndex:i?-1:0,"data-testid":"saveSettingPicture",disabled:i,ref:this.confirmButton,className:a,onClick:this.handleSave,"aria-label":this.props.loadingPicture?(0,_.Vw)({id:"setting_picture.uploading",defaultMessage:"Uploading..."}):(0,_.Vw)({id:"setting_picture.save",defaultMessage:"Save"})},r().createElement(Xe.A,{loading:this.props.loadingPicture,text:(0,c.defineMessage)({id:"setting_picture.uploading",defaultMessage:"Uploading..."})},r().createElement(c.FormattedMessage,{id:"setting_picture.save",defaultMessage:"Save"}))))),r().createElement("section",{className:"section-max form-horizontal"},r().createElement("h4",{className:"col-xs-12 section-title"},this.props.title),r().createElement("div",{className:"col-sm-10 col-sm-offset-2"},r().createElement("div",{className:"setting-list",ref:this.settingList,tabIndex:-1,"aria-label":this.props.title,"aria-describedby":"setting-picture__helptext"},t,r().createElement("div",{id:"setting-picture__helptext",className:"setting-list-item pt-3"},this.props.helpText),r().createElement("div",{className:"setting-list-item"},r().createElement("hr",null),r().createElement(Ke.Ay,{errors:[this.props.clientError,this.props.serverError],type:"modal"}),s,r().createElement("button",{"data-testid":"cancelSettingPicture",className:"btn btn-tertiary theme ml-2",onClick:this.handleCancel,"aria-label":(0,_.Vw)({id:"setting_picture.cancel",defaultMessage:"Cancel"})},r().createElement(c.FormattedMessage,{id:"setting_picture.cancel",defaultMessage:"Cancel"}))))))}}$e(et,"defaultProps",{imageContext:"profile"});var tt=s(98566),st=s(63155);function at(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function it(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?at(Object(s),!0).forEach((function(t){nt(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):at(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function nt(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const rt=(0,c.defineMessages)({usernameReserved:{id:"user.settings.general.usernameReserved",defaultMessage:"This username is reserved, please choose a new one."},usernameGroupNameUniqueness:{id:"user.settings.general.usernameGroupNameUniqueness",defaultMessage:"This username conflicts with an existing group name."},usernameRestrictions:{id:"user.settings.general.usernameRestrictions",defaultMessage:"Username must begin with a letter, and contain between {min} to {max} lowercase characters made up of numbers, letters, and the symbols '.', '-', and '_'."},validEmail:{id:"user.settings.general.validEmail",defaultMessage:"Please enter a valid email address."},validUrl:{id:"user.settings.general.validUrl",defaultMessage:"Please enter a valid url."},emailMatch:{id:"user.settings.general.emailMatch",defaultMessage:"The new emails you entered do not match."},incorrectPassword:{id:"user.settings.general.incorrectPassword",defaultMessage:"Your password is incorrect."},emptyPassword:{id:"user.settings.general.emptyPassword",defaultMessage:"Please enter your current password."},validImage:{id:"user.settings.general.validImage",defaultMessage:"Only BMP, JPG, JPEG, or PNG images may be used for profile pictures"},imageTooLarge:{id:"user.settings.general.imageTooLarge",defaultMessage:"Unable to upload profile image. File is too large."},uploadImage:{id:"user.settings.general.uploadImage",defaultMessage:"Click 'Edit' to upload an image."},uploadImageMobile:{id:"user.settings.general.mobile.uploadImage",defaultMessage:"Click to upload an image"},fullName:{id:"user.settings.general.fullName",defaultMessage:"Full Name"},nickname:{id:"user.settings.general.nickname",defaultMessage:"Nickname"},username:{id:"user.settings.general.username",defaultMessage:"Username"},profilePicture:{id:"user.settings.general.profilePicture",defaultMessage:"Profile Picture"},close:{id:"user.settings.general.close",defaultMessage:"Close"},position:{id:"user.settings.general.position",defaultMessage:"Position"}}),ot={valueContainer:e=>it(it({},e),{},{height:"auto",minHeight:"38px",flexWrap:"wrap",whiteSpace:"normal"}),multiValue:e=>it(it({},e),{},{margin:"2px"}),control:e=>it(it({},e),{},{height:"auto",minHeight:"38px"}),multiValueLabel:e=>it(it({},e),{},{padding:"2px 6px"})};class lt extends n.PureComponent{constructor(e){super(e),nt(this,"submitActive",!1),nt(this,"handleEmailResend",(e=>{this.setState({resendStatus:"sending",showSpinner:!0}),this.props.actions.sendVerificationEmail(e).then((e=>{let{data:t,error:s}=e;t?this.setState({resendStatus:"success"}):s&&this.setState({resendStatus:"failure"})}))})),nt(this,"createEmailResendLink",(e=>r().createElement("span",{className:"resend-verification-wrapper"},r().createElement(Xe.A,{loading:this.state.showSpinner,text:(0,c.defineMessage)({id:"user.settings.general.sending",defaultMessage:"Sending"})},r().createElement("a",{onClick:()=>{this.handleEmailResend(e),setTimeout((()=>{this.setState({showSpinner:!1})}),500)}},r().createElement(c.FormattedMessage,{id:"user.settings.general.sendAgain",defaultMessage:"Send again"})))))),nt(this,"submitUsername",(()=>{const e=Object.assign({},this.props.user),t=this.state.username.trim().toLowerCase();e.username!==t?(e.username=t,this.submitUser(e,!1)):this.updateSection("")})),nt(this,"submitNickname",(()=>{const e=Object.assign({},this.props.user),t=this.state.nickname.trim();e.nickname!==t?(e.nickname=t,this.submitUser(e,!1)):this.updateSection("")})),nt(this,"submitName",(()=>{const e=Object.assign({},this.props.user),t=this.state.firstName.trim(),s=this.state.lastName.trim();e.first_name!==t||e.last_name!==s?(e.first_name=t,e.last_name=s,this.submitUser(e,!1)):this.updateSection("")})),nt(this,"submitEmail",(()=>{const e=Object.assign({},this.props.user),t=this.state.email.trim().toLowerCase(),s=this.state.confirmEmail.trim().toLowerCase(),a=this.state.currentPassword;t!==e.email||""!==s&&s!==e.email?(e.email=t,e.password=a,this.submitUser(e,!0)):this.updateSection("")})),nt(this,"isEmailValid",(()=>{const e=this.state.email.trim().toLowerCase(),t=this.state.confirmEmail.trim().toLowerCase(),s=this.state.currentPassword;return!(""===e||!(0,Je.xf)(e))&&e===t&&""!==s})),nt(this,"submitUser",((e,t)=>{const{formatMessage:s}=this.props.intl;this.setState({sectionIsSaving:!0}),this.props.actions.updateMe(e).then((e=>{let{data:a,error:i}=e;if(a)this.updateSection(""),this.props.requireEmailVerification&&t&&(this.props.actions.clearErrors(),this.props.actions.logError({message:b.Xu.EMAIL_VERIFICATION_REQUIRED,type:b.cn.SUCCESS},{errorBarMode:Ve.tq.Always}));else if(i){let e;e=i.server_error_id&&"api.user.check_user_password.invalid.app_error"===i.server_error_id?s(rt.incorrectPassword):"app.user.group_name_conflict"===i.server_error_id?s(rt.usernameGroupNameUniqueness):i.message?i.message:i,this.setState({serverError:e,emailError:"",sectionIsSaving:!1})}}))})),nt(this,"setDefaultProfilePicture",(async()=>{try{await this.props.actions.setDefaultProfileImage(this.props.user.id),this.updateSection(""),this.submitActive=!1}catch(e){let t;t=e.message?e.message:e,this.setState({serverError:t,emailError:"",pictureError:"",sectionIsSaving:!1})}})),nt(this,"submitPicture",(()=>{if(!this.state.pictureFile)return;if(!this.submitActive)return;const{formatMessage:e}=this.props.intl,t=this.state.pictureFile;b.je.includes(t.type)?t.size>this.props.maxFileSize?this.setState({pictureError:e(rt.imageTooLarge),serverError:""}):(this.setState({loadingPicture:!0}),this.props.actions.uploadProfileImage(this.props.user.id,t).then((e=>{let{data:t,error:s}=e;if(t)this.updateSection(""),this.submitActive=!1;else if(s){const e=this.setupInitialState(this.props);e.serverError=s.message,this.setState(e)}}))):this.setState({pictureError:e(rt.validImage),serverError:""})})),nt(this,"submitPosition",(()=>{const e=Object.assign({},this.props.user),t=this.state.position.trim();e.position!==t?(e.position=t,this.submitUser(e,!1)):this.updateSection("")})),nt(this,"submitAttribute",(async e=>{var t;const s=e[0],a=this.props.customProfileAttributeFields.find((e=>e.id===s));if(void 0===a)return;let i=null===(t=this.state.customAttributeValues)||void 0===t?void 0:t[s];if("string"==typeof i&&a.attrs&&a.attrs.value_type){if("email"===a.attrs.value_type&&""!==i&&!(0,Je.xf)(i))return void this.setState({emailError:"",serverError:""});if("url"===a.attrs.value_type&&""!==i){const e=(0,st.hB)(i);if(!e)return void this.setState({emailError:"",serverError:""});let t=e.toString();t.endsWith("/")&&(t=t.slice(0,-1)),i=t}}"multiselect"!==a.type||i||(i=[]),this.setState({sectionIsSaving:!0}),this.props.actions.saveCustomProfileAttribute(this.props.user.id,s,i).then((e=>{let{data:t,error:s}=e;if(t)this.updateSection(""),this.setState({customAttributeValues:it(it({},this.state.customAttributeValues),t)});else if(s){const e=s.message;this.setState({serverError:e,emailError:"",sectionIsSaving:!1})}}))})),nt(this,"updateUsername",(e=>{this.setState({username:e.target.value})})),nt(this,"updateFirstName",(e=>{this.setState({firstName:e.target.value})})),nt(this,"updateLastName",(e=>{this.setState({lastName:e.target.value})})),nt(this,"updateNickname",(e=>{this.setState({nickname:e.target.value})})),nt(this,"updatePosition",(e=>{this.setState({position:e.target.value})})),nt(this,"updateEmail",(e=>{this.setState({email:e.target.value})})),nt(this,"updateConfirmEmail",(e=>{this.setState({confirmEmail:e.target.value})})),nt(this,"updateCurrentPassword",(e=>{this.setState({currentPassword:e.target.value})})),nt(this,"updatePicture",(e=>{e.target.files&&e.target.files[0]?(this.setState({pictureFile:e.target.files[0]}),this.submitActive=!0,this.setState({pictureError:null})):this.setState({pictureFile:null})})),nt(this,"updateSelectAttribute",((e,t,s)=>{const a=it({},this.state.customAttributeValues);e?Array.isArray(e)?a[s]=e.filter((e=>Boolean(e&&Object.hasOwn(e,"value")))).map((e=>e.value)):a[s]="value"in e&&e.value||"":a[s]="",this.setState({customAttributeValues:a})})),nt(this,"updateAttribute",(e=>{const t=Object.assign({},this.state.customAttributeValues);t[e.target.id.substring(e.target.id.indexOf("_")+1)]=e.target.value,this.setState({customAttributeValues:t})})),nt(this,"updateSection",(e=>{this.setState(Object.assign({},this.setupInitialState(this.props),{pictureError:"",serverError:"",emailError:"",sectionIsSaving:!1})),this.submitActive=!1,this.props.updateSection(e)})),nt(this,"createNameSection",(()=>{const e=this.props.user,{formatMessage:t}=this.props.intl,s="name"===this.props.activeSection;let a=null;if(s){const e=[];let s,i=null;if(this.props.user.auth_service===b.YM.LDAP_SERVICE&&(this.props.ldapFirstNameAttributeSet||this.props.ldapLastNameAttributeSet)||this.props.user.auth_service===b.YM.SAML_SERVICE&&(this.props.samlFirstNameAttributeSet||this.props.samlLastNameAttributeSet)||b.YM.OAUTH_SERVICES.includes(this.props.user.auth_service))s=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{e.push(r().createElement("div",{key:"firstNameSetting",className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label",htmlFor:"firstName"},r().createElement(c.FormattedMessage,{id:"user.settings.general.firstName",defaultMessage:"First Name"})),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"firstName",name:"firstName",autoFocus:!0,type:"text",onChange:this.updateFirstName,maxLength:b.YM.MAX_FIRSTNAME_LENGTH,value:this.state.firstName,onFocus:_.G8,"aria-label":t({id:"user.settings.general.firstName",defaultMessage:"First Name"})})))),e.push(r().createElement("div",{key:"lastNameSetting",className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label",htmlFor:"lastName"},r().createElement(c.FormattedMessage,{id:"user.settings.general.lastName",defaultMessage:"Last Name"})),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"lastName",name:"lastName",type:"text",onChange:this.updateLastName,maxLength:b.YM.MAX_LASTNAME_LENGTH,value:this.state.lastName,"aria-label":t({id:"user.settings.general.lastName",defaultMessage:"Last Name"})}))));const a=e=>{e.preventDefault(),this.updateSection(""),this.props.updateTab("notifications")},n=r().createElement("a",{href:"#",onClick:a.bind(this)},r().createElement(c.FormattedMessage,{id:"user.settings.general.notificationsLink",defaultMessage:"Notifications"}));s=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.notificationsExtra",defaultMessage:"By default, you will receive mention notifications when someone types your first name. Go to {notify} settings to change this default.",values:{notify:n}})),i=this.submitName}a=r().createElement(A.A,{title:t(rt.fullName),inputs:e,submit:i,saving:this.state.sectionIsSaving,serverError:this.state.serverError,updateSection:this.updateSection,extraInfo:s})}let i="";return e.first_name&&e.last_name?i=e.first_name+" "+e.last_name:e.first_name?i=e.first_name:e.last_name?i=e.last_name:(i=r().createElement(c.FormattedMessage,{id:"user.settings.general.emptyName",defaultMessage:"Click 'Edit' to add your full name"}),this.props.isMobileView&&(i=r().createElement(c.FormattedMessage,{id:"user.settings.general.mobile.emptyName",defaultMessage:"Click to add your full name"}))),r().createElement(M.A,{active:s,areAllSectionsInactive:""===this.props.activeSection,title:t(rt.fullName),describe:i,section:"name",updateSection:this.updateSection,max:a})})),nt(this,"createNicknameSection",(()=>{const e=this.props.user,{formatMessage:t}=this.props.intl,s="nickname"===this.props.activeSection;let a=null;if(s){const e=[];let s,i=null;if("ldap"===this.props.user.auth_service&&this.props.ldapNicknameAttributeSet||this.props.user.auth_service===b.YM.SAML_SERVICE&&this.props.samlNicknameAttributeSet)s=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{let a=r().createElement(c.FormattedMessage,{id:"user.settings.general.nickname",defaultMessage:"Nickname"});this.props.isMobileView&&(a=""),e.push(r().createElement("div",{key:"nicknameSetting",className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label"},a),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"nickname",name:"nickname",autoFocus:!0,type:"text",onChange:this.updateNickname,value:this.state.nickname,maxLength:b.YM.MAX_NICKNAME_LENGTH,autoCapitalize:"off","aria-label":t({id:"user.settings.general.nickname",defaultMessage:"Nickname"})})))),s=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.nicknameExtra",defaultMessage:"Use Nickname for a name you might be called that is different from your first name and username. This is most often used when two or more people have similar sounding names and usernames."})),i=this.submitNickname}a=r().createElement(A.A,{title:t(rt.nickname),inputs:e,submit:i,saving:this.state.sectionIsSaving,serverError:this.state.serverError,updateSection:this.updateSection,extraInfo:s})}let i="";return e.nickname?i=e.nickname:(i=r().createElement(c.FormattedMessage,{id:"user.settings.general.emptyNickname",defaultMessage:"Click 'Edit' to add a nickname"}),this.props.isMobileView&&(i=r().createElement(c.FormattedMessage,{id:"user.settings.general.mobile.emptyNickname",defaultMessage:"Click to add a nickname"}))),r().createElement(M.A,{active:s,areAllSectionsInactive:""===this.props.activeSection,title:t(rt.nickname),describe:i,section:"nickname",updateSection:this.updateSection,max:a})})),nt(this,"createUsernameSection",(()=>{const{formatMessage:e}=this.props.intl,t="username"===this.props.activeSection;let s=null;if(t){const t=[];let a,i=null;if(""===this.props.user.auth_service){let s=r().createElement(c.FormattedMessage,{id:"user.settings.general.username",defaultMessage:"Username"});this.props.isMobileView&&(s=""),t.push(r().createElement("div",{key:"usernameSetting",className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label"},s),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"username",name:"username",autoFocus:!0,maxLength:b.YM.MAX_USERNAME_LENGTH,type:"text",onChange:this.updateUsername,value:this.state.username,autoCapitalize:"off",onFocus:_.G8,"aria-label":e({id:"user.settings.general.username",defaultMessage:"Username"}),validate:t=>{const s=_.Bs(t);if(s)return s.id===b.vJ.RESERVED_NAME?{type:"error",value:e(rt.usernameReserved)}:{type:"error",value:e(rt.usernameRestrictions,{min:b.YM.MIN_USERNAME_LENGTH,max:b.YM.MAX_USERNAME_LENGTH})}}})))),a=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.usernameInfo",defaultMessage:"Pick something easy for teammates to recognize and recall."})),i=this.submitUsername}else a=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));s=r().createElement(A.A,{title:e(rt.username),inputs:t,submit:i,saving:this.state.sectionIsSaving,serverError:this.state.serverError,updateSection:this.updateSection,extraInfo:a,isValid:void 0===_.Bs(this.state.username)})}return r().createElement(M.A,{active:t,areAllSectionsInactive:""===this.props.activeSection,title:e(rt.username),describe:this.props.user.username,section:"username",updateSection:this.updateSection,max:s})})),nt(this,"createPositionSection",(()=>{const e=this.props.user,{formatMessage:t}=this.props.intl,s="position"===this.props.activeSection;let a=null;if(s){const e=[];let s,i=null;if(this.props.user.auth_service===b.YM.LDAP_SERVICE&&this.props.ldapPositionAttributeSet||this.props.user.auth_service===b.YM.SAML_SERVICE&&this.props.samlPositionAttributeSet)s=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{let a=r().createElement(c.FormattedMessage,{id:"user.settings.general.position",defaultMessage:"Position"});this.props.isMobileView&&(a=""),e.push(r().createElement("div",{key:"positionSetting",className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label"},a),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"position",name:"position",autoFocus:!0,type:"text",onChange:this.updatePosition,value:this.state.position,maxLength:b.YM.MAX_POSITION_LENGTH,autoCapitalize:"off",onFocus:_.G8,"aria-label":t({id:"user.settings.general.position",defaultMessage:"Position"})})))),s=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.positionExtra",defaultMessage:"Use Position for your role or job title. This will be shown in your profile popover."})),i=this.submitPosition}a=r().createElement(A.A,{title:t(rt.position),inputs:e,submit:i,saving:this.state.sectionIsSaving,serverError:this.state.serverError,updateSection:this.updateSection,extraInfo:s})}let i="";return e.position?i=e.position:(i=r().createElement(c.FormattedMessage,{id:"user.settings.general.emptyPosition",defaultMessage:"Click 'Edit' to add your job title / position"}),this.props.isMobileView&&(i=r().createElement(c.FormattedMessage,{id:"user.settings.general.mobile.emptyPosition",defaultMessage:"Click to add your job title / position"}))),r().createElement(M.A,{active:s,areAllSectionsInactive:""===this.props.activeSection,title:t(rt.position),describe:i,section:"position",updateSection:this.updateSection,max:a})})),nt(this,"createCustomAttributeSection",(()=>{const{formatMessage:e}=this.props.intl;if(null==this.props.customProfileAttributeFields)return r().createElement(r().Fragment,null);const t=this.props.customProfileAttributeFields.map((t=>{var s;const a="customAttribute_"+t.id,i=this.props.activeSection===a;let n=null;const o=e=>{if(!e||!Array.isArray(e)&&!e.length)return"";if("select"===t.type||"multiselect"===t.type){const s=t.attrs.options;if(!s)return"";if(Array.isArray(e))return e.map((e=>{const t=s.find((t=>t.id===e));return t?{label:null==t?void 0:t.name,value:null==t?void 0:t.id}:null})).filter((e=>null!=e));const a=s.find((t=>t.id===e));return a?{label:null==a?void 0:a.name,value:null==a?void 0:a.id}:""}return e};if(i){var l,d,u;const s=[];let i,m=null;const p=()=>{var s,a;if("email"===(null===(s=t.attrs)||void 0===s?void 0:s.value_type)){const s=this.state.customAttributeValues[t.id];if(s&&!(0,Je.xf)(s))return{type:"error",value:e(rt.validEmail)}}if("url"===(null===(a=t.attrs)||void 0===a?void 0:a.value_type)){const s=this.state.customAttributeValues[t.id];if(s&&!(0,st.hB)(s))return{type:"error",value:e(rt.validUrl)}}};if(this.props.user.auth_service===b.YM.LDAP_SERVICE&&null!==(l=t.attrs)&&void 0!==l&&l.ldap||this.props.user.auth_service===b.YM.SAML_SERVICE&&null!==(d=t.attrs)&&void 0!==d&&d.saml)i=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else if("admin"===(null===(u=t.attrs)||void 0===u?void 0:u.managed))i=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.field_managed_by_admin",defaultMessage:"This field can only be changed by an administrator."}));else{let n=t.name;if(this.props.isMobileView&&(n=""),"select"===t.type||"multiselect"===t.type){const i=t.attrs.options.map((e=>({label:e.name,value:e.id})));s.push(r().createElement(Me.Ay,{isMulti:"multiselect"===t.type||void 0,key:a,id:"customProfileAttribute_"+t.id,inputId:"customProfileAttribute_"+t.id+"_input",className:"react-select inlineSelect",classNamePrefix:"react-select",options:i,isClearable:!0,isSearchable:!1,isDisabled:!1,placeholder:e({id:"user.settings.general.select",defaultMessage:"Select"}),components:{IndicatorSeparator:null},styles:ot,value:o(this.state.customAttributeValues[t.id]),onChange:(e,s)=>this.updateSelectAttribute(e,s,t.id)}))}else{const e=t.type;s.push(r().createElement("div",{key:a,className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label"},n),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:a,name:a,autoFocus:!0,type:e,onChange:this.updateAttribute,value:o(this.state.customAttributeValues[t.id]),maxLength:b.YM.MAX_CUSTOM_ATTRIBUTE_LENGTH,autoCapitalize:"off",onFocus:_.G8,"aria-label":t.name,validate:p}))))}i=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.attributeExtra",defaultMessage:"This will be shown in your profile popover."})),m=this.submitAttribute.bind(this,[t.id])}n=r().createElement(A.A,{key:"settingItemMax_"+t.id,title:t.name,inputs:s,submit:m,saving:this.state.sectionIsSaving,serverError:this.state.serverError,updateSection:this.updateSection,extraInfo:i,isValid:void 0===p()})}let m="";if(null!==(s=this.props.user.custom_profile_attributes)&&void 0!==s&&s[t.id]){var p;const e=o(null===(p=this.props.user.custom_profile_attributes)||void 0===p?void 0:p[t.id]);e&&("string"==typeof e?m=e:Array.isArray(e)&&e.length>0?m=r().createElement(c.FormattedList,{value:e.map((e=>(null==e?void 0:e.label)||null))}):!Array.isArray(e)&&Object.hasOwn(e,"label")&&(m=e.label||""))}return m||(m=r().createElement(c.FormattedMessage,{id:"user.settings.general.emptyAttribute",defaultMessage:"Click 'Edit' to add your custom attribute"}),this.props.isMobileView&&(m=r().createElement(c.FormattedMessage,{id:"user.settings.general.mobile.emptyAttribute",defaultMessage:"Click to add your custom attribute"}))),r().createElement("div",{key:a},r().createElement(M.A,{key:"settingItem_"+t.id,active:i,areAllSectionsInactive:""===this.props.activeSection,title:t.name,describe:m,section:a,updateSection:this.updateSection,max:n}),r().createElement("div",{className:"divider-dark"}))}));return r().createElement(r().Fragment,null,t)})),nt(this,"createPictureSection",(()=>{const e=this.props.user,{formatMessage:t}=this.props.intl,s="picture"===this.props.activeSection;let a=null;if(s){let s=null,i=null,n=null,o=null;this.props.user.auth_service!==b.YM.LDAP_SERVICE&&this.props.user.auth_service!==b.YM.SAML_SERVICE||!this.props.ldapPictureAttributeSet?(s=this.submitPicture,i=e.last_picture_update>0?this.setDefaultProfilePicture:null,o=_.RG(e.id,e.last_picture_update),n=r().createElement(c.FormattedMessage,{id:"setting_picture.help.profile",defaultMessage:"Upload a picture in BMP, JPG, JPEG, or PNG format. Maximum file size: {max}",values:{max:_.O1(this.props.maxFileSize)}})):n=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."})),a=r().createElement(et,{title:t(rt.profilePicture),onSubmit:s,onSetDefault:i,src:o,defaultImageSrc:_.mY(e.id),serverError:this.state.serverError,clientError:this.state.pictureError,updateSection:e=>{this.updateSection(""),e.preventDefault()},file:this.state.pictureFile,onFileChange:this.updatePicture,submitActive:this.submitActive,loadingPicture:this.state.loadingPicture,maxFileSize:this.props.maxFileSize,helpText:n})}let i=t(rt.uploadImage);return this.props.isMobileView&&(i=t(rt.uploadImageMobile)),e.last_picture_update>0&&(i=r().createElement(c.FormattedMessage,{id:"user.settings.general.imageUpdated",defaultMessage:"Image last updated {date}",values:{date:r().createElement(c.FormattedDate,{value:new Date(e.last_picture_update),day:"2-digit",month:"short",year:"numeric"})}})),r().createElement(r().Fragment,null,r().createElement(M.A,{active:s,areAllSectionsInactive:""===this.props.activeSection,title:t(rt.profilePicture),describe:i,section:"picture",updateSection:this.updateSection,max:a}),r().createElement("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true"},this.renderPictureStatus()))})),nt(this,"renderPictureStatus",(()=>this.state.loadingPicture?r().createElement(c.FormattedMessage,{id:"user.settings.general.picture.uploading",defaultMessage:"Uploading..."}):this.state.pictureFile?r().createElement(c.FormattedMessage,{id:"user.settings.general.picture.selected",defaultMessage:"Picture selected, ready to save"}):this.submitActive?r().createElement(c.FormattedMessage,{id:"user.settings.general.picture.uploaded",defaultMessage:"Picture uploaded"}):null)),this.state=this.setupInitialState(e)}componentDidMount(){this.props.enableCustomProfileAttributes&&!this.props.user.custom_profile_attributes&&this.props.actions.getCustomProfileAttributeValues(this.props.user.id)}setupInitialState(e){const t=e.user;return{username:t.username,firstName:t.first_name,lastName:t.last_name,nickname:t.nickname,position:t.position,originalEmail:t.email,email:"",confirmEmail:"",currentPassword:"",pictureFile:null,loadingPicture:!1,sectionIsSaving:!1,showSpinner:!1,serverError:"",customAttributeValues:t.custom_profile_attributes||{}}}createEmailSection(){const{formatMessage:e}=this.props.intl,t="email"===this.props.activeSection;let s=null;if(t){const t=this.props.requireEmailVerification,a=[];let i=r().createElement(c.FormattedMessage,{id:"user.settings.general.emailHelp1",defaultMessage:"Email is used for sign-in, notifications, and password reset. Email requires verification if changed."});t||(i=r().createElement(c.FormattedMessage,{id:"user.settings.general.emailHelp3",defaultMessage:"Email is used for sign-in, notifications, and password reset."}));let n=null;""===this.props.user.auth_service?(a.push(r().createElement("div",{key:"currentEmailSetting"},r().createElement("div",{className:"form-group"},r().createElement("span",{className:"as-bs-label col-sm-5 control-label"},r().createElement(c.FormattedMessage,{id:"user.settings.general.currentEmail",defaultMessage:"Current Email"})),r().createElement("div",{className:"col-sm-7"},r().createElement("span",{className:"as-bs-label control-label word-break--all text-left"},this.state.originalEmail))))),a.push(r().createElement("div",{key:"emailSetting"},r().createElement("div",{className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label",htmlFor:"primaryEmail"},r().createElement(c.FormattedMessage,{id:"user.settings.general.newEmail",defaultMessage:"New Email"})),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{autoFocus:!0,id:"primaryEmail",name:"primaryEmail",type:"email",onChange:this.updateEmail,maxLength:b.YM.MAX_EMAIL_LENGTH,value:this.state.email,"aria-label":e({id:"user.settings.general.newEmail",defaultMessage:"New Email"}),validate:t=>{if(""===t||!(0,Je.xf)(t))return{type:"error",value:e(rt.validEmail)}}}))))),a.push(r().createElement("div",{key:"confirmEmailSetting"},r().createElement("div",{className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label",htmlFor:"confirmEmail"},r().createElement(c.FormattedMessage,{id:"user.settings.general.confirmEmail",defaultMessage:"Confirm Email"})),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"confirmEmail",name:"confirmEmail",type:"email",onChange:this.updateConfirmEmail,maxLength:b.YM.MAX_EMAIL_LENGTH,value:this.state.confirmEmail,"aria-label":e({id:"user.settings.general.confirmEmail",defaultMessage:"Confirm Email"}),validate:t=>{if(this.state.email!==t)return{type:"error",value:e(rt.emailMatch)}}}))))),a.push(r().createElement("div",{key:"currentPassword"},r().createElement("div",{className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label",htmlFor:"currentPassword"},r().createElement(c.FormattedMessage,{id:"user.settings.general.currentPassword",defaultMessage:"Current Password"})),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"currentPassword",name:"currentPassword",type:"password",onChange:this.updateCurrentPassword,value:this.state.currentPassword,"aria-label":e({id:"user.settings.general.currentPassword",defaultMessage:"Current Password"}),validate:t=>{if(""===t)return{type:"error",value:e(rt.emptyPassword)}}}))),i)),n=this.submitEmail):this.props.user.auth_service===b.YM.GITLAB_SERVICE?a.push(r().createElement("div",{key:"oauthEmailInfo",className:"form-group"},r().createElement("div",{className:"setting-list__hint pb-3"},r().createElement(c.FormattedMessage,{id:"user.settings.general.emailGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===b.YM.GOOGLE_SERVICE?a.push(r().createElement("div",{key:"oauthEmailInfo",className:"form-group"},r().createElement("div",{className:"setting-list__hint pb-3"},r().createElement(c.FormattedMessage,{id:"user.settings.general.emailGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===b.YM.OFFICE365_SERVICE?a.push(r().createElement("div",{key:"oauthEmailInfo",className:"form-group"},r().createElement("div",{className:"setting-list__hint pb-3"},r().createElement(c.FormattedMessage,{id:"user.settings.general.emailOffice365CantUpdate",defaultMessage:"Login occurs through Entra ID. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===b.YM.OPENID_SERVICE?a.push(r().createElement("div",{key:"oauthEmailInfo",className:"form-group"},r().createElement("div",{className:"setting-list__hint pb-3"},r().createElement(c.FormattedMessage,{id:"user.settings.general.emailOpenIdCantUpdate",defaultMessage:"Login occurs through OpenID Connect. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===b.YM.LDAP_SERVICE?a.push(r().createElement("div",{key:"oauthEmailInfo",className:"pb-2"},r().createElement("div",{className:"setting-list__hint pb-3"},r().createElement(c.FormattedMessage,{id:"user.settings.general.emailLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})))):this.props.user.auth_service===b.YM.SAML_SERVICE&&a.push(r().createElement("div",{key:"oauthEmailInfo",className:"pb-2"},r().createElement("div",{className:"setting-list__hint pb-3"},r().createElement(c.FormattedMessage,{id:"user.settings.general.emailSamlCantUpdate",defaultMessage:"Login occurs through SAML. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)),s=r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.general.email",defaultMessage:"Email"}),inputs:a,submit:n,saving:this.state.sectionIsSaving,serverError:this.state.serverError,updateSection:this.updateSection,isValid:this.isEmailValid()})}let a="";return""===this.props.user.auth_service?a=this.props.user.email:this.props.user.auth_service===b.YM.GITLAB_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.general.loginGitlab",defaultMessage:"Login done through GitLab ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===b.YM.GOOGLE_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.general.loginGoogle",defaultMessage:"Login done through Google Apps ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===b.YM.OFFICE365_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.general.loginOffice365",defaultMessage:"Login done through Entra ID ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===b.YM.LDAP_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.general.loginLdap",defaultMessage:"Login done through AD/LDAP ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===b.YM.SAML_SERVICE&&(a=r().createElement(c.FormattedMessage,{id:"user.settings.general.loginSaml",defaultMessage:"Login done through SAML ({email})",values:{email:this.state.originalEmail}})),r().createElement(M.A,{active:t,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,{id:"user.settings.general.email",defaultMessage:"Email"}),describe:a,section:"email",updateSection:this.updateSection,max:s})}render(){const e=this.createNameSection(),t=this.createNicknameSection(),s=this.createUsernameSection(),a=this.createPositionSection(),i=this.createEmailSection(),n=this.createCustomAttributeSection(),o=this.createPictureSection();return r().createElement("div",{id:"profileSettings","aria-labelledby":"profileButton",role:"tabpanel"},r().createElement(x.A,{closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,text:r().createElement(c.FormattedMessage,{id:"user.settings.modal.profile",defaultMessage:"Profile"})}),r().createElement("div",{className:"user-settings"},r().createElement(F.A,{id:"generalSettingsTitle",text:r().createElement(c.FormattedMessage,{id:"user.settings.modal.profile",defaultMessage:"Profile"})}),r().createElement("div",{className:"divider-dark first"}),e,r().createElement("div",{className:"divider-light"}),s,r().createElement("div",{className:"divider-light"}),t,r().createElement("div",{className:"divider-light"}),a,r().createElement("div",{className:"divider-light"}),i,r().createElement("div",{className:"divider-light"}),n,o,r().createElement("div",{className:"divider-dark"})))}}nt(lt,"propTypes",{updateSection:i().func.isRequired,updateTab:i().func.isRequired,activeSection:i().string,closeModal:i().func.isRequired,collapseModal:i().func.isRequired,isMobileView:i().bool.isRequired,maxFileSize:i().number.isRequired,customProfileAttributeFields:i().array.isRequired,actions:i().shape({logError:i().func.isRequired,clearErrors:i().func.isRequired,updateMe:i().func.isRequired,sendVerificationEmail:i().func.isRequired,setDefaultProfileImage:i().func.isRequired,uploadProfileImage:i().func.isRequired,getCustomProfileAttributeValues:i().func.isRequired,saveCustomProfileAttribute:i().func.isRequired}).isRequired,requireEmailVerification:i().bool,ldapFirstNameAttributeSet:i().bool,ldapLastNameAttributeSet:i().bool,samlFirstNameAttributeSet:i().bool,samlLastNameAttributeSet:i().bool,ldapNicknameAttributeSet:i().bool,samlNicknameAttributeSet:i().bool,ldapPositionAttributeSet:i().bool,samlPositionAttributeSet:i().bool,ldapPictureAttributeSet:i().bool,enableCustomProfileAttributes:i().bool.isRequired});const ct=(0,c.injectIntl)(lt),dt=(0,p.connect)((function(e){const t=(0,E.zj)(e),s=(0,E.A1)(e),a="true"===t.RequireEmailVerification,i=parseInt(t.MaxFileSize,10),n="true"===t.LdapFirstNameAttributeSet,r="true"===t.LdapLastNameAttributeSet,o="true"===t.SamlFirstNameAttributeSet,l="true"===t.SamlLastNameAttributeSet,c="true"===t.LdapNicknameAttributeSet,d="true"===t.SamlNicknameAttributeSet,u="true"===t.SamlPositionAttributeSet,m="true"===t.LdapPositionAttributeSet,p="true"===t.LdapPictureAttributeSet,h=(0,E.Ay)(e),g=(0,We.PL)(h)&&"true"===(0,E.Y6)(e,"CustomProfileAttributes");return{isMobileView:(0,He.w3)(e),requireEmailVerification:a,maxFileSize:i,customProfileAttributeFields:s,ldapFirstNameAttributeSet:n,ldapLastNameAttributeSet:r,samlFirstNameAttributeSet:o,samlLastNameAttributeSet:l,ldapNicknameAttributeSet:c,samlNicknameAttributeSet:d,samlPositionAttributeSet:u,ldapPositionAttributeSet:m,ldapPictureAttributeSet:p,enableCustomProfileAttributes:g}}),(function(e){return{actions:(0,h.zH)({logError:Ve.vV,clearErrors:Ve.x8,updateMe:f.Me,sendVerificationEmail:f.kH,setDefaultProfileImage:f.Ae,uploadProfileImage:f.OB,saveCustomProfileAttribute:f.Ah,getCustomProfileAttributeValues:f.R0},e)}}))(ct);var ut=s(45955),mt=s(148),pt=s(26624);const ht={updateMe:f.Me,patchUser:f.WJ},gt=(0,p.connect)(((e,t)=>{const s=(0,E.zj)(e),a="true"===s.SendPushNotifications,i="true"===s.ExperimentalEnableAutomaticReplies,n=(0,E.Ay)(e),r=(0,ut.Pd)(e),o="true"===s.BuildEnterpriseReady;return{sendPushNotifications:a,enableAutoResponder:i,isCollapsedThreadsEnabled:t.adminMode&&t.userPreferences?(0,v.UH)(e,t.userPreferences):(0,v.WW)(e),isCallsRingingEnabled:(0,mt.zu)(e,"0.17.0")&&(0,mt.pt)(e),isEnterpriseOrCloudOrSKUStarterFree:(0,We.hr)(n,r,o),isEnterpriseReady:o}}),ht)(pt.Ay);var ft=s(83040),Et=s(24867);const vt=e=>{let{action:t}=e;const s=(0,n.useMemo)((()=>t?{text:t.text,title:t.title,primaryButton:{onClick:null==t?void 0:t.onClick,text:null==t?void 0:t.buttonText}}:{text:"",title:""}),[t]);return t?r().createElement("div",{className:"pluginActionContainer"},r().createElement(Et.A,s)):null};function St(e){return"pp_".concat(e).slice(0,32)}var bt=s(18515);const yt={mentionHighlight:!1},Mt=e=>{let{selectedValue:t,name:s,option:a,onSelected:i}=e;const o=(0,n.useCallback)((()=>i(a.value)),[a.value]);return r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{type:"radio",name:s,checked:t===a.value,onChange:o}),a.text),r().createElement("br",null),a.helpText&&r().createElement(bt.A,{message:a.helpText,options:yt}))};Mt.propTypes={selectedValue:i().string.isRequired,name:i().string.isRequired,onSelected:i().func.isRequired};const At=Mt,Tt=e=>{let{setting:t,pluginId:s,informChange:a}=e;const i=(0,p.useSelector)((e=>(0,v.Jt)(e,St(s),t.name,t.default))),[o,l]=(0,n.useState)(i),c=(0,n.useCallback)((e=>{l(e),a(t.name,e)}),[t.name]);return r().createElement("fieldset",{key:t.name},r().createElement("legend",{className:"form-legend hidden-label"},t.title||t.name),t.options.map((e=>r().createElement(At,{key:e.value,name:t.name,option:e,selectedValue:o,onSelected:c}))),t.helpText&&r().createElement("div",{className:"mt-5"},r().createElement(bt.A,{message:t.helpText,options:{mentionHighlight:!1}})))};Tt.propTypes={pluginId:i().string.isRequired,informChange:i().func.isRequired};const _t=Tt,Ct=e=>{let{pluginId:t,section:s,activeSection:a,updateSection:i}=e;const o=(0,p.useDispatch)(),l=(0,p.useSelector)(S.WR),c=(0,p.useSelector)((e=>(0,v.Jt)(e,St(t),s.settings[0].name,s.settings[0].default))),d=(0,n.useRef)({}),u=(0,n.useMemo)((()=>{const e=s.settings[0];var t;if("radio"===e.type)return null===(t=e.options.find((e=>e.value===c)))||void 0===t?void 0:t.text}),[s,c]),m=(0,n.useCallback)(((e,t)=>{d.current[e]=t}),[]),h=(0,n.useCallback)((async()=>{const e=[];for(const s of Object.keys(d.current))e.push({user_id:l,category:St(t),name:s,value:d.current[s]});var a;e.length&&(o((0,g.SF)(l,e)),null===(a=s.onSubmit)||void 0===a||a.call(s,d.current)),i("")}),[t,o,s.onSubmit]);(0,n.useEffect)((()=>{a!==s.title&&(d.current={})}),[a,s.title]);const f=[];for(const e of s.settings)if("radio"===e.type)f.push(r().createElement(_t,{key:e.name,setting:e,informChange:m,pluginId:t}));else if("custom"===e.type){const s=e.component,a=r().createElement(ft.A,{key:e.name,pluginId:t},r().createElement(s,{informChange:m}));f.push(a)}return f.length?s.title===a?r().createElement(A.A,{title:s.title,inputs:f,submit:h,updateSection:i}):r().createElement(w.A,{section:s.title,title:s.title,updateSection:i,describe:u,isDisabled:s.disabled}):null};Ct.propTypes={pluginId:i().string.isRequired,updateSection:i().func.isRequired,activeSection:i().string.isRequired};const wt=Ct,Nt=e=>{let{activeSection:t,closeModal:s,collapseModal:a,settings:i,updateSection:n}=e;const o=(0,c.useIntl)().formatMessage({id:"user.settings.plugins.title",defaultMessage:"{pluginName} Settings"},{pluginName:i.uiName});return r().createElement("div",{id:"".concat(i.id,"Settings"),"aria-labelledby":"".concat(i.id,"Button"),role:"tabpanel"},r().createElement(x.A,{closeModal:s,collapseModal:a,text:o}),r().createElement("div",{className:"user-settings"},r().createElement(F.A,{text:o}),r().createElement(vt,{action:i.action}),r().createElement("div",{className:"divider-dark first"}),i.sections.map((e=>{let s;if("component"in e){const t=e.component;s=r().createElement(ft.A,{pluginId:i.id},r().createElement(t,null))}else s=r().createElement(wt,{pluginId:i.id,activeSection:t,section:e,updateSection:n});return r().createElement(r().Fragment,{key:e.title},s,r().createElement("div",{className:"divider-light"}))})),r().createElement("div",{className:"divider-dark"})))};Nt.propTypes={updateSection:i().func.isRequired,activeSection:i().string.isRequired,closeModal:i().func.isRequired,collapseModal:i().func.isRequired};const Pt=Nt;var kt=s(12966),Ot=s(79342),Rt=s(81911),It=s(43957),Dt=s(1396);const Lt=e=>{let t,{actions:{getUserAudits:s},currentUserId:a,onHide:i,userAudits:o}=e;return(0,n.useEffect)((()=>{s(a,0,200)}),[a,s]),t=0===o.length?r().createElement(Dt.A,null):r().createElement(It.A,{audits:o,showIp:!0,showSession:!0}),r().createElement(d.zW,{id:"accessHistoryModal",className:"a11y__modal access-history-modal modal--scroll",modalHeaderText:r().createElement(c.FormattedMessage,{id:"access_history.title",defaultMessage:"Access History"}),modalHeaderTextId:"accessHistoryModalLabel",show:!0,onHide:i,modalLocation:"top",isStacked:!0,compassDesign:!0,ariaLabelledby:"accessHistoryModalLabel"},r().createElement("div",{className:"access-history-modal__body"},t))};Lt.propTypes={onHide:i().func.isRequired,actions:i().shape({getUserAudits:i().func.isRequired}).isRequired,userAudits:i().array.isRequired,currentUserId:i().string.isRequired};const Ft=r().memo(Lt),xt=(0,p.connect)((function(e){return{currentUserId:(0,S.WR)(e),userAudits:(0,S.Qb)(e)||[]}}),(function(e){return{actions:(0,h.zH)({getUserAudits:f.Qb},e)}}))(Ft);var Ut=s(69657),jt=(s(76409),s(45036));function qt(e){const t=(0,c.useIntl)();return r().createElement("i",{className:e.devicePicture,title:(0,jt.H6)(t.formatMessage,e.deviceTitle)})}function Bt(e){const{locale:t,currentSession:s,handleMoreInfo:a,moreInfo:i}=e;if(i){const e=new Date(s.create_at);return r().createElement("div",null,r().createElement("div",null,r().createElement(c.FormattedMessage,{id:"activity_log.firstTime",defaultMessage:"First time active: {date}, {time}",values:{date:r().createElement(c.FormattedDate,{value:e,day:"2-digit",month:(0,jt.FS)(t),year:"numeric"}),time:r().createElement(c.FormattedTime,{value:e,hour:"2-digit",minute:"2-digit"})}})),r().createElement("div",null,r().createElement(c.FormattedMessage,{id:"activity_log.os",defaultMessage:"OS: {os}",values:{os:s.props.os}})),r().createElement("div",null,r().createElement(c.FormattedMessage,{id:"activity_log.browser",defaultMessage:"Browser: {browser}",values:{browser:s.props.browser}})),r().createElement("div",null,r().createElement(c.FormattedMessage,{id:"activity_log.sessionId",defaultMessage:"Session ID: {id}",values:{id:s.id}})))}return r().createElement("a",{className:"theme",href:"#",onClick:a},r().createElement(c.FormattedMessage,{id:"activity_log.moreInfo",defaultMessage:"More info"}))}function Gt(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}qt.propTypes={devicePicture:i().string},Bt.propTypes={locale:i().string.isRequired,handleMoreInfo:i().func.isRequired,moreInfo:i().bool.isRequired};class zt extends r().PureComponent{constructor(e){super(e),Gt(this,"handleMoreInfo",(()=>{this.setState({moreInfo:!0})})),Gt(this,"submitRevoke",(e=>{this.props.submitRevoke(this.props.currentSession.id,e)})),Gt(this,"isMobileSession",(e=>Boolean(e.device_id&&(e.device_id.includes("apple")||e.device_id.includes("android"))))),Gt(this,"sessionInfo",(e=>{var t,s,a,i,n,o,l,d,u,m,p,h,g,f,E;const v={deviceTitle:"Unknown",devicePlatform:null===(t=e.props)||void 0===t?void 0:t.platform},S="Windows"===(null===(s=e.props)||void 0===s?void 0:s.platform),b="Macintosh"===(null===(a=e.props)||void 0===a?void 0:a.platform),y="iPhone"===(null===(i=e.props)||void 0===i?void 0:i.platform),M="Linux"===(null===(n=e.props)||void 0===n?void 0:n.platform)||(null===(o=e.props)||void 0===o||null===(l=o.os)||void 0===l?void 0:l.includes("Linux")),A=null===(d=e.props)||void 0===d||null===(u=d.os)||void 0===u?void 0:u.includes("Android"),T=null===(m=e.props)||void 0===m||null===(p=m.browser)||void 0===p?void 0:p.includes("Desktop App"),_=null===(h=e.device_id)||void 0===h?void 0:h.includes(C.Bz.PUSH_NOTIFY_APPLE_REACT_NATIVE),w=(null===(g=e.device_id)||void 0===g?void 0:g.includes("apple"))&&!_,N=null===(f=e.device_id)||void 0===f?void 0:f.includes(C.Bz.PUSH_NOTIFY_ANDROID_REACT_NATIVE),P=(null===(E=e.device_id)||void 0===E?void 0:E.includes("android"))&&!N;return b||y||_||w?(v.devicePicture="fa fa-apple",v.deviceTitle=Yt.appleIcon):S?(v.devicePicture="fa fa-windows",v.deviceTitle=Yt.windowsIcon):A||N||P?(v.devicePicture="fa fa-android",v.deviceTitle=Yt.androidIcon):M&&(v.devicePicture="fa fa-linux",v.deviceTitle=Yt.linuxIcon),w?v.devicePlatform=r().createElement(c.FormattedMessage,{id:"activity_log_modal.iphoneNativeClassicApp",defaultMessage:"iPhone Native Classic App"}):_?v.devicePlatform=r().createElement(c.FormattedMessage,{id:"activity_log_modal.iphoneNativeApp",defaultMessage:"iPhone Native App"}):P?v.devicePlatform=r().createElement(c.FormattedMessage,{id:"activity_log_modal.androidNativeClassicApp",defaultMessage:"Android Native Classic App"}):N?v.devicePlatform=r().createElement(c.FormattedMessage,{id:"activity_log_modal.androidNativeApp",defaultMessage:"Android Native App"}):A?v.devicePlatform=r().createElement(c.FormattedMessage,{id:"activity_log_modal.android",defaultMessage:"Android"}):T&&(v.devicePlatform=r().createElement(c.FormattedMessage,{id:"activity_log_modal.desktop",defaultMessage:"Native Desktop App"})),v})),this.state={moreInfo:!1}}render(){const{index:e,locale:t,currentSession:s}=this.props,a=new Date(s.last_activity_at),i=this.sessionInfo(s);return r().createElement("div",{key:"activityLogEntryKey"+e,className:"activity-log__table"},r().createElement("div",{className:"activity-log__report"},r().createElement("div",{className:"report__platform"},r().createElement(qt,{devicePicture:i.devicePicture,deviceTitle:i.deviceTitle}),i.devicePlatform),r().createElement("div",{className:"report__info"},r().createElement("div",null,r().createElement(c.FormattedMessage,{id:"activity_log.lastActivity",defaultMessage:"Last activity: {date}, {time}",values:{date:r().createElement(c.FormattedDate,{value:a,day:"2-digit",month:(0,jt.FS)(t),year:"numeric"}),time:r().createElement(c.FormattedTime,{value:a,hour:"2-digit",minute:"2-digit"})}})),r().createElement(Bt,{locale:t,currentSession:s,moreInfo:this.state.moreInfo,handleMoreInfo:this.handleMoreInfo}))),r().createElement("div",{className:"activity-log__action"},r().createElement("button",{onClick:this.submitRevoke,className:"btn btn-primary"},r().createElement(c.FormattedMessage,{id:"activity_log.logout",defaultMessage:"Log Out"}))))}}Gt(zt,"propTypes",{index:i().number.isRequired,locale:i().string.isRequired,submitRevoke:i().func.isRequired});const Yt=(0,c.defineMessages)({androidIcon:{id:"device_icons.android",defaultMessage:"Android Icon"},appleIcon:{id:"device_icons.apple",defaultMessage:"Apple Icon"},linuxIcon:{id:"device_icons.linux",defaultMessage:"Linux Icon"},windowsIcon:{id:"device_icons.windows",defaultMessage:"Windows Icon"}}),Vt=e=>{let{currentUserId:t,sessions:s,locale:a,onHide:i,actions:{getSessions:o,revokeSession:l}}=e;const u=(0,n.useCallback)(((e,s)=>{var a;s.preventDefault();const i=null===(a=s.target)||void 0===a?void 0:a.closest(".modal-content");null==i||i.classList.add("animation--highlight"),setTimeout((()=>{null==i||i.classList.remove("animation--highlight")}),1500),l(t,e).then((()=>{o(t)}))}),[t,l,o]);(0,n.useEffect)((()=>{o(t)}),[t,o]);const m=(0,n.useMemo)((()=>s.reduce(((e,t,s)=>("UserAccessToken"===t.props.type||e.push(r().createElement(zt,{key:t.id,index:s,locale:a,currentSession:t,submitRevoke:u})),e)),[])),[s,a,u]),p=r().createElement("form",null,m);return r().createElement(d.zW,{id:"activityLogModal",className:"activity-log-modal modal--scroll",modalHeaderText:r().createElement(c.FormattedMessage,{id:"activity_log.activeSessions",defaultMessage:"Active Sessions"}),show:!0,onHide:i,ariaLabelledby:"activityLogModalLabel",modalLocation:"top",isStacked:!0,compassDesign:!0},r().createElement("div",{className:"activity-log-modal__body"},r().createElement("p",{className:"session-help-text"},r().createElement(c.FormattedMessage,{id:"activity_log.sessionsDescription",defaultMessage:"Sessions are created when you log in through a new browser on a device. Sessions let you use Mattermost without having to log in again for a time period specified by the system administrator. To end the session sooner, use the 'Log Out' button."})),p))};Vt.propTypes={currentUserId:i().string.isRequired,sessions:i().array.isRequired,locale:i().string.isRequired,onHide:i().func.isRequired,actions:i().shape({getSessions:i().func.isRequired,revokeSession:i().func.isRequired}).isRequired};const Ht=r().memo(Vt),Wt=(0,p.connect)((function(e){return{currentUserId:(0,S.WR)(e),sessions:(0,S.XF)(e),locale:(0,Ut.k)(e)}}),(function(e){return{actions:(0,h.zH)({getSessions:f.S5,revokeSession:f.T$},e)}}))(Ht);var Jt=s(12762),Kt=s(83984),Xt=s(79135),Qt=s(83469),Zt=s(83007);function $t(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class es extends r().PureComponent{constructor(e){super(e),$t(this,"setupMfa",(e=>{e.preventDefault(),(0,Zt.J)().push("/mfa/setup")})),$t(this,"removeMfa",(async e=>{e.preventDefault();const{error:t}=await this.props.actions.deactivateMfa();t?this.setState({serverError:t.message}):this.props.mfaEnforced?(0,Zt.J)().push("/mfa/setup"):(this.props.updateSection(""),this.setState({serverError:null}))})),$t(this,"renderTitle",(()=>r().createElement(c.FormattedMessage,{id:"user.settings.mfa.title",defaultMessage:"Multi-factor Authentication"}))),$t(this,"renderDescription",(()=>this.props.mfaActive?r().createElement(c.FormattedMessage,{id:"user.settings.security.active",defaultMessage:"Active"}):r().createElement(c.FormattedMessage,{id:"user.settings.security.inactive",defaultMessage:"Inactive"}))),$t(this,"renderContent",(()=>{let e;if(this.props.mfaActive){let t;t=this.props.mfaEnforced?r().createElement(c.FormattedMessage,{id:"user.settings.mfa.reset",defaultMessage:"Reset MFA on Account"}):r().createElement(c.FormattedMessage,{id:"user.settings.mfa.remove",defaultMessage:"Remove MFA from Account"}),e=r().createElement("a",{className:"btn btn-primary",href:"#",onClick:this.removeMfa},t)}else e=r().createElement("a",{className:"btn btn-primary",href:"#",onClick:this.setupMfa},r().createElement(c.FormattedMessage,{id:"user.settings.mfa.add",defaultMessage:"Add MFA to Account"}));return r().createElement("div",{className:"pt-2"},e,r().createElement("br",null))})),$t(this,"renderHelpText",(()=>this.props.mfaActive?this.props.mfaEnforced?r().createElement(c.FormattedMessage,{id:"user.settings.mfa.requiredHelp",defaultMessage:"Multi-factor authentication is required on this server. Resetting is only recommended when you need to switch code generation to a new mobile device. You will be required to set it up again immediately."}):r().createElement(c.FormattedMessage,{id:"user.settings.mfa.removeHelp",defaultMessage:"Removing multi-factor authentication means you will no longer require a phone-based passcode to sign-in to your account."}):r().createElement(c.FormattedMessage,{id:"user.settings.mfa.addHelp",defaultMessage:"Adding multi-factor authentication will make your account more secure by requiring a code from your mobile phone each time you sign in."}))),this.state={serverError:null},this.minRef=r().createRef()}focusEditButton(){var e;null===(e=this.minRef.current)||void 0===e||e.focus()}componentDidUpdate(e){e.active&&!this.props.active&&this.props.areAllSectionsInactive&&this.focusEditButton()}render(){const e=this.renderTitle();return this.props.mfaAvailable?this.props.active?r().createElement(A.A,{title:e,inputs:this.renderContent(),extraInfo:this.renderHelpText(),serverError:this.state.serverError,updateSection:this.props.updateSection}):r().createElement(w.A,{title:e,describe:this.renderDescription(),section:"mfa",updateSection:this.props.updateSection,ref:this.minRef}):null}}const ts=(0,p.connect)((function(e){const t=(0,E.Ay)(e),s=(0,E.zj)(e),a=t&&"true"===t.IsLicensed&&"true"===t.MFA,i="true"===s.EnableMultifactorAuthentication,n=a&&"true"===s.EnforceMultifactorAuthentication,r=(0,S.HW)(e);let o=!1,l=!1;return r&&(o=r.mfa_active,l=i&&(""===r.auth_service||r.auth_service===b.Ay.LDAP_SERVICE)),{mfaActive:o,mfaAvailable:l,mfaEnforced:n}}),(function(e){return{actions:(0,h.zH)({deactivateMfa:Qt.n},e)}}))(es);var ss=s(14309),as=s(87064);function is(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ns="creating",rs="created",os="not_creating";class ls extends r().PureComponent{constructor(e){super(e),is(this,"startCreatingToken",(()=>{this.setState({tokenCreationState:ns})})),is(this,"stopCreatingToken",(()=>{this.setState({tokenCreationState:os,saving:!1})})),is(this,"handleCreateToken",(async()=>{this.handleCancelConfirm();const e=this.newtokendescriptionRef?this.newtokendescriptionRef.current.value:"";if(""===e)return void this.setState({tokenError:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.nameRequired",defaultMessage:"Please enter a description."})});this.setState({tokenError:"",saving:!0}),this.props.setRequireConfirm(!0,this.confirmCopyToken);const t=this.props.user?this.props.user.id:"",{data:s,error:a}=await this.props.actions.createUserAccessToken(t,e);s&&this.state.tokenCreationState===ns?this.setState({tokenCreationState:rs,newToken:s,saving:!1}):a&&this.setState({serverError:a.message,saving:!1})})),is(this,"confirmCopyToken",(e=>{this.setState({showConfirmModal:!0,confirmTitle:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmCopyTitle",defaultMessage:"Copied Your Token?"}),confirmMessage:e=>r().createElement("div",null,r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmCopyMessage",defaultMessage:"Make sure you have copied and saved the access token below. You won't be able to see it again!"}),r().createElement("br",null),r().createElement("br",null),e.tokenCreationState===ns?r().createElement("div",null,r().createElement("strong",{className:"word-break--all"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "})),r().createElement(c.FormattedMessage,{id:"user.settings.tokens.tokenLoading",defaultMessage:"Loading..."})):r().createElement("strong",{className:"word-break--all"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "}),e.newToken.token)),confirmButton:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmCopyButton",defaultMessage:"Yes, I have copied the token"}),confirmComplete:()=>{this.handleCancelConfirm(),e()},confirmHideCancel:!0})})),is(this,"handleCancelConfirm",(()=>{this.setState({showConfirmModal:!1,confirmTitle:null,confirmMessage:null,confirmButton:null,confirmComplete:null,confirmHideCancel:!1})})),is(this,"confirmCreateToken",(()=>{Ot.FV(this.props.user.roles)?this.setState({showConfirmModal:!0,confirmTitle:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmCreateTitle",defaultMessage:"Create System Admin Personal Access Token"}),confirmMessage:()=>r().createElement("div",{className:"alert alert-danger"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmCreateMessage",defaultMessage:"You are generating a personal access token with System Admin permissions. Are you sure want to create this token?"})),confirmButton:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmCreateButton",defaultMessage:"Yes, Create"}),confirmComplete:()=>{this.handleCreateToken()}}):this.handleCreateToken()})),is(this,"saveTokenKeyPress",(e=>{Ae.e(e,b.YM.KeyCodes.ENTER)&&this.confirmCreateToken()})),is(this,"confirmRevokeToken",(e=>{const t=this.props.userAccessTokens[e];this.setState({showConfirmModal:!0,confirmTitle:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmDeleteTitle",defaultMessage:"Delete Token?"}),confirmMessage:()=>r().createElement("div",{className:"alert alert-danger"},r().createElement("p",null,r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmDelete.description",defaultMessage:"Any integrations using this token will no longer be able to access the Mattermost API. You cannot undo this action."})),r().createElement("p",null,r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmDelete.confirmation",defaultMessage:"Are you sure you want to delete the <b>{description}</b> token?",values:{description:t.description,b:e=>r().createElement("b",null,e)}}))),confirmButton:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.confirmDeleteButton",defaultMessage:"Yes, Delete"}),confirmComplete:()=>{this.revokeToken(e)}})})),is(this,"revokeToken",(async e=>{const{error:t}=await this.props.actions.revokeUserAccessToken(e);t&&this.setState({serverError:t.message}),this.handleCancelConfirm()})),is(this,"activateToken",(async e=>{const{error:t}=await this.props.actions.enableUserAccessToken(e);t&&this.setState({serverError:t.message})})),is(this,"deactivateToken",(async e=>{const{error:t}=await this.props.actions.disableUserAccessToken(e);t&&this.setState({serverError:t.message})})),this.state={active:this.props.active,showConfirmModal:!1,newToken:null,tokenCreationState:os,tokenError:"",serverError:null,saving:!1},this.newtokendescriptionRef=r().createRef(),this.minRef=r().createRef()}componentDidUpdate(e){e.active&&!this.props.active&&this.props.areAllSectionsInactive&&this.focusEditButton()}componentDidMount(){this.props.actions.clearUserAccessTokens();const e=this.props.user?this.props.user.id:"";this.props.actions.getUserAccessTokensForUser(e,0,200)}static getDerivedStateFromProps(e,t){return!e.active&&t.active?{active:e.active,showConfirmModal:!1,newToken:null,tokenCreationState:os,tokenError:"",serverError:null,saving:!1}:{active:e.active}}focusEditButton(){var e;null===(e=this.minRef.current)||void 0===e||e.focus()}render(){let e="";if(!this.props.active){const e=r().createElement(c.FormattedMessage,{id:"user.settings.tokens.clickToEdit",defaultMessage:"Click 'Edit' to manage your personal access tokens"});return r().createElement(w.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.title",defaultMessage:"Personal Access Tokens"}),describe:e,section:"tokens",updateSection:this.props.updateSection,ref:this.minRef})}const t=[];let s,a,i;Object.values(this.props.userAccessTokens).forEach((e=>{if(this.state.newToken&&this.state.newToken.id===e.id)return;let s,a;e.is_active?s=r().createElement("a",{id:e.id+"_deactivate",href:"#",onClick:t=>{t.preventDefault(),this.deactivateToken(e.id)}},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.deactivate",defaultMessage:"Disable"})):(a=r().createElement("span",{className:"has-error setting-box__inline-error"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.deactivatedWarning",defaultMessage:"(Disabled)"})),s=r().createElement("a",{id:e.id+"_activate",href:"#",onClick:t=>{t.preventDefault(),this.activateToken(e.id)}},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.activate",defaultMessage:"Enable"}))),t.push(r().createElement("div",{key:e.id,className:"setting-box__item"},r().createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.tokenDesc",defaultMessage:"Token Description: "}),e.description,a),r().createElement("div",{className:"setting-box__token-id whitespace--nowrap overflow--ellipsis"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.tokenId",defaultMessage:"Token ID: "}),e.id),r().createElement("div",null,s," - ",r().createElement("a",{id:e.id+"_delete",href:"#",onClick:t=>{t.preventDefault(),this.confirmRevokeToken(e.id)}},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.delete",defaultMessage:"Delete"}))),r().createElement("hr",{className:"mb-3 mt-3"})))})),0===t.length&&(s=r().createElement(c.FormattedMessage,{key:"notokens",id:"user.settings.tokens.userAccessTokensNone",defaultMessage:"No personal access tokens."})),a=(0,T.Fr)()?r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.tokens.description_mobile",defaultMessage:"<linkTokens>Personal access tokens</linkTokens> function similarly to session tokens and can be used by integrations to <linkAPI>authenticate against the REST API</linkAPI>. Create new tokens on your desktop.",values:{linkTokens:e=>r().createElement(ee.A,{href:b.i3.PERSONAL_ACCESS_TOKENS,location:"user_access_token_section"},e),linkAPI:e=>r().createElement(ee.A,{href:"https://api.mattermost.com/#tag/authentication",location:"user_access_token_section"},e)}})):r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.tokens.description",defaultMessage:"<linkTokens>Personal access tokens</linkTokens> function similarly to session tokens and can be used by integrations to <linkAPI>authenticate against the REST API</linkAPI>.",values:{linkTokens:e=>r().createElement(ee.A,{href:b.i3.PERSONAL_ACCESS_TOKENS,location:"user_access_token_section"},e),linkAPI:e=>r().createElement(ee.A,{href:"https://api.mattermost.com/#tag/authentication",location:"user_access_token_section"},e)}})),this.state.tokenCreationState===ns?i=r().createElement("div",{className:"pl-3"},r().createElement("div",{className:"row"},r().createElement("label",{className:"col-sm-auto control-label pr-3",htmlFor:"newTokenDescription"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "})),r().createElement("div",{className:"col-sm-5"},r().createElement("input",{id:"newTokenDescription",autoFocus:!0,ref:this.newtokendescriptionRef,className:"form-control",type:"text",maxLength:64,onKeyPress:this.saveTokenKeyPress}))),r().createElement("div",null,r().createElement("div",{className:"pt-3"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.nameHelp",defaultMessage:"Enter a description for your token to remember what it does."})),r().createElement("div",null,r().createElement("label",{id:"clientError",className:"has-error mt-2 mb-2"},this.state.tokenError)),r().createElement(ss.A,{savingMessage:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.save",defaultMessage:"Save"}),saving:this.state.saving,onClick:this.confirmCreateToken}),r().createElement("button",{className:"btn btn-tertiary",onClick:this.stopCreatingToken},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.cancel",defaultMessage:"Cancel"})))):this.state.tokenCreationState===rs?(0===t.length&&(e=" hidden"),i=r().createElement("div",{className:"alert alert-warning"},r().createElement(as.A,{additionalClassName:"mr-2"}),r().createElement(c.FormattedMessage,{id:"user.settings.tokens.copy",defaultMessage:"Please copy the access token below. You won't be able to see it again!"}),r().createElement("br",null),r().createElement("br",null),r().createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "}),this.state.newToken.description),r().createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.id",defaultMessage:"Token ID: "}),this.state.newToken.id),r().createElement("strong",{className:"word-break--all"},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "}),this.state.newToken.token))):i=r().createElement("a",{className:"btn btn-primary",href:"#",onClick:this.startCreatingToken},r().createElement(c.FormattedMessage,{id:"user.settings.tokens.create",defaultMessage:"Create Token"}));const n=[];return n.push(r().createElement("div",{key:"tokensSetting",className:"pt-2"},r().createElement("div",{key:"tokenList"},r().createElement("div",{className:"alert alert-transparent"+e},t,s),i))),r().createElement("div",null,r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.tokens.title",defaultMessage:"Personal Access Tokens"}),inputs:n,extraInfo:a,infoPosition:"top",serverError:this.state.serverError,updateSection:this.props.updateSection,isFullWidth:!0,saving:this.state.saving,cancelButtonText:r().createElement(c.FormattedMessage,{id:"user.settings.security.close",defaultMessage:"Close"})}),r().createElement(u.A,{title:this.state.confirmTitle,message:this.state.confirmMessage?this.state.confirmMessage(this.state):null,confirmButtonText:this.state.confirmButton,show:this.state.showConfirmModal,onConfirm:this.state.confirmComplete||(()=>null),onCancel:this.handleCancelConfirm,hideCancel:this.state.confirmHideCancel}))}}is(ls,"propTypes",{active:i().bool,areAllSectionsInactive:i().bool.isRequired,updateSection:i().func.isRequired,userAccessTokens:i().objectOf(i().shape({description:i().string.isRequired,id:i().string.isRequired,is_active:i().bool.isRequired})).isRequired,setRequireConfirm:i().func.isRequired,actions:i().shape({getUserAccessTokensForUser:i().func.isRequired,createUserAccessToken:i().func.isRequired,revokeUserAccessToken:i().func.isRequired,enableUserAccessToken:i().func.isRequired,disableUserAccessToken:i().func.isRequired,clearUserAccessTokens:i().func.isRequired}).isRequired});const cs=(0,p.connect)((function(e){return{userAccessTokens:e.entities.users.myUserAccessTokens}}),(function(e){return{actions:(0,h.zH)({getUserAccessTokensForUser:f.GA,createUserAccessToken:f.NE,revokeUserAccessToken:f.XE,enableUserAccessToken:f.Yp,disableUserAccessToken:f.$q,clearUserAccessTokens:f.TH},e)}}))(ls);function ds(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const us="password",ms="signin",ps="apps",hs="tokens";class gs extends r().PureComponent{constructor(e){super(e),ds(this,"loadAuthorizedOAuthApps",(async()=>{const e=await this.props.actions.getAuthorizedOAuthApps();if("data"in e){const{data:t}=e;this.setState({authorizedApps:t,serverError:null})}else if("error"in e){const{error:t}=e;this.setState({serverError:t.message})}})),ds(this,"submitPassword",(async()=>{const e=this.props.user,t=this.state.currentPassword,s=this.state.newPassword;if(!this.isPasswordValid())return;this.setState({savingPassword:!0});const a=await this.props.actions.updateUserPassword(e.id,t,s);if("data"in a)this.props.updateSection(""),this.props.actions.getMe(),this.setState(this.getDefaultState());else if("error"in a){const{error:e}=a,t=this.getDefaultState();e.message?t.serverError=e.message:t.serverError=e,this.setState(t)}})),ds(this,"isPasswordValid",(()=>{if(""===this.state.currentPassword)return!1;const{valid:e,error:t}=(0,Xt.s)(this.state.newPassword,this.props.passwordConfig);return!(!e&&t)&&this.state.newPassword===this.state.confirmPassword})),ds(this,"updateCurrentPassword",(e=>{this.setState({currentPassword:e.target.value})})),ds(this,"updateNewPassword",(e=>{this.setState({newPassword:e.target.value})})),ds(this,"updateConfirmPassword",(e=>{this.setState({confirmPassword:e.target.value})})),ds(this,"deauthorizeApp",(async e=>{e.preventDefault();const t=e.currentTarget.getAttribute("data-app"),s=await this.props.actions.deauthorizeOAuthApp(t);if("data"in s){const e=this.state.authorizedApps.filter((e=>e.id!==t));this.setState({authorizedApps:e,serverError:null})}else if("error"in s){const{error:e}=s;this.setState({serverError:e.message})}})),ds(this,"handleUpdateSection",(e=>{if(e)this.props.updateSection(e);else{switch(this.props.activeSection){case"mfa":case ms:case hs:case ps:this.setState({serverError:null});break;case us:this.setState({currentPassword:"",newPassword:"",confirmPassword:"",serverError:null})}this.props.updateSection("")}})),ds(this,"createPasswordSection",(()=>{const e=[];let t;const s=this.props.activeSection===us;let a,i=null;if(s){if(""===this.props.user.auth_service)t=this.submitPassword,e.push(r().createElement("div",{key:"currentPasswordUpdateForm",className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label",htmlFor:"currentPassword"},r().createElement(c.FormattedMessage,{id:"user.settings.security.currentPassword",defaultMessage:"Current Password"})),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"currentPassword",name:"currentPassword",autoFocus:!0,type:"password",onChange:this.updateCurrentPassword,value:this.state.currentPassword,"aria-label":this.props.intl.formatMessage({id:"user.settings.security.currentPassword",defaultMessage:"Current Password"}),validate:e=>{if("string"!=typeof e||""===e)return{type:"error",value:r().createElement(c.FormattedMessage,{id:"user.settings.security.currentPasswordError",defaultMessage:"Please enter your current password."})}}})))),e.push(r().createElement("div",{key:"newPasswordUpdateForm",className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label",htmlFor:"newPassword"},r().createElement(c.FormattedMessage,{id:"user.settings.security.newPassword",defaultMessage:"New Password"})),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"newPassword",name:"newPassword",type:"password",onChange:this.updateNewPassword,value:this.state.newPassword,"aria-label":this.props.intl.formatMessage({id:"user.settings.security.newPassword",defaultMessage:"New Password"}),validate:e=>{const{valid:t,error:s}=(0,Xt.s)(e,this.props.passwordConfig);if(!t)return{type:"error",value:s}}})))),e.push(r().createElement("div",{key:"retypeNewPasswordUpdateForm",className:"form-group"},r().createElement("label",{className:"col-sm-5 control-label",htmlFor:"confirmPassword"},r().createElement(c.FormattedMessage,{id:"user.settings.security.retypePassword",defaultMessage:"Retype New Password"})),r().createElement("div",{className:"col-sm-7"},r().createElement(tt.A,{id:"confirmPassword",name:"confirmPassword",type:"password",onChange:this.updateConfirmPassword,value:this.state.confirmPassword,"aria-label":this.props.intl.formatMessage({id:"user.settings.security.retypePassword",defaultMessage:"Retype New Password"}),validate:e=>{if("string"==typeof e)return this.state.newPassword!==e?{type:"error",value:r().createElement(c.FormattedMessage,{id:"user.settings.security.passwordMatchError",defaultMessage:"The new passwords you entered do not match."})}:void 0}}))));else{const t={[b.Ay.GITLAB_SERVICE]:this.props.intl.formatMessage({id:"user.settings.security.passwordGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Password cannot be updated."}),[b.Ay.LDAP_SERVICE]:this.props.intl.formatMessage({id:"user.settings.security.passwordLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Password cannot be updated."}),[b.Ay.SAML_SERVICE]:this.props.intl.formatMessage({id:"user.settings.security.passwordSamlCantUpdate",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}),[b.Ay.GOOGLE_SERVICE]:this.props.intl.formatMessage({id:"user.settings.security.passwordGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Password cannot be updated."}),[b.Ay.OFFICE365_SERVICE]:this.props.intl.formatMessage({id:"user.settings.security.passwordOffice365CantUpdate",defaultMessage:"Login occurs through Entra ID. Password cannot be updated."}),[b.Ay.MAGIC_LINK_SERVICE]:this.props.intl.formatMessage({id:"user.settings.security.passwordMagicLinkCantUpdate",defaultMessage:"Login occurs via magic link. Password cannot be updated."})}[this.props.user.auth_service];t&&e.push(r().createElement("div",{key:"oauthEmailInfo",className:"form-group"},r().createElement("div",{className:"pb-3"},t)))}i=r().createElement(A.A,{title:r().createElement(c.FormattedMessage,{id:"user.settings.security.password",defaultMessage:"Password"}),inputs:e,submit:t,saving:this.state.savingPassword,serverError:this.state.serverError,updateSection:this.handleUpdateSection,isValid:this.isPasswordValid()})}if(""===this.props.user.auth_service){const e=new Date(this.props.user.last_password_update);a=r().createElement(c.FormattedMessage,{id:"user.settings.security.lastUpdated",defaultMessage:"Last updated {date} at {time}",values:{date:r().createElement(c.FormattedDate,{value:e,day:"2-digit",month:"short",year:"numeric"}),time:r().createElement(c.FormattedTime,{value:e,hour12:!this.props.militaryTime,hour:"2-digit",minute:"2-digit"})}})}else this.props.user.auth_service===b.Ay.GITLAB_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.loginGitlab",defaultMessage:"Login done through GitLab"}):this.props.user.auth_service===b.Ay.LDAP_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.loginLdap",defaultMessage:"Login done through AD/LDAP"}):this.props.user.auth_service===b.Ay.SAML_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.loginSaml",defaultMessage:"Login done through SAML"}):this.props.user.auth_service===b.Ay.GOOGLE_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.loginGoogle",defaultMessage:"Login done through Google Apps"}):this.props.user.auth_service===b.Ay.OFFICE365_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.loginOffice365",defaultMessage:"Login done through Entra ID"}):this.props.user.auth_service===b.Ay.MAGIC_LINK_SERVICE&&(a=r().createElement(c.FormattedMessage,{id:"user.settings.security.loginMagicLink",defaultMessage:"Login done through Magic Link"}));return r().createElement(M.A,{active:s,areAllSectionsInactive:""===this.props.activeSection,title:r().createElement(c.FormattedMessage,{id:"user.settings.security.password",defaultMessage:"Password"}),describe:a,section:us,updateSection:this.handleUpdateSection,max:i})})),ds(this,"createSignInSection",(()=>{const e=this.props.user,t=this.props.activeSection===ms;let s=null;if(t){let t,a,i,n,o,l,d;if(""===e.auth_service)this.props.enableSignUpWithGitLab&&(a=r().createElement("div",{className:"pb-3"},r().createElement(Rt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+b.Ay.GITLAB_SERVICE},r().createElement(c.FormattedMessage,{id:"user.settings.security.switchGitlab",defaultMessage:"Switch to Using GitLab SSO"})),r().createElement("br",null))),this.props.enableSignUpWithGoogle&&(i=r().createElement("div",{className:"pb-3"},r().createElement(Rt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+b.Ay.GOOGLE_SERVICE},r().createElement(c.FormattedMessage,{id:"user.settings.security.switchGoogle",defaultMessage:"Switch to Using Google SSO"})),r().createElement("br",null))),this.props.enableSignUpWithOffice365&&(n=r().createElement("div",{className:"pb-3"},r().createElement(Rt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+b.Ay.OFFICE365_SERVICE},r().createElement(c.FormattedMessage,{id:"user.settings.security.switchOffice365",defaultMessage:"Switch to Using Entra ID SSO"})),r().createElement("br",null))),this.props.enableSignUpWithOpenId&&(o=r().createElement("div",{className:"pb-3"},r().createElement(Rt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+b.Ay.OPENID_SERVICE},r().createElement(c.FormattedMessage,{id:"user.settings.security.switchOpenId",defaultMessage:"Switch to Using OpenID SSO"})),r().createElement("br",null))),this.props.enableLdap&&(l=r().createElement("div",{className:"pb-3"},r().createElement(Rt.Link,{className:"btn btn-primary",to:"/claim/email_to_ldap?email="+encodeURIComponent(e.email)},r().createElement(c.FormattedMessage,{id:"user.settings.security.switchLdap",defaultMessage:"Switch to Using AD/LDAP"})),r().createElement("br",null))),this.props.enableSaml&&(d=r().createElement("div",{className:"pb-3"},r().createElement(Rt.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+b.Ay.SAML_SERVICE},r().createElement(c.FormattedMessage,{id:"user.settings.security.switchSaml",defaultMessage:"Switch to Using SAML SSO"})),r().createElement("br",null)));else if(this.props.allowedToSwitchToEmail&&e.auth_service!==b.Ay.MAGIC_LINK_SERVICE){let s;s=e.auth_service===b.Ay.LDAP_SERVICE?"/claim/ldap_to_email?email="+encodeURIComponent(e.email):"/claim/oauth_to_email?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service,t=r().createElement("div",{className:"pb-3"},r().createElement(Rt.Link,{className:"btn btn-primary",to:s},r().createElement(c.FormattedMessage,{id:"user.settings.security.switchEmail",defaultMessage:"Switch to Using Email and Password"})),r().createElement("br",null))}const u=[];u.push(r().createElement("div",{key:"userSignInOption"},t,a,i,n,o,l,d));let m=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.security.oneSignin",defaultMessage:"You may only have one sign-in method at a time. Switching sign-in method will send an email notifying you if the change was successful."}));e.auth_service===b.Ay.MAGIC_LINK_SERVICE&&(m=r().createElement("span",null,r().createElement(c.FormattedMessage,{id:"user.settings.security.magicLinkInfo",defaultMessage:"Magic Link is the only sign-in method available for this account."}))),s=r().createElement(A.A,{title:this.props.intl.formatMessage({id:"user.settings.security.method",defaultMessage:"Sign-in Method"}),extraInfo:m,inputs:u,serverError:this.state.serverError,updateSection:this.handleUpdateSection})}let a=r().createElement(c.FormattedMessage,{id:"user.settings.security.emailPwd",defaultMessage:"Email and Password"});return this.props.user.auth_service===b.Ay.GITLAB_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.gitlab",defaultMessage:"GitLab"}):this.props.user.auth_service===b.Ay.GOOGLE_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.google",defaultMessage:"Google"}):this.props.user.auth_service===b.Ay.OFFICE365_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.office365",defaultMessage:"Entra ID"}):this.props.user.auth_service===b.Ay.OPENID_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.openid",defaultMessage:"OpenID"}):this.props.user.auth_service===b.Ay.LDAP_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.ldap",defaultMessage:"AD/LDAP"}):this.props.user.auth_service===b.Ay.SAML_SERVICE?a=r().createElement(c.FormattedMessage,{id:"user.settings.security.saml",defaultMessage:"SAML"}):this.props.user.auth_service===b.Ay.MAGIC_LINK_SERVICE&&(a=r().createElement(c.FormattedMessage,{id:"user.settings.security.magicLink",defaultMessage:"Magic Link"})),r().createElement(M.A,{active:t,areAllSectionsInactive:""===this.props.activeSection,title:this.props.intl.formatMessage({id:"user.settings.security.method",defaultMessage:"Sign-in Method"}),describe:a,section:ms,updateSection:this.handleUpdateSection,max:s})})),ds(this,"createOAuthAppsSection",(()=>{const e=this.props.activeSection===ps;let t=null;if(e){let e;e=this.state.authorizedApps&&this.state.authorizedApps.length>0?this.state.authorizedApps.map((e=>{const t=r().createElement(ee.A,{href:e.homepage,location:"user_settings_security"},e.homepage);return r().createElement("div",{key:e.id,className:"pb-3 authorized-app"},r().createElement("div",{className:"col-sm-10"},r().createElement("div",{className:"authorized-app__name"},e.name,r().createElement("span",{className:"authorized-app__url"}," -"," ",t)),r().createElement("div",{className:"authorized-app__description"},e.description),r().createElement("div",{className:"authorized-app__deauthorize"},r().createElement("a",{href:"#","data-app":e.id,onClick:this.deauthorizeApp},r().createElement(c.FormattedMessage,{id:"user.settings.security.deauthorize",defaultMessage:"Deauthorize"})))),r().createElement("div",{className:"col-sm-2 pull-right"},r().createElement("img",{alt:e.name,src:e.icon_url||Kt})),r().createElement("br",null))})):r().createElement("div",{className:"pb-3 authorized-app"},r().createElement("div",{className:"setting-list__hint"},r().createElement(c.FormattedMessage,{id:"user.settings.security.noApps",defaultMessage:"No OAuth 2.0 Applications are authorized."})));const s=[];let a,i;Array.isArray(e)&&(a="authorized-apps__wrapper",i=r().createElement("div",{className:"authorized-apps__help"},r().createElement(c.FormattedMessage,{id:"user.settings.security.oauthAppsHelp",defaultMessage:"Applications act on your behalf to access your data based on the permissions you grant them."}))),s.push(r().createElement("div",{className:a,key:"authorizedApps"},e));const n=r().createElement("div",null,r().createElement(c.FormattedMessage,{id:"user.settings.security.oauthApps",defaultMessage:"OAuth 2.0 Applications"}),i);t=r().createElement(A.A,{title:n,inputs:s,serverError:this.state.serverError,updateSection:this.handleUpdateSection,isFullWidth:!0,cancelButtonText:r().createElement(c.FormattedMessage,{id:"user.settings.security.close",defaultMessage:"Close"})})}return r().createElement(M.A,{active:e,areAllSectionsInactive:""===this.props.activeSection,title:this.props.intl.formatMessage({id:"user.settings.security.oauthApps",defaultMessage:"OAuth 2.0 Applications"}),describe:r().createElement(c.FormattedMessage,{id:"user.settings.security.oauthAppsDescription",defaultMessage:"Click 'Edit' to manage your OAuth 2.0 Applications"}),section:ps,updateSection:this.handleUpdateSection,max:t})})),this.state=this.getDefaultState()}getDefaultState(){return{currentPassword:"",newPassword:"",confirmPassword:"",serverError:"",tokenError:"",authService:this.props.user.auth_service,savingPassword:!1,authorizedApps:[]}}componentDidMount(){this.props.enableOAuthServiceProvider&&this.loadAuthorizedOAuthApps()}render(){const e=this.props.user,t=this.createPasswordSection();let s,a,i,n=0;return n=this.props.enableSignUpWithGitLab?n+1:n,n=this.props.enableSignUpWithGoogle?n+1:n,n=this.props.enableSignUpWithOffice365?n+1:n,n=this.props.enableSignUpWithOpenId?n+1:n,n=this.props.enableLdap?n+1:n,n=this.props.enableSaml?n+1:n,(this.props.allowedToSwitchToEmail||""===e.auth_service)&&n>0&&this.props.experimentalEnableAuthenticationTransfer&&(s=this.createSignInSection()),this.props.enableOAuthServiceProvider&&(a=this.createOAuthAppsSection()),this.props.canUseAccessTokens&&(i=r().createElement(cs,{user:this.props.user,active:this.props.activeSection===hs,areAllSectionsInactive:""===this.props.activeSection,updateSection:this.handleUpdateSection,setRequireConfirm:this.props.setRequireConfirm})),r().createElement("div",{id:"securitySettings","aria-labelledby":"securityButton",role:"tabpanel"},r().createElement(x.A,{closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,text:r().createElement(c.FormattedMessage,{id:"user.settings.security.title",defaultMessage:"Security Settings"})}),r().createElement("div",{className:"user-settings"},r().createElement(F.A,{text:r().createElement(c.FormattedMessage,{id:"user.settings.security.title",defaultMessage:"Security Settings"})}),r().createElement("div",{className:"divider-dark first"}),t,r().createElement("div",{className:"divider-light"}),r().createElement(ts,{active:"mfa"===this.props.activeSection,areAllSectionsInactive:""===this.props.activeSection,updateSection:this.handleUpdateSection}),r().createElement("div",{className:"divider-light"}),a,r().createElement("div",{className:"divider-light"}),i,r().createElement("div",{className:"divider-light"}),s,r().createElement("div",{className:"divider-dark"}),r().createElement("br",null),r().createElement(Jt.A,{className:"security-links color--link",modalId:"access_history",dialogType:xt,id:"viewAccessHistory"},r().createElement("i",{className:"icon icon-clock-outline",title:this.props.intl.formatMessage({id:"user.settings.security.viewHistory.icon",defaultMessage:"Access History Icon"}),"aria-hidden":"true"}),r().createElement(c.FormattedMessage,{id:"user.settings.security.viewHistory",defaultMessage:"View Access History"})),r().createElement(Jt.A,{className:"security-links color--link mt-2",modalId:"activity_log",dialogType:Wt,id:"viewAndLogOutOfActiveSessions"},r().createElement("i",{className:"icon icon-clock-outline",title:this.props.intl.formatMessage({id:"user.settings.security.logoutActiveSessions.icon",defaultMessage:"Active Sessions Icon"}),"aria-hidden":"true"}),r().createElement(c.FormattedMessage,{id:"user.settings.security.logoutActiveSessions",defaultMessage:"View and Log Out of Active Sessions"})),this.props.deleteAccountLink&&r().createElement(r().Fragment,null,r().createElement("p",null),r().createElement(ee.A,{className:"security-links color--link mt-2 danger",href:this.props.deleteAccountLink,id:"deleteAccountLink",location:window.location.href},r().createElement("i",{className:"icon icon-trash-can-outline",title:this.props.intl.formatMessage({id:"user.settings.security.deleteAccountLink.icon",defaultMessage:"Delete Account Icon"}),"aria-hidden":"true"}),r().createElement(c.FormattedMessage,{id:"user.settings.security.deleteAccountLink",defaultMessage:"Delete Your Account"})))))}}ds(gs,"propTypes",{activeSection:i().string,updateSection:i().func.isRequired,closeModal:i().func.isRequired,collapseModal:i().func.isRequired,setRequireConfirm:i().func.isRequired,canUseAccessTokens:i().bool.isRequired,enableOAuthServiceProvider:i().bool.isRequired,allowedToSwitchToEmail:i().bool.isRequired,enableSignUpWithGitLab:i().bool.isRequired,enableSignUpWithGoogle:i().bool.isRequired,enableSignUpWithOpenId:i().bool.isRequired,enableLdap:i().bool.isRequired,enableSaml:i().bool.isRequired,enableSignUpWithOffice365:i().bool.isRequired,experimentalEnableAuthenticationTransfer:i().bool.isRequired,militaryTime:i().bool.isRequired,actions:i().shape({getMe:i().func.isRequired,updateUserPassword:i().func.isRequired,getAuthorizedOAuthApps:i().func.isRequired,deauthorizeOAuthApp:i().func.isRequired}).isRequired,deleteAccountLink:i().string});const fs=(0,c.injectIntl)(gs),Es=(0,p.connect)((function(e,t){const s=(0,E.zj)(e),a="true"===s.EnableUserAccessTokens,i=Ot.DA(t.user.roles)||Ot.FV(t.user.roles);return{canUseAccessTokens:a&&i,enableOAuthServiceProvider:"true"===s.EnableOAuthServiceProvider,allowedToSwitchToEmail:"true"===s.EnableSignUpWithEmail&&("true"===s.EnableSignInWithEmail||"true"===s.EnableSignInWithUsername),enableSignUpWithGitLab:"true"===s.EnableSignUpWithGitLab,enableSignUpWithGoogle:"true"===s.EnableSignUpWithGoogle,enableSignUpWithOpenId:"true"===s.EnableSignUpWithOpenId,enableLdap:"true"===s.EnableLdap,enableSaml:"true"===s.EnableSaml,enableSignUpWithOffice365:"true"===s.EnableSignUpWithOffice365,experimentalEnableAuthenticationTransfer:"true"===s.ExperimentalEnableAuthenticationTransfer,passwordConfig:(0,E.OG)(e),militaryTime:(0,v.Jz)(e,b.pm.CATEGORY_DISPLAY_SETTINGS,b.pm.USE_MILITARY_TIME,!1),deleteAccountLink:s.DeleteAccountLink}}),(function(e){return{actions:(0,h.zH)({getMe:f.jp,updateUserPassword:f.ej,getAuthorizedOAuthApps:kt.Zy,deauthorizeOAuthApp:kt.ni},e)}}))(fs);function vs(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function Ss(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?vs(Object(s),!0).forEach((function(t){bs(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):vs(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function bs(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ys=[{value:10,label:"10"},{value:15,label:"15"},{value:20,label:"20"},{value:40,label:"40"}];class Ms extends r().PureComponent{constructor(e){super(e),bs(this,"handleChange",(e=>{e&&"value"in e&&this.setState({limit:e})})),bs(this,"handleSubmit",(async()=>{this.props.userId&&(this.setState({isSaving:!0}),await this.props.savePreferences(this.props.userId,[{user_id:this.props.userId,category:C.pm.CATEGORY_SIDEBAR_SETTINGS,name:C.pm.LIMIT_VISIBLE_DMS_GMS,value:this.state.limit.value.toString()}]),this.setState({isSaving:!1}),this.props.updateSection(""))})),bs(this,"renderDescription",(()=>r().createElement("span",null,this.state.limit.label))),this.state={active:!1,limit:{value:20,label:"20"},isSaving:!1},this.minRef=r().createRef()}static getDerivedStateFromProps(e,t){return e.active!==t.active?e.active&&!t.active?{limit:ys.find((t=>t.value===e.dmGmLimit)),active:e.active}:{active:e.active}:e.active?null:{limit:ys.find((t=>t.value===e.dmGmLimit))}}focusEditButton(){var e;null===(e=this.minRef.current)||void 0===e||e.focus()}componentDidUpdate(e){e.active&&!this.props.active&&this.props.areAllSectionsInactive&&this.focusEditButton()}render(){const e=r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.limitVisibleGMsDMsTitle",defaultMessage:"Number of direct messages to show"});return this.props.active?r().createElement(A.A,{title:e,inputs:r().createElement("fieldset",null,r().createElement("legend",{className:"form-legend hidden-label"},e),r().createElement(Me.Ay,{className:"react-select",classNamePrefix:"react-select",id:"limitVisibleGMsDMs",options:ys,isClearable:!1,onChange:this.handleChange,value:this.state.limit,isSearchable:!1,menuPortalTarget:document.body,styles:As}),r().createElement("div",{className:"mt-5"},r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.limitVisibleGMsDMsDesc",defaultMessage:"You can also change these settings in the direct messages sidebar menu."}))),submit:this.handleSubmit,saving:this.state.isSaving,updateSection:this.props.updateSection}):r().createElement(w.A,{title:e,describe:this.renderDescription(),section:"limitVisibleGMsDMs",updateSection:this.props.updateSection,ref:this.minRef})}}const As={menuPortal:e=>Ss(Ss({},e),{},{zIndex:9999})},Ts={savePreferences:g.SF},_s=(0,p.connect)((function(e,t){const s=t.adminMode&&t.userPreferences?t.userPreferences:void 0;return{userId:t.adminMode?t.userId:(0,S.WR)(e),dmGmLimit:(0,v.pR)(e,s)}}),Ts)(Ms);function Cs(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class ws extends r().PureComponent{constructor(e){super(e),Cs(this,"handleChange",(e=>{this.setState({checked:"true"===e.target.value}),(0,_.b6)(e.target)})),Cs(this,"handleSubmit",(async()=>{this.props.userId&&(this.setState({isSaving:!0}),await this.props.savePreferences(this.props.userId,[{user_id:this.props.userId,category:C.pm.CATEGORY_SIDEBAR_SETTINGS,name:C.pm.SHOW_UNREAD_SECTION,value:this.state.checked.toString()}]),this.setState({isSaving:!1}),this.props.updateSection(""))})),Cs(this,"renderDescription",(()=>this.props.showUnreadsCategory?r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.on",defaultMessage:"On"}):r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.off",defaultMessage:"Off"}))),this.state={active:!1,checked:!1,isSaving:!1},this.minRef=r().createRef()}static getDerivedStateFromProps(e,t){return e.active!==t.active?e.active&&!t.active?{checked:e.showUnreadsCategory,active:e.active}:{active:e.active}:null}focusEditButton(){var e;null===(e=this.minRef.current)||void 0===e||e.focus()}componentDidUpdate(e){e.active&&!this.props.active&&this.props.areAllSectionsInactive&&this.focusEditButton()}render(){const e=r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.showUnreadsCategoryTitle",defaultMessage:"Group unread channels separately"});return this.props.active?r().createElement(A.A,{title:e,inputs:r().createElement("fieldset",null,r().createElement("legend",{className:"form-legend hidden-label"},e),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{"data-testid":"showUnreadsCategoryOn",type:"radio",name:"showUnreadsCategory",checked:this.state.checked,onChange:()=>this.setState({checked:!0})}),r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.on",defaultMessage:"On"})),r().createElement("br",null)),r().createElement("div",{className:"radio"},r().createElement("label",null,r().createElement("input",{"data-testid":"showUnreadsCategoryOff",type:"radio",name:"showUnreadsCategory",checked:!this.state.checked,onChange:()=>this.setState({checked:!1})}),r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.off",defaultMessage:"Off"})),r().createElement("br",null)),r().createElement("div",{className:"mt-5"},r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.showUnreadsCategoryDesc",defaultMessage:"When enabled, all unread channels and direct messages will be grouped together in the sidebar."}))),submit:this.handleSubmit,saving:this.state.isSaving,updateSection:this.props.updateSection}):r().createElement(w.A,{title:e,describe:this.renderDescription(),section:"showUnreadsCategory",updateSection:this.props.updateSection,ref:this.minRef})}}const Ns={savePreferences:g.SF},Ps=(0,p.connect)((function(e,t){const s=t.adminMode&&t.userPreferences?t.userPreferences:void 0;return{userId:t.adminMode?t.userId:(0,S.WR)(e),showUnreadsCategory:(0,v.pE)(e,s)}}),Ns)(ws);function ks(e){return r().createElement("div",{id:"sidebarSettings","aria-labelledby":"sidebarButton",role:"tabpanel"},r().createElement(x.A,{closeModal:e.closeModal,collapseModal:e.collapseModal,text:r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.title",defaultMessage:"Sidebar Settings"})}),r().createElement("div",{id:"sidebarTitle",className:"user-settings"},r().createElement(F.A,{text:r().createElement(c.FormattedMessage,{id:"user.settings.sidebar.title",defaultMessage:"Sidebar Settings"})}),r().createElement("div",{className:"divider-dark first"}),r().createElement(Ps,{active:"showUnreadsCategory"===e.activeSection,updateSection:e.updateSection,areAllSectionsInactive:""===e.activeSection,adminMode:e.adminMode,userId:e.userId,userPreferences:e.userPreferences}),r().createElement("div",{className:"divider-dark"}),r().createElement(_s,{active:"limitVisibleGMsDMs"===e.activeSection,updateSection:e.updateSection,areAllSectionsInactive:""===e.activeSection,adminMode:e.adminMode,userId:e.userId,userPreferences:e.userPreferences}),r().createElement("div",{className:"divider-dark"})))}ks.propTypes={updateSection:i().func.isRequired,activeSection:i().string.isRequired,closeModal:i().func.isRequired,collapseModal:i().func.isRequired,adminMode:i().bool,userId:i().string.isRequired};const Os=ks;function Rs(e){return"profile"===e.activeTab?r().createElement("div",null,r().createElement(dt,{user:e.user,activeSection:e.activeSection,updateSection:e.updateSection,updateTab:e.updateTab,closeModal:e.closeModal,collapseModal:e.collapseModal})):"security"===e.activeTab?r().createElement("div",null,r().createElement(Es,{user:e.user,activeSection:e.activeSection,updateSection:e.updateSection,closeModal:e.closeModal,collapseModal:e.collapseModal,setRequireConfirm:e.setRequireConfirm})):"notifications"===e.activeTab?r().createElement("div",null,r().createElement(gt,{user:e.user,activeSection:e.activeSection,updateSection:e.updateSection,closeModal:e.closeModal,collapseModal:e.collapseModal,adminMode:e.adminMode,userPreferences:e.userPreferences})):"display"===e.activeTab?r().createElement("div",null,r().createElement(Ye,{user:e.user,activeSection:e.activeSection,updateSection:e.updateSection,closeModal:e.closeModal,collapseModal:e.collapseModal,setRequireConfirm:e.setRequireConfirm,adminMode:e.adminMode,userPreferences:e.userPreferences})):"sidebar"===e.activeTab?r().createElement("div",null,r().createElement(Os,{activeSection:e.activeSection,updateSection:e.updateSection,closeModal:e.closeModal,collapseModal:e.collapseModal,adminMode:e.adminMode,userId:e.user.id,userPreferences:e.userPreferences})):"advanced"===e.activeTab?r().createElement("div",null,r().createElement(z,{activeSection:e.activeSection,updateSection:e.updateSection,closeModal:e.closeModal,collapseModal:e.collapseModal,adminMode:e.adminMode,user:e.user,userPreferences:e.userPreferences})):e.activeTab&&e.pluginSettings[e.activeTab]?r().createElement("div",null,r().createElement(Pt,{activeSection:e.activeSection,updateSection:e.updateSection,closeModal:e.closeModal,collapseModal:e.collapseModal,settings:e.pluginSettings[e.activeTab]})):null}Rs.propTypes={activeTab:i().string,activeSection:i().string.isRequired,updateSection:i().func.isRequired,updateTab:i().func.isRequired,closeModal:i().func.isRequired,collapseModal:i().func.isRequired,setRequireConfirm:i().func.isRequired,adminMode:i().bool};var Is=s(53654);const Ds=e=>{let{loading:t,children:s,className:a,onLoaded:i}=e;const[o,l]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{setTimeout((()=>{l(!0)}),1e3)}),[]),(0,n.useEffect)((()=>{!t&&o&&i()}),[t,o,i]),t||!o?r().createElement("div",{className:"SmartLoader ".concat(a)},s):null};Ds.propTypes={loading:i().bool.isRequired,children:i().node.isRequired,className:i().string,onLoaded:i().func.isRequired};const Ls=Ds;var Fs=s(30138),xs=s(36003);function Us(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class js extends r().PureComponent{constructor(e){var t;super(e),Us(this,"handleResend",(e=>{this.setState({resendStatus:"sending"}),this.props.actions.sendVerificationEmail(e).then((e=>{let{data:t,error:s}=e;t?this.setState({resendStatus:"success"}):s&&this.setState({resendStatus:"failure"})}))})),Us(this,"setLoadingFinished",(()=>{this.setState({loading:!1})})),Us(this,"handleKeyDown",(e=>{(0,Ae.r)(e)&&e.shiftKey&&(0,Ae.e)(e,b.Ay.KeyCodes.A)&&(e.preventDefault(),this.handleHide())})),Us(this,"handleHide",(()=>{this.requireConfirm?this.showConfirmModal((()=>this.handleHide())):((0,xs.$c)(),this.setState({show:!1}))})),Us(this,"handleHidden",(()=>{this.setState({active_tab:this.props.isContentProductSettings?"notifications":"profile",active_section:""}),this.props.focusOriginElement&&(0,Fs.p)(this.props.focusOriginElement,!0),this.props.onExited()})),Us(this,"handleCollapse",(()=>{l().findDOMNode(this.modalBodyRef.current).closest(".modal-dialog").classList.remove("display--content"),this.setState({active_tab:"",active_section:""})})),Us(this,"handleConfirm",(()=>{this.setState({showConfirmModal:!1,enforceFocus:!0}),this.requireConfirm=!1,this.customConfirmAction=null,this.afterConfirm&&(this.afterConfirm(),this.afterConfirm=null)})),Us(this,"handleCancelConfirmation",(()=>{this.setState({showConfirmModal:!1,enforceFocus:!0}),this.afterConfirm=null})),Us(this,"showConfirmModal",(e=>{e&&(this.afterConfirm=e),this.customConfirmAction?this.customConfirmAction(this.handleConfirm):this.setState({showConfirmModal:!0,enforceFocus:!1})})),Us(this,"closeModal",(()=>{this.requireConfirm?this.showConfirmModal(this.closeModal):this.handleHide()})),Us(this,"collapseModal",(()=>{this.requireConfirm?this.showConfirmModal(this.collapseModal):this.handleCollapse()})),Us(this,"updateTab",((e,t)=>{!t&&this.requireConfirm?this.showConfirmModal((()=>this.updateTab(e,!0))):this.setState({active_tab:e,active_section:""})})),Us(this,"updateSection",((e,t)=>{!t&&this.requireConfirm?this.showConfirmModal((()=>this.updateSection(e,!0))):this.setState({active_section:null!=e?e:""})})),Us(this,"getUserSettingsTabs",(()=>{const{formatMessage:e}=this.props.intl;return[{name:"notifications",uiName:e({id:"user.settings.modal.notifications",defaultMessage:"Notifications"}),icon:"icon icon-bell-outline",iconTitle:e({id:"user.settings.notifications.icon",defaultMessage:"Notification Settings Icon"})},{name:"display",uiName:e({id:"user.settings.modal.display",defaultMessage:"Display"}),icon:"icon icon-eye-outline",iconTitle:e({id:"user.settings.display.icon",defaultMessage:"Display Settings Icon"})},{name:"sidebar",uiName:e({id:"user.settings.modal.sidebar",defaultMessage:"Sidebar"}),icon:"icon icon-dock-left",iconTitle:e({id:"user.settings.sidebar.icon",defaultMessage:"Sidebar Settings Icon"})},{name:"advanced",uiName:e({id:"user.settings.modal.advanced",defaultMessage:"Advanced"}),icon:"icon icon-tune",iconTitle:e({id:"user.settings.advance.icon",defaultMessage:"Advanced Settings Icon"})}]})),Us(this,"getProfileSettingsTab",(()=>{const{formatMessage:e}=this.props.intl;return[{name:"profile",uiName:e({id:"user.settings.modal.profile",defaultMessage:"Profile"}),icon:"icon icon-settings-outline",iconTitle:e({id:"user.settings.profile.icon",defaultMessage:"Profile Settings Icon"})},{name:"security",uiName:e({id:"user.settings.modal.security",defaultMessage:"Security"}),icon:"icon icon-lock-outline",iconTitle:e({id:"user.settings.security.icon",defaultMessage:"Security Settings Icon"})}]})),Us(this,"getPluginsSettingsTab",(()=>Object.values(this.props.pluginSettings).map((e=>{const t=e.icon&&((0,st.AY)(e.icon)||e.icon.startsWith("/")),s=e.icon?"icon ".concat(e.icon):"icon icon-power-plug-outline";return{name:e.id,uiName:e.uiName,icon:t?{url:e.icon}:s,iconTitle:e.uiName}})))),this.state={active_tab:null!==(t=e.activeTab)&&void 0!==t?t:e.isContentProductSettings?"notifications":"profile",active_section:"",showConfirmModal:!1,enforceFocus:!0,show:!0,resendStatus:"",loading:!1},this.requireConfirm=!1,this.customConfirmAction=null,this.afterConfirm=null,this.modalBodyRef=r().createRef()}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown),this.props.adminMode&&this.props.userID&&(this.setState({loading:!0}),this.props.userPreferences||this.props.actions.getUserPreferences(this.props.userID),this.props.user||this.props.actions.getUser(this.props.userID)),this.props.adminMode||this.setState({loading:!1})}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(e,t){this.state.active_tab!==t.active_tab&&this.modalBodyRef.current&&(this.modalBodyRef.current.scrollTop=0)}render(){const{formatMessage:e}=this.props.intl;let t;t=this.props.adminMode&&this.props.user?e({id:"userSettings.adminMode.modal_header",defaultMessage:"{userDisplayName}'s Settings"},{userDisplayName:(0,_.Mn)(this.props.user)}):this.props.isContentProductSettings?e({id:"global_header.productSettings",defaultMessage:"Settings"}):e({id:"user.settings.modal.title",defaultMessage:"Profile"});const s=r().createElement("div",{className:"UserSettingsModal__headerWrapper",id:"accountSettingsHeader"},r().createElement("span",{id:"accountSettingsModalLabel",className:"modal-header__title"},t),this.props.adminMode&&r().createElement("div",{className:"adminModeBadge"},r().createElement(c.FormattedMessage,{id:"userSettings.adminMode.admin_mode_badge",defaultMessage:"Admin Mode"})));return r().createElement(d.zW,{id:"accountSettingsModal",className:"a11y__modal settings-modal UserSettingsModal",show:this.state.show,onHide:this.handleHide,onExited:this.handleHidden,ariaLabel:t,compassDesign:!0,enforceFocus:this.state.enforceFocus,bodyPadding:!1,modalHeaderText:s,modalLocation:"top",delayFocusTrap:!0},r().createElement("div",{ref:this.modalBodyRef},this.props.adminMode&&r().createElement(Ls,{loading:this.props.adminMode&&(!this.props.userPreferences||!this.props.user),className:"loadingIndicator",onLoaded:this.setLoadingFinished},r().createElement(Is.A,null)),!this.state.loading&&this.props.user&&r().createElement(r().Fragment,null,r().createElement("div",{className:"settings-table"},r().createElement("div",{className:"settings-links"},r().createElement(m.default,{tabs:this.props.isContentProductSettings?this.getUserSettingsTabs():this.getProfileSettingsTab(),pluginTabs:this.props.isContentProductSettings?this.getPluginsSettingsTab():[],activeTab:this.state.active_tab,updateTab:this.updateTab})),r().createElement("div",{className:"settings-content minimize-settings"},r().createElement(Rs,{activeTab:this.state.active_tab,activeSection:this.state.active_section,updateSection:this.updateSection,updateTab:this.updateTab,closeModal:this.closeModal,collapseModal:this.collapseModal,setRequireConfirm:(e,t)=>{this.requireConfirm=e||!1,this.customConfirmAction=t||null},pluginSettings:this.props.pluginSettings,user:this.props.user,adminMode:this.props.adminMode,userPreferences:this.props.userPreferences}))))),r().createElement(u.A,{title:e({id:"user.settings.modal.confirmTitle",defaultMessage:"Discard Changes?"}),message:e({id:"user.settings.modal.confirmMsg",defaultMessage:"You have unsaved changes, are you sure you want to discard them?"}),confirmButtonText:e({id:"user.settings.modal.confirmBtns",defaultMessage:"Yes, Discard"}),show:this.state.showConfirmModal,onConfirm:this.handleConfirm,onCancel:this.handleCancelConfirmation}))}}Us(js,"propTypes",{userID:i().string,adminMode:i().bool,isContentProductSettings:i().bool.isRequired,activeTab:i().string,onExited:i().func.isRequired,focusOriginElement:i().string,actions:i().shape({sendVerificationEmail:i().func.isRequired,getUserPreferences:i().func.isRequired,getUser:i().func.isRequired}).isRequired});const qs=(0,c.injectIntl)(js)},84295:(e,t,s)=>{s.d(t,{A:()=>l});var a=s(68102),i=s(36418),n=s(22580),r=s(36512),o=s(50026),l=(s(40140),s(93759),(0,i.forwardRef)((function(e,t){var s=(0,r.u)(e),l=(0,o.u)(s);return i.createElement(n.S,(0,a.A)({ref:t},l))})))},50026:(e,t,s)=>{s.d(t,{u:()=>m});var a=s(27405),i=s(94300),n=s(81515),r=s(36418),o=s(7453),l=s(22580),c=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],d=function(){var e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,s=String(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toLowerCase(),a=String(t.getOptionValue(e)).toLowerCase(),i=String(t.getOptionLabel(e)).toLowerCase();return a===s||i===s},u={formatCreateLabel:function(e){return'Create "'.concat(e,'"')},isValidNewOption:function(e,t,s,a){return!(!e||t.some((function(t){return d(e,t,a)}))||s.some((function(t){return d(e,t,a)})))},getNewOptionData:function(e,t){return{label:t,value:e,__isNew__:!0}}};function m(e){var t=e.allowCreateWhileLoading,s=void 0!==t&&t,d=e.createOptionPosition,m=void 0===d?"last":d,p=e.formatCreateLabel,h=void 0===p?u.formatCreateLabel:p,g=e.isValidNewOption,f=void 0===g?u.isValidNewOption:g,E=e.getNewOptionData,v=void 0===E?u.getNewOptionData:E,S=e.onCreateOption,b=e.options,y=void 0===b?[]:b,M=e.onChange,A=(0,n.A)(e,c),T=A.getOptionValue,_=void 0===T?l.g:T,C=A.getOptionLabel,w=void 0===C?l.b:C,N=A.inputValue,P=A.isLoading,k=A.isMulti,O=A.value,R=A.name,I=(0,r.useMemo)((function(){return f(N,(0,o.H)(O),y,{getOptionValue:_,getOptionLabel:w})?v(N,h(N)):void 0}),[h,v,w,_,N,f,y,O]),D=(0,r.useMemo)((function(){return!s&&P||!I?y:"first"===m?[I].concat((0,i.A)(y)):[].concat((0,i.A)(y),[I])}),[s,m,P,I,y]),L=(0,r.useCallback)((function(e,t){if("select-option"!==t.action)return M(e,t);var s=Array.isArray(e)?e:[e];if(s[s.length-1]!==I)M(e,t);else if(S)S(N);else{var a=v(N,N),n={action:"create-option",name:R,option:a};M((0,o.D)(k,[].concat((0,i.A)((0,o.H)(O)),[a]),a),n)}}),[v,N,k,R,I,S,M,O]);return(0,a.A)((0,a.A)({},A),{},{options:D,onChange:L})}}}]);
//# sourceMappingURL=5200.70f19b4666ba015167dd.js.map