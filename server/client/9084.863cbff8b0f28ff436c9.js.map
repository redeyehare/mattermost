{"version":3,"file":"9084.863cbff8b0f28ff436c9.js","mappings":"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","sources":["webpack://mattermost-webapp/./src/components/channel_header/channel_header_title_direct.tsx","webpack://mattermost-webapp/./src/components/channel_header/channel_header_title_group.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/channel_bookmarks_submenu.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/close_message.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/edit_conversation_header.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/plugins_submenu.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/toggle_favorite_channel.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/toggle_info.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/toggle_mute_channel.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/view_pinned_posts.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/channel_header_menu_items/channel_header_direct_menu.tsx","webpack://mattermost-webapp/./src/components/convert_gm_to_channel_modal/no_common_teams/no_common_teams.tsx","webpack://mattermost-webapp/./src/components/convert_gm_to_channel_modal/team_selector/team_selector.tsx","webpack://mattermost-webapp/./src/components/convert_gm_to_channel_modal/warning_text_section/warning_text_section.tsx","webpack://mattermost-webapp/./src/components/convert_gm_to_channel_modal/convert_gm_to_channel_modal.tsx","webpack://mattermost-webapp/./src/components/convert_gm_to_channel_modal/index.ts","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/convert_gm_to_private.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/notification.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/open_members_rhs.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/channel_header_menu_items/channel_header_group_menu.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/channel_header_menu_items/channel_header_mobile_menu.tsx","webpack://mattermost-webapp/./src/components/delete_channel_modal/delete_channel_modal.tsx","webpack://mattermost-webapp/./src/components/delete_channel_modal/index.ts","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/archive_channel.tsx","webpack://mattermost-webapp/./src/selectors/views/channel_settings.ts","webpack://mattermost-webapp/./src/components/system_policy_indicator/system_policy_indicator.tsx","webpack://mattermost-webapp/./src/components/channel_settings_modal/channel_activity_warning_modal.tsx","webpack://mattermost-webapp/./src/components/channel_settings_modal/channel_settings_access_rules_tab.tsx","webpack://mattermost-webapp/./src/hooks/useChannelSystemPolicies.ts","webpack://mattermost-webapp/./src/components/channel_settings_modal/channel_settings_archive_tab.tsx","webpack://mattermost-webapp/./src/components/channel_settings_modal/channel_settings_configuration_tab.tsx","webpack://mattermost-webapp/./src/components/channel_settings_modal/channel_settings_info_tab.tsx","webpack://mattermost-webapp/./src/components/channel_settings_modal/channel_settings_modal.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/channel_settings_menu.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/close_channel.tsx","webpack://mattermost-webapp/./src/components/channel_groups_manage_modal/channel_groups_manage_modal.tsx","webpack://mattermost-webapp/./src/components/channel_groups_manage_modal/index.ts","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/groups.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/leave_channel.tsx","webpack://mattermost-webapp/./src/components/unarchive_channel_modal/unarchive_channel_modal.tsx","webpack://mattermost-webapp/./src/components/unarchive_channel_modal/index.ts","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/unarchive_channel.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/channel_header_menu_items/channel_header_public_private_menu.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/channel_header_menu.tsx","webpack://mattermost-webapp/./src/components/channel_header_menu/menu_items/mobile_channel_header_plugins.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {memo} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport type {UserProfile} from '@mattermost/types/users';\r\n\r\nimport {getTeammateNameDisplaySetting} from 'mattermost-redux/selectors/entities/preferences';\r\nimport {getCurrentUser} from 'mattermost-redux/selectors/entities/users';\r\nimport {displayUsername, isGuest} from 'mattermost-redux/utils/user_utils';\r\n\r\nimport GuestTag from 'components/widgets/tag/guest_tag';\r\n\r\ntype Props = {\r\n    dmUser?: UserProfile;\r\n}\r\n\r\nconst ChannelHeaderTitleDirect = ({\r\n    dmUser,\r\n}: Props) => {\r\n    const currentUser = useSelector(getCurrentUser);\r\n    const teammateNameDisplaySetting = useSelector(getTeammateNameDisplaySetting);\r\n    const displayName = displayUsername(dmUser, teammateNameDisplaySetting);\r\n\r\n    return (\r\n        <>\r\n            {currentUser.id !== dmUser?.id && displayName + ' '}\r\n            {currentUser.id === dmUser?.id &&\r\n                <FormattedMessage\r\n                    id='channel_header.directchannel.you'\r\n                    defaultMessage='{displayName} (you) '\r\n                    values={{displayName}}\r\n                />}\r\n            {isGuest(dmUser?.roles ?? '') && <GuestTag/>}\r\n        </>\r\n    );\r\n};\r\n\r\nexport default memo(ChannelHeaderTitleDirect);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {memo} from 'react';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport type {UserProfile} from '@mattermost/types/users';\r\n\r\nimport {getCurrentChannel} from 'mattermost-redux/selectors/entities/channels';\r\nimport {getTeammateNameDisplaySetting} from 'mattermost-redux/selectors/entities/preferences';\r\nimport {getCurrentUser} from 'mattermost-redux/selectors/entities/users';\r\nimport {displayUsername, isGuest} from 'mattermost-redux/utils/user_utils';\r\n\r\nimport GuestTag from 'components/widgets/tag/guest_tag';\r\n\r\ntype Props = {\r\n    gmMembers?: UserProfile[];\r\n}\r\n\r\nconst ChannelHeaderTitleGroup = ({\r\n    gmMembers,\r\n}: Props) => {\r\n    const currentUser = useSelector(getCurrentUser);\r\n    const teammateNameDisplaySetting = useSelector(getTeammateNameDisplaySetting);\r\n    const channel = useSelector(getCurrentChannel);\r\n\r\n    if (!channel) {\r\n        return null;\r\n    }\r\n\r\n    // map the displayname to the gm member users\r\n    const membersMap: Record<string, UserProfile[]> = {};\r\n    if (gmMembers) {\r\n        for (const user of gmMembers) {\r\n            if (user.id === currentUser.id) {\r\n                continue;\r\n            }\r\n            const userDisplayName = displayUsername(user, teammateNameDisplaySetting);\r\n\r\n            if (!membersMap[userDisplayName]) {\r\n                membersMap[userDisplayName] = []; //Create an array for cases with same display name\r\n            }\r\n\r\n            membersMap[userDisplayName].push(user);\r\n        }\r\n    }\r\n\r\n    const displayNames = channel.display_name.split(', ');\r\n\r\n    return (\r\n        <>\r\n            {displayNames.map((displayName, index) => {\r\n                if (!membersMap[displayName]) {\r\n                    return displayName;\r\n                }\r\n\r\n                const user = membersMap[displayName].shift();\r\n\r\n                return (\r\n                    <React.Fragment key={user?.id}>\r\n                        {index > 0 && ', '}\r\n                        {displayName}\r\n                        {isGuest(user?.roles ?? '') && <GuestTag/>}\r\n                    </React.Fragment>\r\n                );\r\n            })}\r\n        </>\r\n    );\r\n};\r\n\r\nexport default memo(ChannelHeaderTitleGroup);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\n// Purpose of this file to exists is only required until channel header dropdown is migrated to new menus\r\nimport React, {memo} from 'react';\r\nimport {FormattedMessage, useIntl} from 'react-intl';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport {\r\n    ChevronRightIcon,\r\n    LinkVariantIcon,\r\n    PaperclipIcon,\r\n    BookmarkOutlineIcon,\r\n} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {getChannelBookmarks} from 'mattermost-redux/selectors/entities/channel_bookmarks';\r\n\r\nimport {useBookmarkAddActions} from 'components/channel_bookmarks/channel_bookmarks_menu';\r\nimport {MAX_BOOKMARKS_PER_CHANNEL, useCanUploadFiles, useChannelBookmarkPermission} from 'components/channel_bookmarks/utils';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n};\r\n\r\nconst ChannelBookmarksSubmenu = (props: Props) => {\r\n    const {formatMessage} = useIntl();\r\n\r\n    const {handleCreateLink, handleCreateFile} = useBookmarkAddActions(props.channel.id);\r\n    const canAdd = useChannelBookmarkPermission(props.channel.id, 'add');\r\n    const canUploadFiles = useCanUploadFiles();\r\n\r\n    useSelector((state: GlobalState) => {\r\n        const bookmarks = getChannelBookmarks(state, props.channel.id);\r\n        return bookmarks && Object.keys(bookmarks).length >= MAX_BOOKMARKS_PER_CHANNEL;\r\n    });\r\n\r\n    if (!canAdd) {\r\n        return null;\r\n    }\r\n    return (\r\n        <Menu.SubMenu\r\n            id={`channel-menu-${props.channel.id}-bookmarks`}\r\n            leadingElement={<BookmarkOutlineIcon size={18}/>}\r\n            labels={(\r\n                <FormattedMessage\r\n                    id='channel_menu.bookmarks'\r\n                    defaultMessage='Bookmarks Bar'\r\n                />\r\n            )}\r\n            trailingElements={(\r\n                <ChevronRightIcon size={16}/>\r\n            )}\r\n            menuId={`channel-menu-${props.channel.id}-menu`}\r\n            menuAriaLabel={formatMessage({id: 'channel_menu.bookmarks', defaultMessage: 'Bookmarks Bar'})}\r\n        >\r\n            <Menu.Item\r\n                id={`channel-menu-${props.channel.id}-bookmarks-link`}\r\n                leadingElement={<LinkVariantIcon size={18}/>}\r\n                labels={(\r\n                    <FormattedMessage\r\n                        id='channel_menu.bookmarks.addLink'\r\n                        defaultMessage='Add a link'\r\n                    />\r\n                )}\r\n                onClick={() => handleCreateLink()}\r\n            />\r\n            {canUploadFiles && (\r\n                <Menu.Item\r\n                    id={`channel-menu-${props.channel.id}-bookmarks-file`}\r\n                    leadingElement={<PaperclipIcon size={18}/>}\r\n                    labels={(\r\n                        <FormattedMessage\r\n                            id='channel_menu.bookmarks.addFile'\r\n                            defaultMessage='Attach a file'\r\n                        />\r\n                    )}\r\n                    onClick={() => handleCreateFile()}\r\n                />\r\n            )}\r\n        </Menu.SubMenu>\r\n    );\r\n};\r\n\r\nexport default memo(ChannelBookmarksSubmenu);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\n\r\nimport {CloseIcon} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {savePreferences} from 'mattermost-redux/actions/preferences';\r\nimport {getRedirectChannelNameForCurrentTeam} from 'mattermost-redux/selectors/entities/channels';\r\nimport {getCurrentTeam} from 'mattermost-redux/selectors/entities/teams';\r\n\r\nimport {leaveDirectChannel} from 'actions/views/channel';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {getHistory} from 'utils/browser_history';\r\nimport {Constants} from 'utils/constants';\r\n\r\ntype Props = {\r\n    currentUserID: string;\r\n    channel: Channel;\r\n    id?: string;\r\n};\r\n\r\nexport default function CloseMessage(props: Props) {\r\n    const dispatch = useDispatch();\r\n    const currentTeam = useSelector(getCurrentTeam);\r\n    const redirectChannel = useSelector(getRedirectChannelNameForCurrentTeam);\r\n\r\n    const handleClose = () => {\r\n        const {\r\n            channel,\r\n            currentUserID,\r\n        } = props;\r\n\r\n        let name: string;\r\n        let category;\r\n        if (channel.type === Constants.DM_CHANNEL) {\r\n            category = Constants.Preferences.CATEGORY_DIRECT_CHANNEL_SHOW;\r\n            name = channel.teammate_id!;\r\n        } else {\r\n            category = Constants.Preferences.CATEGORY_GROUP_CHANNEL_SHOW;\r\n            name = channel.id;\r\n        }\r\n\r\n        dispatch(leaveDirectChannel(channel.name));\r\n        dispatch(savePreferences(currentUserID, [{user_id: currentUserID, category, name, value: 'false'}]));\r\n\r\n        if (currentTeam) {\r\n            getHistory().push(`/${currentTeam.name}/channels/${redirectChannel}`);\r\n        }\r\n    };\r\n\r\n    const {id, channel} = props;\r\n\r\n    // DM\r\n    let text = (\r\n        <FormattedMessage\r\n            id='center_panel.direct.closeDirectMessage'\r\n            defaultMessage='Close Direct Message'\r\n        />);\r\n    if (channel.type === Constants.GM_CHANNEL) {\r\n        text = (\r\n            <FormattedMessage\r\n                id='center_panel.direct.closeGroupMessage'\r\n                defaultMessage='Close Group Message'\r\n            />);\r\n    }\r\n\r\n    return (\r\n        <Menu.Item\r\n            id={id}\r\n            leadingElement={<CloseIcon size='18px'/>}\r\n            onClick={handleClose}\r\n            labels={text}\r\n        />\r\n    );\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {openModal} from 'actions/views/modals';\r\n\r\nimport EditChannelHeaderModal from 'components/edit_channel_header_modal';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {ModalIdentifiers} from 'utils/constants';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n    leadingElement?: React.ReactNode;\r\n}\r\n\r\nconst EditConversationHeader = ({channel, leadingElement}: Props): JSX.Element => {\r\n    const dispatch = useDispatch();\r\n    const handleEditHeader = () => {\r\n        dispatch(\r\n            openModal({\r\n                modalId: ModalIdentifiers.EDIT_CHANNEL_HEADER,\r\n                dialogType: EditChannelHeaderModal,\r\n                dialogProps: {channel},\r\n            }),\r\n        );\r\n    };\r\n\r\n    return (\r\n        <Menu.Item\r\n            id='channelEditHeader'\r\n            leadingElement={leadingElement}\r\n            onClick={handleEditHeader}\r\n            labels={\r\n                <FormattedMessage\r\n                    id='channel_header.setConversationHeader'\r\n                    defaultMessage='Edit Header'\r\n                />\r\n            }\r\n        />\r\n    );\r\n};\r\n\r\nexport default React.memo(EditConversationHeader);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport type {ReactNode} from 'react';\r\nimport React, {memo} from 'react';\r\nimport {FormattedMessage, useIntl} from 'react-intl';\r\n\r\nimport {\r\n    AppsIcon,\r\n    ChevronRightIcon,\r\n} from '@mattermost/compass-icons/components';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\ntype Props = {\r\n    pluginItems: ReactNode[];\r\n};\r\n\r\nconst PluginsSubmenu = (props: Props) => {\r\n    const {formatMessage} = useIntl();\r\n    if (!props.pluginItems || !props.pluginItems.length) {\r\n        return <></>;\r\n    }\r\n    return (\r\n        <Menu.SubMenu\r\n            id={'moreActions'}\r\n            labels={\r\n                <FormattedMessage\r\n                    id='pluginsMenu.more_actions'\r\n                    defaultMessage='More actions'\r\n                />\r\n            }\r\n            leadingElement={<AppsIcon size='18px'/>}\r\n            trailingElements={<ChevronRightIcon size={16}/>}\r\n            menuId={'moreActions-menu'}\r\n            menuAriaLabel={formatMessage({id: 'pluginsMenu.more_actions', defaultMessage: 'More actions'})}\r\n        >\r\n            {props.pluginItems}\r\n        </Menu.SubMenu>\r\n    );\r\n};\r\n\r\nexport default memo(PluginsSubmenu);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {memo} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport {favoriteChannel, unfavoriteChannel} from 'mattermost-redux/actions/channels';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\ntype Props = {\r\n    channelID: string;\r\n    isFavorite: boolean;\r\n};\r\n\r\nconst ToggleFavoriteChannel = ({\r\n    isFavorite,\r\n    channelID,\r\n}: Props) => {\r\n    const dispatch = useDispatch();\r\n    const toggleFavorite = () => {\r\n        if (isFavorite) {\r\n            dispatch(unfavoriteChannel(channelID));\r\n        } else {\r\n            dispatch(favoriteChannel(channelID));\r\n        }\r\n    };\r\n\r\n    let text = (\r\n        <FormattedMessage\r\n            id='channelHeader.addToFavorites'\r\n            defaultMessage='Add to Favorites'\r\n        />);\r\n    if (isFavorite) {\r\n        text = (\r\n            <FormattedMessage\r\n                id='channelHeader.removeFromFavorites'\r\n                defaultMessage='Remove from Favorites'\r\n            />);\r\n    }\r\n    return (\r\n        <Menu.Item\r\n            onClick={toggleFavorite}\r\n            labels={text}\r\n        />\r\n    );\r\n};\r\n\r\nexport default memo(ToggleFavoriteChannel);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useSelector, useDispatch} from 'react-redux';\r\n\r\nimport {InformationOutlineIcon} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {closeRightHandSide, showChannelInfo} from 'actions/views/rhs';\r\nimport {getIsRhsOpen, getRhsState} from 'selectors/rhs';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {RHSStates} from 'utils/constants';\r\n\r\ninterface Props extends Menu.FirstMenuItemProps {\r\n    channel: Channel;\r\n}\r\n\r\nconst ToggleInfo = ({channel, ...rest}: Props) => {\r\n    const dispatch = useDispatch();\r\n    let rhsOpen = useSelector(getIsRhsOpen);\r\n    const rhsState = useSelector(getRhsState);\r\n    if (rhsState !== RHSStates.CHANNEL_INFO) {\r\n        rhsOpen = false;\r\n    }\r\n\r\n    const toggleRHS = () => {\r\n        if (rhsOpen) {\r\n            dispatch(closeRightHandSide());\r\n            return;\r\n        }\r\n        dispatch(showChannelInfo(channel.id));\r\n    };\r\n\r\n    let text;\r\n    if (rhsOpen) {\r\n        text = (\r\n            <FormattedMessage\r\n                id='channelHeader.hideInfo'\r\n                defaultMessage='Close Info'\r\n            />);\r\n    } else {\r\n        text = (\r\n            <FormattedMessage\r\n                id='channelHeader.viewInfo'\r\n                defaultMessage='View Info'\r\n            />);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Menu.Item\r\n                leadingElement={<InformationOutlineIcon size='18px'/>}\r\n                onClick={toggleRHS}\r\n                labels={text}\r\n                {...rest}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport default ToggleInfo;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport {BellOffOutlineIcon} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {updateChannelNotifyProps} from 'mattermost-redux/actions/channels';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {Constants, NotificationLevels} from 'utils/constants';\r\n\r\ntype Props = {\r\n    userID: string;\r\n    channel: Channel;\r\n    isMuted: boolean;\r\n};\r\n\r\nexport default function ToggleMuteChannel({\r\n    isMuted,\r\n    channel,\r\n    userID,\r\n}: Props) {\r\n    const dispatch = useDispatch();\r\n\r\n    const handleClick = () => {\r\n        dispatch(updateChannelNotifyProps(\r\n            userID,\r\n            channel.id,\r\n            {\r\n                mark_unread: (isMuted ? NotificationLevels.ALL : NotificationLevels.MENTION) as 'all' | 'mention',\r\n            },\r\n        ));\r\n    };\r\n\r\n    let text;\r\n    if (channel.type === Constants.DM_CHANNEL || channel.type === Constants.GM_CHANNEL) {\r\n        if (isMuted) {\r\n            text = (\r\n                <FormattedMessage\r\n                    id='channel_header.unmuteConversation'\r\n                    defaultMessage='Unmute'\r\n                />\r\n            );\r\n        } else {\r\n            text = (\r\n                <FormattedMessage\r\n                    id='channel_header.muteConversation'\r\n                    defaultMessage='Mute'\r\n                />\r\n            );\r\n        }\r\n    } else if (isMuted) {\r\n        text = (\r\n            <FormattedMessage\r\n                id='channel_header.unmute'\r\n                defaultMessage='Unmute Channel'\r\n            />\r\n        );\r\n    } else {\r\n        text = (\r\n            <FormattedMessage\r\n                id='channel_header.mute'\r\n                defaultMessage='Mute Channel'\r\n            />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Menu.Item\r\n            leadingElement={<BellOffOutlineIcon size='18px'/>}\r\n            id='channelToggleMuteChannel'\r\n            onClick={handleClick}\r\n            labels={text}\r\n        />\r\n    );\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {memo} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\n\r\nimport {closeRightHandSide, showPinnedPosts} from 'actions/views/rhs';\r\nimport {getRhsState} from 'selectors/rhs';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {RHSStates} from 'utils/constants';\r\n\r\ntype Props = {\r\n    channelID: string;\r\n}\r\n\r\nconst ViewPinnedPosts = ({\r\n    channelID,\r\n}: Props) => {\r\n    const dispatch = useDispatch();\r\n    const rhsState = useSelector(getRhsState);\r\n    const hasPinnedPosts = rhsState === RHSStates.PIN;\r\n\r\n    const handleClick = () => {\r\n        if (hasPinnedPosts) {\r\n            dispatch(closeRightHandSide());\r\n        } else {\r\n            dispatch(showPinnedPosts(channelID));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Menu.Item\r\n            onClick={handleClick}\r\n            labels={\r\n                <FormattedMessage\r\n                    id='navbar.viewPinnedPosts'\r\n                    defaultMessage='View Pinned Posts'\r\n                />\r\n            }\r\n        />\r\n    );\r\n};\r\n\r\nexport default memo(ViewPinnedPosts);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport type {ReactNode} from 'react';\r\nimport React from 'react';\r\n\r\nimport {CogOutlineIcon} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\nimport type {UserProfile} from '@mattermost/types/users';\r\n\r\nimport {isGuest} from 'mattermost-redux/utils/user_utils';\r\n\r\nimport ChannelMoveToSubMenu from 'components/channel_move_to_sub_menu';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport MenuItemChannelBookmarks from '../menu_items/channel_bookmarks_submenu';\r\nimport CloseMessage from '../menu_items/close_message';\r\nimport EditConversationHeader from '../menu_items/edit_conversation_header';\r\nimport MenuItemPluginItems from '../menu_items/plugins_submenu';\r\nimport MenuItemToggleFavoriteChannel from '../menu_items/toggle_favorite_channel';\r\nimport MenuItemToggleInfo from '../menu_items/toggle_info';\r\nimport MenuItemToggleMuteChannel from '../menu_items/toggle_mute_channel';\r\nimport MenuItemViewPinnedPosts from '../menu_items/view_pinned_posts';\r\n\r\ninterface Props extends Menu.FirstMenuItemProps {\r\n    channel: Channel;\r\n    user: UserProfile;\r\n    isMuted: boolean;\r\n    isMobile: boolean;\r\n    isFavorite: boolean;\r\n    pluginItems: ReactNode[];\r\n    isChannelBookmarksEnabled: boolean;\r\n}\r\n\r\nconst ChannelHeaderDirectMenu = ({channel, user, isMuted, isMobile, isFavorite, pluginItems, isChannelBookmarksEnabled, ...rest}: Props) => {\r\n    return (\r\n        <>\r\n            <MenuItemToggleInfo\r\n                channel={channel}\r\n                {...rest}\r\n            />\r\n            <MenuItemToggleMuteChannel\r\n                userID={user.id}\r\n                channel={channel}\r\n                isMuted={isMuted}\r\n            />\r\n            {isMobile && (\r\n                <>\r\n                    <MenuItemToggleFavoriteChannel\r\n                        channelID={channel.id}\r\n                        isFavorite={isFavorite}\r\n                    />\r\n                    <MenuItemViewPinnedPosts\r\n                        channelID={channel.id}\r\n                    />\r\n                </>\r\n            )}\r\n            <EditConversationHeader\r\n                leadingElement={<CogOutlineIcon size='18px'/>}\r\n                channel={channel}\r\n            />\r\n            <Menu.Separator/>\r\n            {!isGuest(user.roles) && isChannelBookmarksEnabled && (\r\n                <MenuItemChannelBookmarks\r\n                    channel={channel}\r\n                />\r\n            )}\r\n            <ChannelMoveToSubMenu\r\n                channel={channel}\r\n            />\r\n            {!isMobile && (\r\n                <MenuItemPluginItems pluginItems={pluginItems}/>\r\n            )}\r\n            <Menu.Separator/>\r\n            <CloseMessage\r\n                currentUserID={user.id}\r\n                channel={channel}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport default ChannelHeaderDirectMenu;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {useIntl} from 'react-intl';\r\n\r\nimport SectionNotice from 'components/section_notice';\r\n\r\nconst NoCommonTeamsError = (): JSX.Element => {\r\n    const intl = useIntl();\r\n    return (\r\n        <SectionNotice\r\n            title={intl.formatMessage({\r\n                id: 'sidebar_left.sidebar_channel_modal.no_common_teams_error.heading',\r\n                defaultMessage: 'Unable to convert to a channel because group members are part of different teams',\r\n            })}\r\n            text={intl.formatMessage({\r\n                id: 'sidebar_left.sidebar_channel_modal.no_common_teams_error.body',\r\n                defaultMessage: 'Group Message cannot be converted to a channel because members are not a part of the same team. Add all members to a single team to convert this group message to a channel in that team.',\r\n            })}\r\n            type={'danger'}\r\n        />\r\n    );\r\n};\r\n\r\nexport default NoCommonTeamsError;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useCallback, useState} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport type {Team} from '@mattermost/types/teams';\r\n\r\nimport {getCurrentLocale} from 'selectors/i18n';\r\n\r\nimport type {ValueType} from 'components/dropdown_input';\r\nimport DropdownInput from 'components/dropdown_input';\r\n\r\nexport type Props = {\r\n    teamsById: {[id: string]: Team};\r\n    onChange: (teamId: string) => void;\r\n}\r\n\r\nconst TeamSelector = (props: Props): JSX.Element => {\r\n    const [value, setValue] = useState<Team>();\r\n    const intl = useIntl();\r\n    const {formatMessage} = intl;\r\n\r\n    const handleTeamChange = useCallback((value: ValueType) => {\r\n        const teamId = value.value;\r\n\r\n        setValue(props.teamsById[teamId]);\r\n        props.onChange(teamId);\r\n    }, []);\r\n\r\n    const currentLocale = useSelector(getCurrentLocale);\r\n\r\n    const teamValues = Object.values(props.teamsById).\r\n        map((team) => ({value: team.id, label: team.display_name})).\r\n        sort((teamA, teamB) => teamA.label.localeCompare(teamB.label, currentLocale));\r\n\r\n    return (\r\n        <DropdownInput\r\n            className='team_selector'\r\n            required={true}\r\n            onChange={handleTeamChange}\r\n            value={value ? {label: value.display_name, value: value.id} : undefined}\r\n            options={teamValues}\r\n            legend={formatMessage({id: 'sidebar_left.sidebar_channel_modal.select_team_placeholder', defaultMessage: 'Select Team'})}\r\n            placeholder={formatMessage({id: 'sidebar_left.sidebar_channel_modal.select_team_placeholder', defaultMessage: 'Select Team'})}\r\n            name='team_selector'\r\n        />\r\n    );\r\n};\r\n\r\nexport default TeamSelector;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {useIntl} from 'react-intl';\r\n\r\nimport SectionNotice from 'components/section_notice';\r\n\r\nexport type Props = {\r\n    channelMemberNames: string[];\r\n}\r\nconst WarningTextSection = (props: Props): JSX.Element => {\r\n    const intl = useIntl();\r\n\r\n    let memberNames: string;\r\n\r\n    if (props.channelMemberNames.length > 0) {\r\n        memberNames = intl.formatList(props.channelMemberNames);\r\n    } else {\r\n        memberNames = intl.formatMessage({id: 'sidebar_left.sidebar_channel_modal.warning_body_yourself', defaultMessage: 'yourself'});\r\n    }\r\n\r\n    return (\r\n        <SectionNotice\r\n            title={intl.formatMessage({\r\n                id: 'sidebar_left.sidebar_channel_modal.warning_header',\r\n                defaultMessage: 'Conversation history will be visible to any channel members',\r\n            })}\r\n            text={intl.formatMessage({\r\n                id: 'sidebar_left.sidebar_channel_modal.warning_body',\r\n                defaultMessage: 'You are about to convert the Group Message with {memberNames} to a Channel. This cannot be undone.',\r\n            },\r\n            {\r\n                memberNames,\r\n            })}\r\n        />\r\n    );\r\n};\r\nexport default WarningTextSection;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport classNames from 'classnames';\r\nimport type {ComponentProps} from 'react';\r\nimport React, {useCallback, useEffect, useRef, useState} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport './convert_gm_to_channel_modal.scss';\r\n\r\nimport {GenericModal} from '@mattermost/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\nimport type {Team} from '@mattermost/types/teams';\r\nimport type {UserProfile} from '@mattermost/types/users';\r\n\r\nimport {displayUsername} from 'mattermost-redux/utils/user_utils';\r\n\r\nimport {getGroupMessageMembersCommonTeams} from 'actions/team_actions';\r\n\r\nimport ChannelNameFormField from 'components/channel_name_form_field/channel_name_form_field';\r\nimport LoadingSpinner from 'components/widgets/loading/loading_spinner';\r\n\r\nimport NoCommonTeamsError from './no_common_teams/no_common_teams';\r\nimport TeamSelector from './team_selector/team_selector';\r\nimport WarningTextSection from './warning_text_section/warning_text_section';\r\n\r\nimport type {Actions} from './index';\r\n\r\nconst enum ServerErrorId {\r\n    CHANNEL_NAME_EXISTS = 'store.sql_channel.save_channel.exists.app_error',\r\n}\r\n\r\nexport type Props = {\r\n    onExited: () => void;\r\n    channel: Channel;\r\n    actions: Actions;\r\n    profilesInChannel: UserProfile[];\r\n    teammateNameDisplaySetting: string;\r\n    currentUserId: string;\r\n}\r\n\r\nconst ConvertGmToChannelModal = (props: Props) => {\r\n    const intl = useIntl();\r\n    const {formatMessage} = intl;\r\n\r\n    const [channelName, setChannelName] = useState<string>('');\r\n    const channelURL = useRef<string>('');\r\n\r\n    const [urlError, setURLError] = useState('');\r\n    const handleChannelURLChange = useCallback((newURL: string) => {\r\n        channelURL.current = newURL;\r\n        setURLError('');\r\n    }, []);\r\n\r\n    const [channelMemberNames, setChannelMemberNames] = useState<string[]>([]);\r\n\r\n    useEffect(() => {\r\n        const validProfilesInChannel = props.profilesInChannel.\r\n            filter((user) => user.id !== props.currentUserId && user.delete_at === 0).\r\n            map((user) => displayUsername(user, props.teammateNameDisplaySetting));\r\n\r\n        setChannelMemberNames(validProfilesInChannel);\r\n    }, [props.profilesInChannel, props.currentUserId, props.teammateNameDisplaySetting]);\r\n\r\n    const [commonTeamsById, setCommonTeamsById] = useState<{[id: string]: Team}>({});\r\n    const [commonTeamsFetched, setCommonTeamsFetched] = useState<boolean>(false);\r\n    const [loadingAnimationTimeout, setLoadingAnimationTimeout] = useState<boolean>(false);\r\n    const [selectedTeamId, setSelectedTeamId] = useState<string>();\r\n    const [nameError, setNameError] = useState<boolean>(false);\r\n    const [conversionError, setConversionError] = useState<string>();\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const mounted = useRef(false);\r\n    useEffect(() => {\r\n        mounted.current = true;\r\n        return (() => {\r\n            mounted.current = false;\r\n        });\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const work = async () => {\r\n            const response = await dispatch(getGroupMessageMembersCommonTeams(props.channel.id));\r\n            if (!mounted.current) {\r\n                return;\r\n            }\r\n\r\n            if (response.error || !response.data) {\r\n                return;\r\n            }\r\n            const teams = response.data;\r\n\r\n            const teamsById: {[id: string]: Team} = {};\r\n            teams.forEach((team) => {\r\n                teamsById[team.id] = team;\r\n            });\r\n\r\n            setCommonTeamsById(teamsById);\r\n            setCommonTeamsFetched(true);\r\n\r\n            // if there is only common team, selected it.\r\n            if (teams.length === 1) {\r\n                setSelectedTeamId(teams[0].id);\r\n            }\r\n        };\r\n\r\n        work();\r\n        setTimeout(() => setLoadingAnimationTimeout(true), 1200);\r\n    }, [dispatch, props.channel.id]);\r\n\r\n    const handleConfirm = useCallback(async () => {\r\n        if (!selectedTeamId) {\r\n            return;\r\n        }\r\n\r\n        const {error} = await props.actions.convertGroupMessageToPrivateChannel(props.channel.id, selectedTeamId, channelName.trim(), channelURL.current.trim());\r\n\r\n        if (error) {\r\n            if (error.server_error_id === ServerErrorId.CHANNEL_NAME_EXISTS) {\r\n                setURLError(\r\n                    formatMessage({\r\n                        id: 'channel_modal.alreadyExist',\r\n                        defaultMessage: 'A channel with that URL already exists',\r\n                    }),\r\n                );\r\n            } else {\r\n                setConversionError(error.message);\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        setConversionError(undefined);\r\n        props.onExited();\r\n    }, [selectedTeamId, props, channelName, formatMessage]);\r\n\r\n    const showLoader = !commonTeamsFetched || !loadingAnimationTimeout;\r\n    const canCreate = selectedTeamId !== undefined && channelName !== '' && !nameError && !urlError;\r\n    const modalProps: Partial<ComponentProps<typeof GenericModal>> = {};\r\n    let modalBody;\r\n\r\n    if (!showLoader && Object.keys(commonTeamsById).length === 0) {\r\n        modalProps.confirmButtonText = formatMessage({id: 'generic.okay', defaultMessage: 'Okay'});\r\n        modalProps.handleConfirm = props.onExited;\r\n\r\n        modalBody = (\r\n            <div className='convert-gm-to-channel-modal-body error'>\r\n                <NoCommonTeamsError/>\r\n            </div>\r\n        );\r\n    } else {\r\n        modalProps.handleCancel = showLoader ? undefined : props.onExited;\r\n        modalProps.isDeleteModal = true;\r\n        modalProps.cancelButtonText = formatMessage({id: 'channel_modal.cancel', defaultMessage: 'Cancel'});\r\n        modalProps.confirmButtonText = formatMessage({id: 'sidebar_left.sidebar_channel_modal.confirmation_text', defaultMessage: 'Convert to private channel'});\r\n        modalProps.isConfirmDisabled = !canCreate;\r\n\r\n        let subBody;\r\n        if (showLoader) {\r\n            subBody = (\r\n                <div className='loadingIndicator'>\r\n                    <LoadingSpinner/>\r\n                </div>\r\n            );\r\n        } else {\r\n            subBody = (\r\n                <>\r\n                    <WarningTextSection channelMemberNames={channelMemberNames}/>\r\n\r\n                    {\r\n                        Object.keys(commonTeamsById).length > 1 &&\r\n                        <TeamSelector\r\n                            teamsById={commonTeamsById}\r\n                            onChange={setSelectedTeamId}\r\n                        />\r\n                    }\r\n\r\n                    <ChannelNameFormField\r\n                        value={channelName}\r\n                        name='convert-gm-to-channel-modal-channel-name'\r\n                        placeholder={formatMessage({id: 'sidebar_left.sidebar_channel_modal.channel_name_placeholder', defaultMessage: 'Enter a name for the channel'})}\r\n                        autoFocus={false}\r\n                        onDisplayNameChange={setChannelName}\r\n                        onURLChange={handleChannelURLChange}\r\n                        onErrorStateChange={setNameError}\r\n                        team={selectedTeamId ? commonTeamsById[selectedTeamId] : undefined}\r\n                        urlError={urlError}\r\n                    />\r\n\r\n                    {\r\n                        conversionError &&\r\n                        <div className='conversion-error'>\r\n                            <i className='icon icon-alert-outline'/>\r\n                            <span>{conversionError}</span>\r\n                        </div>\r\n                    }\r\n\r\n                </>\r\n            );\r\n        }\r\n\r\n        modalBody = (\r\n            <div\r\n                className={classNames({\r\n                    'convert-gm-to-channel-modal-body': true,\r\n                    loading: showLoader,\r\n                    'single-team': Object.keys(commonTeamsById).length === 1,\r\n                    'multi-team': Object.keys(commonTeamsById).length > 1,\r\n                })}\r\n            >\r\n                {subBody}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <GenericModal\r\n            id='convert-gm-to-channel-modal'\r\n            className='convert-gm-to-channel-modal'\r\n            modalHeaderText={formatMessage({id: 'sidebar_left.sidebar_channel_modal.header', defaultMessage: 'Convert to Private Channel'})}\r\n            compassDesign={true}\r\n            handleConfirm={showLoader ? undefined : handleConfirm}\r\n            onExited={props.onExited}\r\n            autoCloseOnConfirmButton={false}\r\n            {...modalProps}\r\n        >\r\n            {modalBody}\r\n        </GenericModal>\r\n    );\r\n};\r\n\r\nexport default ConvertGmToChannelModal;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {connect} from 'react-redux';\r\nimport type {Dispatch} from 'redux';\r\nimport {bindActionCreators} from 'redux';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {convertGroupMessageToPrivateChannel} from 'mattermost-redux/actions/channels';\r\nimport {getTeammateNameDisplaySetting} from 'mattermost-redux/selectors/entities/preferences';\r\nimport {\r\n    getCurrentUserId,\r\n    makeGetProfilesInChannel,\r\n} from 'mattermost-redux/selectors/entities/users';\r\nimport type {ActionResult} from 'mattermost-redux/types/actions';\r\n\r\nimport {moveChannelsInSidebar} from 'actions/views/channel_sidebar';\r\nimport {closeModal} from 'actions/views/modals';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\nimport ConvertGmToChannelModal from './convert_gm_to_channel_modal';\r\n\r\ntype OwnProps = {\r\n    channel: Channel;\r\n}\r\nfunction makeMapStateToProps() {\r\n    const getProfilesInChannel = makeGetProfilesInChannel();\r\n\r\n    return (state: GlobalState, ownProps: OwnProps) => {\r\n        const allProfilesInChannel = getProfilesInChannel(state, ownProps.channel.id);\r\n        const currentUserId = getCurrentUserId(state);\r\n        const teammateNameDisplaySetting = getTeammateNameDisplaySetting(state);\r\n\r\n        return {\r\n            profilesInChannel: allProfilesInChannel,\r\n            teammateNameDisplaySetting,\r\n            currentUserId,\r\n        };\r\n    };\r\n}\r\n\r\nexport type Actions = {\r\n    closeModal: (modalID: string) => void;\r\n    convertGroupMessageToPrivateChannel: (channelID: string, teamID: string, displayName: string, name: string) => Promise<ActionResult>;\r\n    moveChannelsInSidebar: (categoryId: string, targetIndex: number, draggableChannelId: string, setManualSorting?: boolean) => void;\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch) {\r\n    return {\r\n        actions: bindActionCreators({\r\n            closeModal,\r\n            convertGroupMessageToPrivateChannel,\r\n            moveChannelsInSidebar,\r\n        }, dispatch),\r\n    };\r\n}\r\n\r\nexport default connect(makeMapStateToProps, mapDispatchToProps)(ConvertGmToChannelModal);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {openModal} from 'actions/views/modals';\r\n\r\nimport ConvertGmToChannelModal from 'components/convert_gm_to_channel_modal';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {ModalIdentifiers} from 'utils/constants';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n}\r\n\r\nconst ConvertGMtoPrivate = ({channel}: Props): JSX.Element => {\r\n    const dispatch = useDispatch();\r\n    const handleConvertToPrivate = () => {\r\n        dispatch(\r\n            openModal({\r\n                modalId: ModalIdentifiers.CONVERT_GM_TO_CHANNEL,\r\n                dialogType: ConvertGmToChannelModal,\r\n                dialogProps: {channel},\r\n            }),\r\n        );\r\n    };\r\n\r\n    return (\r\n        <Menu.Item\r\n            id='convertGMPrivateChannel'\r\n            onClick={handleConvertToPrivate}\r\n            labels={\r\n                <FormattedMessage\r\n                    id='sidebar_left.sidebar_channel_menu_convert_to_channel'\r\n                    defaultMessage='Convert to Private Channel'\r\n                />\r\n            }\r\n        />\r\n    );\r\n};\r\n\r\nexport default React.memo(ConvertGMtoPrivate);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport {BellOutlineIcon} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\nimport type {UserProfile} from '@mattermost/types/users';\r\n\r\nimport {openModal} from 'actions/views/modals';\r\n\r\nimport ChannelNotificationsModal from 'components/channel_notifications_modal';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {ModalIdentifiers} from 'utils/constants';\r\n\r\ninterface Props extends Menu.FirstMenuItemProps {\r\n    channel: Channel;\r\n    user: UserProfile;\r\n}\r\n\r\nconst Notification = ({channel, user, ...rest}: Props): JSX.Element => {\r\n    const dispatch = useDispatch();\r\n\r\n    const handleNotificationPreferences = () => {\r\n        dispatch(openModal({\r\n            modalId: ModalIdentifiers.CHANNEL_NOTIFICATIONS,\r\n            dialogType: ChannelNotificationsModal,\r\n            dialogProps: {\r\n                channel,\r\n                currentUser: user,\r\n            },\r\n        }));\r\n    };\r\n\r\n    return (\r\n        <Menu.Item\r\n            leadingElement={<BellOutlineIcon size='18px'/>}\r\n            id='channelNotificationPreferences'\r\n            onClick={handleNotificationPreferences}\r\n            labels={\r\n                <FormattedMessage\r\n                    id='navbar.preferences'\r\n                    defaultMessage='Notification Preferences'\r\n                />\r\n            }\r\n            {...rest}\r\n        />\r\n    );\r\n};\r\n\r\nexport default React.memo(Notification);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\n\r\nimport {AccountOutlineIcon} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {showChannelMembers} from 'actions/views/rhs';\r\nimport {getIsRhsOpen, getRhsState} from 'selectors/rhs';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {RHSStates} from 'utils/constants';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n    id: string;\r\n    editMembers?: boolean;\r\n    text: React.ReactElement;\r\n};\r\n\r\nconst OpenMembersRHS = ({\r\n    id,\r\n    channel,\r\n    text,\r\n    editMembers = false,\r\n}: Props) => {\r\n    const dispatch = useDispatch();\r\n    let rhsOpen = useSelector(getIsRhsOpen);\r\n    const rhsState = useSelector(getRhsState);\r\n    if (rhsState !== RHSStates.CHANNEL_MEMBERS) {\r\n        rhsOpen = false;\r\n    }\r\n    const openRHSIfNotOpen = () => {\r\n        if (rhsOpen) {\r\n            return;\r\n        }\r\n        dispatch(showChannelMembers(channel.id, editMembers));\r\n    };\r\n\r\n    return (\r\n        <Menu.Item\r\n            leadingElement={<AccountOutlineIcon size={16}/>}\r\n            id={id}\r\n            onClick={openRHSIfNotOpen}\r\n            labels={text}\r\n        />\r\n    );\r\n};\r\n\r\nexport default OpenMembersRHS;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport type {ReactNode} from 'react';\r\nimport React from 'react';\r\nimport {FormattedMessage, useIntl} from 'react-intl';\r\n\r\nimport {\r\n    ChevronRightIcon,\r\n    CogOutlineIcon,\r\n} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\nimport type {UserProfile} from '@mattermost/types/users';\r\n\r\nimport {Permissions} from 'mattermost-redux/constants';\r\nimport {isGuest} from 'mattermost-redux/utils/user_utils';\r\n\r\nimport ChannelMoveToSubMenu from 'components/channel_move_to_sub_menu';\r\nimport * as Menu from 'components/menu';\r\nimport ChannelPermissionGate from 'components/permissions_gates/channel_permission_gate';\r\n\r\nimport MenuItemChannelBookmarks from '../menu_items/channel_bookmarks_submenu';\r\nimport CloseMessage from '../menu_items/close_message';\r\nimport MenuItemConvertToPrivate from '../menu_items/convert_gm_to_private';\r\nimport EditConversationHeader from '../menu_items/edit_conversation_header';\r\nimport MenuItemNotification from '../menu_items/notification';\r\nimport MenuItemOpenMembersRHS from '../menu_items/open_members_rhs';\r\nimport MenuItemPluginItems from '../menu_items/plugins_submenu';\r\nimport MenuItemToggleFavoriteChannel from '../menu_items/toggle_favorite_channel';\r\nimport MenuItemToggleInfo from '../menu_items/toggle_info';\r\nimport MenuItemToggleMuteChannel from '../menu_items/toggle_mute_channel';\r\nimport MenuItemViewPinnedPosts from '../menu_items/view_pinned_posts';\r\n\r\ninterface Props extends Menu.FirstMenuItemProps {\r\n    channel: Channel;\r\n    user: UserProfile;\r\n    isMuted: boolean;\r\n    isMobile: boolean;\r\n    isFavorite: boolean;\r\n    pluginItems: ReactNode[];\r\n    isChannelBookmarksEnabled: boolean;\r\n}\r\n\r\nconst ChannelHeaderGroupMenu = ({channel, user, isMuted, isMobile, isFavorite, pluginItems, isChannelBookmarksEnabled, ...rest}: Props) => {\r\n    const isGroupConstrained = channel?.group_constrained === true;\r\n    const isArchived = channel.delete_at !== 0;\r\n    const {formatMessage} = useIntl();\r\n\r\n    return (\r\n        <>\r\n            <MenuItemToggleInfo\r\n                channel={channel}\r\n                {...rest}\r\n            />\r\n            <MenuItemToggleMuteChannel\r\n                userID={user.id}\r\n                channel={channel}\r\n                isMuted={isMuted}\r\n            />\r\n            {isMobile && (\r\n                <>\r\n                    <MenuItemToggleFavoriteChannel\r\n                        channelID={channel.id}\r\n                        isFavorite={isFavorite}\r\n                    />\r\n                    <MenuItemViewPinnedPosts\r\n                        channelID={channel.id}\r\n                    />\r\n                </>\r\n            )}\r\n            {!isArchived && (\r\n                <MenuItemNotification\r\n                    user={user}\r\n                    channel={channel}\r\n                />\r\n            )}\r\n            {(!isArchived && isGuest(user.roles)) && (\r\n                <EditConversationHeader\r\n                    leadingElement={<CogOutlineIcon size='18px'/>}\r\n                    channel={channel}\r\n                />\r\n            )}\r\n            {(!isArchived && !isGroupConstrained && !isGuest(user.roles)) && (\r\n                <Menu.SubMenu\r\n                    id={'channelSettings'}\r\n                    labels={\r\n                        <FormattedMessage\r\n                            id='channel_header.settings'\r\n                            defaultMessage='Settings'\r\n                        />\r\n                    }\r\n                    leadingElement={<CogOutlineIcon size={18}/>}\r\n                    trailingElements={<ChevronRightIcon size={16}/>}\r\n                    menuId={'channelSettings-menu'}\r\n                    menuAriaLabel={formatMessage({id: 'channel_header.settings', defaultMessage: 'Settings'})}\r\n                >\r\n                    <EditConversationHeader\r\n                        channel={channel}\r\n                    />\r\n                    <MenuItemConvertToPrivate\r\n                        channel={channel}\r\n                    />\r\n                </Menu.SubMenu>\r\n            )}\r\n            {!isArchived && !isGuest(user.roles) && isChannelBookmarksEnabled && (\r\n                <MenuItemChannelBookmarks\r\n                    channel={channel}\r\n                />\r\n            )}\r\n            <Menu.Separator/>\r\n            {(!isArchived && !isGroupConstrained) && (\r\n                <ChannelPermissionGate\r\n                    channelId={channel.id}\r\n                    teamId={channel.team_id}\r\n                    permissions={[Permissions.MANAGE_PUBLIC_CHANNEL_MEMBERS]}\r\n                >\r\n                    <MenuItemOpenMembersRHS\r\n                        id='channelMembers'\r\n                        channel={channel}\r\n                        text={\r\n                            <FormattedMessage\r\n                                id='channel_header.members'\r\n                                defaultMessage='Members'\r\n                            />\r\n                        }\r\n                    />\r\n                    <Menu.Separator/>\r\n                </ChannelPermissionGate>\r\n            )}\r\n            <ChannelMoveToSubMenu channel={channel}/>\r\n            {!isMobile && (\r\n                <MenuItemPluginItems pluginItems={pluginItems}/>\r\n            )}\r\n            <Menu.Separator/>\r\n            <CloseMessage\r\n                currentUserID={user.id}\r\n                channel={channel}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport default ChannelHeaderGroupMenu;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport type {ReactNode} from 'react';\r\nimport React, {memo} from 'react';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\nimport MobileChannelHeaderPlugins from '../menu_items/mobile_channel_header_plugins';\r\n\r\ntype Props = {\r\n    isMobile: boolean;\r\n    channel: Channel;\r\n    pluginItems: ReactNode[];\r\n}\r\n\r\nconst ChannelHeaderMobileMenu = (props: Props): JSX.Element => {\r\n    if (!props.isMobile) {\r\n        return <></>;\r\n    }\r\n    return (\r\n        <>\r\n            <MobileChannelHeaderPlugins\r\n                channel={props.channel}\r\n                isDropdown={true}\r\n            />\r\n            <Menu.Separator/>\r\n            {props.pluginItems}\r\n        </>\r\n    );\r\n};\r\n\r\nexport default memo(ChannelHeaderMobileMenu);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {Modal} from 'react-bootstrap';\r\nimport {FormattedMessage} from 'react-intl';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport Constants from 'utils/constants';\r\n\r\nexport type Props = {\r\n    onExited: () => void;\r\n    channel: Channel;\r\n    actions: {\r\n        deleteChannel: (channelId: string) => void;\r\n    };\r\n}\r\n\r\ntype State = {\r\n    show: boolean;\r\n}\r\n\r\nexport default class DeleteChannelModal extends React.PureComponent<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n        this.state = {show: true};\r\n    }\r\n\r\n    handleDelete = () => {\r\n        if (this.props.channel.id.length !== Constants.CHANNEL_ID_LENGTH) {\r\n            return;\r\n        }\r\n        this.props.actions.deleteChannel(this.props.channel.id);\r\n        this.onHide();\r\n    };\r\n\r\n    onHide = () => {\r\n        this.setState({show: false});\r\n    };\r\n\r\n    render() {\r\n        return (\r\n            <Modal\r\n                dialogClassName='a11y__modal'\r\n                show={this.state.show}\r\n                onHide={this.onHide}\r\n                onExited={this.props.onExited}\r\n                role='none'\r\n                aria-labelledby='deleteChannelModalLabel'\r\n                id='deleteChannelModal'\r\n            >\r\n                <Modal.Header closeButton={true}>\r\n                    <Modal.Title\r\n                        componentClass='h1'\r\n                        id='deleteChannelModalLabel'\r\n                    >\r\n                        <FormattedMessage\r\n                            id='delete_channel.confirm'\r\n                            defaultMessage='Confirm ARCHIVE Channel'\r\n                        />\r\n                    </Modal.Title>\r\n                </Modal.Header>\r\n                <Modal.Body>\r\n                    <div className='alert alert-danger'>\r\n                        <p>\r\n                            <FormattedMessage\r\n                                id='deleteChannelModal.canViewArchivedChannelsWarning'\r\n                                defaultMessage='This will archive the channel from the team. Channel contents will still be accessible by channel members.'\r\n                            />\r\n                        </p>\r\n                        <p>\r\n                            <FormattedMessage\r\n                                id='deleteChannelModal.confirmArchive'\r\n                                defaultMessage='Are you sure you wish to archive the <strong>{display_name}</strong> channel?'\r\n                                values={{\r\n                                    display_name: this.props.channel.display_name,\r\n                                    strong: (chunks) => <strong>{chunks}</strong>,\r\n                                }}\r\n                            />\r\n                        </p>\r\n                    </div>\r\n                </Modal.Body>\r\n                <Modal.Footer>\r\n                    <button\r\n                        type='button'\r\n                        className='btn btn-tertiary'\r\n                        onClick={this.onHide}\r\n                    >\r\n                        <FormattedMessage\r\n                            id='delete_channel.cancel'\r\n                            defaultMessage='Cancel'\r\n                        />\r\n                    </button>\r\n                    <button\r\n                        type='button'\r\n                        className='btn btn-danger'\r\n                        data-dismiss='modal'\r\n                        onClick={this.handleDelete}\r\n                        autoFocus={true}\r\n                        id='deleteChannelModalDeleteButton'\r\n                    >\r\n                        <FormattedMessage\r\n                            id='delete_channel.del'\r\n                            defaultMessage='Archive'\r\n                        />\r\n                    </button>\r\n                </Modal.Footer>\r\n            </Modal>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {connect} from 'react-redux';\r\nimport {bindActionCreators} from 'redux';\r\nimport type {Dispatch} from 'redux';\r\n\r\nimport type {GlobalState} from '@mattermost/types/store';\r\n\r\nimport {getCurrentTeam} from 'mattermost-redux/selectors/entities/teams';\r\n\r\nimport {deleteChannel} from 'actions/views/channel';\r\n\r\nimport DeleteChannelModal from './delete_channel_modal';\r\n\r\nfunction mapStateToProps(state: GlobalState) {\r\n    return {\r\n        currentTeamDetails: getCurrentTeam(state),\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch) {\r\n    return {\r\n        actions: bindActionCreators(\r\n            {\r\n                deleteChannel,\r\n            },\r\n            dispatch,\r\n        ),\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DeleteChannelModal);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {memo} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport {ArchiveOutlineIcon} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {openModal} from 'actions/views/modals';\r\n\r\nimport DeleteChannelModal from 'components/delete_channel_modal';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {ModalIdentifiers} from 'utils/constants';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n}\r\n\r\nconst ArchiveChannel = ({\r\n    channel,\r\n}: Props) => {\r\n    const dispatch = useDispatch();\r\n\r\n    const handleArchiveChannel = () => {\r\n        dispatch(\r\n            openModal({\r\n                modalId: ModalIdentifiers.DELETE_CHANNEL,\r\n                dialogType: DeleteChannelModal,\r\n                dialogProps: {\r\n                    channel,\r\n                },\r\n            }),\r\n        );\r\n    };\r\n\r\n    return (\r\n        <Menu.Item\r\n            id='channelArchiveChannel'\r\n            leadingElement={<ArchiveOutlineIcon size={18}/>}\r\n            onClick={handleArchiveChannel}\r\n            labels={\r\n                <FormattedMessage\r\n                    id='channel_header.delete'\r\n                    defaultMessage='Archive Channel'\r\n                />\r\n            }\r\n            isDestructive={true}\r\n        />\r\n    );\r\n};\r\n\r\nexport default memo(ArchiveChannel);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {Permissions} from 'mattermost-redux/constants';\r\nimport {createSelector} from 'mattermost-redux/selectors/create_selector';\r\nimport {haveIChannelPermission} from 'mattermost-redux/selectors/entities/roles';\r\n\r\nimport Constants from 'utils/constants';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\n/**\r\n * Selector to determine if a user has access to any tab in the channel settings modal\r\n * Returns true if the user has permission to access at least one tab (Info, Configuration, Archive)\r\n * Note: This does not check license requirements - those should be handled by the calling component\r\n */\r\nexport const canAccessChannelSettings = createSelector(\r\n    'canAccessChannelSettings',\r\n    (state: GlobalState) => state,\r\n    (state: GlobalState) => state.entities.channels.channels,\r\n    (state: GlobalState, channelId: string) => channelId,\r\n    (state, channels, channelId) => {\r\n        const channel = channels[channelId];\r\n        if (!channel) {\r\n            return false;\r\n        }\r\n\r\n        const isPrivate = channel.type === Constants.PRIVATE_CHANNEL;\r\n        const isDefaultChannel = channel.name === Constants.DEFAULT_CHANNEL;\r\n\r\n        // Get the team ID from the channel\r\n        const teamId = channel.team_id;\r\n\r\n        // Info tab permissions\r\n        const infoPermission = isPrivate ? Permissions.MANAGE_PRIVATE_CHANNEL_PROPERTIES : Permissions.MANAGE_PUBLIC_CHANNEL_PROPERTIES;\r\n\r\n        const hasInfoPermission = haveIChannelPermission(\r\n            state,\r\n            teamId,\r\n            channelId,\r\n            infoPermission,\r\n        );\r\n\r\n        // Configuration tab (banner) permissions\r\n        const bannerPermission = isPrivate ? Permissions.MANAGE_PRIVATE_CHANNEL_BANNER : Permissions.MANAGE_PUBLIC_CHANNEL_BANNER;\r\n\r\n        const hasBannerPermission = haveIChannelPermission(\r\n            state,\r\n            teamId,\r\n            channelId,\r\n            bannerPermission,\r\n        );\r\n\r\n        // Archive tab permissions\r\n        const archivePermission = isPrivate ? Permissions.DELETE_PRIVATE_CHANNEL : Permissions.DELETE_PUBLIC_CHANNEL;\r\n\r\n        const hasArchivePermission = !isDefaultChannel && haveIChannelPermission(\r\n            state,\r\n            teamId,\r\n            channelId,\r\n            archivePermission,\r\n        );\r\n\r\n        // User can access channel settings if they have permission for at least one tab\r\n        return hasInfoPermission || hasBannerPermission || hasArchivePermission;\r\n    },\r\n);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useCallback, useMemo} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\n\r\nimport type {AccessControlPolicy} from '@mattermost/types/access_control';\r\n\r\nimport AlertBanner from 'components/alert_banner';\r\n\r\nimport './system_policy_indicator.scss';\r\n\r\nexport type SystemPolicyIndicatorProps = {\r\n    policies?: AccessControlPolicy[];\r\n    resourceType?: 'channel' | 'team' | 'file';\r\n    showPolicyNames?: boolean;\r\n    variant?: 'compact' | 'detailed';\r\n    className?: string;\r\n    testId?: string;\r\n    onMorePoliciesClick?: () => void;\r\n};\r\n\r\nconst SystemPolicyIndicator: React.FC<SystemPolicyIndicatorProps> = ({\r\n    policies = [],\r\n    resourceType = 'channel',\r\n    showPolicyNames = true,\r\n    variant = 'detailed',\r\n    className = '',\r\n    testId = 'system-policy-indicator',\r\n    onMorePoliciesClick,\r\n}) => {\r\n    // Handle malformed data - ensure policies is always an array\r\n    const safePolicies = useMemo(() => {\r\n        if (!policies || !Array.isArray(policies)) {\r\n            return [];\r\n        }\r\n        return policies.filter((policy) => policy && typeof policy === 'object' && policy.id);\r\n    }, [policies]);\r\n\r\n    const hasMultiplePolicies = safePolicies.length > 1;\r\n\r\n    const handleMorePoliciesClick = useCallback((event: React.MouseEvent | React.KeyboardEvent) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        if (onMorePoliciesClick) {\r\n            onMorePoliciesClick();\r\n        }\r\n    }, [onMorePoliciesClick]);\r\n\r\n    const handleKeyDown = useCallback((event: React.KeyboardEvent) => {\r\n        if (event.key === 'Enter' || event.key === ' ') {\r\n            handleMorePoliciesClick(event);\r\n        }\r\n    }, [handleMorePoliciesClick]);\r\n\r\n    const getPolicyDisplayName = useCallback((policy: AccessControlPolicy): string => {\r\n        return policy.name || policy.id || 'Unknown Policy';\r\n    }, []);\r\n\r\n    const renderPolicyList = useCallback(() => {\r\n        if (!showPolicyNames || safePolicies.length === 0) {\r\n            return '';\r\n        }\r\n\r\n        if (safePolicies.length === 1) {\r\n            return <strong>{getPolicyDisplayName(safePolicies[0])}</strong>;\r\n        }\r\n\r\n        if (safePolicies.length === 2) {\r\n            return (\r\n                <>\r\n                    <strong>{getPolicyDisplayName(safePolicies[0])}</strong>\r\n                    {' and '}\r\n                    <strong>{getPolicyDisplayName(safePolicies[1])}</strong>\r\n                </>\r\n            );\r\n        }\r\n\r\n        // More than 2 policies: show first two and \"X more\"\r\n        const remainingCount = safePolicies.length - 2;\r\n        return (\r\n            <>\r\n                <strong>{getPolicyDisplayName(safePolicies[0])}</strong>\r\n                {', '}\r\n                <strong>{getPolicyDisplayName(safePolicies[1])}</strong>\r\n                {' and '}\r\n                <button\r\n                    type='button'\r\n                    className='system-policy-indicator__more-link'\r\n                    onClick={handleMorePoliciesClick}\r\n                    onKeyDown={handleKeyDown}\r\n                    aria-label={`View ${remainingCount} more policies`}\r\n                    tabIndex={0}\r\n                >\r\n                    <FormattedMessage\r\n                        id='system_policy_indicator.more_policies'\r\n                        defaultMessage='{count} more'\r\n                        values={{\r\n                            count: remainingCount,\r\n                        }}\r\n                    />\r\n                </button>\r\n            </>\r\n        );\r\n    }, [showPolicyNames, safePolicies, getPolicyDisplayName, handleMorePoliciesClick, handleKeyDown]);\r\n\r\n    const renderCompactMessage = useCallback(() => {\r\n        return (\r\n            <FormattedMessage\r\n                id='system_policy_indicator.base_message'\r\n                defaultMessage='This {resourceType} has system-level access {policyText} applied'\r\n                values={{\r\n                    resourceType,\r\n                    policyText: hasMultiplePolicies ? 'policies' : 'policy',\r\n                }}\r\n            />\r\n        );\r\n    }, [resourceType, hasMultiplePolicies]);\r\n\r\n    const renderDetailedMessage = useCallback(() => {\r\n        const title = hasMultiplePolicies ? (\r\n            <FormattedMessage\r\n                id='system_policy_indicator.multiple_policies_title'\r\n                defaultMessage='Multiple system access policies applied to this {resourceType}'\r\n                values={{resourceType}}\r\n            />\r\n        ) : (\r\n            <FormattedMessage\r\n                id='system_policy_indicator.single_policy_title'\r\n                defaultMessage='System access policy applied to this {resourceType}'\r\n                values={{resourceType}}\r\n            />\r\n        );\r\n\r\n        return (\r\n            <>\r\n                <div\r\n                    className='system-policy-indicator__title'\r\n                    role='heading'\r\n                    aria-level={3}\r\n                >\r\n                    {title}\r\n                </div>\r\n                <div\r\n                    className='system-policy-indicator__description'\r\n                    role='region'\r\n                    aria-label='System policy details'\r\n                >\r\n                    <FormattedMessage\r\n                        id='system_policy_indicator.description_with_policies'\r\n                        defaultMessage='This {resourceType} has system-level access policies applied: {policyList}. Any custom access rules you set here will be applied in addition to this policy.'\r\n                        values={{\r\n                            resourceType,\r\n                            policyList: renderPolicyList(),\r\n                        }}\r\n                    />\r\n                </div>\r\n            </>\r\n        );\r\n    }, [hasMultiplePolicies, resourceType, renderPolicyList]);\r\n\r\n    const renderMessage = useCallback(() => {\r\n        if (variant === 'compact') {\r\n            return renderCompactMessage();\r\n        }\r\n        return renderDetailedMessage();\r\n    }, [variant, renderCompactMessage, renderDetailedMessage]);\r\n\r\n    const alertMessage = useMemo(() => renderMessage(), [renderMessage]);\r\n\r\n    if (safePolicies.length === 0) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <AlertBanner\r\n            id={testId}\r\n            mode='info'\r\n            className={`system-policy-indicator ${className}`}\r\n            variant='app'\r\n            message={alertMessage}\r\n        />\r\n    );\r\n};\r\n\r\nexport default SystemPolicyIndicator;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useState, useCallback, useEffect} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\n\r\nimport ConfirmModal from 'components/confirm_modal';\r\n\r\nimport './channel_activity_warning_modal.scss';\r\n\r\ntype Props = {\r\n\r\n    /** Whether the modal is open/visible */\r\n    isOpen: boolean;\r\n\r\n    /** Callback when modal is closed/cancelled */\r\n    onClose: () => void;\r\n\r\n    /** Callback when user confirms the action */\r\n    onConfirm: () => void;\r\n};\r\n\r\n/**\r\n * Modal that warns users about exposing channel history when modifying access rules.\r\n * Requires user acknowledgment before allowing the action to proceed.\r\n */\r\nconst ChannelActivityWarningModal: React.FC<Props> = ({\r\n    isOpen,\r\n    onClose,\r\n    onConfirm,\r\n}) => {\r\n    const [acknowledgeRisk, setAcknowledgeRisk] = useState(false);\r\n\r\n    const handleConfirm = useCallback(() => {\r\n        // Only proceed if user has acknowledged the risk\r\n        if (!acknowledgeRisk) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setAcknowledgeRisk(false); // Reset checkbox after confirmation\r\n            onConfirm();\r\n        } catch (error) {\r\n            // eslint-disable-next-line no-console\r\n            console.error('Error confirming activity warning:', error);\r\n        }\r\n    }, [acknowledgeRisk, onConfirm]);\r\n\r\n    const handleCancel = useCallback(() => {\r\n        setAcknowledgeRisk(false); // Reset checkbox when modal is closed\r\n        onClose();\r\n    }, [onClose]);\r\n\r\n    const handleCheckboxChange = useCallback((checked: boolean) => {\r\n        setAcknowledgeRisk(checked);\r\n    }, []);\r\n\r\n    // Reset checkbox whenever modal opens (force reset every time)\r\n    useEffect(() => {\r\n        setAcknowledgeRisk(false);\r\n    }, [isOpen]);\r\n\r\n    return (\r\n        <ConfirmModal\r\n            id='activityWarningModal'\r\n            show={isOpen}\r\n            title={\r\n                <FormattedMessage\r\n                    id='channel_settings.activity_warning.exposing_history_title'\r\n                    defaultMessage='Exposing channel history'\r\n                />\r\n            }\r\n            message={\r\n                <div className='channel-activity-warning-content'>\r\n                    <div className='warning-description'>\r\n                        <FormattedMessage\r\n                            id='channel_settings.activity_warning.exposing_history_description'\r\n                            defaultMessage='Everyone who gains access to this channel can view the entire message history, including messages that were sent under stricter access rules.'\r\n                        />\r\n                    </div>\r\n                </div>\r\n            }\r\n            showCheckbox={true}\r\n            checkboxClass='checkbox text-left mb-0 activity-warning-checkbox'\r\n            checkboxText={\r\n                <FormattedMessage\r\n                    id='channel_settings.activity_warning.acknowledge_expose_history'\r\n                    defaultMessage='I acknowledge this change will expose all historical channel messages to more users'\r\n                />\r\n            }\r\n            confirmButtonText={\r\n                <FormattedMessage\r\n                    id='channel_settings.activity_warning.save_and_apply'\r\n                    defaultMessage='Save and apply'\r\n                />\r\n            }\r\n            confirmButtonClass='btn btn-danger'\r\n            confirmDisabled={!acknowledgeRisk}\r\n            onConfirm={handleConfirm}\r\n            onCancel={handleCancel}\r\n            onCheckboxChange={handleCheckboxChange}\r\n            isStacked={true}\r\n        />\r\n    );\r\n};\r\n\r\nexport default ChannelActivityWarningModal;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useState, useEffect, useCallback, useMemo, useRef} from 'react';\r\nimport {FormattedMessage, useIntl} from 'react-intl';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\nimport type {UserPropertyField} from '@mattermost/types/properties';\r\n\r\nimport {getAccessControlSettings} from 'mattermost-redux/selectors/entities/access_control';\r\nimport {getChannelMessageCount} from 'mattermost-redux/selectors/entities/channels';\r\nimport {getCurrentUser, isCurrentUserSystemAdmin} from 'mattermost-redux/selectors/entities/users';\r\n\r\nimport TableEditor from 'components/admin_console/access_control/editors/table_editor/table_editor';\r\nimport ConfirmModal from 'components/confirm_modal';\r\nimport SystemPolicyIndicator from 'components/system_policy_indicator';\r\nimport SaveChangesPanel, {type SaveChangesPanelState} from 'components/widgets/modals/components/save_changes_panel';\r\n\r\nimport {useChannelAccessControlActions} from 'hooks/useChannelAccessControlActions';\r\nimport {useChannelSystemPolicies} from 'hooks/useChannelSystemPolicies';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\nimport ChannelAccessRulesConfirmModal from './channel_access_rules_confirm_modal';\r\nimport ChannelActivityWarningModal from './channel_activity_warning_modal';\r\n\r\nimport './channel_settings_access_rules_tab.scss';\r\n\r\n// Constants\r\nconst SAVE_RESULT_SAVED = 'saved' as const;\r\nconst SAVE_RESULT_ERROR = 'error' as const;\r\nconst SAVE_RESULT_CONFIRMATION_REQUIRED = 'confirmation_required' as const;\r\nconst MAX_USERS_SEARCH_LIMIT = 1000;\r\n\r\ntype SaveResult = typeof SAVE_RESULT_SAVED | typeof SAVE_RESULT_ERROR | typeof SAVE_RESULT_CONFIRMATION_REQUIRED;\r\n\r\ntype ChannelSettingsAccessRulesTabProps = {\r\n    channel: Channel;\r\n    setAreThereUnsavedChanges?: (unsaved: boolean) => void;\r\n    showTabSwitchError?: boolean;\r\n};\r\n\r\nfunction ChannelSettingsAccessRulesTab({\r\n    channel,\r\n    setAreThereUnsavedChanges,\r\n    showTabSwitchError,\r\n}: ChannelSettingsAccessRulesTabProps) {\r\n    const {formatMessage} = useIntl();\r\n\r\n    // Get access control settings and current user from Redux state\r\n    const accessControlSettings = useSelector((state: GlobalState) => getAccessControlSettings(state));\r\n    const currentUser = useSelector(getCurrentUser);\r\n    const channelMessageCount = useSelector((state: GlobalState) => getChannelMessageCount(state, channel.id));\r\n\r\n    // Check if current user is system admin (system admins should never be restricted)\r\n    const isSystemAdmin = useSelector(isCurrentUserSystemAdmin);\r\n\r\n    // State for the access control expression and user attributes\r\n    const [expression, setExpression] = useState('');\r\n    const [originalExpression, setOriginalExpression] = useState('');\r\n    const [userAttributes, setUserAttributes] = useState<UserPropertyField[]>([]);\r\n    const [attributesLoaded, setAttributesLoaded] = useState(false);\r\n\r\n    // Auto-sync members toggle state\r\n    const [autoSyncMembers, setAutoSyncMembers] = useState(false);\r\n    const [originalAutoSyncMembers, setOriginalAutoSyncMembers] = useState(false);\r\n\r\n    // SaveChangesPanel state\r\n    const [saveChangesPanelState, setSaveChangesPanelState] = useState<SaveChangesPanelState>();\r\n    const [formError, setFormError] = useState('');\r\n\r\n    // Validation modal state\r\n    const [showSelfExclusionModal, setShowSelfExclusionModal] = useState(false);\r\n\r\n    // Activity warning modal state\r\n    const [showActivityWarningModal, setShowActivityWarningModal] = useState(false);\r\n    const [shouldShowActivityWarning, setShouldShowActivityWarning] = useState(false);\r\n    const [activityWarningModalKey, setActivityWarningModalKey] = useState(0);\r\n\r\n    // Confirmation modal state\r\n    const [showConfirmModal, setShowConfirmModal] = useState(false);\r\n    const [usersToAdd, setUsersToAdd] = useState<string[]>([]);\r\n    const [usersToRemove, setUsersToRemove] = useState<string[]>([]);\r\n    const [isProcessingSave, setIsProcessingSave] = useState(false);\r\n\r\n    const actions = useChannelAccessControlActions(channel.id);\r\n\r\n    // Fetch system policies applied to this channel\r\n    const {policies: systemPolicies, loading: policiesLoading} = useChannelSystemPolicies(channel);\r\n\r\n    // Load user attributes on component mount\r\n    useEffect(() => {\r\n        const loadAttributes = async () => {\r\n            try {\r\n                const result = await actions.getAccessControlFields('', 100);\r\n                if (result.data) {\r\n                    setUserAttributes(result.data);\r\n                }\r\n                setAttributesLoaded(true);\r\n            } catch (error) {\r\n                setUserAttributes([]);\r\n\r\n                // Only set attributesLoaded for permission errors (403), not for other errors\r\n                // This allows channel admins to still use the interface when they get 403 on attributes\r\n                const errorMessage = error instanceof Error ? error.message : String(error);\r\n                if (errorMessage.includes('403') || errorMessage.includes('Forbidden')) {\r\n                    setAttributesLoaded(true);\r\n                }\r\n\r\n                // For other errors, keep attributesLoaded false so UI doesn't render\r\n            }\r\n        };\r\n\r\n        loadAttributes();\r\n    }, [actions]);\r\n\r\n    // Load existing channel access rules\r\n    useEffect(() => {\r\n        const loadChannelPolicy = async () => {\r\n            try {\r\n                const result = await actions.getChannelPolicy(channel.id);\r\n                if (result.data) {\r\n                    // Extract expression from the policy rules\r\n                    const existingExpression = result.data.rules?.[0]?.expression || '';\r\n                    const existingAutoSync = result.data.active || false;\r\n\r\n                    setExpression(existingExpression);\r\n                    setOriginalExpression(existingExpression);\r\n                    setAutoSyncMembers(existingAutoSync);\r\n                    setOriginalAutoSyncMembers(existingAutoSync);\r\n                }\r\n            } catch (error) {\r\n                // If no policy exists (404), that's fine - use defaults\r\n                setExpression('');\r\n                setOriginalExpression('');\r\n            }\r\n        };\r\n\r\n        loadChannelPolicy();\r\n    }, [channel.id, actions]);\r\n\r\n    // Update parent component when changes occur\r\n    useEffect(() => {\r\n        const unsavedChanges =\r\n            expression !== originalExpression ||\r\n            autoSyncMembers !== originalAutoSyncMembers;\r\n\r\n        setAreThereUnsavedChanges?.(unsavedChanges);\r\n    }, [expression, originalExpression, autoSyncMembers, originalAutoSyncMembers, setAreThereUnsavedChanges]);\r\n\r\n    const handleExpressionChange = useCallback((newExpression: string) => {\r\n        setExpression(newExpression);\r\n\r\n        // Don't clear form error here - let validation determine if the error should be cleared\r\n        setSaveChangesPanelState(undefined);\r\n    }, []);\r\n\r\n    const handleParseError = useCallback((errorMessage?: string) => {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('Failed to parse expression in table editor');\r\n\r\n        // Don't show UI errors for permission issues (403/Forbidden)\r\n        if (errorMessage?.includes('403') || errorMessage?.includes('Forbidden')) {\r\n            return;\r\n        }\r\n\r\n        setFormError(formatMessage({\r\n            id: 'channel_settings.access_rules.parse_error',\r\n            defaultMessage: 'Invalid expression format',\r\n        }));\r\n    }, [formatMessage]);\r\n\r\n    // Helper function to detect empty rules state\r\n    const isEmptyRulesState = useMemo((): boolean => {\r\n        const hasChannelRules = expression && expression.trim().length > 0;\r\n        const hasSystemPolicies = systemPolicies && systemPolicies.length > 0;\r\n\r\n        // Return true if there are no channel rules or system policies\r\n        return !(hasChannelRules || hasSystemPolicies);\r\n    }, [expression, systemPolicies]);\r\n\r\n    // Auto-disable auto-sync when there are no system policies and no rules\r\n    useEffect(() => {\r\n        if (policiesLoading) {\r\n            return;\r\n        }\r\n\r\n        // Only auto-disable if there are no system policies and no rules (empty state)\r\n        if (isEmptyRulesState && autoSyncMembers) {\r\n            setAutoSyncMembers(false);\r\n        }\r\n    }, [isEmptyRulesState, autoSyncMembers]);\r\n\r\n    const handleAutoSyncToggle = useCallback(() => {\r\n        // Don't allow toggling if in empty rules state\r\n        if (isEmptyRulesState) {\r\n            return;\r\n        }\r\n\r\n        setAutoSyncMembers((prev) => !prev);\r\n    }, [isEmptyRulesState]);\r\n\r\n    // Helper function to combine system policy expressions with channel expression\r\n    const combineSystemAndChannelExpressions = useCallback((channelExpression: string): string => {\r\n        // Get expressions from system policies\r\n        const systemExpressions = systemPolicies.\r\n            map((policy) => policy.rules?.[0]?.expression).\r\n            filter((expr) => expr && expr.trim());\r\n\r\n        // Combine channel expression with system expressions\r\n        const allExpressions = [];\r\n\r\n        // Add channel expression first (if it exists)\r\n        if (channelExpression.trim()) {\r\n            allExpressions.push(channelExpression.trim());\r\n        }\r\n\r\n        // Add system policy expressions\r\n        if (systemExpressions.length > 0) {\r\n            allExpressions.push(...systemExpressions);\r\n        }\r\n\r\n        // Combine with AND logic (same as sync job does)\r\n        if (allExpressions.length === 0) {\r\n            return '';\r\n        } else if (allExpressions.length === 1) {\r\n            return allExpressions[0];\r\n        }\r\n\r\n        // Wrap each expression in parentheses and combine with &&\r\n        return allExpressions.\r\n            map((expr) => `(${expr})`).\r\n            join(' && ');\r\n    }, [systemPolicies]);\r\n\r\n    // Validate that current user satisfies the expression\r\n    const validateSelfExclusion = useCallback(async (testExpression: string): Promise<boolean> => {\r\n        if (!testExpression.trim()) {\r\n            return true; // No expression, skip validation\r\n        }\r\n\r\n        if (!currentUser?.id) {\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.access_rules.error.no_current_user',\r\n                defaultMessage: 'Cannot validate access rules: current user not found',\r\n            }));\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            // use backend endpoint for direct validation\r\n            const result = await actions.validateExpressionAgainstRequester(testExpression);\r\n\r\n            if (!result.data?.requester_matches) {\r\n                setShowSelfExclusionModal(true);\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        } catch (error) {\r\n            // If validation fails, prevent save for security - don't risk self-exclusion\r\n            // eslint-disable-next-line no-console\r\n            console.error('Failed to validate self-exclusion:', error);\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.access_rules.error.validation_failed',\r\n                defaultMessage: 'Failed to validate access rules. Please try again.',\r\n            }));\r\n            return false;\r\n        }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [currentUser?.id]);\r\n\r\n    // Check if rules are becoming less restrictive by comparing user matches\r\n    const isBecomingLessRestrictive = useCallback(async (oldExpression: string, newExpression: string): Promise<boolean> => {\r\n        try {\r\n            const hadRules = oldExpression.trim().length > 0;\r\n            const hasRules = newExpression.trim().length > 0;\r\n\r\n            // If there were no rules before, we can't be removing rules\r\n            if (!hadRules) {\r\n                return false;\r\n            }\r\n\r\n            // If removing all rules, definitely more permissive\r\n            if (!hasRules) {\r\n                return true;\r\n            }\r\n\r\n            // Compare the actual user matches between old and new expressions\r\n            const oldCombined = combineSystemAndChannelExpressions(oldExpression);\r\n            const newCombined = combineSystemAndChannelExpressions(newExpression);\r\n\r\n            // Search users matching old expression\r\n            const oldMatchResult = await actions.searchUsers(oldCombined, '', '', MAX_USERS_SEARCH_LIMIT);\r\n            const oldMatchingUserIds = oldMatchResult.data?.users.map((u) => u.id) || [];\r\n\r\n            // Search users matching new expression\r\n            const newMatchResult = await actions.searchUsers(newCombined, '', '', MAX_USERS_SEARCH_LIMIT);\r\n            const newMatchingUserIds = newMatchResult.data?.users.map((u) => u.id) || [];\r\n\r\n            // Check if there are users who match the new expression but not the old one\r\n            // If yes, the new rules are definitely less restrictive\r\n            const newlyMatchingUsers = newMatchingUserIds.filter((id) => !oldMatchingUserIds.includes(id));\r\n            if (newlyMatchingUsers.length > 0) {\r\n                return true;\r\n            }\r\n\r\n            // Check if there are users who match the old expression but not the new one\r\n            // If yes, the new rules are more restrictive\r\n            const removedUsers = oldMatchingUserIds.filter((id) => !newMatchingUserIds.includes(id));\r\n            if (removedUsers.length > 0) {\r\n                return false;\r\n            }\r\n\r\n            // If we reach here, the same users match both expressions\r\n            // This could mean:\r\n            // 1. The expressions are functionally equivalent, OR\r\n            // 2. There are no users in the system that would expose the difference\r\n            // To be safe, if the expressions are different, assume it could be less restrictive\r\n            return oldExpression.trim() !== newExpression.trim();\r\n        } catch (error) {\r\n            // eslint-disable-next-line no-console\r\n            console.error('Failed to compare expression restrictiveness:', error);\r\n\r\n            // On error, be conservative and show warning\r\n            return true;\r\n        }\r\n    }, [actions, combineSystemAndChannelExpressions]);\r\n\r\n    // Calculate membership changes\r\n    const calculateMembershipChanges = useCallback(async (channelExpression: string): Promise<{toAdd: string[]; toRemove: string[]; potentialToAdd: string[]}> => {\r\n        // Combine system and channel expressions (same logic as sync job)\r\n        const combinedExpression = combineSystemAndChannelExpressions(channelExpression);\r\n        if (!combinedExpression.trim()) {\r\n            return {toAdd: [], toRemove: [], potentialToAdd: []};\r\n        }\r\n\r\n        try {\r\n            // Get users who match the COMBINED expression (system + channel)\r\n            const matchResult = await actions.searchUsers(combinedExpression, '', '', MAX_USERS_SEARCH_LIMIT);\r\n            const matchingUserIds = matchResult.data?.users.map((u) => u.id) || [];\r\n\r\n            // Get current channel members\r\n            const membersResult = await actions.getChannelMembers(channel.id);\r\n            const currentMemberIds = membersResult.data?.map((m: {user_id: string}) => m.user_id) || [];\r\n\r\n            // Calculate who COULD potentially be added (regardless of auto-sync)\r\n            const potentialToAdd = matchingUserIds.filter((id) => !currentMemberIds.includes(id));\r\n\r\n            // Calculate who will be added (if auto-sync is enabled)\r\n            const toAdd = autoSyncMembers ? potentialToAdd : [];\r\n\r\n            // Calculate who will be removed (users who don't match the expression)\r\n            const toRemove = currentMemberIds.filter((id) => !matchingUserIds.includes(id));\r\n\r\n            return {toAdd, toRemove, potentialToAdd};\r\n        } catch (error) {\r\n            // eslint-disable-next-line no-console\r\n            console.error('Failed to calculate membership changes:', error);\r\n            return {toAdd: [], toRemove: [], potentialToAdd: []};\r\n        }\r\n    }, [channel.id, autoSyncMembers, actions, combineSystemAndChannelExpressions]);\r\n\r\n    // Perform the actual save\r\n    const performSave = useCallback(async (): Promise<boolean> => {\r\n        try {\r\n            setIsProcessingSave(true);\r\n\r\n            // Check if we're entering empty rules state\r\n            const willBeEmptyState = isEmptyRulesState;\r\n\r\n            if (willBeEmptyState) {\r\n                // Edge case: Delete policy entirely to return to standard access\r\n                // When no rules AND no system policies exist, delete the channel policy\r\n                try {\r\n                    await actions.deleteChannelPolicy(channel.id);\r\n                } catch (deleteError: unknown) {\r\n                    // Ignore \"not found\" errors - policy might not exist yet\r\n                    const errorMessage = deleteError instanceof Error ? deleteError.message : String(deleteError);\r\n                    if (errorMessage && !errorMessage.includes('not found')) {\r\n                        throw new Error(errorMessage || 'Failed to delete channel policy');\r\n                    }\r\n                }\r\n\r\n                // Update original values to reflect the empty state\r\n                setOriginalExpression('');\r\n                setOriginalAutoSyncMembers(false);\r\n\r\n                // Close confirmation modal if open\r\n                setShowConfirmModal(false);\r\n                setUsersToAdd([]);\r\n                setUsersToRemove([]);\r\n\r\n                return true;\r\n            }\r\n\r\n            // Step 1: Build and save the policy object (without active field to avoid conflicts)\r\n            const policy = {\r\n                id: channel.id,\r\n                name: channel.display_name,\r\n                type: 'channel',\r\n                version: 'v0.2',\r\n                active: false, // Always save as false initially, then update separately\r\n                revision: 1,\r\n                created_at: Date.now(),\r\n                rules: expression.trim() ? [{\r\n                    actions: ['*'],\r\n                    expression: expression.trim(),\r\n                }] : [],\r\n                imports: systemPolicies.map((p) => p.id), // Include existing parent policies\r\n            };\r\n\r\n            // Save the policy first\r\n            const result = await actions.saveChannelPolicy(policy);\r\n            if (result.error) {\r\n                throw new Error(result.error.message || 'Failed to save policy');\r\n            }\r\n\r\n            // Step 2: Update the active status separately (like System Console does)\r\n            try {\r\n                await actions.updateAccessControlPoliciesActive([{id: channel.id, active: autoSyncMembers}]);\r\n            } catch (activeError) {\r\n                // Don't fail the entire save operation for this, but log it\r\n                // eslint-disable-next-line no-console\r\n                console.error('Failed to update policy active status:', activeError);\r\n            }\r\n\r\n            // Step 3: Create a job to immediately sync channel membership when rules exist\r\n            // This ensures both user removal (always) and addition (conditional) happen immediately\r\n            if (expression.trim()) {\r\n                try {\r\n                    await actions.createAccessControlSyncJob({\r\n                        policy_id: channel.id, // Sync only this specific channel policy\r\n                    });\r\n                } catch (jobError) {\r\n                    // Log job creation error but don't fail the save operation\r\n                    // eslint-disable-next-line no-console\r\n                    console.error('Failed to create access control sync job:', jobError);\r\n                }\r\n            }\r\n\r\n            // Update original values on successful save\r\n            setOriginalExpression(expression);\r\n            setOriginalAutoSyncMembers(autoSyncMembers);\r\n\r\n            // Close confirmation modal if open\r\n            setShowConfirmModal(false);\r\n            setUsersToAdd([]);\r\n            setUsersToRemove([]);\r\n\r\n            return true;\r\n        } catch (error) {\r\n            // eslint-disable-next-line no-console\r\n            console.error('Failed to save access rules:', error);\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.access_rules.save_error',\r\n                defaultMessage: 'Failed to save access rules',\r\n            }));\r\n            return false;\r\n        } finally {\r\n            setIsProcessingSave(false);\r\n        }\r\n    }, [channel.id, channel.display_name, expression, autoSyncMembers, systemPolicies, actions, formatMessage, isEmptyRulesState]);\r\n\r\n    // Handle save action\r\n    const handleSave = useCallback(async (): Promise<SaveResult> => {\r\n        try {\r\n            // Check if we're removing all rules (special case that requires warning)\r\n            const hasChannelHistory = (channelMessageCount?.total ?? 0) > 0;\r\n            const hadRulesBefore = originalExpression.trim().length > 0;\r\n            const hasRulesNow = expression.trim().length > 0;\r\n            const isRemovingAllRules = hadRulesBefore && !hasRulesNow;\r\n\r\n            // For empty rules state, check if we need to show warning for removing all rules\r\n            if (isEmptyRulesState) {\r\n                // If removing all rules and channel has history, show activity warning first\r\n                if (isRemovingAllRules && hasChannelHistory) {\r\n                    setShouldShowActivityWarning(true);\r\n                    setActivityWarningModalKey((prev) => prev + 1);\r\n                    setShowActivityWarningModal(true);\r\n                    return SAVE_RESULT_CONFIRMATION_REQUIRED;\r\n                }\r\n\r\n                // No warning needed, save directly\r\n                const success = await performSave();\r\n                const result = success ? SAVE_RESULT_SAVED : SAVE_RESULT_ERROR;\r\n                return result;\r\n            }\r\n\r\n            // Validate expression if auto-sync is enabled\r\n            if (autoSyncMembers && isEmptyRulesState) {\r\n                setFormError(formatMessage({\r\n                    id: 'channel_settings.access_rules.expression_required_for_autosync',\r\n                    defaultMessage: 'Access rules are required when auto-add members is enabled',\r\n                }));\r\n                return SAVE_RESULT_ERROR;\r\n            }\r\n\r\n            // Validate self-exclusion\r\n            if (expression.trim()) {\r\n                const isValid = await validateSelfExclusion(expression);\r\n                if (!isValid) {\r\n                    return SAVE_RESULT_ERROR;\r\n                }\r\n            }\r\n\r\n            // Calculate membership changes\r\n            const changes = await calculateMembershipChanges(expression);\r\n\r\n            // Determine warning conditions\r\n            const becomingLessRestrictive = await isBecomingLessRestrictive(originalExpression, expression);\r\n            const willImmediatelyAddUsers = changes.toAdd.length > 0;\r\n\r\n            const isAddingFirstRules = !hadRulesBefore && hasRulesNow;\r\n            const rulesBecomingLessRestrictiveWithAutoAddDisabled = !autoSyncMembers && becomingLessRestrictive;\r\n            const rulesBecomingLessRestrictiveWithAutoAddEnabled = autoSyncMembers && becomingLessRestrictive;\r\n            const addingUsersWithAutoAddEnabled = autoSyncMembers && willImmediatelyAddUsers;\r\n\r\n            // Determine if warning should be shown\r\n            const shouldShowWarning = hasChannelHistory && (\r\n                isRemovingAllRules ||\r\n                rulesBecomingLessRestrictiveWithAutoAddDisabled ||\r\n                rulesBecomingLessRestrictiveWithAutoAddEnabled ||\r\n                addingUsersWithAutoAddEnabled\r\n            ) && !isAddingFirstRules;\r\n\r\n            // If there are membership changes, show confirmation modal\r\n            if (changes.toAdd.length > 0 || changes.toRemove.length > 0) {\r\n                setUsersToAdd(changes.toAdd);\r\n                setUsersToRemove(changes.toRemove);\r\n                setShouldShowActivityWarning(shouldShowWarning);\r\n                setShowConfirmModal(true);\r\n                return SAVE_RESULT_CONFIRMATION_REQUIRED;\r\n            }\r\n\r\n            // No immediate membership changes, but if warning needed, show it before saving\r\n            if (shouldShowWarning) {\r\n                setShouldShowActivityWarning(true);\r\n                setActivityWarningModalKey((prev) => prev + 1);\r\n                setShowActivityWarningModal(true);\r\n                return SAVE_RESULT_CONFIRMATION_REQUIRED;\r\n            }\r\n\r\n            // No changes and no warning needed, save directly\r\n            const success = await performSave();\r\n            const finalResult = success ? SAVE_RESULT_SAVED : SAVE_RESULT_ERROR;\r\n            return finalResult;\r\n        } catch (error) {\r\n            // eslint-disable-next-line no-console\r\n            console.error('handleSave: Caught error in save process:', error);\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.access_rules.save_error',\r\n                defaultMessage: 'Failed to save access rules',\r\n            }));\r\n            return SAVE_RESULT_ERROR;\r\n        }\r\n    }, [expression, originalExpression, autoSyncMembers, formatMessage, validateSelfExclusion, calculateMembershipChanges, performSave, isEmptyRulesState, channelMessageCount, isBecomingLessRestrictive]);\r\n\r\n    // Prevent duplicate saves with immediate response\r\n    const saveInProgressRef = useRef(false);\r\n\r\n    // Handle confirmation modal confirm - immediate response, no debounce\r\n    const handleConfirmSave = useCallback(async () => {\r\n        // Prevent duplicate clicks - immediate response\r\n        if (saveInProgressRef.current) {\r\n            return;\r\n        }\r\n\r\n        // Close confirmation modal first\r\n        setShowConfirmModal(false);\r\n\r\n        // If activity warning should be shown, show it instead of saving directly\r\n        if (shouldShowActivityWarning) {\r\n            setActivityWarningModalKey((prev) => prev + 1);\r\n            setShowActivityWarningModal(true);\r\n            return;\r\n        }\r\n\r\n        // No activity warning needed, proceed with save\r\n        saveInProgressRef.current = true;\r\n\r\n        try {\r\n            const success = await performSave();\r\n            if (success) {\r\n                setSaveChangesPanelState(SAVE_RESULT_SAVED);\r\n            } else {\r\n                setSaveChangesPanelState(SAVE_RESULT_ERROR);\r\n            }\r\n        } finally {\r\n            saveInProgressRef.current = false;\r\n        }\r\n    }, [shouldShowActivityWarning, performSave]);\r\n\r\n    // Handle save changes panel actions - immediate response, no debounce\r\n    const handleSaveChanges = useCallback(async () => {\r\n        // Prevent duplicate clicks - immediate response\r\n        if (saveInProgressRef.current) {\r\n            return;\r\n        }\r\n\r\n        saveInProgressRef.current = true;\r\n\r\n        try {\r\n            const result = await handleSave();\r\n\r\n            if (result === SAVE_RESULT_SAVED) {\r\n                setSaveChangesPanelState(SAVE_RESULT_SAVED);\r\n            } else if (result === SAVE_RESULT_ERROR) {\r\n                setSaveChangesPanelState(SAVE_RESULT_ERROR);\r\n            }\r\n\r\n            // When result === SAVE_RESULT_CONFIRMATION_REQUIRED, no panel state change needed\r\n            // Modal workflows will handle the next steps\r\n        } finally {\r\n            saveInProgressRef.current = false;\r\n        }\r\n    }, [handleSave]);\r\n\r\n    const handleCancel = useCallback(() => {\r\n        // Reset to original values\r\n        setExpression(originalExpression);\r\n        setAutoSyncMembers(originalAutoSyncMembers);\r\n\r\n        // Clear errors and panel state\r\n        setFormError('');\r\n        setSaveChangesPanelState(undefined);\r\n    }, [originalExpression, originalAutoSyncMembers]);\r\n\r\n    const handleClose = useCallback(() => {\r\n        setSaveChangesPanelState(undefined);\r\n    }, []);\r\n\r\n    // Handle activity warning modal actions\r\n    const handleActivityWarningContinue = useCallback(async () => {\r\n        setShowActivityWarningModal(false);\r\n\r\n        // Proceed with save after activity warning acknowledgment\r\n        saveInProgressRef.current = true;\r\n\r\n        try {\r\n            const success = await performSave();\r\n            if (success) {\r\n                setSaveChangesPanelState(SAVE_RESULT_SAVED);\r\n            } else {\r\n                setSaveChangesPanelState(SAVE_RESULT_ERROR);\r\n            }\r\n        } finally {\r\n            saveInProgressRef.current = false;\r\n        }\r\n    }, [performSave]);\r\n\r\n    const handleActivityWarningClose = useCallback(() => {\r\n        setShowActivityWarningModal(false);\r\n    }, []);\r\n\r\n    // Calculate if there are errors\r\n    const hasErrors = Boolean(formError) || Boolean(showTabSwitchError);\r\n\r\n    // Calculate whether to show the save changes panel\r\n    const shouldShowPanel = useMemo(() => {\r\n        const unsavedChanges =\r\n            expression !== originalExpression ||\r\n            autoSyncMembers !== originalAutoSyncMembers;\r\n\r\n        return unsavedChanges || saveChangesPanelState === SAVE_RESULT_SAVED;\r\n    }, [expression, originalExpression, autoSyncMembers, originalAutoSyncMembers, saveChangesPanelState]);\r\n\r\n    return (\r\n        <div className='ChannelSettingsModal__accessRulesTab'>\r\n            {/* Display system policies indicator if any are applied */}\r\n            {!policiesLoading && systemPolicies.length > 0 && (\r\n                <div className='ChannelSettingsModal__systemPolicies'>\r\n                    <SystemPolicyIndicator\r\n                        policies={systemPolicies}\r\n                        resourceType='channel'\r\n                        showPolicyNames={true}\r\n                        variant='detailed'\r\n                    />\r\n                </div>\r\n            )}\r\n\r\n            <div className='ChannelSettingsModal__accessRulesHeader'>\r\n                <h3 className='ChannelSettingsModal__accessRulesTitle'>\r\n                    {formatMessage({id: 'channel_settings.access_rules.title', defaultMessage: 'Access Rules'})}\r\n                </h3>\r\n                <p className='ChannelSettingsModal__accessRulesSubtitle'>\r\n                    {formatMessage({\r\n                        id: 'channel_settings.access_rules.subtitle',\r\n                        defaultMessage: 'Select user attributes and values as rules to restrict channel membership',\r\n                    })}\r\n                </p>\r\n            </div>\r\n\r\n            {/* TableEditor for creating access rules */}\r\n            {attributesLoaded && (\r\n                <div className='ChannelSettingsModal__accessRulesEditor'>\r\n                    <TableEditor\r\n                        value={expression}\r\n                        onChange={handleExpressionChange}\r\n                        onValidate={() => setFormError('')}\r\n                        userAttributes={userAttributes}\r\n                        onParseError={handleParseError}\r\n                        channelId={channel.id}\r\n                        actions={actions}\r\n                        enableUserManagedAttributes={accessControlSettings?.EnableUserManagedAttributes || false}\r\n                        isSystemAdmin={isSystemAdmin}\r\n                        validateExpressionAgainstRequester={actions.validateExpressionAgainstRequester}\r\n                    />\r\n                </div>\r\n            )}\r\n\r\n            {/* Divider between access rules and auto-sync */}\r\n            <hr className='ChannelSettingsModal__divider'/>\r\n\r\n            {/* Auto-sync members toggle */}\r\n            <div className='ChannelSettingsModal__autoSyncSection'>\r\n                <div className='ChannelSettingsModal__autoSyncCheckboxContainer'>\r\n                    <input\r\n                        type='checkbox'\r\n                        className='ChannelSettingsModal__autoSyncCheckbox'\r\n                        checked={autoSyncMembers}\r\n                        onChange={handleAutoSyncToggle}\r\n                        disabled={isEmptyRulesState}\r\n                        id='autoSyncMembersCheckbox'\r\n                        name='autoSyncMembers'\r\n                    />\r\n                    <label\r\n                        htmlFor='autoSyncMembersCheckbox'\r\n                        className='ChannelSettingsModal__autoSyncLabel'\r\n                        title={(() => {\r\n                            if (isEmptyRulesState) {\r\n                                return formatMessage({\r\n                                    id: 'channel_settings.access_rules.auto_sync_disabled_empty_state',\r\n                                    defaultMessage: 'Auto-add is disabled because no access rules are defined',\r\n                                });\r\n                            }\r\n\r\n                            if (!expression.trim()) {\r\n                                return formatMessage({\r\n                                    id: 'channel_settings.access_rules.auto_sync_requires_expression',\r\n                                    defaultMessage: 'Define access rules to enable auto-add members',\r\n                                });\r\n                            }\r\n                            return undefined;\r\n                        })()}\r\n                    >\r\n                        <span className={`ChannelSettingsModal__autoSyncText ${(isEmptyRulesState && systemPolicies.length === 0) ? 'disabled' : ''}`}>\r\n                            {formatMessage({\r\n                                id: 'channel_settings.access_rules.auto_sync',\r\n                                defaultMessage: 'Auto-add members based on access rules',\r\n                            })}\r\n                        </span>\r\n                    </label>\r\n                </div>\r\n                <p className='ChannelSettingsModal__autoSyncDescription'>\r\n                    {(() => {\r\n                        if (autoSyncMembers) {\r\n                            return formatMessage({\r\n                                id: 'channel_settings.access_rules.auto_sync_enabled_description',\r\n                                defaultMessage: 'Users who match the configured attribute values will be automatically added as members and those who no longer match will be removed.',\r\n                            });\r\n                        }\r\n\r\n                        return formatMessage({\r\n                            id: 'channel_settings.access_rules.auto_sync_disabled_description',\r\n                            defaultMessage: 'Access rules will prevent unauthorized users from joining, but will not automatically add qualifying members.',\r\n                        });\r\n                    })()}\r\n                </p>\r\n            </div>\r\n\r\n            {/* SaveChangesPanel for unsaved changes */}\r\n            {shouldShowPanel && (\r\n                <SaveChangesPanel\r\n                    handleSubmit={handleSaveChanges}\r\n                    handleCancel={handleCancel}\r\n                    handleClose={handleClose}\r\n                    tabChangeError={hasErrors}\r\n                    state={hasErrors ? SAVE_RESULT_ERROR : saveChangesPanelState}\r\n                    customErrorMessage={formError || (showTabSwitchError ? undefined : formatMessage({\r\n                        id: 'channel_settings.access_rules.form_error',\r\n                        defaultMessage: 'There are errors in the form above',\r\n                    }))}\r\n                    cancelButtonText={formatMessage({\r\n                        id: 'channel_settings.save_changes_panel.reset',\r\n                        defaultMessage: 'Reset',\r\n                    })}\r\n                />\r\n            )}\r\n\r\n            {/* Self-exclusion error modal */}\r\n            <ConfirmModal\r\n                show={showSelfExclusionModal}\r\n                title={\r\n                    <FormattedMessage\r\n                        id='channel_settings.access_rules.error.self_exclusion_title'\r\n                        defaultMessage='Cannot save access rules'\r\n                    />\r\n                }\r\n                message={\r\n                    <FormattedMessage\r\n                        id='channel_settings.access_rules.error.self_exclusion_message'\r\n                        defaultMessage=\"You cannot set this rule because it would remove you from the channel. Please update the access rules to make sure you satisfy them and they don't cause any unintended issues.\"\r\n                    />\r\n                }\r\n                confirmButtonText={\r\n                    <FormattedMessage\r\n                        id='channel_settings.access_rules.error.back_to_editing'\r\n                        defaultMessage='Back to editing'\r\n                    />\r\n                }\r\n                onConfirm={() => setShowSelfExclusionModal(false)}\r\n                onCancel={() => setShowSelfExclusionModal(false)}\r\n                hideCancel={true}\r\n                confirmButtonClass='btn btn-primary'\r\n                isStacked={true}\r\n            />\r\n\r\n            {/* Confirmation modal for membership changes */}\r\n            <ChannelAccessRulesConfirmModal\r\n                show={showConfirmModal}\r\n                onHide={() => {\r\n                    setShowConfirmModal(false);\r\n                    setUsersToAdd([]);\r\n                    setUsersToRemove([]);\r\n\r\n                    // Clear any error state when canceling the modal\r\n                    if (saveChangesPanelState === SAVE_RESULT_ERROR) {\r\n                        setSaveChangesPanelState(undefined);\r\n                    }\r\n                }}\r\n                onConfirm={handleConfirmSave}\r\n                channelName={channel.display_name}\r\n                usersToAdd={usersToAdd}\r\n                usersToRemove={usersToRemove}\r\n                isProcessing={isProcessingSave}\r\n                autoSyncEnabled={autoSyncMembers}\r\n                isStacked={true}\r\n                willShowActivityWarning={shouldShowActivityWarning}\r\n            />\r\n\r\n            {/* Activity warning modal */}\r\n            <ChannelActivityWarningModal\r\n                key={activityWarningModalKey}\r\n                isOpen={showActivityWarningModal}\r\n                onClose={handleActivityWarningClose}\r\n                onConfirm={handleActivityWarningContinue}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChannelSettingsAccessRulesTab;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {useState, useEffect} from 'react';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport type {AccessControlPolicy} from '@mattermost/types/access_control';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {getAccessControlPolicy} from 'mattermost-redux/actions/access_control';\r\n\r\nimport type {ActionFunc} from 'types/store';\r\n\r\ninterface UseChannelSystemPoliciesResult {\r\n    policies: AccessControlPolicy[];\r\n    loading: boolean;\r\n    error: string | null;\r\n}\r\n\r\n/**\r\n * Custom hook to fetch system-level policies applied to a channel\r\n * @param channel - The channel to fetch policies for\r\n * @returns Object containing policies array, loading state, and error\r\n */\r\nexport function useChannelSystemPolicies(channel: Channel | null): UseChannelSystemPoliciesResult {\r\n    const dispatch = useDispatch();\r\n    const [policies, setPolicies] = useState<AccessControlPolicy[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (!channel) {\r\n            setPolicies([]);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const fetchPolicies = async () => {\r\n            setLoading(true);\r\n            setError(null);\r\n\r\n            try {\r\n                // Check if channel has policy_enforced flag (ABAC enabled)\r\n                if (!channel.policy_enforced) {\r\n                    setPolicies([]);\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n\r\n                // In ABAC, the policy ID is the same as the channel ID\r\n                // This is how the backend links policies to channels\r\n                const channelPolicyResult = await dispatch(getAccessControlPolicy(channel.id) as unknown as ActionFunc);\r\n\r\n                if (channelPolicyResult.error) {\r\n                    // No policy found for this channel\r\n                    setPolicies([]);\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n\r\n                const channelPolicy = channelPolicyResult.data as AccessControlPolicy;\r\n\r\n                // If the channel policy has imports (parent policies), fetch them\r\n                if (channelPolicy && channelPolicy.imports && channelPolicy.imports.length > 0) {\r\n                    // Fetch all parent policies in parallel with channel context\r\n                    const parentPromises = channelPolicy.imports.map((parentId) =>\r\n                        dispatch(getAccessControlPolicy(parentId, channel.id) as unknown as ActionFunc),\r\n                    );\r\n\r\n                    const parentResults = await Promise.all(parentPromises);\r\n                    const parentPolicies: AccessControlPolicy[] = [];\r\n\r\n                    for (const result of parentResults) {\r\n                        if (result && !result.error && result.data) {\r\n                            parentPolicies.push(result.data as AccessControlPolicy);\r\n                        }\r\n                    }\r\n\r\n                    // Return parent policies if channel inherits from them\r\n                    setPolicies(parentPolicies);\r\n                } else if (channelPolicy && channelPolicy.type === 'parent') {\r\n                    // If the channel directly has a parent policy applied\r\n                    setPolicies([channelPolicy]);\r\n                } else if (channelPolicy) {\r\n                    // Channel has its own policy (could be a channel policy without imports)\r\n                    // For channel-level policies without imports, we might want to show them\r\n                    // but typically these are custom rules, not system policies\r\n                    setPolicies([]);\r\n                } else {\r\n                    setPolicies([]);\r\n                }\r\n            } catch (err) {\r\n                setError('Failed to fetch policies');\r\n                setPolicies([]);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchPolicies();\r\n    }, [channel, channel?.id, channel?.policy_enforced, dispatch]);\r\n\r\n    return {policies, loading, error};\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useState, useCallback} from 'react';\r\nimport {FormattedMessage, useIntl} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {deleteChannel} from 'actions/views/channel';\r\n\r\nimport ConfirmationModal from 'components/confirm_modal';\r\n\r\ntype ChannelSettingsArchiveTabProps = {\r\n    channel: Channel;\r\n    onHide: () => void;\r\n}\r\n\r\nfunction ChannelSettingsArchiveTab({\r\n    channel,\r\n    onHide,\r\n}: ChannelSettingsArchiveTabProps) {\r\n    const {formatMessage} = useIntl();\r\n    const dispatch = useDispatch();\r\n\r\n    const [showArchiveConfirmModal, setShowArchiveConfirmModal] = useState(false);\r\n\r\n    const handleArchiveChannel = useCallback(() => {\r\n        setShowArchiveConfirmModal(true);\r\n    }, []);\r\n\r\n    const doArchiveChannel = async () => {\r\n        // Call the delete channel action which handles validation, redirection, and notification sounds\r\n        await dispatch(deleteChannel(channel.id));\r\n\r\n        // Close the modal\r\n        onHide();\r\n    };\r\n\r\n    return (\r\n        <div className='ChannelSettingsModal__archiveTab'>\r\n            <FormattedMessage\r\n                id='channel_settings.archive.warning'\r\n                defaultMessage=\"Archiving a channel removes it from the user interface, but doesn't permanently delete the channel. New messages can't be posted to archived channels.\"\r\n            />\r\n            <button\r\n                type='button'\r\n                className='btn btn-danger'\r\n                onClick={handleArchiveChannel}\r\n                id='channelSettingsArchiveChannelButton'\r\n                aria-label={`Archive channel ${channel.display_name}`}\r\n            >\r\n                <FormattedMessage\r\n                    id='channel_settings.archive.button'\r\n                    defaultMessage='Archive this channel'\r\n                />\r\n            </button>\r\n\r\n            {showArchiveConfirmModal && (\r\n                <ConfirmationModal\r\n                    id='archiveChannelConfirmModal'\r\n                    show={true}\r\n                    title={formatMessage({id: 'channel_settings.modal.archiveTitle', defaultMessage: 'Archive channel?'})}\r\n                    message={\r\n                        <div>\r\n                            <p>\r\n                                <FormattedMessage\r\n                                    id='deleteChannelModal.canViewArchivedChannelsWarning'\r\n                                    defaultMessage=\"Archiving a channel removes it from the user interface, but doesn't permanently delete the channel. New messages can't be posted to archived channels.\"\r\n                                />\r\n                            </p>\r\n                            <p>\r\n                                <FormattedMessage\r\n                                    id='deleteChannelModal.confirmArchive'\r\n                                    defaultMessage='Are you sure you wish to archive the <strong>{display_name}</strong> channel?'\r\n                                    values={{\r\n                                        display_name: channel.display_name,\r\n                                        strong: (chunks) => <strong>{chunks}</strong>,\r\n                                    }}\r\n                                />\r\n                            </p>\r\n                        </div>\r\n                    }\r\n                    confirmButtonText={formatMessage({id: 'channel_settings.modal.confirmArchive', defaultMessage: 'Confirm'})}\r\n                    onConfirm={doArchiveChannel}\r\n                    onCancel={() => setShowArchiveConfirmModal(false)}\r\n                    confirmButtonClass='btn btn-danger'\r\n                    modalClass='archiveChannelConfirmModal'\r\n                    focusOriginElement='channelSettingsArchiveChannelButton'\r\n                    isStacked={true}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChannelSettingsArchiveTab;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useCallback, useEffect, useState} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\nimport type {ServerError} from '@mattermost/types/errors';\r\n\r\nimport {patchChannel} from 'mattermost-redux/actions/channels';\r\n\r\nimport ColorInput from 'components/color_input';\r\nimport type {TextboxElement} from 'components/textbox';\r\nimport Toggle from 'components/toggle';\r\nimport AdvancedTextbox from 'components/widgets/advanced_textbox/advanced_textbox';\r\nimport type {SaveChangesPanelState} from 'components/widgets/modals/components/save_changes_panel';\r\nimport SaveChangesPanel from 'components/widgets/modals/components/save_changes_panel';\r\n\r\nimport './channel_settings_configuration_tab.scss';\r\n\r\nconst CHANNEL_BANNER_MAX_CHARACTER_LIMIT = 1024;\r\nconst CHANNEL_BANNER_MIN_CHARACTER_LIMIT = 0;\r\n\r\nconst DEFAULT_CHANNEL_BANNER = {\r\n    enabled: false,\r\n    background_color: '#DDDDDD',\r\n    text: '',\r\n};\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n    setAreThereUnsavedChanges?: (unsaved: boolean) => void;\r\n    showTabSwitchError?: boolean;\r\n}\r\n\r\nfunction ChannelSettingsConfigurationTab({channel, setAreThereUnsavedChanges, showTabSwitchError}: Props) {\r\n    const {formatMessage} = useIntl();\r\n    const dispatch = useDispatch();\r\n\r\n    const heading = formatMessage({id: 'channel_banner.label.name', defaultMessage: 'Channel Banner'});\r\n    const subHeading = formatMessage({id: 'channel_banner.label.subtext', defaultMessage: 'When enabled, a customized banner will display at the top of the channel.'});\r\n    const bannerTextSettingTitle = formatMessage({id: 'channel_banner.banner_text.label', defaultMessage: 'Banner text'});\r\n    const bannerColorSettingTitle = formatMessage({id: 'channel_banner.banner_color.label', defaultMessage: 'Banner color'});\r\n    const bannerTextPlaceholder = formatMessage({id: 'channel_banner.banner_text.placeholder', defaultMessage: 'Channel banner text'});\r\n\r\n    const initialBannerInfo = channel.banner_info || DEFAULT_CHANNEL_BANNER;\r\n\r\n    const [formError, setFormError] = useState('');\r\n    const [showBannerTextPreview, setShowBannerTextPreview] = useState(false);\r\n    const [updatedChannelBanner, setUpdatedChannelBanner] = useState(initialBannerInfo);\r\n\r\n    const [requireConfirm, setRequireConfirm] = useState(false);\r\n    const [characterLimitExceeded, setCharacterLimitExceeded] = useState(false);\r\n    const [saveChangesPanelState, setSaveChangesPanelState] = useState<SaveChangesPanelState>();\r\n\r\n    // Change handlers\r\n    const handleToggle = useCallback(() => {\r\n        const newValue = !updatedChannelBanner.enabled;\r\n        const toUpdate = {\r\n            ...updatedChannelBanner,\r\n            enabled: newValue,\r\n        };\r\n        if (!newValue) {\r\n            toUpdate.text = initialBannerInfo.text;\r\n            toUpdate.background_color = initialBannerInfo.background_color;\r\n        }\r\n\r\n        setUpdatedChannelBanner(toUpdate);\r\n    }, [initialBannerInfo, updatedChannelBanner]);\r\n\r\n    const resetFormErrors = useCallback(() => {\r\n        setFormError('');\r\n        setSaveChangesPanelState(undefined);\r\n    }, []);\r\n\r\n    const handleTextChange = useCallback((e: React.ChangeEvent<TextboxElement>) => {\r\n        const newValue = e.target.value;\r\n        setUpdatedChannelBanner((prev) => ({\r\n            ...prev,\r\n            text: newValue,\r\n        }));\r\n\r\n        if (newValue.trim().length > CHANNEL_BANNER_MAX_CHARACTER_LIMIT) {\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.save_changes_panel.standard_error',\r\n                defaultMessage: 'There are errors in the form above',\r\n            }));\r\n            setCharacterLimitExceeded(true);\r\n        } else if (newValue.trim().length <= CHANNEL_BANNER_MIN_CHARACTER_LIMIT) {\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.save_changes_panel.banner_text.required_error',\r\n                defaultMessage: 'Channel banner text cannot be empty when enabled',\r\n            }));\r\n            setCharacterLimitExceeded(true);\r\n        } else {\r\n            resetFormErrors();\r\n            setCharacterLimitExceeded(false);\r\n        }\r\n    }, [formatMessage, resetFormErrors]);\r\n\r\n    const handleColorChange = useCallback((color: string) => {\r\n        setUpdatedChannelBanner((prev) => ({\r\n            ...prev,\r\n            background_color: color,\r\n        }));\r\n\r\n        if (color.trim()) {\r\n            resetFormErrors();\r\n        }\r\n    }, [resetFormErrors]);\r\n\r\n    const toggleTextPreview = useCallback(() => setShowBannerTextPreview((show) => !show), []);\r\n\r\n    const hasUnsavedChanges = useCallback(() => {\r\n        return (updatedChannelBanner.text?.trim() || '') !== (initialBannerInfo?.text?.trim() || '') ||\r\n            (updatedChannelBanner.background_color?.trim() || '') !== (initialBannerInfo?.background_color?.trim() || '') ||\r\n            updatedChannelBanner.enabled !== initialBannerInfo?.enabled;\r\n    }, [initialBannerInfo, updatedChannelBanner]);\r\n\r\n    useEffect(() => {\r\n        const unsavedChanges = hasUnsavedChanges();\r\n        setRequireConfirm(unsavedChanges);\r\n        setAreThereUnsavedChanges?.(unsavedChanges);\r\n    }, [hasUnsavedChanges, setAreThereUnsavedChanges]);\r\n\r\n    const handleServerError = useCallback((err: ServerError) => {\r\n        const errorMsg = err.message || formatMessage({id: 'channel_settings.unknown_error', defaultMessage: 'Something went wrong.'});\r\n        setFormError(errorMsg);\r\n    }, [formatMessage]);\r\n\r\n    const handleSave = useCallback(async (): Promise<boolean> => {\r\n        if (!channel) {\r\n            return false;\r\n        }\r\n\r\n        if (updatedChannelBanner.enabled && !updatedChannelBanner.text?.trim()) {\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.error_banner_text_required',\r\n                defaultMessage: 'Banner text is required',\r\n            }));\r\n            return false;\r\n        }\r\n\r\n        if (updatedChannelBanner.enabled && !updatedChannelBanner.background_color?.trim()) {\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.error_banner_color_required',\r\n                defaultMessage: 'Banner color is required',\r\n            }));\r\n            return false;\r\n        }\r\n\r\n        const updated: Channel = {\r\n            ...channel,\r\n        };\r\n\r\n        updated.banner_info = {\r\n            text: updatedChannelBanner.text?.trim() || '',\r\n            background_color: updatedChannelBanner.background_color?.trim() || '',\r\n            enabled: updatedChannelBanner.enabled,\r\n        };\r\n\r\n        const {error} = await dispatch(patchChannel(channel.id, updated));\r\n        if (error) {\r\n            handleServerError(error as ServerError);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }, [channel, dispatch, formatMessage, handleServerError, updatedChannelBanner]);\r\n\r\n    const handleSaveChanges = useCallback(async () => {\r\n        const success = await handleSave();\r\n        if (!success) {\r\n            setSaveChangesPanelState('error');\r\n            return;\r\n        }\r\n\r\n        // Update local state with trimmed values after successful save\r\n        setUpdatedChannelBanner((prev) => ({\r\n            ...prev,\r\n            text: prev.text?.trim() || '',\r\n            background_color: prev.background_color?.trim() || '',\r\n        }));\r\n\r\n        resetFormErrors();\r\n        setSaveChangesPanelState('saved');\r\n    }, [handleSave, resetFormErrors]);\r\n\r\n    const handleCancel = useCallback(() => {\r\n        setRequireConfirm(false);\r\n        setSaveChangesPanelState(undefined);\r\n        setShowBannerTextPreview(false);\r\n\r\n        setUpdatedChannelBanner(initialBannerInfo);\r\n        setFormError('');\r\n        setSaveChangesPanelState(undefined);\r\n        setCharacterLimitExceeded(false);\r\n    }, [initialBannerInfo]);\r\n\r\n    const handleClose = useCallback(() => {\r\n        setSaveChangesPanelState(undefined);\r\n        setRequireConfirm(false);\r\n    }, []);\r\n\r\n    const hasErrors = Boolean(formError) ||\r\n        characterLimitExceeded ||\r\n        showTabSwitchError;\r\n\r\n    const showSaveChangesPanel = requireConfirm || saveChangesPanelState === 'saved';\r\n\r\n    return (\r\n        <div className='ChannelSettingsModal__configurationTab'>\r\n            <div className='channel_banner_header'>\r\n                <div className='channel_banner_header__text'>\r\n                    <label\r\n                        className='Input_legend'\r\n                        aria-label={heading}\r\n                    >\r\n                        {heading}\r\n                    </label>\r\n                    <label\r\n                        className='Input_subheading'\r\n                        aria-label={heading}\r\n                    >\r\n                        {subHeading}\r\n                    </label>\r\n                </div>\r\n\r\n                <div className='channel_banner_header__toggle'>\r\n                    <Toggle\r\n                        id='channelBannerToggle'\r\n                        ariaLabel={heading}\r\n                        size='btn-md'\r\n                        disabled={false}\r\n                        onToggle={handleToggle}\r\n                        toggled={updatedChannelBanner.enabled}\r\n                        tabIndex={0}\r\n                        toggleClassName='btn-toggle-primary'\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {\r\n                updatedChannelBanner.enabled &&\r\n                <div className='channel_banner_section_body'>\r\n                    {/*Banner text section*/}\r\n                    <div className='setting_section'>\r\n                        <span\r\n                            className='setting_title'\r\n                            aria-label={bannerTextSettingTitle}\r\n                        >\r\n                            {bannerTextSettingTitle}\r\n                        </span>\r\n\r\n                        <div className='setting_body'>\r\n                            <AdvancedTextbox\r\n                                id='channel_banner_banner_text_textbox'\r\n                                value={updatedChannelBanner.text!}\r\n                                channelId={channel.id}\r\n                                onKeyPress={() => {}}\r\n                                showCharacterCount={true}\r\n                                useChannelMentions={false}\r\n                                onChange={handleTextChange}\r\n                                preview={showBannerTextPreview}\r\n                                togglePreview={toggleTextPreview}\r\n                                hasError={characterLimitExceeded}\r\n                                createMessage={bannerTextPlaceholder}\r\n                                maxLength={CHANNEL_BANNER_MAX_CHARACTER_LIMIT}\r\n                                minLength={CHANNEL_BANNER_MIN_CHARACTER_LIMIT}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/*Banner background color section*/}\r\n                    <div className='setting_section'>\r\n                        <span\r\n                            className='setting_title'\r\n                            aria-label={bannerColorSettingTitle}\r\n                        >\r\n                            {bannerColorSettingTitle}\r\n                        </span>\r\n\r\n                        <div className='setting_body'>\r\n                            <ColorInput\r\n                                id='channel_banner_banner_background_color_picker'\r\n                                onChange={handleColorChange}\r\n                                value={updatedChannelBanner.background_color || ''}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {showSaveChangesPanel && (\r\n                <SaveChangesPanel\r\n                    handleSubmit={handleSaveChanges}\r\n                    handleCancel={handleCancel}\r\n                    handleClose={handleClose}\r\n                    tabChangeError={hasErrors}\r\n                    state={hasErrors ? 'error' : saveChangesPanelState}\r\n                    customErrorMessage={formError}\r\n                    cancelButtonText={formatMessage({\r\n                        id: 'channel_settings.save_changes_panel.reset',\r\n                        defaultMessage: 'Reset',\r\n                    })}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChannelSettingsConfigurationTab;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useCallback, useState, useEffect, useMemo} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\n\r\nimport type {Channel, ChannelType} from '@mattermost/types/channels';\r\nimport type {ServerError} from '@mattermost/types/errors';\r\n\r\nimport {patchChannel, updateChannelPrivacy} from 'mattermost-redux/actions/channels';\r\nimport {General} from 'mattermost-redux/constants';\r\nimport Permissions from 'mattermost-redux/constants/permissions';\r\nimport {haveIChannelPermission} from 'mattermost-redux/selectors/entities/roles';\r\n\r\nimport {\r\n    setShowPreviewOnChannelSettingsHeaderModal,\r\n    setShowPreviewOnChannelSettingsPurposeModal,\r\n} from 'actions/views/textbox';\r\nimport {\r\n    showPreviewOnChannelSettingsHeaderModal,\r\n    showPreviewOnChannelSettingsPurposeModal,\r\n} from 'selectors/views/textbox';\r\n\r\nimport ConvertConfirmModal from 'components/admin_console/team_channel_settings/convert_confirm_modal';\r\nimport ChannelNameFormField from 'components/channel_name_form_field/channel_name_form_field';\r\nimport type {TextboxElement} from 'components/textbox';\r\nimport AdvancedTextbox from 'components/widgets/advanced_textbox/advanced_textbox';\r\nimport SaveChangesPanel, {type SaveChangesPanelState} from 'components/widgets/modals/components/save_changes_panel';\r\nimport PublicPrivateSelector from 'components/widgets/public-private-selector/public-private-selector';\r\n\r\nimport Constants from 'utils/constants';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\ntype ChannelSettingsInfoTabProps = {\r\n    channel: Channel;\r\n    onCancel?: () => void;\r\n    setAreThereUnsavedChanges?: (unsaved: boolean) => void;\r\n    showTabSwitchError?: boolean;\r\n};\r\n\r\nfunction ChannelSettingsInfoTab({\r\n    channel,\r\n    onCancel,\r\n    setAreThereUnsavedChanges,\r\n    showTabSwitchError,\r\n}: ChannelSettingsInfoTabProps) {\r\n    const {formatMessage} = useIntl();\r\n    const dispatch = useDispatch();\r\n    const shouldShowPreviewPurpose = useSelector(showPreviewOnChannelSettingsPurposeModal);\r\n    const shouldShowPreviewHeader = useSelector(showPreviewOnChannelSettingsHeaderModal);\r\n\r\n    // Permissions for transforming channel type\r\n    const canConvertToPrivate = useSelector((state: GlobalState) =>\r\n        haveIChannelPermission(state, channel.team_id, channel.id, Permissions.CONVERT_PUBLIC_CHANNEL_TO_PRIVATE),\r\n    );\r\n    const canConvertToPublic = useSelector((state: GlobalState) =>\r\n        haveIChannelPermission(state, channel.team_id, channel.id, Permissions.CONVERT_PRIVATE_CHANNEL_TO_PUBLIC),\r\n    );\r\n\r\n    // Permissions for managing channel (name, header, purpose)\r\n    const channelPropertiesPermission = channel.type === Constants.PRIVATE_CHANNEL ? Permissions.MANAGE_PRIVATE_CHANNEL_PROPERTIES : Permissions.MANAGE_PUBLIC_CHANNEL_PROPERTIES;\r\n    const canManageChannelProperties = useSelector((state: GlobalState) =>\r\n        haveIChannelPermission(state, channel.team_id, channel.id, channelPropertiesPermission),\r\n    );\r\n\r\n    // Constants\r\n    const HEADER_MAX_LENGTH = 1024;\r\n\r\n    // Internal state variables\r\n    const [internalUrlError, setUrlError] = useState('');\r\n    const [channelNameError, setChannelNameError] = useState('');\r\n    const [characterLimitExceeded, setCharacterLimitExceeded] = useState(false);\r\n    const [showConvertConfirmModal, setShowConvertConfirmModal] = useState(false);\r\n\r\n    // Removed switchingTabsWithUnsaved state as we now use the showTabSwitchError prop directly\r\n\r\n    // The fields we allow editing\r\n    const [displayName, setDisplayName] = useState(channel?.display_name ?? '');\r\n    const [channelUrl, setChannelURL] = useState(channel?.name ?? '');\r\n    const [channelPurpose, setChannelPurpose] = useState(channel.purpose ?? '');\r\n    const [channelHeader, setChannelHeader] = useState(channel?.header ?? '');\r\n    const [channelType, setChannelType] = useState<ChannelType>(channel?.type as ChannelType ?? Constants.OPEN_CHANNEL as ChannelType);\r\n\r\n    // UI Feedback: errors, states\r\n    const [formError, setFormError] = useState('');\r\n\r\n    // SaveChangesPanel state\r\n    const [saveChangesPanelState, setSaveChangesPanelState] = useState<SaveChangesPanelState>();\r\n\r\n    // Handler for channel name validation errors\r\n    const handleChannelNameError = useCallback((isError: boolean, errorMessage?: string) => {\r\n        setChannelNameError(errorMessage || '');\r\n\r\n        // If there's an error, update the error to show in the SaveChangesPanel\r\n        if (isError && errorMessage) {\r\n            setFormError(errorMessage);\r\n        } else if (formError === channelNameError) {\r\n            // Only clear error if it's the same as the channel name error\r\n            setFormError('');\r\n        }\r\n    }, [channelNameError, formError, setFormError]);\r\n\r\n    // Update parent component when changes occur\r\n    useEffect(() => {\r\n        // Calculate unsaved changes directly\r\n        const unsavedChanges = channel ? (\r\n            displayName.trim() !== channel.display_name ||\r\n            channelUrl.trim() !== channel.name ||\r\n            channelPurpose.trim() !== channel.purpose ||\r\n            channelHeader.trim() !== channel.header ||\r\n            channelType !== channel.type\r\n        ) : false;\r\n\r\n        setAreThereUnsavedChanges?.(unsavedChanges);\r\n    }, [channel, displayName, channelUrl, channelPurpose, channelHeader, channelType, setAreThereUnsavedChanges]);\r\n\r\n    const handleURLChange = useCallback((newURL: string) => {\r\n        if (internalUrlError) {\r\n            setFormError('');\r\n            setSaveChangesPanelState(undefined);\r\n            setUrlError('');\r\n        }\r\n        setChannelURL(newURL.trim());\r\n    }, [internalUrlError]);\r\n\r\n    const togglePurposePreview = useCallback(() => {\r\n        dispatch(setShowPreviewOnChannelSettingsPurposeModal(!shouldShowPreviewPurpose));\r\n    }, [dispatch, shouldShowPreviewPurpose]);\r\n\r\n    const toggleHeaderPreview = useCallback(() => {\r\n        dispatch(setShowPreviewOnChannelSettingsHeaderModal(!shouldShowPreviewHeader));\r\n    }, [dispatch, shouldShowPreviewHeader]);\r\n\r\n    const handleChannelTypeChange = (type: ChannelType) => {\r\n        // Never allow conversion from private to public, regardless of permissions\r\n        if (channel.type === Constants.PRIVATE_CHANNEL && type === Constants.OPEN_CHANNEL) {\r\n            return;\r\n        }\r\n\r\n        // Check if user has permission to convert from public to private\r\n        if (channel.type === Constants.OPEN_CHANNEL && type === Constants.PRIVATE_CHANNEL && !canConvertToPrivate) {\r\n            return;\r\n        }\r\n\r\n        setChannelType(type);\r\n        setFormError('');\r\n    };\r\n\r\n    const handleHeaderChange = useCallback((e: React.ChangeEvent<TextboxElement>) => {\r\n        const newValue = e.target.value;\r\n\r\n        // Update the header value\r\n        setChannelHeader(newValue);\r\n\r\n        // Check for character limit\r\n        if (newValue.trim().length > HEADER_MAX_LENGTH) {\r\n            setFormError(formatMessage({\r\n                id: 'edit_channel_header_modal.error',\r\n                defaultMessage: 'The text entered exceeds the character limit. The channel header is limited to {maxLength} characters.',\r\n            }, {\r\n                maxLength: HEADER_MAX_LENGTH,\r\n            }));\r\n        } else if (formError && !channelNameError) {\r\n            // Only clear form error if there's no channel name error\r\n            // This prevents clearing channel name errors when editing the header\r\n            setFormError('');\r\n        }\r\n    }, [HEADER_MAX_LENGTH, formError, channelNameError, setFormError, formatMessage]);\r\n\r\n    const handlePurposeChange = useCallback((e: React.ChangeEvent<TextboxElement>) => {\r\n        const newValue = e.target.value;\r\n\r\n        // Update the purpose value\r\n        setChannelPurpose(newValue);\r\n\r\n        // Check for character limit\r\n        if (newValue.trim().length > Constants.MAX_CHANNELPURPOSE_LENGTH) {\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.error_purpose_length',\r\n                defaultMessage: 'The text entered exceeds the character limit. The channel purpose is limited to {maxLength} characters.',\r\n            }, {\r\n                maxLength: Constants.MAX_CHANNELPURPOSE_LENGTH,\r\n            }));\r\n        } else if (formError && !channelNameError) {\r\n            // Only clear server error if there's no channel name error\r\n            // This prevents clearing channel name errors when editing the purpose\r\n            setFormError('');\r\n        }\r\n    }, [formError, channelNameError, setFormError, formatMessage]);\r\n\r\n    const handleServerError = (err: ServerError) => {\r\n        const errorMsg = err.message || formatMessage({id: 'channel_settings.unknown_error', defaultMessage: 'Something went wrong.'});\r\n        setFormError(errorMsg);\r\n        setSaveChangesPanelState('error');\r\n\r\n        // Check if the error is related to a URL conflict\r\n        if (err.message && (\r\n            err.message.toLowerCase().includes('url') ||\r\n            err.message.toLowerCase().includes('name') ||\r\n            err.message.toLowerCase().includes('already exists')\r\n        )) {\r\n            setUrlError(errorMsg); // Set the URL error to show in the URL input\r\n        }\r\n    };\r\n\r\n    // Validate & Save - using useCallback to ensure it has the latest state values\r\n    const handleSave = useCallback(async (): Promise<boolean> => {\r\n        if (!channel) {\r\n            return false;\r\n        }\r\n\r\n        if (!displayName.trim()) {\r\n            setFormError(formatMessage({\r\n                id: 'channel_settings.error_display_name_required',\r\n                defaultMessage: 'Channel name is required',\r\n            }));\r\n            return false;\r\n        }\r\n\r\n        // write the code to validate if the channel is changing from public to private\r\n        if (channel.type === Constants.OPEN_CHANNEL && channelType === Constants.PRIVATE_CHANNEL) {\r\n            const {error} = await dispatch(updateChannelPrivacy(channel.id, General.PRIVATE_CHANNEL));\r\n            if (error) {\r\n                handleServerError(error as ServerError);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // Build updated channel object\r\n        const updated: Channel = {\r\n            ...channel,\r\n            display_name: displayName.trim(),\r\n            name: channelUrl.trim(),\r\n            purpose: channelPurpose.trim(),\r\n            header: channelHeader.trim(),\r\n        };\r\n\r\n        const {data, error} = await dispatch(patchChannel(channel.id, updated));\r\n        if (error) {\r\n            handleServerError(error as ServerError);\r\n            return false;\r\n        }\r\n\r\n        // After every successful save, update local state to match the saved values\r\n        // with this, we make sure that the unsavedChanges check will return false after saving\r\n        setDisplayName(data?.display_name ?? updated.display_name);\r\n        setChannelURL(data?.name ?? updated.name);\r\n        setChannelPurpose(data?.purpose ?? updated.purpose);\r\n        setChannelHeader(data?.header ?? updated.header);\r\n        return true;\r\n    }, [channel, displayName, channelUrl, channelPurpose, channelHeader, channelType, setFormError, handleServerError]);\r\n\r\n    // Handle save changes panel actions\r\n    const handleSaveChanges = useCallback(async () => {\r\n        // Check if privacy is changing from public to private\r\n        const isPrivacyChanging = channel.type === Constants.OPEN_CHANNEL &&\r\n                                 channelType === Constants.PRIVATE_CHANNEL;\r\n\r\n        // If privacy is changing, show confirmation modal\r\n        if (isPrivacyChanging) {\r\n            setShowConvertConfirmModal(true);\r\n            return;\r\n        }\r\n\r\n        // Otherwise proceed with normal save\r\n        const success = await handleSave();\r\n        if (!success) {\r\n            setSaveChangesPanelState('error');\r\n            return;\r\n        }\r\n        setSaveChangesPanelState('saved');\r\n    }, [channel, channelType, handleSave]);\r\n\r\n    const handleClose = useCallback(() => {\r\n        setSaveChangesPanelState(undefined);\r\n    }, []);\r\n\r\n    const hideConvertConfirmModal = useCallback(() => {\r\n        setShowConvertConfirmModal(false);\r\n    }, []);\r\n\r\n    const handleCancel = useCallback(() => {\r\n        // First, hide the panel immediately to prevent further interactions\r\n        setSaveChangesPanelState(undefined);\r\n\r\n        // Then reset all form fields to their original values\r\n        setDisplayName(channel?.display_name ?? '');\r\n        setChannelURL(channel?.name ?? '');\r\n        setChannelPurpose(channel?.purpose ?? '');\r\n        setChannelHeader(channel?.header ?? '');\r\n        setChannelType(channel?.type as ChannelType ?? Constants.OPEN_CHANNEL as ChannelType);\r\n\r\n        // Clear errors\r\n        setUrlError('');\r\n        setFormError('');\r\n        setCharacterLimitExceeded(false);\r\n        setChannelNameError('');\r\n\r\n        // If parent provided an onCancel callback, call it\r\n        if (onCancel) {\r\n            onCancel();\r\n        }\r\n    }, [channel, onCancel, setFormError]);\r\n\r\n    // Calculate if there are errors\r\n    const hasErrors = Boolean(formError) ||\r\n                     characterLimitExceeded ||\r\n                     Boolean(channelNameError) ||\r\n                     Boolean(showTabSwitchError) ||\r\n                     Boolean(internalUrlError);\r\n\r\n    // Memoize the calculation for whether to show the save changes panel\r\n    const shouldShowPanel = useMemo(() => {\r\n        const unsavedChanges = channel ? (\r\n            displayName.trim() !== channel.display_name ||\r\n            channelUrl.trim() !== channel.name ||\r\n            channelPurpose.trim() !== channel.purpose ||\r\n            channelHeader.trim() !== channel.header ||\r\n            channelType !== channel.type\r\n        ) : false;\r\n\r\n        return unsavedChanges || saveChangesPanelState === 'saved';\r\n    }, [channel, displayName, channelUrl, channelPurpose, channelHeader, channelType, saveChangesPanelState]);\r\n\r\n    return (\r\n        <div className='ChannelSettingsModal__infoTab'>\r\n            {/* ConvertConfirmModal for channel privacy changes */}\r\n            <ConvertConfirmModal\r\n                show={showConvertConfirmModal}\r\n                onCancel={hideConvertConfirmModal}\r\n                onConfirm={async () => {\r\n                    hideConvertConfirmModal();\r\n                    const success = await handleSave();\r\n                    if (!success) {\r\n                        setSaveChangesPanelState('error');\r\n                        return;\r\n                    }\r\n                    setSaveChangesPanelState('saved');\r\n                }}\r\n                displayName={channel?.display_name || ''}\r\n                toPublic={false} // Always false since we're only converting from public to private\r\n            />\r\n\r\n            {/* Channel Name Section*/}\r\n            <div\r\n                className='ChannelSettingsModal__infoTabTitle'\r\n            >\r\n                {formatMessage({id: 'channel_settings.channel_info_tab.name', defaultMessage: 'Channel Info'})}\r\n            </div>\r\n            <ChannelNameFormField\r\n                value={displayName}\r\n                name='channel-settings-name'\r\n                placeholder={formatMessage({\r\n                    id: 'channel_settings_modal.name.placeholder',\r\n                    defaultMessage: 'Enter a name for your channel',\r\n                })}\r\n                onDisplayNameChange={(name) => {\r\n                    setDisplayName(name);\r\n                }}\r\n                onURLChange={handleURLChange}\r\n                onErrorStateChange={handleChannelNameError}\r\n                urlError={internalUrlError}\r\n                currentUrl={channelUrl}\r\n                readOnly={!canManageChannelProperties}\r\n                isEditingExistingChannel={true}\r\n            />\r\n\r\n            {/* Channel Type Section*/}\r\n            <PublicPrivateSelector\r\n                className='ChannelSettingsModal__typeSelector'\r\n                selected={channelType}\r\n                publicButtonProps={{\r\n                    title: formatMessage({id: 'channel_modal.type.public.title', defaultMessage: 'Public Channel'}),\r\n                    description: formatMessage({id: 'channel_modal.type.public.description', defaultMessage: 'Anyone can join'}),\r\n\r\n                    // Always disable public button if current channel is private, regardless of permissions\r\n                    disabled: channel.type === Constants.PRIVATE_CHANNEL || !canConvertToPublic,\r\n                }}\r\n                privateButtonProps={{\r\n                    title: formatMessage({id: 'channel_modal.type.private.title', defaultMessage: 'Private Channel'}),\r\n                    description: formatMessage({id: 'channel_modal.type.private.description', defaultMessage: 'Only invited members'}),\r\n                    disabled: !canConvertToPrivate,\r\n                }}\r\n                onChange={handleChannelTypeChange}\r\n            />\r\n\r\n            {/* Purpose Section*/}\r\n            <AdvancedTextbox\r\n                id='channel_settings_purpose_textbox'\r\n                value={channelPurpose}\r\n                channelId={channel.id}\r\n                onChange={handlePurposeChange}\r\n                createMessage={formatMessage({\r\n                    id: 'channel_settings_modal.purpose.placeholder',\r\n                    defaultMessage: 'Enter a purpose for this channel',\r\n                })}\r\n                maxLength={Constants.MAX_CHANNELPURPOSE_LENGTH}\r\n                preview={shouldShowPreviewPurpose}\r\n                togglePreview={togglePurposePreview}\r\n                useChannelMentions={false}\r\n                onKeyPress={() => {}}\r\n                descriptionMessage={formatMessage({\r\n                    id: 'channel_settings.purpose.description',\r\n                    defaultMessage: 'Describe how this channel should be used.',\r\n                })}\r\n                hasError={channelPurpose.length > Constants.MAX_CHANNELPURPOSE_LENGTH}\r\n                errorMessage={channelPurpose.length > Constants.MAX_CHANNELPURPOSE_LENGTH ? formatMessage({\r\n                    id: 'channel_settings.error_purpose_length',\r\n                    defaultMessage: 'The channel purpose exceeds the maximum character limit of {maxLength} characters.',\r\n                }, {\r\n                    maxLength: Constants.MAX_CHANNELPURPOSE_LENGTH,\r\n                }) : undefined\r\n                }\r\n                showCharacterCount={channelPurpose.length > Constants.MAX_CHANNELPURPOSE_LENGTH}\r\n                readOnly={!canManageChannelProperties}\r\n                name={formatMessage({id: 'channel_settings.purpose.label', defaultMessage: 'Channel Purpose'})}\r\n            />\r\n\r\n            {/* Channel Header Section*/}\r\n            <AdvancedTextbox\r\n                id='channel_settings_header_textbox'\r\n                value={channelHeader}\r\n                channelId={channel.id}\r\n                onChange={handleHeaderChange}\r\n                createMessage={formatMessage({\r\n                    id: 'channel_settings_modal.header.placeholder',\r\n                    defaultMessage: 'Enter a header description or important links',\r\n                })}\r\n                maxLength={HEADER_MAX_LENGTH}\r\n                preview={shouldShowPreviewHeader}\r\n                togglePreview={toggleHeaderPreview}\r\n                useChannelMentions={false}\r\n                onKeyPress={() => {}}\r\n                descriptionMessage={formatMessage({\r\n                    id: 'channel_settings.purpose.header',\r\n                    defaultMessage: 'This is the text that will appear in the header of the channel beside the channel name. You can use markdown to include links by typing [Link Title](http://example.com).',\r\n                })}\r\n                hasError={channelHeader.length > HEADER_MAX_LENGTH}\r\n                errorMessage={channelHeader.length > HEADER_MAX_LENGTH ? formatMessage({\r\n                    id: 'edit_channel_header_modal.error',\r\n                    defaultMessage: 'The channel header exceeds the maximum character limit of {maxLength} characters.',\r\n                }, {\r\n                    maxLength: HEADER_MAX_LENGTH,\r\n                }) : undefined\r\n                }\r\n                showCharacterCount={channelHeader.length > HEADER_MAX_LENGTH}\r\n                readOnly={!canManageChannelProperties}\r\n                name={formatMessage({id: 'channel_settings.header.label', defaultMessage: 'Channel Header'})}\r\n            />\r\n\r\n            {/* SaveChangesPanel for unsaved changes */}\r\n            {(canManageChannelProperties && shouldShowPanel) && (\r\n                <SaveChangesPanel\r\n                    handleSubmit={handleSaveChanges}\r\n                    handleCancel={handleCancel}\r\n                    handleClose={handleClose}\r\n                    tabChangeError={hasErrors}\r\n                    state={hasErrors ? 'error' : saveChangesPanelState}\r\n                    {...(!showTabSwitchError && { // for swowTabShiwthError use the default message\r\n                        customErrorMessage: formatMessage({\r\n                            id: 'channel_settings.save_changes_panel.standard_error',\r\n                            defaultMessage: 'There are errors in the form above',\r\n                        }),\r\n                    })}\r\n                    cancelButtonText={formatMessage({\r\n                        id: 'channel_settings.save_changes_panel.reset',\r\n                        defaultMessage: 'Reset',\r\n                    })}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChannelSettingsInfoTab;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {\r\n    useState,\r\n    useRef,\r\n} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useSelector, useDispatch} from 'react-redux';\r\n\r\nimport {GenericModal} from '@mattermost/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport Permissions from 'mattermost-redux/constants/permissions';\r\nimport {getChannel} from 'mattermost-redux/selectors/entities/channels';\r\nimport {getLicense} from 'mattermost-redux/selectors/entities/general';\r\nimport {haveIChannelPermission} from 'mattermost-redux/selectors/entities/roles';\r\n\r\nimport {\r\n    setShowPreviewOnChannelSettingsHeaderModal,\r\n    setShowPreviewOnChannelSettingsPurposeModal,\r\n} from 'actions/views/textbox';\r\nimport {isChannelAccessControlEnabled} from 'selectors/general';\r\n\r\nimport {focusElement} from 'utils/a11y_utils';\r\nimport Constants from 'utils/constants';\r\nimport {isMinimumEnterpriseAdvancedLicense} from 'utils/license_utils';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\nimport ChannelSettingsAccessRulesTab from './channel_settings_access_rules_tab';\r\nimport ChannelSettingsArchiveTab from './channel_settings_archive_tab';\r\nimport ChannelSettingsConfigurationTab from './channel_settings_configuration_tab';\r\nimport ChannelSettingsInfoTab from './channel_settings_info_tab';\r\n\r\nimport './channel_settings_modal.scss';\r\n\r\n// Lazy-loaded components\r\nconst SettingsSidebar = React.lazy(() => import('components/settings_sidebar'));\r\n\r\ntype ChannelSettingsModalProps = {\r\n    channelId: string;\r\n    onExited: () => void;\r\n    isOpen: boolean;\r\n    focusOriginElement?: string;\r\n};\r\n\r\nenum ChannelSettingsTabs {\r\n    INFO = 'info',\r\n    ACCESS_RULES = 'access_rules',\r\n    CONFIGURATION = 'configuration',\r\n    ARCHIVE = 'archive',\r\n}\r\n\r\nconst SHOW_PANEL_ERROR_STATE_TAB_SWITCH_TIMEOUT = 3000;\r\n\r\nfunction ChannelSettingsModal({channelId, isOpen, onExited, focusOriginElement}: ChannelSettingsModalProps) {\r\n    const {formatMessage} = useIntl();\r\n    const dispatch = useDispatch();\r\n    const channel = useSelector((state: GlobalState) => getChannel(state, channelId)) as Channel;\r\n    const channelBannerEnabled = isMinimumEnterpriseAdvancedLicense(useSelector(getLicense));\r\n\r\n    const canManagePublicChannelBanner = useSelector((state: GlobalState) =>\r\n        haveIChannelPermission(state, channel.team_id, channel.id, Permissions.MANAGE_PUBLIC_CHANNEL_BANNER),\r\n    );\r\n    const canManagePrivateChannelBanner = useSelector((state: GlobalState) =>\r\n        haveIChannelPermission(state, channel.team_id, channel.id, Permissions.MANAGE_PRIVATE_CHANNEL_BANNER),\r\n    );\r\n    const hasManageChannelBannerPermission = (channel.type === 'O' && canManagePublicChannelBanner) || (channel.type === 'P' && canManagePrivateChannelBanner);\r\n\r\n    const shouldShowConfigurationTab = channelBannerEnabled && hasManageChannelBannerPermission;\r\n\r\n    const canArchivePrivateChannels = useSelector((state: GlobalState) =>\r\n        haveIChannelPermission(state, channel.team_id, channel.id, Permissions.DELETE_PRIVATE_CHANNEL),\r\n    );\r\n\r\n    const canArchivePublicChannels = useSelector((state: GlobalState) =>\r\n        haveIChannelPermission(state, channel.team_id, channel.id, Permissions.DELETE_PUBLIC_CHANNEL),\r\n    );\r\n\r\n    const canManageChannelAccessRules = useSelector((state: GlobalState) =>\r\n        haveIChannelPermission(state, channel.team_id, channel.id, Permissions.MANAGE_CHANNEL_ACCESS_RULES),\r\n    );\r\n\r\n    const channelAdminABACControlEnabled = useSelector(isChannelAccessControlEnabled);\r\n\r\n    const shouldShowAccessRulesTab = channelAdminABACControlEnabled && canManageChannelAccessRules && channel.type === Constants.PRIVATE_CHANNEL && !channel.group_constrained;\r\n\r\n    const [show, setShow] = useState(isOpen);\r\n\r\n    // Active tab\r\n    const [activeTab, setActiveTab] = useState<ChannelSettingsTabs>(ChannelSettingsTabs.INFO);\r\n\r\n    // State for showing error in the save changes panel when trying to switch tabs with unsaved changes\r\n    const [showTabSwitchError, setShowTabSwitchError] = useState(false);\r\n\r\n    // State to track if there are unsaved changes\r\n    const [areThereUnsavedChanges, setAreThereUnsavedChanges] = useState(false);\r\n\r\n    // State to track if user has been warned about unsaved changes\r\n    const [hasBeenWarned, setHasBeenWarned] = useState(false);\r\n\r\n    // Refs\r\n    const modalBodyRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Called to set the active tab, prompting save changes panel if there are unsaved changes\r\n    const updateTab = (newTab: string) => {\r\n        /**\r\n         * If there are unsaved changes, show an error in the save changes panel\r\n         * and reset it after a timeout to indicate the user needs to save or discard changes\r\n         * before switching tabs.\r\n         */\r\n        if (areThereUnsavedChanges) {\r\n            setShowTabSwitchError(true);\r\n            setTimeout(() => {\r\n                setShowTabSwitchError(false);\r\n            }, SHOW_PANEL_ERROR_STATE_TAB_SWITCH_TIMEOUT);\r\n            return;\r\n        }\r\n\r\n        const tab = newTab as ChannelSettingsTabs;\r\n        setActiveTab(tab);\r\n\r\n        if (modalBodyRef.current) {\r\n            modalBodyRef.current.scrollTop = 0;\r\n        }\r\n    };\r\n\r\n    const handleHide = () => {\r\n        // Prevent modal closing if there are unsaved changes (warn once, then allow)\r\n        if (areThereUnsavedChanges && !hasBeenWarned) {\r\n            setHasBeenWarned(true);\r\n\r\n            // Show error message in SaveChangesPanel\r\n            setShowTabSwitchError(true);\r\n            setTimeout(() => {\r\n                setShowTabSwitchError(false);\r\n            }, SHOW_PANEL_ERROR_STATE_TAB_SWITCH_TIMEOUT);\r\n        } else {\r\n            handleHideConfirm();\r\n        }\r\n    };\r\n\r\n    const handleHideConfirm = () => {\r\n        // Reset preview states to false when closing the modal\r\n        dispatch(setShowPreviewOnChannelSettingsHeaderModal(false));\r\n        dispatch(setShowPreviewOnChannelSettingsPurposeModal(false));\r\n        setShow(false);\r\n    };\r\n\r\n    // Called after the fade-out completes\r\n    const handleExited = () => {\r\n        // Clear anything if needed\r\n        setActiveTab(ChannelSettingsTabs.INFO);\r\n        setHasBeenWarned(false);\r\n        if (focusOriginElement) {\r\n            focusElement(focusOriginElement, true);\r\n        }\r\n        onExited();\r\n    };\r\n\r\n    // Renders content based on active tab\r\n    const renderTabContent = () => {\r\n        switch (activeTab) {\r\n        case ChannelSettingsTabs.INFO:\r\n            return renderInfoTab();\r\n        case ChannelSettingsTabs.ACCESS_RULES:\r\n            return renderAccessRulesTab();\r\n        case ChannelSettingsTabs.CONFIGURATION:\r\n            return renderConfigurationTab();\r\n        case ChannelSettingsTabs.ARCHIVE:\r\n            return renderArchiveTab();\r\n        default:\r\n            return renderInfoTab();\r\n        }\r\n    };\r\n\r\n    const renderInfoTab = () => {\r\n        return (\r\n            <ChannelSettingsInfoTab\r\n                channel={channel}\r\n                setAreThereUnsavedChanges={setAreThereUnsavedChanges}\r\n                showTabSwitchError={showTabSwitchError}\r\n            />\r\n        );\r\n    };\r\n\r\n    const renderConfigurationTab = () => {\r\n        return (\r\n            <ChannelSettingsConfigurationTab\r\n                channel={channel}\r\n                setAreThereUnsavedChanges={setAreThereUnsavedChanges}\r\n                showTabSwitchError={showTabSwitchError}\r\n            />\r\n        );\r\n    };\r\n\r\n    const renderAccessRulesTab = () => {\r\n        return (\r\n            <ChannelSettingsAccessRulesTab\r\n                channel={channel}\r\n                setAreThereUnsavedChanges={setAreThereUnsavedChanges}\r\n                showTabSwitchError={showTabSwitchError}\r\n            />\r\n        );\r\n    };\r\n\r\n    const renderArchiveTab = () => {\r\n        return (\r\n            <ChannelSettingsArchiveTab\r\n                channel={channel}\r\n                onHide={handleHideConfirm}\r\n            />\r\n        );\r\n    };\r\n\r\n    // Define tabs for the settings sidebar\r\n    const tabs = [\r\n        {\r\n            name: ChannelSettingsTabs.INFO,\r\n            uiName: formatMessage({id: 'channel_settings.tab.info', defaultMessage: 'Info'}),\r\n            icon: 'icon icon-information-outline',\r\n            iconTitle: formatMessage({id: 'generic_icons.info', defaultMessage: 'Info Icon'}),\r\n        },\r\n        {\r\n            name: ChannelSettingsTabs.ACCESS_RULES,\r\n            uiName: formatMessage({id: 'channel_settings.tab.access_control', defaultMessage: 'Access Control'}),\r\n            icon: 'icon icon-shield-outline',\r\n            iconTitle: formatMessage({id: 'generic_icons.access_rules', defaultMessage: 'Access Rules Icon'}),\r\n            display: shouldShowAccessRulesTab,\r\n        },\r\n        {\r\n            name: ChannelSettingsTabs.CONFIGURATION,\r\n            uiName: formatMessage({id: 'channel_settings.tab.configuration', defaultMessage: 'Configuration'}),\r\n            icon: 'icon icon-cog-outline',\r\n            iconTitle: formatMessage({id: 'generic_icons.settings', defaultMessage: 'Settings Icon'}),\r\n            display: shouldShowConfigurationTab,\r\n        },\r\n        {\r\n            name: ChannelSettingsTabs.ARCHIVE,\r\n            uiName: formatMessage({id: 'channel_settings.tab.archive', defaultMessage: 'Archive Channel'}),\r\n            icon: 'icon icon-archive-outline',\r\n            iconTitle: formatMessage({id: 'generic_icons.archive', defaultMessage: 'Archive Icon'}),\r\n            newGroup: true,\r\n            display: channel.name !== Constants.DEFAULT_CHANNEL && // archive is not available for the default channel\r\n                ((channel.type === Constants.PRIVATE_CHANNEL && canArchivePrivateChannels) ||\r\n                (channel.type === Constants.OPEN_CHANNEL && canArchivePublicChannels)),\r\n        },\r\n    ];\r\n\r\n    // Renders the body: left sidebar for tabs, the content on the right\r\n    const renderModalBody = () => {\r\n        return (\r\n            <div\r\n                ref={modalBodyRef}\r\n                className='settings-table'\r\n            >\r\n                <div className='settings-links'>\r\n                    <React.Suspense fallback={null}>\r\n                        <SettingsSidebar\r\n                            tabs={tabs}\r\n                            activeTab={activeTab}\r\n                            updateTab={updateTab}\r\n                        />\r\n                    </React.Suspense>\r\n                </div>\r\n                <div className='settings-content minimize-settings'>\r\n                    {renderTabContent()}\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const modalTitle = formatMessage({id: 'channel_settings.modal.title', defaultMessage: 'Channel Settings'});\r\n\r\n    return (\r\n        <GenericModal\r\n            id='channelSettingsModal'\r\n            ariaLabel={modalTitle}\r\n            className='ChannelSettingsModal settings-modal'\r\n            show={show}\r\n            onHide={handleHide}\r\n            preventClose={areThereUnsavedChanges && !hasBeenWarned}\r\n            onExited={handleExited}\r\n            compassDesign={true}\r\n            modalHeaderText={modalTitle}\r\n            bodyPadding={false}\r\n            modalLocation={'top'}\r\n            enforceFocus={false}\r\n        >\r\n            <div className='ChannelSettingsModal__bodyWrapper'>\r\n                {renderModalBody()}\r\n            </div>\r\n        </GenericModal>\r\n    );\r\n}\r\n\r\nexport default ChannelSettingsModal;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {memo} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\n\r\nimport {\r\n    CogOutlineIcon,\r\n} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {openModal} from 'actions/views/modals';\r\nimport {canAccessChannelSettings} from 'selectors/views/channel_settings';\r\n\r\nimport ChannelSettingsModal from 'components/channel_settings_modal/channel_settings_modal';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {ModalIdentifiers} from 'utils/constants';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n}\r\n\r\nconst ChannelSettingsMenu = ({channel}: Props): JSX.Element | null => {\r\n    const dispatch = useDispatch();\r\n    const canAccess = useSelector((state: GlobalState) => canAccessChannelSettings(state, channel.id));\r\n\r\n    // Don't render the menu item if the user doesn't have access to any channel settings tab\r\n    if (!canAccess) {\r\n        return null;\r\n    }\r\n\r\n    const handleOpenChannelSettings = () => {\r\n        dispatch(\r\n            openModal({\r\n                modalId: ModalIdentifiers.CHANNEL_SETTINGS,\r\n                dialogType: ChannelSettingsModal,\r\n                dialogProps: {\r\n                    channelId: channel.id,\r\n                    focusOriginElement: 'channelHeaderDropdownButton',\r\n                    isOpen: true,\r\n                },\r\n            }),\r\n        );\r\n    };\r\n\r\n    return (\r\n        <Menu.Item\r\n            id={'channelSettings'}\r\n            labels={\r\n                <FormattedMessage\r\n                    id='channel_header.channel_settings'\r\n                    defaultMessage='Channel Settings'\r\n                />\r\n            }\r\n            onClick={handleOpenChannelSettings}\r\n            leadingElement={<CogOutlineIcon size={18}/>}\r\n        />\r\n    );\r\n};\r\n\r\nexport default memo(ChannelSettingsMenu);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\n\r\nimport {goToLastViewedChannel} from 'actions/views/channel';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\ninterface Props extends Menu.FirstMenuItemProps {}\r\n\r\nconst CloseChannel = ({...rest}: Props): JSX.Element => {\r\n    return (\r\n        <Menu.Item\r\n            onClick={goToLastViewedChannel}\r\n            labels={\r\n                <FormattedMessage\r\n                    id='center_panel.archived.closeChannel'\r\n                    defaultMessage='Close Channel'\r\n                />}\r\n            {...rest}\r\n        />\r\n    );\r\n};\r\nexport default React.memo(CloseChannel);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage, injectIntl} from 'react-intl';\r\nimport type {IntlShape} from 'react-intl';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\nimport {SyncableType} from '@mattermost/types/groups';\r\nimport type {Group} from '@mattermost/types/groups';\r\n\r\nimport type {ActionResult} from 'mattermost-redux/types/actions';\r\n\r\nimport AddGroupsToChannelModal from 'components/add_groups_to_channel_modal';\r\nimport ListModal, {DEFAULT_NUM_PER_PAGE} from 'components/list_modal';\r\nimport DropdownIcon from 'components/widgets/icons/fa_dropdown_icon';\r\nimport Menu from 'components/widgets/menu/menu';\r\nimport MenuWrapper from 'components/widgets/menu/menu_wrapper';\r\n\r\nimport groupsAvatar from 'images/groups-avatar.png';\r\nimport {ModalIdentifiers} from 'utils/constants';\r\nimport * as Utils from 'utils/utils';\r\n\r\nimport type {ModalData} from 'types/actions';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n    intl: IntlShape;\r\n    actions: {\r\n        getGroupsAssociatedToChannel: (channelId: string, searchTerm: string, pageNumber: number, perPage: number) => Promise<ActionResult>;\r\n        unlinkGroupSyncable: (itemId: string, channelId: string, groupsSyncableTypeChannel: SyncableType) => Promise<ActionResult>;\r\n        patchGroupSyncable: (itemId: string, channelId: string, groupsSyncableTypeChannel: SyncableType, params: {scheme_admin: boolean}) => Promise<ActionResult>;\r\n        getMyChannelMember: (channelId: string) => void;\r\n        closeModal: (modalId: string) => void;\r\n        openModal: <P>(modalData: ModalData<P>) => void;\r\n    };\r\n};\r\n\r\nclass ChannelGroupsManageModal extends React.PureComponent<Props> {\r\n    public loadItems = async (pageNumber: number, searchTerm: string) => {\r\n        const {data} = await this.props.actions.getGroupsAssociatedToChannel(this.props.channel.id, searchTerm, pageNumber, DEFAULT_NUM_PER_PAGE);\r\n        return {\r\n            items: data.groups,\r\n            totalCount: data.totalGroupCount,\r\n        };\r\n    };\r\n\r\n    public onClickRemoveGroup = (item: Group, listModal: any) => this.props.actions.unlinkGroupSyncable(item.id, this.props.channel.id, SyncableType.Channel).then(async () => {\r\n        listModal.setState({loading: true});\r\n        const {items, totalCount} = await listModal.props.loadItems(listModal.setState.page, listModal.state.searchTerm);\r\n        listModal.setState({loading: false, items, totalCount});\r\n    });\r\n\r\n    public onHide = () => {\r\n        this.props.actions.closeModal(ModalIdentifiers.MANAGE_CHANNEL_GROUPS);\r\n    };\r\n\r\n    public titleButtonOnClick = () => {\r\n        this.onHide();\r\n        this.props.actions.openModal({modalId: ModalIdentifiers.ADD_GROUPS_TO_TEAM, dialogType: AddGroupsToChannelModal});\r\n    };\r\n\r\n    public setChannelMemberStatus = async (item: Group, listModal: any, isChannelAdmin: boolean) => {\r\n        this.props.actions.patchGroupSyncable(item.id, this.props.channel.id, SyncableType.Channel, {scheme_admin: isChannelAdmin}).then(async () => {\r\n            listModal.setState({loading: true});\r\n            const {items, totalCount} = await listModal.props.loadItems(listModal.setState.page, listModal.state.searchTerm);\r\n            await this.props.actions.getMyChannelMember(this.props.channel.id);\r\n\r\n            listModal.setState({loading: false, items, totalCount});\r\n        });\r\n    };\r\n\r\n    public renderRow = (item: Group, listModal: any) => {\r\n        let title;\r\n        if (item.scheme_admin) {\r\n            title = (\r\n                <FormattedMessage\r\n                    id='channel_members_dropdown.channel_admins'\r\n                    defaultMessage='Channel Admins'\r\n                />\r\n            );\r\n        } else {\r\n            title = (\r\n                <FormattedMessage\r\n                    id='channel_members_dropdown.channel_members'\r\n                    defaultMessage='Channel Members'\r\n                />\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div\r\n                key={item.id}\r\n                className='more-modal__row'\r\n            >\r\n                <img\r\n                    className='more-modal__image'\r\n                    src={groupsAvatar}\r\n                    alt='group picture'\r\n                    width='32'\r\n                    height='32'\r\n                />\r\n                <div className='more-modal__details'>\r\n                    <div className='more-modal__name'>{item.display_name} {'-'}{' '}\r\n                        <span className='more-modal__name_count'>\r\n                            <FormattedMessage\r\n                                id='numMembers'\r\n                                defaultMessage='{num, number} {num, plural, one {member} other {members}}'\r\n                                values={{\r\n                                    num: item.member_count,\r\n                                }}\r\n                            />\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n                <div className='more-modal__actions'>\r\n                    <MenuWrapper>\r\n                        <button\r\n                            id={`teamGroupsDropdown_${item.display_name}`}\r\n                            className='dropdown-toggle theme color--link style--none'\r\n                            type='button'\r\n                            aria-expanded='true'\r\n                        >\r\n                            <span>{title} </span>\r\n                            <DropdownIcon/>\r\n                        </button>\r\n                        <Menu\r\n                            openLeft={true}\r\n                            ariaLabel={Utils.localizeMessage({id: 'channel_members_dropdown.menuAriaLabel', defaultMessage: 'Change the role of channel member'})}\r\n                        >\r\n                            <Menu.ItemAction\r\n                                show={!item.scheme_admin}\r\n                                onClick={() => this.setChannelMemberStatus(item, listModal, true)}\r\n                                text={Utils.localizeMessage({id: 'channel_members_dropdown.make_channel_admins', defaultMessage: 'Make Channel Admins'})}\r\n                            />\r\n                            <Menu.ItemAction\r\n                                show={Boolean(item.scheme_admin)}\r\n                                onClick={() => this.setChannelMemberStatus(item, listModal, false)}\r\n                                text={Utils.localizeMessage({id: 'channel_members_dropdown.make_channel_members', defaultMessage: 'Make Channel Members'})}\r\n                            />\r\n                            <Menu.ItemAction\r\n                                onClick={() => this.onClickRemoveGroup(item, listModal)}\r\n                                text={Utils.localizeMessage({id: 'group_list_modal.removeGroupButton', defaultMessage: 'Remove Group'})}\r\n                            />\r\n                        </Menu>\r\n                    </MenuWrapper>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    render() {\r\n        const {formatMessage} = this.props.intl;\r\n        return (\r\n            <ListModal\r\n                titleText={formatMessage({id: 'channel_groups', defaultMessage: '{channel} Groups'}, {channel: this.props.channel.display_name})}\r\n                searchPlaceholderText={formatMessage({id: 'manage_channel_groups_modal.search_placeholder', defaultMessage: 'Search groups'})}\r\n                renderRow={this.renderRow}\r\n                loadItems={this.loadItems}\r\n                onHide={this.onHide}\r\n                titleBarButtonText={formatMessage({id: 'group_list_modal.addGroupButton', defaultMessage: 'Add Groups'})}\r\n                titleBarButtonOnClick={this.titleButtonOnClick}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\nexport default injectIntl(ChannelGroupsManageModal);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {connect} from 'react-redux';\r\nimport {bindActionCreators} from 'redux';\r\nimport type {Dispatch} from 'redux';\r\n\r\nimport type {GlobalState} from '@mattermost/types/store';\r\n\r\nimport {getMyChannelMember} from 'mattermost-redux/actions/channels';\r\nimport {getGroupsAssociatedToChannel, unlinkGroupSyncable, patchGroupSyncable} from 'mattermost-redux/actions/groups';\r\n\r\nimport {closeModal, openModal} from 'actions/views/modals';\r\n\r\nimport ChannelGroupsManageModal from './channel_groups_manage_modal';\r\n\r\nconst mapStateToProps = (state: GlobalState, ownProps: any) => {\r\n    return {\r\n        channel: state.entities.channels.channels[ownProps.channelID],\r\n    };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch) => ({\r\n    actions: bindActionCreators(\r\n        {\r\n            getGroupsAssociatedToChannel,\r\n            closeModal,\r\n            openModal,\r\n            unlinkGroupSyncable,\r\n            patchGroupSyncable,\r\n            getMyChannelMember,\r\n        },\r\n        dispatch,\r\n    ),\r\n});\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ChannelGroupsManageModal);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport {AccountMultipleOutlineIcon, AccountMultiplePlusOutlineIcon} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {openModal} from 'actions/views/modals';\r\n\r\nimport AddGroupsToChannelModal from 'components/add_groups_to_channel_modal';\r\nimport ChannelGroupsManageModal from 'components/channel_groups_manage_modal';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {ModalIdentifiers} from 'utils/constants';\r\n\r\ninterface Props extends Menu.FirstMenuItemProps {\r\n    channel: Channel;\r\n}\r\n\r\nconst Groups = ({channel, ...rest}: Props): JSX.Element => {\r\n    const dispatch = useDispatch();\r\n    const handleAddGroups = () => {\r\n        dispatch(\r\n            openModal({\r\n                modalId: ModalIdentifiers.ADD_GROUPS_TO_CHANNEL,\r\n                dialogType: AddGroupsToChannelModal,\r\n            }),\r\n        );\r\n    };\r\n\r\n    const handleManageGroups = () => {\r\n        dispatch(\r\n            openModal({\r\n                modalId: ModalIdentifiers.MANAGE_CHANNEL_GROUPS,\r\n                dialogType: ChannelGroupsManageModal,\r\n                dialogProps: {channelID: channel.id},\r\n            }),\r\n        );\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Menu.Item\r\n                id='channelAddGroups'\r\n                leadingElement={<AccountMultiplePlusOutlineIcon size='18px'/>}\r\n                onClick={handleAddGroups}\r\n                labels={\r\n                    <FormattedMessage\r\n                        id='navbar.addGroups'\r\n                        defaultMessage='Add Groups'\r\n                    />\r\n                }\r\n                {...rest}\r\n            />\r\n            <Menu.Item\r\n                id='channelManageGroups'\r\n                leadingElement={<AccountMultipleOutlineIcon size='18px'/>}\r\n                onClick={handleManageGroups}\r\n                labels={\r\n                    <FormattedMessage\r\n                        id='navbar_dropdown.manageGroups'\r\n                        defaultMessage='Manage Groups'\r\n                    />\r\n                }\r\n                {...rest}\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport default React.memo(Groups);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {memo} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport {LogoutVariantIcon} from '@mattermost/compass-icons/components';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {leaveChannel} from 'actions/views/channel';\r\nimport {openModal} from 'actions/views/modals';\r\n\r\nimport LeaveChannelModal from 'components/leave_channel_modal';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {Constants, ModalIdentifiers} from 'utils/constants';\r\n\r\n// import type {PropsFromRedux} from './index';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n    id?: string;\r\n}\r\n\r\nconst LeaveChannel = ({\r\n    channel,\r\n    id,\r\n}: Props) => {\r\n    const dispatch = useDispatch();\r\n    const handleLeave = () => {\r\n        if (channel.type === Constants.PRIVATE_CHANNEL) {\r\n            dispatch(\r\n                openModal({\r\n                    modalId: ModalIdentifiers.LEAVE_PRIVATE_CHANNEL_MODAL,\r\n                    dialogType: LeaveChannelModal,\r\n                    dialogProps: {\r\n                        channel,\r\n                    },\r\n                }),\r\n            );\r\n        } else {\r\n            dispatch(leaveChannel(channel.id));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Menu.Item\r\n            id={id}\r\n            leadingElement={<LogoutVariantIcon size='18px'/>}\r\n            onClick={handleLeave}\r\n            labels={\r\n                <FormattedMessage\r\n                    id='channel_header.leave'\r\n                    defaultMessage='Leave Channel'\r\n                />\r\n            }\r\n            isDestructive={true}\r\n        />\r\n    );\r\n};\r\n\r\nexport default memo(LeaveChannel);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {Modal} from 'react-bootstrap';\r\nimport {FormattedMessage} from 'react-intl';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport type {ActionResult} from 'mattermost-redux/types/actions';\r\n\r\nimport Constants from 'utils/constants';\r\n\r\ntype Props = {\r\n    onExited: () => void;\r\n    channel: Channel;\r\n    actions: ChannelDetailsActions;\r\n}\r\n\r\ntype State = {\r\n    show: boolean;\r\n}\r\n\r\nexport type ChannelDetailsActions = {\r\n    unarchiveChannel: (channelId: string) => Promise<ActionResult>;\r\n};\r\n\r\nexport default class UnarchiveChannelModal extends React.PureComponent<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {show: true};\r\n    }\r\n\r\n    handleUnarchive = (): void => {\r\n        if (this.props.channel.id.length !== Constants.CHANNEL_ID_LENGTH) {\r\n            return;\r\n        }\r\n        this.props.actions.unarchiveChannel(this.props.channel.id);\r\n        this.onHide();\r\n    };\r\n\r\n    onHide = (): void => {\r\n        this.setState({show: false});\r\n    };\r\n\r\n    render(): JSX.Element {\r\n        return (\r\n            <Modal\r\n                dialogClassName='a11y__modal'\r\n                show={this.state.show}\r\n                onHide={this.onHide}\r\n                onExited={this.props.onExited}\r\n                role='none'\r\n                aria-labelledby='unarchiveChannelModalLabel'\r\n                id='unarchiveChannelModal'\r\n            >\r\n                <Modal.Header closeButton={true}>\r\n                    <Modal.Title\r\n                        componentClass='h1'\r\n                        id='unarchiveChannelModalLabel'\r\n                    >\r\n                        <FormattedMessage\r\n                            id='unarchive_channel.confirm'\r\n                            defaultMessage='Confirm UNARCHIVE Channel'\r\n                        />\r\n                    </Modal.Title>\r\n                </Modal.Header>\r\n                <Modal.Body>\r\n                    <div className='alert alert-danger'>\r\n                        <FormattedMessage\r\n                            id='unarchiveChannelModal.viewArchived.question'\r\n                            defaultMessage={'Are you sure you wish to unarchive the <b>{display_name}</b> channel?'}\r\n                            values={{\r\n                                display_name: this.props.channel.display_name,\r\n                                b: (chunks) => <b>{chunks}</b>,\r\n                            }}\r\n                        />\r\n                    </div>\r\n                </Modal.Body>\r\n                <Modal.Footer>\r\n                    <button\r\n                        type='button'\r\n                        className='btn btn-tertiary'\r\n                        onClick={this.onHide}\r\n                    >\r\n                        <FormattedMessage\r\n                            id='unarchive_channel.cancel'\r\n                            defaultMessage='Cancel'\r\n                        />\r\n                    </button>\r\n                    <button\r\n                        type='button'\r\n                        className='btn btn-danger'\r\n                        data-dismiss='modal'\r\n                        onClick={this.handleUnarchive}\r\n                        autoFocus={true}\r\n                        id='unarchiveChannelModalDeleteButton'\r\n                    >\r\n                        <FormattedMessage\r\n                            id='unarchive_channel.del'\r\n                            defaultMessage='Unarchive'\r\n                        />\r\n                    </button>\r\n                </Modal.Footer>\r\n            </Modal>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {connect} from 'react-redux';\r\nimport {bindActionCreators} from 'redux';\r\nimport type {Dispatch} from 'redux';\r\n\r\nimport {unarchiveChannel} from 'mattermost-redux/actions/channels';\r\n\r\nimport UnarchiveChannelModal from './unarchive_channel_modal';\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch) {\r\n    return {\r\n        actions: bindActionCreators({\r\n            unarchiveChannel,\r\n        }, dispatch),\r\n    };\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(UnarchiveChannelModal);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {memo} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {openModal} from 'actions/views/modals';\r\n\r\nimport * as Menu from 'components/menu';\r\nimport UnarchiveChannelModal from 'components/unarchive_channel_modal';\r\n\r\nimport {ModalIdentifiers} from 'utils/constants';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n}\r\n\r\nconst UnarchiveChannel = ({\r\n    channel,\r\n}: Props) => {\r\n    const dispatch = useDispatch();\r\n\r\n    const handleUnarchiveChannel = () => {\r\n        dispatch(\r\n            openModal({\r\n                modalId: ModalIdentifiers.UNARCHIVE_CHANNEL,\r\n                dialogType: UnarchiveChannelModal,\r\n                dialogProps: {channel},\r\n            }),\r\n        );\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Menu.Separator/>\r\n            <Menu.Item\r\n                id='channelUnarchiveChannel'\r\n                onClick={handleUnarchiveChannel}\r\n                labels={\r\n                    <FormattedMessage\r\n                        id='channel_header.unarchive'\r\n                        defaultMessage='Unarchive Channel'\r\n                    />\r\n                }\r\n            />\r\n        </>\r\n    );\r\n};\r\n\r\nexport default memo(UnarchiveChannel);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport type {ReactNode} from 'react';\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\nimport type {UserProfile} from '@mattermost/types/users';\r\n\r\nimport {Permissions} from 'mattermost-redux/constants';\r\nimport {isGuest} from 'mattermost-redux/utils/user_utils';\r\n\r\nimport ChannelMoveToSubMenu from 'components/channel_move_to_sub_menu';\r\nimport * as Menu from 'components/menu';\r\nimport ChannelPermissionGate from 'components/permissions_gates/channel_permission_gate';\r\n\r\nimport {Constants} from 'utils/constants';\r\n\r\nimport MenuItemArchiveChannel from '../menu_items/archive_channel';\r\nimport MenuItemChannelBookmarks from '../menu_items/channel_bookmarks_submenu';\r\nimport MenuItemChannelSettings from '../menu_items/channel_settings_menu';\r\nimport MenuItemCloseChannel from '../menu_items/close_channel';\r\nimport MenuItemGroupsMenuItems from '../menu_items/groups';\r\nimport MenuItemLeaveChannel from '../menu_items/leave_channel';\r\nimport MenuItemNotification from '../menu_items/notification';\r\nimport MenuItemOpenMembersRHS from '../menu_items/open_members_rhs';\r\nimport MenuItemPluginItems from '../menu_items/plugins_submenu';\r\nimport MenuItemToggleFavoriteChannel from '../menu_items/toggle_favorite_channel';\r\nimport MenuItemToggleInfo from '../menu_items/toggle_info';\r\nimport MenuItemToggleMuteChannel from '../menu_items/toggle_mute_channel';\r\nimport MenuItemUnarchiveChannel from '../menu_items/unarchive_channel';\r\nimport MenuItemViewPinnedPosts from '../menu_items/view_pinned_posts';\r\n\r\ninterface Props extends Menu.FirstMenuItemProps {\r\n    channel: Channel;\r\n    user: UserProfile;\r\n    isMuted: boolean;\r\n    isReadonly: boolean;\r\n    isDefault: boolean;\r\n    isMobile: boolean;\r\n    isFavorite: boolean;\r\n    isLicensedForLDAPGroups: boolean;\r\n    pluginItems: ReactNode[];\r\n    isChannelBookmarksEnabled: boolean;\r\n}\r\n\r\nconst ChannelHeaderPublicMenu = ({channel, user, isMuted, isDefault, isMobile, isFavorite, isLicensedForLDAPGroups, pluginItems, isChannelBookmarksEnabled, ...rest}: Props) => {\r\n    const isGroupConstrained = channel?.group_constrained === true;\r\n    const isArchived = channel.delete_at !== 0;\r\n    const isPrivate = channel?.type === Constants.PRIVATE_CHANNEL;\r\n\r\n    const channelMembersPermission = isPrivate ? Permissions.MANAGE_PRIVATE_CHANNEL_MEMBERS : Permissions.MANAGE_PUBLIC_CHANNEL_MEMBERS;\r\n    const channelDeletePermission = isPrivate ? Permissions.DELETE_PRIVATE_CHANNEL : Permissions.DELETE_PUBLIC_CHANNEL;\r\n    const channelUnarchivePermission = Permissions.MANAGE_TEAM;\r\n\r\n    return (\r\n        <>\r\n            <MenuItemToggleInfo\r\n                channel={channel}\r\n                {...rest}\r\n            />\r\n            <MenuItemToggleMuteChannel\r\n                userID={user.id}\r\n                channel={channel}\r\n                isMuted={isMuted}\r\n            />\r\n            {!isArchived && (\r\n                <>\r\n                    <MenuItemNotification\r\n                        user={user}\r\n                        channel={channel}\r\n                    />\r\n                    <MenuItemChannelSettings\r\n                        channel={channel}\r\n                    />\r\n                    {isChannelBookmarksEnabled && (\r\n                        <MenuItemChannelBookmarks\r\n                            channel={channel}\r\n                        />\r\n                    )}\r\n                </>\r\n            )}\r\n            <Menu.Separator/>\r\n            {isMobile && (\r\n                <>\r\n                    <MenuItemToggleFavoriteChannel\r\n                        channelID={channel.id}\r\n                        isFavorite={isFavorite}\r\n                    />\r\n                    <MenuItemViewPinnedPosts\r\n                        channelID={channel.id}\r\n                    />\r\n                    <Menu.Separator/>\r\n                </>\r\n            )}\r\n\r\n            {(isArchived || isDefault) && (\r\n                <MenuItemOpenMembersRHS\r\n                    id='channelMembers'\r\n                    channel={channel}\r\n                    text={\r\n                        <FormattedMessage\r\n                            id='channel_header.members'\r\n                            defaultMessage='Members'\r\n                        />\r\n                    }\r\n                />\r\n            )}\r\n\r\n            {!isArchived && !isDefault && (\r\n                <>\r\n                    <ChannelPermissionGate\r\n                        channelId={channel.id}\r\n                        teamId={channel.team_id}\r\n                        permissions={[channelMembersPermission]}\r\n                    >\r\n                        {isGroupConstrained && isLicensedForLDAPGroups && (\r\n                            <MenuItemGroupsMenuItems\r\n                                channel={channel}\r\n                            />\r\n                        )}\r\n                        <MenuItemOpenMembersRHS\r\n                            id='channelMembers'\r\n                            channel={channel}\r\n                            text={\r\n                                <FormattedMessage\r\n                                    id='channel_header.members'\r\n                                    defaultMessage='Members'\r\n                                />\r\n                            }\r\n                        />\r\n                    </ChannelPermissionGate>\r\n\r\n                    <ChannelPermissionGate\r\n                        channelId={channel.id}\r\n                        teamId={channel.team_id}\r\n                        permissions={[channelMembersPermission]}\r\n                        invert={true}\r\n                    >\r\n                        <MenuItemOpenMembersRHS\r\n                            id='channelMembers'\r\n                            channel={channel}\r\n                            text={\r\n                                <FormattedMessage\r\n                                    id='channel_header.members'\r\n                                    defaultMessage='Members'\r\n                                />\r\n                            }\r\n                        />\r\n                    </ChannelPermissionGate>\r\n                </>\r\n            )}\r\n\r\n            <Menu.Separator/>\r\n            <ChannelMoveToSubMenu channel={channel}/>\r\n            {!isMobile && (\r\n                <MenuItemPluginItems pluginItems={pluginItems}/>\r\n            )}\r\n            {!isDefault && (\r\n                <Menu.Separator/>\r\n            )}\r\n            {!isDefault && !isGuest(user.roles) && (\r\n                <MenuItemLeaveChannel\r\n                    id='channelLeaveChannel'\r\n                    channel={channel}\r\n                />\r\n            )}\r\n\r\n            {isArchived && (\r\n                <MenuItemCloseChannel/>\r\n            )}\r\n\r\n            {!isArchived && !isDefault && (\r\n                <ChannelPermissionGate\r\n                    channelId={channel.id}\r\n                    teamId={channel.team_id}\r\n                    permissions={[channelDeletePermission]}\r\n                >\r\n                    <MenuItemArchiveChannel\r\n                        channel={channel}\r\n                    />\r\n                </ChannelPermissionGate>\r\n            )}\r\n\r\n            {isArchived && !isDefault && (\r\n                <ChannelPermissionGate\r\n                    channelId={channel.id}\r\n                    teamId={channel.team_id}\r\n                    permissions={[channelUnarchivePermission]}\r\n                >\r\n                    <MenuItemUnarchiveChannel\r\n                        channel={channel}\r\n                    />\r\n                </ChannelPermissionGate>\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nexport default ChannelHeaderPublicMenu;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport classNames from 'classnames';\r\nimport type {ReactNode} from 'react';\r\nimport React from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport ChevronDownIcon from '@mattermost/compass-icons/components/chevron-down';\r\nimport type {UserProfile} from '@mattermost/types/users';\r\n\r\nimport {\r\n    getCurrentChannel,\r\n    isCurrentChannelDefault,\r\n    isCurrentChannelFavorite,\r\n    isCurrentChannelMuted,\r\n} from 'mattermost-redux/selectors/entities/channels';\r\nimport {getLicense} from 'mattermost-redux/selectors/entities/general';\r\nimport {\r\n    getCurrentUser,\r\n} from 'mattermost-redux/selectors/entities/users';\r\n\r\nimport {getChannelHeaderMenuPluginComponents} from 'selectors/plugins';\r\n\r\nimport {getIsChannelBookmarksEnabled} from 'components/channel_bookmarks/utils';\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {Constants} from 'utils/constants';\r\n\r\nimport ChannelDirectMenu from './channel_header_menu_items/channel_header_direct_menu';\r\nimport ChannelGroupMenu from './channel_header_menu_items/channel_header_group_menu';\r\nimport ChannelHeaderMobileMenu from './channel_header_menu_items/channel_header_mobile_menu';\r\nimport ChannelPublicPrivateMenu from './channel_header_menu_items/channel_header_public_private_menu';\r\n\r\nimport ChannelHeaderTitleDirect from '../channel_header/channel_header_title_direct';\r\nimport ChannelHeaderTitleGroup from '../channel_header/channel_header_title_group';\r\nimport {usePluginVisibilityInSharedChannel} from '../common/hooks/usePluginVisibilityInSharedChannel';\r\n\r\ntype Props = {\r\n    dmUser?: UserProfile;\r\n    gmMembers?: UserProfile[];\r\n    archivedIcon?: JSX.Element;\r\n    sharedIcon?: JSX.Element;\r\n    isMobile?: boolean;\r\n}\r\n\r\nexport default function ChannelHeaderMenu({dmUser, gmMembers, isMobile, archivedIcon, sharedIcon}: Props): JSX.Element | null {\r\n    const intl = useIntl();\r\n\r\n    const user = useSelector(getCurrentUser);\r\n    const channel = useSelector(getCurrentChannel);\r\n    const isDefault = useSelector(isCurrentChannelDefault);\r\n    const isFavorite = useSelector(isCurrentChannelFavorite);\r\n    const isMuted = useSelector(isCurrentChannelMuted);\r\n    const isLicensedForLDAPGroups = useSelector(getLicense).LDAPGroups === 'true';\r\n    const pluginMenuItems = useSelector(getChannelHeaderMenuPluginComponents);\r\n    const isChannelBookmarksEnabled = useSelector(getIsChannelBookmarksEnabled);\r\n    const pluginItemsVisible = usePluginVisibilityInSharedChannel(channel?.id);\r\n\r\n    const isReadonly = false;\r\n\r\n    if (!channel) {\r\n        return null;\r\n    }\r\n\r\n    const isDirect = (channel.type === Constants.DM_CHANNEL);\r\n    const isGroup = (channel.type === Constants.GM_CHANNEL);\r\n\r\n    let channelTitle: ReactNode = channel.display_name;\r\n    let ariaLabel = intl.formatMessage({\r\n        id: 'channel_header.otherchannel',\r\n        defaultMessage: '{displayName} Channel Menu',\r\n    }, {\r\n        displayName: channel.display_name,\r\n    });\r\n    if (isDirect && dmUser) {\r\n        channelTitle = <ChannelHeaderTitleDirect dmUser={dmUser}/>;\r\n        if (user.id === dmUser.id) {\r\n            ariaLabel = intl.formatMessage({\r\n                id: 'channel_header.directchannel',\r\n                defaultMessage: '{displayName} (you) Channel Menu',\r\n            }, {\r\n                displayName: channel.display_name,\r\n            });\r\n        }\r\n    } else if (isGroup) {\r\n        channelTitle = <ChannelHeaderTitleGroup gmMembers={gmMembers}/>;\r\n    }\r\n\r\n    let pluginItems: JSX.Element[] = [];\r\n\r\n    if (pluginItemsVisible) {\r\n        pluginItems = pluginMenuItems.map((item) => {\r\n            const handlePluginItemClick = () => {\r\n                if (item.action) {\r\n                    item.action(channel.id);\r\n                }\r\n            };\r\n\r\n            return (\r\n                <Menu.Item\r\n                    id={item.id + '_pluginmenuitem'}\r\n                    key={item.id + '_pluginmenuitem'}\r\n                    onClick={handlePluginItemClick}\r\n                    labels={<span>{item.text}</span>}\r\n                />\r\n            );\r\n        });\r\n    }\r\n\r\n    return (\r\n        <Menu.Container\r\n            menuButtonTooltip={{\r\n                text: channelTitle as string,\r\n            }}\r\n            menuButton={{\r\n                id: 'channelHeaderDropdownButton',\r\n                class: classNames('channel-header__trigger style--none'),\r\n                children: (\r\n                    <>\r\n                        {archivedIcon}\r\n                        <strong\r\n                            id='channelHeaderTitle'\r\n                            className='heading'\r\n                        >\r\n                            {channelTitle as string}\r\n                        </strong>\r\n                        {sharedIcon}\r\n                        <ChevronDownIcon size={16}/>\r\n                    </>\r\n                ),\r\n                'aria-label': ariaLabel.toLowerCase(),\r\n            }}\r\n            menu={{\r\n                id: 'channelHeaderDropdownMenu',\r\n            }}\r\n            transformOrigin={{\r\n                horizontal: 'left',\r\n                vertical: 'top',\r\n            }}\r\n            anchorOrigin={{\r\n                vertical: 'bottom',\r\n                horizontal: 'left',\r\n            }}\r\n        >\r\n            {isDirect && (\r\n                <ChannelDirectMenu\r\n                    channel={channel}\r\n                    user={user}\r\n                    isMuted={isMuted}\r\n                    pluginItems={pluginItems}\r\n                    isFavorite={isFavorite}\r\n                    isMobile={isMobile || false}\r\n                    isChannelBookmarksEnabled={isChannelBookmarksEnabled}\r\n                />\r\n            )}\r\n            {isGroup && (\r\n                <ChannelGroupMenu\r\n                    channel={channel}\r\n                    user={user}\r\n                    isMuted={isMuted}\r\n                    pluginItems={pluginItems}\r\n                    isFavorite={isFavorite}\r\n                    isMobile={isMobile || false}\r\n                    isChannelBookmarksEnabled={isChannelBookmarksEnabled}\r\n                />\r\n            )}\r\n            {(!isDirect && !isGroup) && (\r\n                <ChannelPublicPrivateMenu\r\n                    channel={channel}\r\n                    user={user}\r\n                    isMuted={isMuted}\r\n                    pluginItems={pluginItems}\r\n                    isFavorite={isFavorite}\r\n                    isMobile={isMobile || false}\r\n                    isDefault={isDefault}\r\n                    isReadonly={isReadonly}\r\n                    isLicensedForLDAPGroups={isLicensedForLDAPGroups}\r\n                    isChannelBookmarksEnabled={isChannelBookmarksEnabled}\r\n                />\r\n            )}\r\n\r\n            <ChannelHeaderMobileMenu\r\n                isMobile={isMobile || false}\r\n                pluginItems={pluginItems}\r\n                channel={channel}\r\n            />\r\n        </Menu.Container>\r\n    );\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {memo} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useSelector, useDispatch} from 'react-redux';\r\n\r\nimport type {AppBinding} from '@mattermost/types/apps';\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {AppCallResponseTypes, AppBindingLocations} from 'mattermost-redux/constants/apps';\r\nimport {makeAppBindingsSelector} from 'mattermost-redux/selectors/entities/apps';\r\nimport {getMyCurrentChannelMembership} from 'mattermost-redux/selectors/entities/channels';\r\n\r\nimport {handleBindingClick, openAppsModal, postEphemeralCallResponseForChannel} from 'actions/apps';\r\nimport {getChannelMobileHeaderPluginButtons} from 'selectors/plugins';\r\n\r\nimport * as Menu from 'components/menu';\r\n\r\nimport {createCallContext} from 'utils/apps';\r\n\r\nimport type {MobileChannelHeaderButtonAction} from 'types/store/plugins';\r\n\r\ntype Props = {\r\n    channel: Channel;\r\n    isDropdown: boolean;\r\n}\r\n\r\nconst MobileChannelHeaderPlugins = (props: Props): JSX.Element => {\r\n    const mobileComponents = useSelector(getChannelMobileHeaderPluginButtons);\r\n    const channelMember = useSelector(getMyCurrentChannelMembership);\r\n    const getChannelHeaderBindings = useSelector(makeAppBindingsSelector(AppBindingLocations.CHANNEL_HEADER_ICON));\r\n    const intl = useIntl();\r\n    const dispatch = useDispatch();\r\n\r\n    const createAppButton = (binding: AppBinding) => {\r\n        const handleAppButtonClick = () => fireAppAction(binding);\r\n\r\n        if (props.isDropdown) {\r\n            return (\r\n                <Menu.Item\r\n                    key={'mobileChannelHeaderItem' + binding.app_id + binding.location}\r\n                    onClick={handleAppButtonClick}\r\n                    labels={<span>{binding.label}</span>}\r\n                />\r\n            );\r\n        }\r\n        return (\r\n            <li className='flex-parent--center'>\r\n                <button\r\n                    id={`${binding.app_id}_${binding.location}`}\r\n                    className='navbar-toggle navbar-right__icon'\r\n                    onClick={handleAppButtonClick}\r\n                >\r\n                    <span className='icon navbar-plugin-button'>\r\n                        <img\r\n                            alt=''\r\n                            src={binding.icon}\r\n                            width='16'\r\n                            height='16'\r\n                        />\r\n                    </span>\r\n                </button>\r\n            </li>\r\n        );\r\n    };\r\n\r\n    const createButton = (plug: MobileChannelHeaderButtonAction) => {\r\n        const handlePluginButtonClick = () => fireAction(plug);\r\n\r\n        if (props.isDropdown) {\r\n            return (\r\n                <Menu.Item\r\n                    key={'mobileChannelHeaderItem' + plug.id}\r\n                    id={'mobileChannelHeaderItem' + plug.id}\r\n                    onClick={handlePluginButtonClick}\r\n                    labels={<span>{plug.dropdownText}</span>}\r\n                    leadingElement={plug.icon}\r\n                />\r\n            );\r\n        }\r\n\r\n        return (\r\n            <li className='flex-parent--center'>\r\n                <button\r\n                    className='navbar-toggle navbar-right__icon'\r\n                    onClick={handlePluginButtonClick}\r\n                >\r\n                    <span className='icon navbar-plugin-button'>\r\n                        {plug.icon}\r\n                    </span>\r\n                </button>\r\n            </li>\r\n        );\r\n    };\r\n\r\n    const createList = (plugs: MobileChannelHeaderButtonAction[]) => {\r\n        return plugs.map(createButton);\r\n    };\r\n\r\n    const createAppList = (bindings: AppBinding[]) => {\r\n        return bindings.map(createAppButton);\r\n    };\r\n\r\n    const fireAction = (plug: MobileChannelHeaderButtonAction) => {\r\n        return plug.action?.(props.channel, channelMember);\r\n    };\r\n\r\n    const fireAppAction = async (binding: AppBinding) => {\r\n        const {channel} = props;\r\n        const context = createCallContext(\r\n            binding.app_id,\r\n            binding.location,\r\n            channel.id,\r\n            channel.team_id,\r\n        );\r\n\r\n        const handleAppResponse = (callResp: any, errorResponse?: any) => {\r\n            if (errorResponse) {\r\n                const errorMessage = errorResponse.text || intl.formatMessage({\r\n                    id: 'apps.error.unknown',\r\n                    defaultMessage: 'Unknown error occurred.',\r\n                });\r\n                dispatch(postEphemeralCallResponseForChannel(errorResponse, errorMessage, channel.id));\r\n                return;\r\n            }\r\n\r\n            switch (callResp.type) {\r\n            case AppCallResponseTypes.OK:\r\n                if (callResp.text) {\r\n                    dispatch(postEphemeralCallResponseForChannel(callResp, callResp.text, channel.id));\r\n                }\r\n                break;\r\n            case AppCallResponseTypes.NAVIGATE:\r\n                break;\r\n            case AppCallResponseTypes.FORM:\r\n                if (callResp.form) {\r\n                    dispatch(openAppsModal(callResp.form, context));\r\n                }\r\n                break;\r\n            default: {\r\n                const errorMessage = intl.formatMessage({\r\n                    id: 'apps.error.responses.unknown_type',\r\n                    defaultMessage: 'App response type not supported. Response type: {type}.',\r\n                }, {\r\n                    type: callResp.type,\r\n                });\r\n                dispatch(postEphemeralCallResponseForChannel(callResp, errorMessage, channel.id));\r\n            }\r\n            }\r\n        };\r\n\r\n        const res = await dispatch(handleBindingClick(binding, context, intl));\r\n        if (res.error) {\r\n            handleAppResponse(null, res.error);\r\n            return;\r\n        }\r\n        handleAppResponse(res.data!);\r\n    };\r\n\r\n    const components = mobileComponents || [];\r\n    const bindings = getChannelHeaderBindings || [];\r\n\r\n    if (components.length === 0 && bindings.length === 0) {\r\n        return <></>;\r\n    } else if (components.length === 1 && bindings.length === 0) {\r\n        return createButton(components[0]);\r\n    } else if (components.length === 0 && bindings.length === 1) {\r\n        return createAppButton(bindings[0]);\r\n    }\r\n\r\n    if (!props.isDropdown) {\r\n        return <></>;\r\n    }\r\n\r\n    const plugItems = createList(components);\r\n    const appItems = createAppList(bindings);\r\n    return (\r\n        <>\r\n            <Menu.Separator/>\r\n            {appItems}\r\n            {plugItems}\r\n        </>\r\n\r\n    );\r\n};\r\n\r\n// Exported for tests\r\nexport {MobileChannelHeaderPlugins as RawMobileChannelHeaderPlug};\r\n\r\nexport default memo(MobileChannelHeaderPlugins);\r\n"],"names":["ChannelHeaderTitleDirect","_ref","_dmUser$roles","dmUser","currentUser","useSelector","getCurrentUser","teammateNameDisplaySetting","getTeammateNameDisplaySetting","displayName","displayUsername","React","id","FormattedMessage","defaultMessage","values","isGuest","roles","GuestTag","memo","ChannelHeaderTitleGroup","gmMembers","channel","getCurrentChannel","membersMap","user","userDisplayName","push","displayNames","display_name","split","map","index","_user$roles","shift","key","propTypes","_pt","ChannelBookmarksSubmenu","props","formatMessage","useIntl","handleCreateLink","handleCreateFile","useBookmarkAddActions","canAdd","useChannelBookmarkPermission","canUploadFiles","useCanUploadFiles","state","bookmarks","getChannelBookmarks","Object","keys","length","MAX_BOOKMARKS_PER_CHANNEL","Menu","concat","leadingElement","BookmarkOutlineIcon","size","labels","trailingElements","ChevronRightIcon","menuId","menuAriaLabel","LinkVariantIcon","onClick","PaperclipIcon","CloseMessage","dispatch","useDispatch","currentTeam","getCurrentTeam","redirectChannel","getRedirectChannelNameForCurrentTeam","text","type","Constants","GM_CHANNEL","CloseIcon","handleClose","currentUserID","name","category","DM_CHANNEL","Preferences","CATEGORY_DIRECT_CHANNEL_SHOW","teammate_id","CATEGORY_GROUP_CHANNEL_SHOW","leaveDirectChannel","savePreferences","user_id","value","getHistory","isRequired","EditConversationHeader","handleEditHeader","openModal","modalId","ModalIdentifiers","EDIT_CHANNEL_HEADER","dialogType","EditChannelHeaderModal","dialogProps","PluginsSubmenu","pluginItems","AppsIcon","ToggleFavoriteChannel","isFavorite","channelID","toggleFavorite","unfavoriteChannel","favoriteChannel","rest","_objectWithoutProperties","_excluded","rhsOpen","getIsRhsOpen","getRhsState","RHSStates","CHANNEL_INFO","assign","InformationOutlineIcon","toggleRHS","closeRightHandSide","showChannelInfo","ToggleMuteChannel","isMuted","userID","BellOffOutlineIcon","handleClick","updateChannelNotifyProps","mark_unread","NotificationLevels","ALL","MENTION","ViewPinnedPosts","hasPinnedPosts","PIN","showPinnedPosts","ChannelHeaderDirectMenu","isMobile","isChannelBookmarksEnabled","e","t","o","r","i","n","hasOwnProperty","call","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","propertyIsEnumerable","MenuItemToggleInfo","MenuItemToggleMuteChannel","MenuItemToggleFavoriteChannel","MenuItemViewPinnedPosts","CogOutlineIcon","MenuItemChannelBookmarks","ChannelMoveToSubMenu","MenuItemPluginItems","NoCommonTeamsError","intl","SectionNotice","title","TeamSelector","setValue","useState","handleTeamChange","useCallback","teamId","teamsById","onChange","currentLocale","getCurrentLocale","teamValues","team","label","sort","teamA","teamB","localeCompare","DropdownInput","className","required","undefined","options","legend","placeholder","WarningTextSection","memberNames","channelMemberNames","formatList","ServerErrorId","ConvertGmToChannelModal","channelName","setChannelName","channelURL","useRef","urlError","setURLError","handleChannelURLChange","newURL","current","setChannelMemberNames","useEffect","validProfilesInChannel","profilesInChannel","filter","currentUserId","delete_at","commonTeamsById","setCommonTeamsById","commonTeamsFetched","setCommonTeamsFetched","loadingAnimationTimeout","setLoadingAnimationTimeout","selectedTeamId","setSelectedTeamId","nameError","setNameError","conversionError","setConversionError","mounted","async","response","getGroupMessageMembersCommonTeams","error","data","teams","forEach","work","setTimeout","handleConfirm","actions","convertGroupMessageToPrivateChannel","trim","server_error_id","CHANNEL_NAME_EXISTS","message","onExited","showLoader","canCreate","modalProps","modalBody","subBody","handleCancel","isDeleteModal","cancelButtonText","confirmButtonText","isConfirmDisabled","LoadingSpinner","ChannelNameFormField","autoFocus","onDisplayNameChange","onURLChange","onErrorStateChange","classNames","loading","GenericModal","modalHeaderText","compassDesign","autoCloseOnConfirmButton","connect","getProfilesInChannel","makeGetProfilesInChannel","ownProps","allProfilesInChannel","getCurrentUserId","bindActionCreators","closeModal","moveChannelsInSidebar","ConvertGMtoPrivate","handleConvertToPrivate","CONVERT_GM_TO_CHANNEL","Notification","BellOutlineIcon","handleNotificationPreferences","CHANNEL_NOTIFICATIONS","ChannelNotificationsModal","OpenMembersRHS","editMembers","CHANNEL_MEMBERS","AccountOutlineIcon","openRHSIfNotOpen","showChannelMembers","ChannelHeaderGroupMenu","isGroupConstrained","group_constrained","isArchived","MenuItemNotification","MenuItemConvertToPrivate","ChannelPermissionGate","channelId","team_id","permissions","Permissions","MANAGE_PUBLIC_CHANNEL_MEMBERS","MenuItemOpenMembersRHS","ChannelHeaderMobileMenu","MobileChannelHeaderPlugins","isDropdown","DeleteChannelModal","constructor","super","_defineProperty","this","CHANNEL_ID_LENGTH","deleteChannel","onHide","setState","show","render","Modal","dialogClassName","role","Header","closeButton","Title","componentClass","Body","strong","chunks","Footer","handleDelete","currentTeamDetails","ArchiveChannel","ArchiveOutlineIcon","handleArchiveChannel","DELETE_CHANNEL","isDestructive","canAccessChannelSettings","createSelector","entities","channels","isPrivate","PRIVATE_CHANNEL","isDefaultChannel","DEFAULT_CHANNEL","infoPermission","MANAGE_PRIVATE_CHANNEL_PROPERTIES","MANAGE_PUBLIC_CHANNEL_PROPERTIES","hasInfoPermission","haveIChannelPermission","bannerPermission","MANAGE_PRIVATE_CHANNEL_BANNER","MANAGE_PUBLIC_CHANNEL_BANNER","hasBannerPermission","archivePermission","DELETE_PRIVATE_CHANNEL","DELETE_PUBLIC_CHANNEL","hasArchivePermission","SystemPolicyIndicator","policies","resourceType","showPolicyNames","variant","testId","onMorePoliciesClick","safePolicies","useMemo","Array","isArray","policy","hasMultiplePolicies","handleMorePoliciesClick","event","preventDefault","stopPropagation","handleKeyDown","getPolicyDisplayName","renderPolicyList","remainingCount","onKeyDown","tabIndex","count","renderCompactMessage","policyText","renderDetailedMessage","policyList","renderMessage","alertMessage","AlertBanner","mode","ChannelActivityWarningModal","isOpen","onClose","onConfirm","acknowledgeRisk","setAcknowledgeRisk","console","handleCheckboxChange","checked","ConfirmModal","showCheckbox","checkboxClass","checkboxText","confirmButtonClass","confirmDisabled","onCancel","onCheckboxChange","isStacked","SAVE_RESULT_SAVED","SAVE_RESULT_ERROR","SAVE_RESULT_CONFIRMATION_REQUIRED","MAX_USERS_SEARCH_LIMIT","ChannelSettingsAccessRulesTab","setAreThereUnsavedChanges","showTabSwitchError","accessControlSettings","getAccessControlSettings","channelMessageCount","getChannelMessageCount","isSystemAdmin","isCurrentUserSystemAdmin","expression","setExpression","originalExpression","setOriginalExpression","userAttributes","setUserAttributes","attributesLoaded","setAttributesLoaded","autoSyncMembers","setAutoSyncMembers","originalAutoSyncMembers","setOriginalAutoSyncMembers","saveChangesPanelState","setSaveChangesPanelState","formError","setFormError","showSelfExclusionModal","setShowSelfExclusionModal","showActivityWarningModal","setShowActivityWarningModal","shouldShowActivityWarning","setShouldShowActivityWarning","activityWarningModalKey","setActivityWarningModalKey","showConfirmModal","setShowConfirmModal","usersToAdd","setUsersToAdd","usersToRemove","setUsersToRemove","isProcessingSave","setIsProcessingSave","useChannelAccessControlActions","systemPolicies","policiesLoading","setPolicies","setLoading","setError","policy_enforced","channelPolicyResult","getAccessControlPolicy","channelPolicy","imports","parentPromises","parentId","parentResults","Promise","all","parentPolicies","result","err","fetchPolicies","useChannelSystemPolicies","getAccessControlFields","errorMessage","Error","String","includes","loadAttributes","getChannelPolicy","_result$data$rules","_result$data$rules$","existingExpression","rules","existingAutoSync","active","loadChannelPolicy","handleExpressionChange","newExpression","handleParseError","warn","isEmptyRulesState","hasChannelRules","hasSystemPolicies","handleAutoSyncToggle","prev","combineSystemAndChannelExpressions","channelExpression","systemExpressions","_policy$rules","_policy$rules$","expr","allExpressions","join","validateSelfExclusion","testExpression","_result$data","validateExpressionAgainstRequester","requester_matches","isBecomingLessRestrictive","oldExpression","_oldMatchResult$data","_newMatchResult$data","hadRules","hasRules","oldCombined","newCombined","oldMatchingUserIds","searchUsers","users","u","newMatchingUserIds","calculateMembershipChanges","combinedExpression","toAdd","toRemove","potentialToAdd","_matchResult$data","_membersResult$data","matchingUserIds","currentMemberIds","getChannelMembers","m","performSave","deleteChannelPolicy","deleteError","version","revision","created_at","Date","now","p","saveChannelPolicy","updateAccessControlPoliciesActive","activeError","createAccessControlSyncJob","policy_id","jobError","handleSave","_channelMessageCount$","hasChannelHistory","total","hadRulesBefore","hasRulesNow","isRemovingAllRules","changes","becomingLessRestrictive","willImmediatelyAddUsers","shouldShowWarning","saveInProgressRef","handleConfirmSave","success","handleSaveChanges","handleActivityWarningContinue","handleActivityWarningClose","hasErrors","Boolean","shouldShowPanel","TableEditor","onValidate","onParseError","enableUserManagedAttributes","EnableUserManagedAttributes","disabled","htmlFor","SaveChangesPanel","handleSubmit","tabChangeError","customErrorMessage","hideCancel","ChannelAccessRulesConfirmModal","isProcessing","autoSyncEnabled","willShowActivityWarning","ChannelSettingsArchiveTab","showArchiveConfirmModal","setShowArchiveConfirmModal","ConfirmationModal","modalClass","focusOriginElement","DEFAULT_CHANNEL_BANNER","enabled","background_color","ChannelSettingsConfigurationTab","heading","subHeading","bannerTextSettingTitle","bannerColorSettingTitle","bannerTextPlaceholder","initialBannerInfo","banner_info","showBannerTextPreview","setShowBannerTextPreview","updatedChannelBanner","setUpdatedChannelBanner","requireConfirm","setRequireConfirm","characterLimitExceeded","setCharacterLimitExceeded","handleToggle","newValue","toUpdate","_objectSpread","resetFormErrors","handleTextChange","target","handleColorChange","color","toggleTextPreview","hasUnsavedChanges","_updatedChannelBanner","_initialBannerInfo$te","_updatedChannelBanner2","_initialBannerInfo$ba","unsavedChanges","handleServerError","errorMsg","_updatedChannelBanner3","_updatedChannelBanner4","_updatedChannelBanner5","_updatedChannelBanner6","updated","patchChannel","_prev$text","_prev$background_colo","showSaveChangesPanel","Toggle","ariaLabel","onToggle","toggled","toggleClassName","AdvancedTextbox","onKeyPress","showCharacterCount","useChannelMentions","preview","togglePreview","hasError","createMessage","maxLength","minLength","ColorInput","ChannelSettingsInfoTab","_channel$display_name","_channel$name","_channel$purpose","_channel$header","_ref2","shouldShowPreviewPurpose","showPreviewOnChannelSettingsPurposeModal","shouldShowPreviewHeader","showPreviewOnChannelSettingsHeaderModal","canConvertToPrivate","CONVERT_PUBLIC_CHANNEL_TO_PRIVATE","canConvertToPublic","CONVERT_PRIVATE_CHANNEL_TO_PUBLIC","channelPropertiesPermission","canManageChannelProperties","HEADER_MAX_LENGTH","internalUrlError","setUrlError","channelNameError","setChannelNameError","showConvertConfirmModal","setShowConvertConfirmModal","setDisplayName","channelUrl","setChannelURL","channelPurpose","setChannelPurpose","purpose","channelHeader","setChannelHeader","header","channelType","setChannelType","OPEN_CHANNEL","handleChannelNameError","isError","handleURLChange","togglePurposePreview","setShowPreviewOnChannelSettingsPurposeModal","toggleHeaderPreview","setShowPreviewOnChannelSettingsHeaderModal","handleHeaderChange","handlePurposeChange","MAX_CHANNELPURPOSE_LENGTH","toLowerCase","_data$display_name","_data$name","_data$purpose","_data$header","updateChannelPrivacy","General","hideConvertConfirmModal","_channel$display_name2","_channel$name2","_channel$purpose2","_channel$header2","_ref3","ConvertConfirmModal","toPublic","currentUrl","readOnly","isEditingExistingChannel","PublicPrivateSelector","selected","publicButtonProps","description","privateButtonProps","descriptionMessage","SettingsSidebar","ChannelSettingsTabs","ChannelSettingsModal","getChannel","channelBannerEnabled","isMinimumEnterpriseAdvancedLicense","getLicense","canManagePublicChannelBanner","canManagePrivateChannelBanner","hasManageChannelBannerPermission","shouldShowConfigurationTab","canArchivePrivateChannels","canArchivePublicChannels","canManageChannelAccessRules","MANAGE_CHANNEL_ACCESS_RULES","shouldShowAccessRulesTab","isChannelAccessControlEnabled","setShow","activeTab","setActiveTab","INFO","setShowTabSwitchError","areThereUnsavedChanges","hasBeenWarned","setHasBeenWarned","modalBodyRef","handleHideConfirm","renderInfoTab","tabs","uiName","icon","iconTitle","ACCESS_RULES","display","CONFIGURATION","ARCHIVE","newGroup","modalTitle","handleHide","preventClose","handleExited","focusElement","bodyPadding","modalLocation","enforceFocus","ref","fallback","updateTab","newTab","scrollTop","renderTabContent","ChannelSettingsMenu","handleOpenChannelSettings","CHANNEL_SETTINGS","CloseChannel","_objectDestructuringEmpty","goToLastViewedChannel","ChannelGroupsManageModal","arguments","pageNumber","searchTerm","getGroupsAssociatedToChannel","DEFAULT_NUM_PER_PAGE","items","groups","totalCount","totalGroupCount","item","listModal","unlinkGroupSyncable","SyncableType","Channel","then","loadItems","page","MANAGE_CHANNEL_GROUPS","ADD_GROUPS_TO_TEAM","AddGroupsToChannelModal","isChannelAdmin","patchGroupSyncable","scheme_admin","getMyChannelMember","src","groupsAvatar","alt","width","height","num","member_count","MenuWrapper","DropdownIcon","openLeft","Utils","ItemAction","setChannelMemberStatus","onClickRemoveGroup","ListModal","titleText","searchPlaceholderText","renderRow","titleBarButtonText","titleBarButtonOnClick","titleButtonOnClick","injectIntl","mapStateToProps","Groups","AccountMultiplePlusOutlineIcon","handleAddGroups","ADD_GROUPS_TO_CHANNEL","AccountMultipleOutlineIcon","handleManageGroups","LeaveChannel","LogoutVariantIcon","handleLeave","LEAVE_PRIVATE_CHANNEL_MODAL","LeaveChannelModal","leaveChannel","UnarchiveChannelModal","unarchiveChannel","b","handleUnarchive","UnarchiveChannel","handleUnarchiveChannel","UNARCHIVE_CHANNEL","ChannelHeaderPublicMenu","isDefault","isLicensedForLDAPGroups","channelMembersPermission","MANAGE_PRIVATE_CHANNEL_MEMBERS","channelDeletePermission","channelUnarchivePermission","MANAGE_TEAM","MenuItemChannelSettings","MenuItemGroupsMenuItems","invert","MenuItemLeaveChannel","MenuItemCloseChannel","MenuItemArchiveChannel","MenuItemUnarchiveChannel","isReadonly","ChannelHeaderMenu","archivedIcon","sharedIcon","isCurrentChannelDefault","isCurrentChannelFavorite","isCurrentChannelMuted","LDAPGroups","pluginMenuItems","getChannelHeaderMenuPluginComponents","getIsChannelBookmarksEnabled","pluginItemsVisible","usePluginVisibilityInSharedChannel","isDirect","isGroup","channelTitle","handlePluginItemClick","action","menuButtonTooltip","menuButton","class","children","ChevronDownIcon","menu","transformOrigin","horizontal","vertical","anchorOrigin","ChannelDirectMenu","ChannelGroupMenu","ChannelPublicPrivateMenu","mobileComponents","getChannelMobileHeaderPluginButtons","channelMember","getMyCurrentChannelMembership","getChannelHeaderBindings","makeAppBindingsSelector","AppBindingLocations","CHANNEL_HEADER_ICON","createAppButton","binding","handleAppButtonClick","fireAppAction","app_id","location","createButton","plug","handlePluginButtonClick","fireAction","dropdownText","_plug$action","context","createCallContext","handleAppResponse","callResp","errorResponse","postEphemeralCallResponseForChannel","AppCallResponseTypes","OK","NAVIGATE","FORM","form","openAppsModal","res","handleBindingClick","components","bindings","plugItems","appItems","createAppList"],"sourceRoot":""}