{"version":3,"file":"7422.8c13440208f50df0e81a.js","mappings":"gRA0EA,QAhDuBA,KACnB,MAAMC,GAAQC,EAAAA,EAAAA,iBACRC,GAAWC,EAAAA,EAAAA,eAEXC,EAAWJ,EAAMK,OAAOC,KACxBC,EAAaP,EAAMK,OAAOE,WAE1BD,GAAOE,EAAAA,EAAAA,cAAaC,IAAuBC,EAAAA,EAAAA,IAAcD,EAAOL,KAEhEO,GAAwBH,EAAAA,EAAAA,cAAaC,IAAuBG,EAAAA,EAAAA,IAAmCH,EAAOL,KACtGS,GAAoBL,EAAAA,EAAAA,cAAaC,IAAuBK,EAAAA,EAAAA,IAAiCL,GAAOH,aAAI,EAAJA,EAAMS,KAAM,GAAIJ,KAatH,OAXAK,EAAAA,EAAAA,YAAU,KAC6BC,WAC/B,MAAMC,EAAoBL,QAAAA,QAA2BM,EAAAA,GAAQC,kBAAiBd,aAAI,EAAJA,EAAMS,KAAM,GAAI,eAE9Fb,GAASmB,EAAAA,EAAAA,IAAgBH,IACzBhB,EASZ,SAA8BoB,EAAyBC,EAAgBhB,GACnE,OAAOU,UAEH,MAAMO,GAAWC,EAAAA,EAAAA,MACjBvB,EAAS,CAACwB,KAAM,0BAA2BF,aAE3C,MAAMG,EAAU,0BAAHC,OAA6BrB,EAAU,KAAAqB,OAAIJ,GAElDK,EAAO,CACTC,WAAYR,EAAeP,GAC3BgB,QAASR,GAGb,IACI,MAAMS,QAAab,EAAAA,GAAQc,eAAeN,EAASE,GACnD3B,EAAS,CAACwB,KAAMQ,EAAAA,GAAiBC,2BAA4BH,KAAMA,aAAI,EAAJA,EAAMI,YAC7E,CAAE,MAAOC,GACLC,QAAQD,MAAMA,EAClB,EAER,CA7BqBE,CAAqBrB,GAAmBZ,aAAI,EAAJA,EAAMS,KAAM,GAAIR,GAAY,EAGjFiC,EAA4B,GAC7B,IAEI,IAAI,C","sources":["webpack://mattermost-webapp/./src/components/channel_layout/playbook_runner.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {useEffect} from 'react';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\nimport {useRouteMatch} from 'react-router-dom';\r\nimport type {AnyAction, Dispatch} from 'redux';\r\n\r\nimport type {Channel} from '@mattermost/types/channels';\r\n\r\nimport {IntegrationTypes} from 'mattermost-redux/action_types';\r\nimport {Client4} from 'mattermost-redux/client';\r\nimport {getChannelByTeamIdAndChannelName} from 'mattermost-redux/selectors/entities/channels';\r\nimport {getTeamByName} from 'mattermost-redux/selectors/entities/teams';\r\nimport {generateId} from 'mattermost-redux/utils/helpers';\r\n\r\nimport {switchToChannel} from 'actions/views/channel';\r\nimport {getLastViewedChannelNameByTeamName} from 'selectors/local_storage';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\ninterface MatchParams {\r\n    team: string;\r\n    playbookId: string;\r\n}\r\n\r\nconst PlaybookRunner = () => {\r\n    const match = useRouteMatch<MatchParams>();\r\n    const dispatch = useDispatch();\r\n\r\n    const teamName = match.params.team;\r\n    const playbookId = match.params.playbookId;\r\n\r\n    const team = useSelector((state: GlobalState) => getTeamByName(state, teamName));\r\n\r\n    const lastViewedChannelName = useSelector((state: GlobalState) => getLastViewedChannelNameByTeamName(state, teamName));\r\n    const lastViewedChannel = useSelector((state: GlobalState) => getChannelByTeamIdAndChannelName(state, team?.id || '', lastViewedChannelName));\r\n\r\n    useEffect(() => {\r\n        const switchToChannelAndStartRun = async () => {\r\n            const channelToSwitchTo = lastViewedChannel ?? await Client4.getChannelByName(team?.id || '', 'town-square');\r\n\r\n            dispatch(switchToChannel(channelToSwitchTo));\r\n            dispatch(startPlaybookRunById(channelToSwitchTo, team?.id || '', playbookId));\r\n        };\r\n\r\n        switchToChannelAndStartRun();\r\n    }, []);\r\n\r\n    return null;\r\n};\r\n\r\nfunction startPlaybookRunById(currentChannel: Channel, teamId: string, playbookId: string) {\r\n    return async (dispatch: Dispatch<AnyAction>) => {\r\n        // Generate a unique id for the command and send it to Playbooks\r\n        const clientId = generateId();\r\n        dispatch({type: 'playbooks_set_client_id', clientId});\r\n\r\n        const command = `/playbook run-playbook ${playbookId} ${clientId}`;\r\n\r\n        const args = {\r\n            channel_id: currentChannel.id,\r\n            team_id: teamId,\r\n        };\r\n\r\n        try {\r\n            const data = await Client4.executeCommand(command, args);\r\n            dispatch({type: IntegrationTypes.RECEIVED_DIALOG_TRIGGER_ID, data: data?.trigger_id});\r\n        } catch (error) {\r\n            console.error(error); //eslint-disable-line no-console\r\n        }\r\n    };\r\n}\r\n\r\nexport default PlaybookRunner;\r\n"],"names":["PlaybookRunner","match","useRouteMatch","dispatch","useDispatch","teamName","params","team","playbookId","useSelector","state","getTeamByName","lastViewedChannelName","getLastViewedChannelNameByTeamName","lastViewedChannel","getChannelByTeamIdAndChannelName","id","useEffect","async","channelToSwitchTo","Client4","getChannelByName","switchToChannel","currentChannel","teamId","clientId","generateId","type","command","concat","args","channel_id","team_id","data","executeCommand","IntegrationTypes","RECEIVED_DIALOG_TRIGGER_ID","trigger_id","error","console","startPlaybookRunById","switchToChannelAndStartRun"],"sourceRoot":""}