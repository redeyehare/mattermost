{"version":3,"file":"1241.ac58ec07b10ea6ae7bb5.js","mappings":"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","sources":["webpack://mattermost-webapp/./src/actions/views/mfa.js","webpack://mattermost-webapp/./src/components/common/back_button.tsx","webpack://mattermost-webapp/./src/components/localized_placeholder_input.tsx","webpack://mattermost-webapp/./src/components/mfa/confirm.tsx","webpack://mattermost-webapp/./src/components/mfa/setup/setup.tsx","webpack://mattermost-webapp/./src/components/mfa/setup/index.ts","webpack://mattermost-webapp/./src/components/mfa/mfa_controller/mfa_controller.tsx","webpack://mattermost-webapp/./src/components/mfa/mfa_controller/index.ts","webpack://mattermost-webapp/./src/components/widgets/icons/fa_logout_icon.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport * as UserActions from 'mattermost-redux/actions/users';\r\nimport {getCurrentUserId} from 'mattermost-redux/selectors/entities/users';\r\n\r\nexport function activateMfa(code) {\r\n    return (dispatch, getState) => {\r\n        const currentUserId = getCurrentUserId(getState());\r\n\r\n        return dispatch(UserActions.updateUserMfa(currentUserId, true, code));\r\n    };\r\n}\r\n\r\nexport function deactivateMfa() {\r\n    return (dispatch, getState) => {\r\n        const currentUserId = getCurrentUserId(getState());\r\n\r\n        return dispatch(UserActions.updateUserMfa(currentUserId, false));\r\n    };\r\n}\r\n\r\nexport function generateMfaSecret() {\r\n    return (dispatch, getState) => {\r\n        const currentUserId = getCurrentUserId(getState());\r\n\r\n        return dispatch(UserActions.generateMfaSecret(currentUserId));\r\n    };\r\n}\r\n\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport classNames from 'classnames';\r\nimport React from 'react';\r\nimport {FormattedMessage, useIntl} from 'react-intl';\r\nimport {Link} from 'react-router-dom';\r\n\r\ntype Props = {\r\n\r\n    /**\r\n     * URL to return to\r\n     */\r\n    url?: string;\r\n\r\n    className?: string;\r\n\r\n    /**\r\n     * onClick handler when user clicks back button\r\n     */\r\n    onClick?: React.EventHandler<React.MouseEvent>;\r\n}\r\n\r\nconst BackButton = ({url = '/', className, onClick}: Props): JSX.Element => {\r\n    const {formatMessage} = useIntl();\r\n\r\n    return (\r\n        <div className={classNames('signup-header', className)}>\r\n            <Link\r\n                data-testid='back_button'\r\n                onClick={onClick}\r\n                to={url}\r\n            >\r\n                <span\r\n                    id='back_button_icon'\r\n                    className='fa fa-1x fa-angle-left'\r\n                    title={formatMessage({id: 'generic_icons.back', defaultMessage: 'Back Icon'})}\r\n                />\r\n                <FormattedMessage\r\n                    id='web.header.back'\r\n                    defaultMessage='Back'\r\n                />\r\n            </Link>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default BackButton;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {useIntl, type MessageDescriptor} from 'react-intl';\r\n\r\ntype Props = {\r\n    placeholder: MessageDescriptor;\r\n} & Omit<React.InputHTMLAttributes<HTMLInputElement>, 'placeholder'>;\r\n\r\nconst LocalizedPlaceholderInput = React.forwardRef<HTMLInputElement, Props>(({placeholder, ...otherProps}, ref) => {\r\n    const intl = useIntl();\r\n\r\n    return (\r\n        <input\r\n            ref={ref}\r\n            placeholder={intl.formatMessage(placeholder)}\r\n            {...otherProps}\r\n        />\r\n    );\r\n});\r\n\r\nLocalizedPlaceholderInput.displayName = 'LocalizedPlaceholderInput';\r\n\r\nexport default LocalizedPlaceholderInput;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useEffect} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\n\r\nimport {redirectUserToDefaultTeam} from 'actions/global_actions';\r\n\r\nimport Constants from 'utils/constants';\r\nimport {isKeyPressed} from 'utils/keyboard';\r\n\r\nconst KeyCodes = Constants.KeyCodes;\r\n\r\nconst submit = (e: KeyboardEvent | React.FormEvent<HTMLFormElement>): void => {\r\n    e.preventDefault();\r\n    redirectUserToDefaultTeam();\r\n};\r\n\r\nconst onKeyPress = (e: React.KeyboardEvent<HTMLFormElement>| KeyboardEvent) => {\r\n    if (isKeyPressed(e as KeyboardEvent, KeyCodes.ENTER)) {\r\n        submit(e);\r\n    }\r\n};\r\n\r\nexport default function Confirm() {\r\n    useEffect(() => {\r\n        document.body.addEventListener('keydown', onKeyPress);\r\n\r\n        return () => {\r\n            document.body.removeEventListener('keydown', onKeyPress);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            <form\r\n                onSubmit={submit}\r\n                onKeyPress={onKeyPress}\r\n                className='form-group'\r\n            >\r\n                <strong>\r\n                    <FormattedMessage\r\n                        id='mfa.confirm.complete'\r\n                        defaultMessage='Set up complete!'\r\n                    />\r\n                </strong>\r\n                <p>\r\n                    <FormattedMessage\r\n                        id='mfa.confirm.secure'\r\n                        defaultMessage='Your account is now secure. Next time you sign in, you will be asked to enter a code from your authenticator app on your phone.'\r\n                    />\r\n                </p>\r\n                <button\r\n                    type='submit'\r\n                    className='btn btn-primary'\r\n                >\r\n                    <FormattedMessage\r\n                        id='mfa.confirm.okay'\r\n                        defaultMessage='Okay'\r\n                    />\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {defineMessage, FormattedMessage} from 'react-intl';\r\n\r\nimport type {UserProfile} from '@mattermost/types/users';\r\n\r\nimport LocalizedPlaceholderInput from 'components/localized_placeholder_input';\r\n\r\ntype MFAControllerState = {\r\n    enforceMultifactorAuthentication: boolean;\r\n};\r\n\r\ntype Props = {\r\n\r\n    /*\r\n     * Object containing enforceMultifactorAuthentication\r\n     */\r\n    state: MFAControllerState;\r\n\r\n    /*\r\n     * Function that updates parent component with state props\r\n     */\r\n    updateParent: (state: MFAControllerState) => void;\r\n\r\n    currentUser: UserProfile;\r\n    siteName?: string;\r\n    enforceMultifactorAuthentication: boolean;\r\n    actions: {\r\n        activateMfa: (code: string) => Promise<{\r\n            error?: {\r\n                server_error_id: string;\r\n                message: string;\r\n            };\r\n        }>;\r\n        generateMfaSecret: () => Promise<{\r\n            data: {\r\n                secret: string;\r\n                qr_code: string;\r\n            };\r\n            error?: {\r\n                message: string;\r\n            };\r\n        }>;\r\n    };\r\n    history: {\r\n        push(path: string): void;\r\n    };\r\n}\r\n\r\ntype State = {\r\n    secret: string;\r\n    qrCode: string;\r\n    error: React.ReactNode;\r\n    serverError?: string;\r\n}\r\n\r\nexport default class Setup extends React.PureComponent<Props, State> {\r\n    input: React.RefObject<HTMLInputElement>;\r\n\r\n    public constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            error: undefined,\r\n            secret: '',\r\n            qrCode: '',\r\n        };\r\n\r\n        this.input = React.createRef();\r\n    }\r\n\r\n    public componentDidMount(): void {\r\n        const user = this.props.currentUser;\r\n        if (!user || user.mfa_active) {\r\n            this.props.history.push('/');\r\n            return;\r\n        }\r\n\r\n        this.props.actions.generateMfaSecret().then(({data, error}) => {\r\n            if (error) {\r\n                this.setState({\r\n                    serverError: error.message,\r\n                });\r\n                return;\r\n            }\r\n\r\n            this.setState({\r\n                secret: data.secret,\r\n                qrCode: data.qr_code,\r\n            });\r\n        });\r\n    }\r\n\r\n    submit = (e: React.FormEvent<HTMLFormElement>): void => {\r\n        e.preventDefault();\r\n        const code = this.input?.current?.value.replace(/\\s/g, '');\r\n        if (!code || code.length === 0) {\r\n            this.setState({\r\n                error: (\r\n                    <FormattedMessage\r\n                        id='mfa.setup.codeError'\r\n                        defaultMessage='Please enter the code from your authenticator app.'\r\n                    />\r\n                ),\r\n            });\r\n            this.input?.current?.focus();\r\n            return;\r\n        }\r\n\r\n        this.setState({error: null});\r\n\r\n        this.props.actions.activateMfa(code).then(({error}) => {\r\n            if (error) {\r\n                if (error.server_error_id === 'ent.mfa.activate.authenticate.app_error') {\r\n                    this.setState({\r\n                        error: (\r\n                            <FormattedMessage\r\n                                id='mfa.setup.badCode'\r\n                                defaultMessage='Invalid code. If this issue persists, contact your System Administrator.'\r\n                            />\r\n                        ),\r\n                    });\r\n                } else {\r\n                    this.setState({\r\n                        error: error.message,\r\n                    });\r\n                }\r\n                this.input?.current?.focus();\r\n                return;\r\n            }\r\n\r\n            this.props.history.push('/mfa/confirm');\r\n        });\r\n    };\r\n\r\n    public render(): JSX.Element {\r\n        let formClass = 'form-group';\r\n        let errorContent;\r\n        if (this.state.error) {\r\n            errorContent = (\r\n                <div\r\n                    id='mfa-setup-error'\r\n                    className='form-group has-error'\r\n                    role='alert'\r\n                >\r\n                    <label className='control-label'>{this.state.error}</label>\r\n                </div>\r\n            );\r\n            formClass += ' has-error';\r\n        }\r\n\r\n        let mfaRequired;\r\n        if (this.props.enforceMultifactorAuthentication) {\r\n            mfaRequired = (\r\n                <p>\r\n                    <FormattedMessage\r\n                        id='mfa.setup.required_mfa'\r\n                        defaultMessage='<strong>Multi-factor authentication is required on {siteName}.</strong>'\r\n                        values={{\r\n                            siteName: this.props.siteName,\r\n                            strong: (chunks: React.ReactNode) => <strong>{chunks}</strong>,\r\n                        }}\r\n                    />\r\n                </p>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <form\r\n                    onSubmit={this.submit}\r\n                    className={formClass}\r\n                >\r\n                    {mfaRequired}\r\n                    <p>\r\n                        <FormattedMessage\r\n                            id='mfa.setup.step1'\r\n                            defaultMessage='1. Scan the QR code below using an authenticator app of your choice, such as Google Authenticator, Microsoft Authenticator app, or 1Password.'\r\n                        />\r\n                    </p>\r\n                    <p>\r\n                        <FormattedMessage\r\n                            id='mfa.setup.step2_secret'\r\n                            defaultMessage='Alternatively, enter the secret key displayed below into the authenticator app manually.'\r\n                        />\r\n                    </p>\r\n                    <div className='form-group'>\r\n                        <div className='col-sm-12'>\r\n                            <img\r\n                                alt={'qr code image'}\r\n                                style={style.qrCode}\r\n                                src={'data:image/png;base64,' + this.state.qrCode}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <br/>\r\n                    <div className='form-group'>\r\n                        <p className='col-sm-12'>\r\n                            <FormattedMessage\r\n                                id='mfa.setup.secret'\r\n                                defaultMessage='Secret: {secret}'\r\n                                values={{\r\n                                    secret: this.state.secret,\r\n                                }}\r\n                            />\r\n                        </p>\r\n                    </div>\r\n                    <p>\r\n                        <FormattedMessage\r\n                            id='mfa.setup.step3_code'\r\n                            defaultMessage='2. Enter the code generated by the authenticator app in the field below.'\r\n                            values={{\r\n                                strong: (chunks: React.ReactNode) => <strong>{chunks}</strong>,\r\n                            }}\r\n                        />\r\n                    </p>\r\n                    <p>\r\n                        <LocalizedPlaceholderInput\r\n                            ref={this.input}\r\n                            className='form-control'\r\n                            placeholder={defineMessage({id: 'mfa.setup.code', defaultMessage: 'MFA Code'})}\r\n                            autoFocus={true}\r\n                            aria-describedby={this.state.error ? 'mfa-setup-error' : undefined}\r\n                        />\r\n                    </p>\r\n                    {errorContent}\r\n                    <button\r\n                        type='submit'\r\n                        className='btn btn-primary'\r\n                    >\r\n                        <FormattedMessage\r\n                            id='mfa.setup.save'\r\n                            defaultMessage='Save'\r\n                        />\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nconst style = {\r\n    qrCode: {maxHeight: 170},\r\n};\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {connect} from 'react-redux';\r\nimport {bindActionCreators} from 'redux';\r\nimport type {Dispatch} from 'redux';\r\n\r\nimport type {GlobalState} from '@mattermost/types/store';\r\n\r\nimport {getConfig} from 'mattermost-redux/selectors/entities/general';\r\nimport {getCurrentUser} from 'mattermost-redux/selectors/entities/users';\r\n\r\nimport {activateMfa, generateMfaSecret} from 'actions/views/mfa';\r\n\r\nimport Setup from './setup';\r\n\r\nfunction mapStateToProps(state: GlobalState) {\r\n    const config = getConfig(state);\r\n\r\n    const siteName = config.SiteName;\r\n    const enforceMultifactorAuthentication = config.EnforceMultifactorAuthentication === 'true';\r\n\r\n    return {\r\n        currentUser: getCurrentUser(state),\r\n        siteName,\r\n        enforceMultifactorAuthentication,\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch) {\r\n    return {\r\n        actions: bindActionCreators({\r\n            activateMfa,\r\n            generateMfaSecret,\r\n        }, dispatch),\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Setup);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {Route, Switch} from 'react-router-dom';\r\nimport type {RouteComponentProps} from 'react-router-dom';\r\n\r\nimport {emitUserLoggedOutEvent} from 'actions/global_actions';\r\n\r\nimport BackButton from 'components/common/back_button';\r\nimport LogoutIcon from 'components/widgets/icons/fa_logout_icon';\r\n\r\nimport logoImage from 'images/logo.png';\r\n\r\nimport Confirm from '../confirm';\r\nimport Setup from '../setup';\r\n\r\ntype Location = {\r\n    search: string;\r\n}\r\n\r\ntype Props = {\r\n    location: Location;\r\n    children?: React.ReactNode;\r\n    mfa: boolean;\r\n    enableMultifactorAuthentication: boolean;\r\n    enforceMultifactorAuthentication: boolean;\r\n\r\n    /*\r\n     * Object from react-router\r\n     */\r\n    match: {\r\n        url: string;\r\n    };\r\n}\r\n\r\ntype State = {\r\n    enforceMultifactorAuthentication: boolean;\r\n}\r\n\r\nexport default class MFAController extends React.PureComponent<Props & RouteComponentProps, State> {\r\n    public constructor(props: Props & RouteComponentProps) {\r\n        super(props);\r\n\r\n        this.state = {enforceMultifactorAuthentication: props.enableMultifactorAuthentication};\r\n    }\r\n\r\n    public componentDidMount(): void {\r\n        document.body.classList.add('sticky');\r\n        document.getElementById('root')!.classList.add('container-fluid');\r\n\r\n        if (!this.props.enableMultifactorAuthentication) {\r\n            this.props.history.push('/');\r\n        }\r\n    }\r\n\r\n    public componentWillUnmount(): void {\r\n        document.body.classList.remove('sticky');\r\n        document.getElementById('root')!.classList.remove('container-fluid');\r\n    }\r\n\r\n    public handleOnClick = (e: React.MouseEvent<HTMLButtonElement, MouseEvent>): void => {\r\n        e.preventDefault();\r\n        emitUserLoggedOutEvent('/login');\r\n    };\r\n\r\n    public updateParent = (state: State): void => {\r\n        this.setState(state);\r\n    };\r\n\r\n    public render(): JSX.Element {\r\n        let backButton;\r\n        if (this.props.mfa && this.props.enforceMultifactorAuthentication) {\r\n            backButton = (\r\n                <div className='signup-header'>\r\n                    <button\r\n                        className='style--none color--link'\r\n                        onClick={this.handleOnClick}\r\n                    >\r\n                        <LogoutIcon/>\r\n                        <FormattedMessage\r\n                            id='web.header.logout'\r\n                            defaultMessage='Logout'\r\n                        />\r\n                    </button>\r\n                </div>\r\n            );\r\n        } else {\r\n            backButton = (<BackButton/>);\r\n        }\r\n\r\n        return (\r\n            <div className='inner-wrap'>\r\n                <div className='row content'>\r\n                    <div>\r\n                        {backButton}\r\n                        <div className='col-sm-12'>\r\n                            <div className='signup-team__container'>\r\n                                <h3>\r\n                                    <FormattedMessage\r\n                                        id='mfa.setupTitle'\r\n                                        defaultMessage='Multi-factor Authentication Setup'\r\n                                    />\r\n                                </h3>\r\n                                <img\r\n                                    alt={'signup team logo'}\r\n                                    className='signup-team-logo'\r\n                                    src={logoImage}\r\n                                />\r\n                                <div id='mfa'>\r\n                                    <Switch>\r\n                                        <Route\r\n                                            path={`${this.props.match.url}/setup`}\r\n                                            render={(props) => (\r\n                                                <Setup\r\n                                                    state={this.state}\r\n                                                    updateParent={this.updateParent}\r\n                                                    {...props}\r\n                                                />\r\n                                            )}\r\n                                        />\r\n                                        <Route\r\n                                            path={`${this.props.match.url}/confirm`}\r\n                                            render={() => (\r\n                                                <Confirm/>\r\n                                            )}\r\n                                        />\r\n                                    </Switch>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {connect} from 'react-redux';\r\n\r\nimport {getConfig, getLicense} from 'mattermost-redux/selectors/entities/general';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\nimport MFAController from './mfa_controller';\r\n\r\nfunction mapStateToProps(state: GlobalState) {\r\n    const license = getLicense(state);\r\n    const config = getConfig(state);\r\n\r\n    const mfa = license.MFA === 'true';\r\n    const enableMultifactorAuthentication = config.EnableMultifactorAuthentication === 'true';\r\n    const enforceMultifactorAuthentication = config.EnforceMultifactorAuthentication === 'true';\r\n\r\n    return {\r\n        mfa,\r\n        enableMultifactorAuthentication,\r\n        enforceMultifactorAuthentication,\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps)(MFAController);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {useIntl} from 'react-intl';\r\n\r\nexport default function LogoutIcon() {\r\n    const {formatMessage} = useIntl();\r\n    return (\r\n        <i\r\n            className='fa fa-1x fa-angle-left'\r\n            title={formatMessage({id: 'generic_icons.logout', defaultMessage: 'Logout Icon'})}\r\n        />\r\n    );\r\n}\r\n"],"names":["activateMfa","code","dispatch","getState","currentUserId","getCurrentUserId","UserActions","deactivateMfa","generateMfaSecret","BackButton","_ref","url","className","onClick","formatMessage","useIntl","React","classNames","Link","to","id","title","defaultMessage","FormattedMessage","propTypes","_pt","LocalizedPlaceholderInput","ref","placeholder","otherProps","_objectWithoutProperties","_excluded","intl","Object","assign","displayName","KeyCodes","Constants","submit","e","preventDefault","redirectUserToDefaultTeam","onKeyPress","isKeyPressed","ENTER","Confirm","useEffect","document","body","addEventListener","removeEventListener","onSubmit","type","Setup","constructor","props","super","_defineProperty","_this$input","_this$input$current","this","input","current","value","replace","_this$input2","_this$input2$current","length","setState","error","focus","actions","then","_this$input3","_this$input3$current","server_error_id","message","history","push","state","undefined","secret","qrCode","componentDidMount","user","currentUser","mfa_active","_ref2","data","serverError","qr_code","render","errorContent","mfaRequired","formClass","role","enforceMultifactorAuthentication","values","siteName","strong","chunks","alt","style","src","defineMessage","autoFocus","isRequired","updateParent","maxHeight","connect","config","getConfig","SiteName","EnforceMultifactorAuthentication","getCurrentUser","bindActionCreators","MFAController","emitUserLoggedOutEvent","enableMultifactorAuthentication","classList","add","getElementById","componentWillUnmount","remove","backButton","mfa","handleOnClick","LogoutIcon","logoImage","Switch","Route","path","concat","match","location","search","children","license","getLicense","MFA","EnableMultifactorAuthentication"],"sourceRoot":""}