{"version":3,"file":"9420.9f8cae9d874c3779f31a.js","mappings":"itBAwCe,MAAMA,UAAkBC,IAAAA,cAC5BC,WAAAA,CAAYC,GACfC,MAAMD,GAAOE,EAAA,oBAwBI,KACjB,MAAMC,EAAe,IAAIC,gBAAgBC,KAAKL,MAAMM,SAASC,QACvDC,EAAS,CACXC,aAAcN,EAAaO,IAAI,iBAC/BC,SAAUR,EAAaO,IAAI,aAC3BE,YAAaT,EAAaO,IAAI,gBAC9BG,MAAOV,EAAaO,IAAI,SACxBI,MAAOX,EAAaO,IAAI,SACxBK,SAAUZ,EAAaO,IAAI,YAC3BM,cAAeb,EAAaO,IAAI,kBAChCO,oBAAqBd,EAAaO,IAAI,0BAG1CL,KAAKL,MAAMkB,QAAQC,YAAYX,GAAQY,MACnCC,IAAmB,IAAlB,KAACC,EAAI,MAAEC,GAAMF,EACNC,GAAQA,EAAKE,SACbC,OAAOnB,SAASoB,KAAOJ,EAAKE,SACrBD,GACPlB,KAAKsB,SAAS,CAACJ,MAAOA,EAAMK,SAChC,GAEP,IACJ1B,EAAA,mBAEmB,KAChB,MAAMU,EAAe,IAAIR,gBAAgBC,KAAKL,MAAMM,SAASC,QAASG,IAAI,gBACtEE,IAAgBA,EAAYiB,WAAW,aAAejB,EAAYiB,WAAW,YAC7EJ,OAAOnB,SAASoB,KAAOd,EAAc,wBAIzCkB,EAAAA,EAAAA,KAAaC,QAAQ,SAAS,IArD9B1B,KAAKQ,MAAQ,CAAC,CAClB,CAEOmB,iBAAAA,GAEH,MAAMC,EAAUC,SAASC,eAAe,iBACpCF,GAAWA,EAAQG,YACnBH,EAAQG,WAAWC,YAAYJ,GAEnC,MAAMtB,EAAY,IAAIP,gBAAgBC,KAAKL,MAAMM,SAASC,QAASG,IAAI,aACnEC,IAAe,cAAe2B,KAAK3B,IAIvCN,KAAKL,MAAMkB,QAAQqB,gBAAgB5B,GAAUS,MACzCoB,IAAY,IAAX,KAAClB,GAAKkB,EACClB,GACAjB,KAAKsB,SAAS,CAACc,IAAKnB,GACxB,GAEZ,CAoCOoB,MAAAA,GACH,MAAMD,EAAMpC,KAAKQ,MAAM4B,IACvB,IAAKA,EACD,OAAO,KAGX,IAAIE,EAOApB,EASJ,OAdIoB,EADAF,EAAIG,SACGH,EAAIG,SAEJC,EAIPxC,KAAKQ,MAAMU,QACXA,EACIzB,IAAAA,cAAA,OAAKgD,UAAU,4BACXhD,IAAAA,cAACiD,EAAAA,GAAS,CAACxB,MAAOlB,KAAKQ,MAAMU,UAMrCzB,IAAAA,cAAA,OAAKgD,UAAU,mBACXhD,IAAAA,cAAA,OAAKgD,UAAU,UACXhD,IAAAA,cAAA,OAAKgD,UAAU,mBACXhD,IAAAA,cAAA,OAAKgD,UAAU,oBACXhD,IAAAA,cAAA,OACIkD,IAAK,cACLC,IAAKN,EACLO,MAAM,KACNC,OAAO,QAGfrD,IAAAA,cAAA,OAAKgD,UAAU,QACXhD,IAAAA,cAACsD,EAAAA,iBAAgB,CACbC,GAAG,yBACHC,eAAe,+EACfC,OAAQ,CACJC,QAASf,EAAIgB,KACbC,EAAIC,GAAW7D,IAAAA,cAAA,SAAI6D,QAKnC7D,IAAAA,cAAA,SACIA,IAAAA,cAACsD,EAAAA,iBAAgB,CACbC,GAAG,+BACHC,eAAe,+FACfC,OAAQ,CACJC,QAASf,EAAIgB,KACbC,EAAIC,GAAW7D,IAAAA,cAAA,SAAI6D,OAI/B7D,IAAAA,cAAA,MAAIgD,UAAU,iBACVhD,IAAAA,cAACsD,EAAAA,iBAAgB,CACbC,GAAG,wBACHC,eAAe,iCACfC,OAAQ,CACJC,QAASf,EAAIgB,KACbC,EAAIC,GAAW7D,IAAAA,cAAA,SAAI6D,OAI/B7D,IAAAA,cAAA,OAAKgD,UAAU,mBACXhD,IAAAA,cAAA,UACI8D,KAAK,SACLd,UAAU,iCACVe,QAASxD,KAAKyD,YAEdhE,IAAAA,cAACsD,EAAAA,iBAAgB,CACbC,GAAG,iBACHC,eAAe,UAGvBxD,IAAAA,cAAA,UACI8D,KAAK,SACLd,UAAU,gCACVe,QAASxD,KAAK0D,aAEdjE,IAAAA,cAACsD,EAAAA,iBAAgB,CACbC,GAAG,kBACHC,eAAe,YAI1B/B,GAIjB,EC3KJ,SAAeyC,EAAAA,EAAAA,SAAQ,MATvB,SAA4BC,GACxB,MAAO,CACH/C,SAASgD,EAAAA,EAAAA,IAAmB,CACxB3B,gBAAe,KACfpB,YAAWA,EAAAA,IACZ8C,GAEX,GAEA,CAAiDpE,E,oGCf1C,MACMsE,EAAiB,YAYxBC,EAAsC,GAEtCrB,EAA6B1B,IAO7B,IAP8B,MAChCE,EAAQ,KAAI,OACZ8C,EAASD,EAAgB,cACzBE,EAAa,OACbC,EAAM,cACNC,EAAa,KACbZ,GACHvC,EACG,IAAKE,GAA2B,IAAlB8C,EAAOI,OACjB,OAAO,KAIX,IAAI7C,EAAUL,EAEd,IAAKK,EACD,IAAK,MAAM8C,KAAOL,EACVK,IACA9C,EAAU8C,GAKtB,OAAK9C,EAtCiB,UA0ClBgC,EAEI9D,IAAAA,cAAA,OAAKgD,UAAU,cACXhD,IAAAA,cAAA,SAAOgD,UAAU,uBAAuBlB,IAKhDgC,IAASO,EAELrE,IAAAA,cAAA,OAAKgD,UAAU,uBACXhD,IAAAA,cAAA,SAAOgD,UAAU,iBAAiBlB,IAK1C2C,EAEIzE,IAAAA,cAAA,OAAKgD,UAAU,wBACXhD,IAAAA,cAAA,SAAOgD,UAAU,iBAAiBlB,IAM1C9B,IAAAA,cAAA,OAAKgD,UAAS,aAAA6B,OAAeH,GAAiB,cAC1C1E,IAAAA,cAAA,SAAOgD,UAAU,iBACbhD,IAAAA,cAAA,KACIgD,UAAS,MAAA6B,OAAQL,GAAiB,2BACnC,IACF1C,IAjCF,IAmCD,EAEZmB,EAAA6B,UAAA,CAvEEhB,KAAIiB,IAAAA,KACJtD,MAAKsD,IAAAA,KACLL,cAAaK,IAAAA,OACbP,cAAaO,IAAAA,OACbN,OAAMM,IAAAA,KACNR,OAAMQ,IAAAA,QAAAA,IAAAA,OAoEV,QAAe/E,IAAAA,KAAWiD,E","sources":["webpack://mattermost-webapp/./src/components/authorize/authorize.tsx","webpack://mattermost-webapp/./src/components/authorize/index.ts","webpack://mattermost-webapp/./src/components/form_error.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport type {ReactNode} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\n\r\nimport type {OAuthApp} from '@mattermost/types/integrations';\r\n\r\nimport type {ActionResult} from 'mattermost-redux/types/actions';\r\n\r\nimport FormError from 'components/form_error';\r\n\r\nimport icon50 from 'images/icon50x50.png';\r\nimport {getHistory} from 'utils/browser_history';\r\n\r\nexport type Params = {\r\n    responseType: string | null;\r\n    clientId: string | null;\r\n    redirectUri: string | null;\r\n    state: string | null;\r\n    scope: string | null;\r\n    resource: string | null;\r\n}\r\n\r\ntype Props = {\r\n    location: {\r\n        search: string;\r\n    };\r\n    actions: {\r\n        getOAuthAppInfo: (clientId: string | null) => Promise<ActionResult<OAuthApp>>;\r\n        allowOAuth2: (params: Params) => Promise<ActionResult<{redirect: string}>>;\r\n    };\r\n}\r\n\r\ntype State = {\r\n    app?: OAuthApp;\r\n    error?: string;\r\n}\r\n\r\nexport default class Authorize extends React.PureComponent<Props, State> {\r\n    public constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {};\r\n    }\r\n\r\n    public componentDidMount(): void {\r\n        // if we get to this point remove the antiClickjack blocker\r\n        const blocker = document.getElementById('antiClickjack');\r\n        if (blocker && blocker.parentNode) {\r\n            blocker.parentNode.removeChild(blocker);\r\n        }\r\n        const clientId = (new URLSearchParams(this.props.location.search)).get('client_id');\r\n        if (clientId && !((/^[a-z0-9]+$/).test(clientId))) {\r\n            return;\r\n        }\r\n\r\n        this.props.actions.getOAuthAppInfo(clientId).then(\r\n            ({data}) => {\r\n                if (data) {\r\n                    this.setState({app: data});\r\n                }\r\n            });\r\n    }\r\n\r\n    public handleAllow = (): void => {\r\n        const searchParams = new URLSearchParams(this.props.location.search);\r\n        const params = {\r\n            responseType: searchParams.get('response_type'),\r\n            clientId: searchParams.get('client_id'),\r\n            redirectUri: searchParams.get('redirect_uri'),\r\n            state: searchParams.get('state'),\r\n            scope: searchParams.get('scope'),\r\n            resource: searchParams.get('resource'),\r\n            codeChallenge: searchParams.get('code_challenge'),\r\n            codeChallengeMethod: searchParams.get('code_challenge_method'),\r\n        };\r\n\r\n        this.props.actions.allowOAuth2(params).then(\r\n            ({data, error}) => {\r\n                if (data && data.redirect) {\r\n                    window.location.href = data.redirect;\r\n                } else if (error) {\r\n                    this.setState({error: error.message});\r\n                }\r\n            },\r\n        );\r\n    };\r\n\r\n    public handleDeny = (): void => {\r\n        const redirectUri = (new URLSearchParams(this.props.location.search)).get('redirect_uri');\r\n        if (redirectUri && (redirectUri.startsWith('https://') || redirectUri.startsWith('http://'))) {\r\n            window.location.href = redirectUri + '?error=access_denied';\r\n            return;\r\n        }\r\n\r\n        getHistory().replace('/error');\r\n    };\r\n\r\n    public render(): ReactNode {\r\n        const app = this.state.app;\r\n        if (!app) {\r\n            return null;\r\n        }\r\n\r\n        let icon;\r\n        if (app.icon_url) {\r\n            icon = app.icon_url;\r\n        } else {\r\n            icon = icon50;\r\n        }\r\n\r\n        let error;\r\n        if (this.state.error) {\r\n            error = (\r\n                <div className='prompt__error form-group'>\r\n                    <FormError error={this.state.error}/>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div className='container-fluid'>\r\n                <div className='prompt'>\r\n                    <div className='prompt__heading'>\r\n                        <div className='prompt__app-icon'>\r\n                            <img\r\n                                alt={'prompt icon'}\r\n                                src={icon}\r\n                                width='50'\r\n                                height='50'\r\n                            />\r\n                        </div>\r\n                        <div className='text'>\r\n                            <FormattedMessage\r\n                                id='authorize.connectTitle'\r\n                                defaultMessage='Authorize <b>{appName}</b> to Connect to Your <b>Mattermost</b> User Account'\r\n                                values={{\r\n                                    appName: app.name,\r\n                                    b: (chunks) => <b>{chunks}</b>,\r\n                                }}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <p>\r\n                        <FormattedMessage\r\n                            id='authorize.modificationAccess'\r\n                            defaultMessage='The app <b>{appName}</b> would like the ability to access and modify your basic information.'\r\n                            values={{\r\n                                appName: app.name,\r\n                                b: (chunks) => <b>{chunks}</b>,\r\n                            }}\r\n                        />\r\n                    </p>\r\n                    <h2 className='prompt__allow'>\r\n                        <FormattedMessage\r\n                            id='authorize.allowAccess'\r\n                            defaultMessage='Allow <b>{appName}</b> access?'\r\n                            values={{\r\n                                appName: app.name,\r\n                                b: (chunks) => <b>{chunks}</b>,\r\n                            }}\r\n                        />\r\n                    </h2>\r\n                    <div className='prompt__buttons'>\r\n                        <button\r\n                            type='submit'\r\n                            className='btn btn-tertiary authorize-btn'\r\n                            onClick={this.handleDeny}\r\n                        >\r\n                            <FormattedMessage\r\n                                id='authorize.deny'\r\n                                defaultMessage='Deny'\r\n                            />\r\n                        </button>\r\n                        <button\r\n                            type='submit'\r\n                            className='btn btn-primary authorize-btn'\r\n                            onClick={this.handleAllow}\r\n                        >\r\n                            <FormattedMessage\r\n                                id='authorize.allow'\r\n                                defaultMessage='Allow'\r\n                            />\r\n                        </button>\r\n                    </div>\r\n                    {error}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {connect} from 'react-redux';\r\nimport {bindActionCreators} from 'redux';\r\nimport type {Dispatch} from 'redux';\r\n\r\nimport {allowOAuth2, getOAuthAppInfo} from 'actions/admin_actions.jsx';\r\n\r\nimport Authorize from './authorize';\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch) {\r\n    return {\r\n        actions: bindActionCreators({\r\n            getOAuthAppInfo,\r\n            allowOAuth2,\r\n        }, dispatch),\r\n    };\r\n}\r\n\r\nexport default connect(null, mapDispatchToProps)(Authorize);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\n\r\nexport const TYPE_MODAL = 'modal';\r\nexport const TYPE_BACKSTAGE = 'backstage';\r\n\r\n// accepts either a single error or an array of errors\r\ntype Props = {\r\n    type?: React.ReactNode;\r\n    error?: React.ReactNode;\r\n    textClassName?: string;\r\n    iconClassName?: string;\r\n    margin?: boolean;\r\n    errors?: React.ReactNode[];\r\n};\r\n\r\nconst EMPTY_ERROR_LIST: React.ReactNode[] = [];\r\n\r\nconst FormError: React.FC<Props> = ({\r\n    error = null,\r\n    errors = EMPTY_ERROR_LIST,\r\n    iconClassName,\r\n    margin,\r\n    textClassName,\r\n    type,\r\n}) => {\r\n    if (!error && errors.length === 0) {\r\n        return null;\r\n    }\r\n\r\n    // look for the first truthy error to display\r\n    let message = error;\r\n\r\n    if (!message) {\r\n        for (const err of errors) {\r\n            if (err) {\r\n                message = err;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!message) {\r\n        return null;\r\n    }\r\n\r\n    if (type === TYPE_MODAL) {\r\n        return (\r\n            <div className='form-group'>\r\n                <label className='col-sm-12 has-error'>{message}</label>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (type === TYPE_BACKSTAGE) {\r\n        return (\r\n            <div className='pull-left has-error'>\r\n                <label className='control-label'>{message}</label>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (margin) {\r\n        return (\r\n            <div className='form-group has-error'>\r\n                <label className='control-label'>{message}</label>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={`col-sm-12 ${textClassName || 'has-error'}`}>\r\n            <label className='control-label'>\r\n                <i\r\n                    className={`fa ${iconClassName || 'fa-exclamation-circle'}`}\r\n                />{' '}\r\n                {message}\r\n            </label>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default React.memo(FormError);\r\n"],"names":["Authorize","React","constructor","props","super","_defineProperty","searchParams","URLSearchParams","this","location","search","params","responseType","get","clientId","redirectUri","state","scope","resource","codeChallenge","codeChallengeMethod","actions","allowOAuth2","then","_ref","data","error","redirect","window","href","setState","message","startsWith","getHistory","replace","componentDidMount","blocker","document","getElementById","parentNode","removeChild","test","getOAuthAppInfo","_ref2","app","render","icon","icon_url","icon50","className","FormError","alt","src","width","height","FormattedMessage","id","defaultMessage","values","appName","name","b","chunks","type","onClick","handleDeny","handleAllow","connect","dispatch","bindActionCreators","TYPE_BACKSTAGE","EMPTY_ERROR_LIST","errors","iconClassName","margin","textClassName","length","err","concat","propTypes","_pt"],"sourceRoot":""}