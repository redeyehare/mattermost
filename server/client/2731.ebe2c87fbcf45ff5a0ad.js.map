{"version":3,"file":"2731.ebe2c87fbcf45ff5a0ad.js","mappings":"wVA4BA,MAGMA,EAAYC,IAAAA,IAAUC,WAAA,CAAAC,YAAA,aAAVF,CAAU,iDA8I5B,EAxIA,WAAiC,IAAAG,EAC7B,MAAOC,EAAMC,IAAWC,EAAAA,EAAAA,WAAS,IAC3B,cAACC,EAAa,aAAEC,IAAgBC,EAAAA,EAAAA,WAChCC,GAAWC,EAAAA,EAAAA,eAEXC,GAAQC,EAAAA,EAAAA,MACPC,IAAeC,EAAAA,EAAAA,MAChB,iBAACC,EAAgB,YAAEC,IAAeC,EAAAA,EAAAA,KAElCC,GAAOC,EAAAA,EAAAA,aAAYC,EAAAA,IACnBC,GAAUF,EAAAA,EAAAA,aAAYG,EAAAA,IACtBC,GAAUJ,EAAAA,EAAAA,aAAYK,EAAAA,IACtBC,GAAUN,EAAAA,EAAAA,aAAYO,EAAAA,IACtBC,GAAYF,aAAO,EAAPA,EAASG,OAAQC,EAAAA,GAAcC,QAE3CC,GAAsBZ,EAAAA,EAAAA,cAAaa,IAAuBC,EAAAA,EAAAA,IAAiBD,EAAOE,EAAAA,GAAYC,0BAA2B,8BAE/H,IAAIC,GAAkB,EACtB,GAA4B,KAAxBL,EAA4B,CAC5B,MAAMM,EAAaC,KAAKC,MAAMR,GAE9BK,EADiBI,KAAKC,MAAQJ,EAAWK,qBA5BjBC,KA8B5B,CAEA,IAAKxC,EACD,OAAO,KAGX,IAAKiC,EACD,OAAO,KAGX,IAAKb,IAAYI,EACb,OAAO,KAGX,MAAMiB,EAAmB/B,SAAkB,QAAPX,EAAXW,EAAagC,aAAK,IAAA3C,OAAP,EAAXA,EAAoB4C,cACvCC,EAA0BpC,EAAMkC,MAAMG,aAC5C,QAA0BC,IAArBL,KAAqCG,EAA0BH,GAChE,OAAO,KAGX,MAiBMM,EACFC,IAAAA,cAACC,EAAAA,iBAAgB,CACbC,GAAI,oDACJC,eAAgB,qDAChBC,OAAQ,CACJC,WAAWC,EAAAA,EAAAA,IAAWb,EAAkBrC,MAK9CmD,EAAe1C,EAEbmC,IAAAA,cAACC,EAAAA,iBAAgB,CACbC,GAAI,+DACJC,eAAgB,wGAIpBH,IAAAA,cAACC,EAAAA,iBAAgB,CACbC,GAAI,qDACJC,eAAgB,uIAChBC,OAAQ,CACJI,EAAIC,GAEIT,IAAAA,cAAA,KACIU,QACKC,IACGA,EAAEC,iBACFhD,GAAkB,GAG5B6C,MAOpBI,EAAkBhD,EAEhBmC,IAAAA,cAACC,EAAAA,iBAAgB,CACbC,GAAI,mEACJC,eAAgB,gGAIpBH,IAAAA,cAACC,EAAAA,iBAAgB,CACbC,GAAI,yDACJC,eAAgB,8HAChBC,OAAQ,CACJI,EAAIC,GACAT,IAAAA,cAACc,EAAAA,EAAc,CACXC,QAASN,EACTO,kBAAmB,CACfC,cAAeC,EAAAA,GAAYC,aAC3BC,iBAAkBC,EAAAA,GAAmBC,uBACrCC,oBAAoB,QAOhD,OACIvB,IAAAA,cAACrD,EAAS,CAACuD,GAAG,2BACVF,IAAAA,cAACwB,EAAAA,EAAW,CACRC,KAAM,UACNC,QAAS,MACTC,UArFSC,KACjB,MAAMC,EAAuD,CACzDtC,oBAAqBF,KAAKC,OAG9BhC,GAASwE,EAAAA,EAAAA,IAAgB/D,EAAKmC,GAAI,CAC9B,CACI6B,SAAUhD,EAAAA,GAAYC,0BACtBgD,KAAM,2BACNC,QAASlE,EAAKmC,GACdgC,MAAO/C,KAAKgD,UAAUN,OAI9B5E,GAAQ,EAAM,EAwENmF,gBAAiBjF,EAAc,CAAC+C,GAAI,sDAAuDC,eAAgB,gCAAiC,CAACkC,WAzInI,KA0IVtC,MAAOA,EACPuC,QAASpE,EAAUqC,EAAeM,IAIlD,C","sources":["webpack://mattermost-webapp/./src/components/file_limit_sticky_banner/index.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useState} from 'react';\r\nimport {FormattedMessage, useIntl} from 'react-intl';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\nimport styled from 'styled-components';\r\n\r\nimport {savePreferences} from 'mattermost-redux/actions/preferences';\r\nimport {isCurrentLicenseCloud, getSubscriptionProduct as selectSubscriptionProduct} from 'mattermost-redux/selectors/entities/cloud';\r\nimport {get as selectPreference} from 'mattermost-redux/selectors/entities/preferences';\r\nimport {getCurrentUser, isCurrentUserSystemAdmin} from 'mattermost-redux/selectors/entities/users';\r\n\r\nimport AlertBanner from 'components/alert_banner';\r\nimport useGetLimits from 'components/common/hooks/useGetLimits';\r\nimport useGetUsage from 'components/common/hooks/useGetUsage';\r\nimport useOpenPricingModal from 'components/common/hooks/useOpenPricingModal';\r\nimport NotifyAdminCTA from 'components/notify_admin_cta/notify_admin_cta';\r\n\r\nimport {CloudProducts, LicenseSkus, MattermostFeatures, Preferences} from 'utils/constants';\r\nimport {asGBString} from 'utils/limits';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\ninterface FileLimitSnoozePreference {\r\n    lastSnoozeTimestamp: number;\r\n}\r\n\r\nconst snoozeCoolOffDays = 10;\r\nconst snoozeCoolOffDaysMillis = snoozeCoolOffDays * 24 * 60 * 60 * 1000;\r\n\r\nconst StyledDiv = styled.div`\r\nwidth: 100%;\r\npadding: 0 24px;\r\nmargin: 12px auto;\r\n`;\r\n\r\nfunction FileLimitStickyBanner() {\r\n    const [show, setShow] = useState(true);\r\n    const {formatMessage, formatNumber} = useIntl();\r\n    const dispatch = useDispatch();\r\n\r\n    const usage = useGetUsage();\r\n    const [cloudLimits] = useGetLimits();\r\n    const {openPricingModal, isAirGapped} = useOpenPricingModal();\r\n\r\n    const user = useSelector(getCurrentUser);\r\n    const isAdmin = useSelector(isCurrentUserSystemAdmin);\r\n    const isCloud = useSelector(isCurrentLicenseCloud);\r\n    const product = useSelector(selectSubscriptionProduct);\r\n    const isStarter = product?.sku === CloudProducts.STARTER;\r\n\r\n    const snoozePreferenceVal = useSelector((state: GlobalState) => selectPreference(state, Preferences.CLOUD_USER_EPHEMERAL_INFO, 'file_limit_banner_snooze'));\r\n\r\n    let shouldShowAgain = true;\r\n    if (snoozePreferenceVal !== '') {\r\n        const snoozeInfo = JSON.parse(snoozePreferenceVal) as FileLimitSnoozePreference;\r\n        const timeDiff = Date.now() - snoozeInfo.lastSnoozeTimestamp;\r\n        shouldShowAgain = timeDiff >= snoozeCoolOffDaysMillis;\r\n    }\r\n\r\n    if (!show) {\r\n        return null;\r\n    }\r\n\r\n    if (!shouldShowAgain) {\r\n        return null;\r\n    }\r\n\r\n    if (!isCloud || !isStarter) {\r\n        return null;\r\n    }\r\n\r\n    const fileStorageLimit = cloudLimits?.files?.total_storage;\r\n    const currentFileStorageUsage = usage.files.totalStorage;\r\n    if ((fileStorageLimit === undefined) || !(currentFileStorageUsage > fileStorageLimit)) {\r\n        return null;\r\n    }\r\n\r\n    const snoozeBanner = () => {\r\n        const fileLimitBannerSnoozeInfo: FileLimitSnoozePreference = {\r\n            lastSnoozeTimestamp: Date.now(),\r\n        };\r\n\r\n        dispatch(savePreferences(user.id, [\r\n            {\r\n                category: Preferences.CLOUD_USER_EPHEMERAL_INFO,\r\n                name: 'file_limit_banner_snooze',\r\n                user_id: user.id,\r\n                value: JSON.stringify(fileLimitBannerSnoozeInfo),\r\n            },\r\n        ]));\r\n\r\n        setShow(false);\r\n    };\r\n\r\n    const title = (\r\n        <FormattedMessage\r\n            id={'create_post.file_limit_sticky_banner.messageTitle'}\r\n            defaultMessage={'Your free plan is limited to {storageGB} of files.'}\r\n            values={{\r\n                storageGB: asGBString(fileStorageLimit, formatNumber),\r\n            }}\r\n        />\r\n    );\r\n\r\n    const adminMessage = isAirGapped ?\r\n        (\r\n            <FormattedMessage\r\n                id={'create_post.file_limit_sticky_banner.admin_message_airgapped'}\r\n                defaultMessage={'New uploads will automatically archive older files. To view them again, you can delete older files.'}\r\n            />\r\n        ) :\r\n        (\r\n            <FormattedMessage\r\n                id={'create_post.file_limit_sticky_banner.admin_message'}\r\n                defaultMessage={'New uploads will automatically archive older files. To view them again, you can delete older files or <a>upgrade to a paid plan.</a>'}\r\n                values={{\r\n                    a: (chunks: React.ReactNode) => {\r\n                        return (\r\n                            <a\r\n                                onClick={\r\n                                    (e) => {\r\n                                        e.preventDefault();\r\n                                        openPricingModal();\r\n                                    }\r\n                                }\r\n                            >{chunks}</a>\r\n                        );\r\n                    },\r\n                }}\r\n            />\r\n        );\r\n\r\n    const nonAdminMessage = isAirGapped ?\r\n        (\r\n            <FormattedMessage\r\n                id={'create_post.file_limit_sticky_banner.non_admin_message_airgapped'}\r\n                defaultMessage={'New uploads will automatically archive older files. To view them again, contact your admin.'}\r\n            />\r\n        ) :\r\n        (\r\n            <FormattedMessage\r\n                id={'create_post.file_limit_sticky_banner.non_admin_message'}\r\n                defaultMessage={'New uploads will automatically archive older files. To view them again, <a>notify your admin to upgrade to a paid plan.</a>'}\r\n                values={{\r\n                    a: (chunks: React.ReactNode) => (\r\n                        <NotifyAdminCTA\r\n                            ctaText={chunks}\r\n                            notifyRequestData={{\r\n                                required_plan: LicenseSkus.Professional,\r\n                                required_feature: MattermostFeatures.UNLIMITED_FILE_STORAGE,\r\n                                trial_notification: false,\r\n                            }}\r\n                        />),\r\n                }}\r\n            />\r\n        );\r\n\r\n    return (\r\n        <StyledDiv id='cloud_file_limit_banner'>\r\n            <AlertBanner\r\n                mode={'warning'}\r\n                variant={'app'}\r\n                onDismiss={snoozeBanner}\r\n                closeBtnTooltip={formatMessage({id: 'create_post.file_limit_sticky_banner.snooze_tooltip', defaultMessage: 'Snooze for {snoozeDays} days'}, {snoozeDays: snoozeCoolOffDays})}\r\n                title={title}\r\n                message={isAdmin ? adminMessage : nonAdminMessage}\r\n            />\r\n        </StyledDiv>\r\n    );\r\n}\r\n\r\nexport default FileLimitStickyBanner;\r\n"],"names":["StyledDiv","styled","withConfig","displayName","_cloudLimits$files","show","setShow","useState","formatMessage","formatNumber","useIntl","dispatch","useDispatch","usage","useGetUsage","cloudLimits","useGetLimits","openPricingModal","isAirGapped","useOpenPricingModal","user","useSelector","getCurrentUser","isAdmin","isCurrentUserSystemAdmin","isCloud","isCurrentLicenseCloud","product","selectSubscriptionProduct","isStarter","sku","CloudProducts","STARTER","snoozePreferenceVal","state","selectPreference","Preferences","CLOUD_USER_EPHEMERAL_INFO","shouldShowAgain","snoozeInfo","JSON","parse","Date","now","lastSnoozeTimestamp","snoozeCoolOffDays","fileStorageLimit","files","total_storage","currentFileStorageUsage","totalStorage","undefined","title","React","FormattedMessage","id","defaultMessage","values","storageGB","asGBString","adminMessage","a","chunks","onClick","e","preventDefault","nonAdminMessage","NotifyAdminCTA","ctaText","notifyRequestData","required_plan","LicenseSkus","Professional","required_feature","MattermostFeatures","UNLIMITED_FILE_STORAGE","trial_notification","AlertBanner","mode","variant","onDismiss","snoozeBanner","fileLimitBannerSnoozeInfo","savePreferences","category","name","user_id","value","stringify","closeBtnTooltip","snoozeDays","message"],"sourceRoot":""}