{"version":3,"file":"4414.451923b40db6e91aea11.js","mappings":"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","sources":["webpack://mattermost-webapp/./src/components/terms_of_service/terms_of_service.tsx","webpack://mattermost-webapp/./src/components/terms_of_service/index.ts","webpack://mattermost-webapp/./src/components/widgets/icons/fa_logout_icon.tsx","webpack://mattermost-webapp/./src/components/widgets/icons/fa_warning_icon.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {Button} from 'react-bootstrap';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport type {RouteComponentProps} from 'react-router';\r\n\r\nimport type {TermsOfService as ReduxTermsOfService} from '@mattermost/types/terms_of_service';\r\n\r\nimport type {ActionResult} from 'mattermost-redux/types/actions';\r\nimport {memoizeResult} from 'mattermost-redux/utils/helpers';\r\n\r\nimport * as GlobalActions from 'actions/global_actions';\r\n\r\nimport AnnouncementBar from 'components/announcement_bar';\r\nimport LoadingScreen from 'components/loading_screen';\r\nimport LogoutIcon from 'components/widgets/icons/fa_logout_icon';\r\nimport WarningIcon from 'components/widgets/icons/fa_warning_icon';\r\nimport LoadingSpinner from 'components/widgets/loading/loading_spinner';\r\n\r\nimport {getHistory} from 'utils/browser_history';\r\nimport {Constants} from 'utils/constants';\r\nimport type EmojiMap from 'utils/emoji_map';\r\nimport messageHtmlToComponent from 'utils/message_html_to_component';\r\nimport {formatText} from 'utils/text_formatting';\r\n\r\nexport interface UpdateMyTermsOfServiceStatusResponse {\r\n    terms_of_service_create_at: number;\r\n    terms_of_service_id: string;\r\n    user_id: number;\r\n}\r\n\r\nexport interface TermsOfServiceProps extends RouteComponentProps {\r\n    termsEnabled: boolean;\r\n    actions: {\r\n        getTermsOfService: () => Promise<ActionResult<ReduxTermsOfService>>;\r\n        updateMyTermsOfServiceStatus: (\r\n            termsOfServiceId: string,\r\n            accepted: boolean\r\n        ) => Promise<ActionResult>;\r\n    };\r\n    emojiMap: EmojiMap;\r\n    onboardingFlowEnabled: boolean;\r\n}\r\n\r\ninterface TermsOfServiceState {\r\n    customTermsOfServiceId: string;\r\n    customTermsOfServiceText: string;\r\n    loading: boolean;\r\n    loadingAgree: boolean;\r\n    loadingDisagree: boolean;\r\n    serverError: React.ReactNode;\r\n}\r\n\r\nexport default class TermsOfService extends React.PureComponent<TermsOfServiceProps, TermsOfServiceState> {\r\n    formattedText: (text: string) => string;\r\n\r\n    constructor(props: TermsOfServiceProps) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            customTermsOfServiceId: '',\r\n            customTermsOfServiceText: '',\r\n            loading: true,\r\n            loadingAgree: false,\r\n            loadingDisagree: false,\r\n            serverError: null,\r\n        };\r\n\r\n        this.formattedText = memoizeResult((text: string) => formatText(text, {}, props.emojiMap));\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        if (this.props.termsEnabled) {\r\n            this.getTermsOfService();\r\n        } else {\r\n            GlobalActions.redirectUserToDefaultTeam();\r\n        }\r\n    }\r\n\r\n    getTermsOfService = async (): Promise<void> => {\r\n        this.setState({\r\n            customTermsOfServiceId: '',\r\n            customTermsOfServiceText: '',\r\n            loading: true,\r\n        });\r\n        const {data} = await this.props.actions.getTermsOfService();\r\n        if (data) {\r\n            this.setState({\r\n                customTermsOfServiceId: data.id,\r\n                customTermsOfServiceText: data.text,\r\n                loading: false,\r\n            });\r\n        } else {\r\n            GlobalActions.emitUserLoggedOutEvent(`/login?extra=${Constants.GET_TERMS_ERROR}`);\r\n        }\r\n    };\r\n\r\n    handleLogoutClick = (e: React.MouseEvent<HTMLAnchorElement, MouseEvent>): void => {\r\n        e.preventDefault();\r\n        GlobalActions.emitUserLoggedOutEvent('/login');\r\n    };\r\n\r\n    handleAcceptTerms = (): void => {\r\n        this.setState({\r\n            loadingAgree: true,\r\n            serverError: null,\r\n        });\r\n        this.registerUserAction(\r\n            true,\r\n            () => {\r\n                const query = new URLSearchParams(this.props.location?.search);\r\n                const redirectTo = query.get('redirect_to');\r\n                if (redirectTo && redirectTo.match(/^\\/([^/]|$)/)) {\r\n                    getHistory().push(redirectTo);\r\n                } else if (this.props.onboardingFlowEnabled) {\r\n                    // need info about whether admin or not,\r\n                    // and whether admin has already completed\r\n                    // first time onboarding. Instead of fetching and orchestrating that here,\r\n                    // let the default root component handle it.\r\n                    getHistory().push('/');\r\n                } else {\r\n                    GlobalActions.redirectUserToDefaultTeam();\r\n                }\r\n            },\r\n        );\r\n    };\r\n\r\n    handleRejectTerms = (): void => {\r\n        this.setState({\r\n            loadingDisagree: true,\r\n            serverError: null,\r\n        });\r\n        this.registerUserAction(\r\n            false,\r\n            () => {\r\n                GlobalActions.emitUserLoggedOutEvent(`/login?extra=${Constants.TERMS_REJECTED}`);\r\n            },\r\n        );\r\n    };\r\n\r\n    registerUserAction = async (accepted: boolean, success: (data: UpdateMyTermsOfServiceStatusResponse) => void): Promise<void> => {\r\n        const {data} = await this.props.actions.updateMyTermsOfServiceStatus(this.state.customTermsOfServiceId, accepted);\r\n        if (data) {\r\n            success(data);\r\n        } else {\r\n            this.setState({\r\n                loadingAgree: false,\r\n                loadingDisagree: false,\r\n                serverError: (\r\n                    <FormattedMessage\r\n                        id='terms_of_service.api_error'\r\n                        defaultMessage='Unable to complete the request. If this issue persists, contact your System Administrator.'\r\n                    />\r\n                ),\r\n            });\r\n        }\r\n    };\r\n\r\n    render(): JSX.Element {\r\n        if (this.state.loading) {\r\n            return <LoadingScreen/>;\r\n        }\r\n\r\n        let termsMarkdownClasses = 'terms-of-service__markdown';\r\n        if (this.state.serverError) {\r\n            termsMarkdownClasses += ' terms-of-service-error__height--fill';\r\n        } else {\r\n            termsMarkdownClasses += ' terms-of-service__height--fill';\r\n        }\r\n        return (\r\n            <div className='signup-page-container'>\r\n                <AnnouncementBar/>\r\n                <div className='signup-header'>\r\n                    <a\r\n                        href='#'\r\n                        onClick={this.handleLogoutClick}\r\n                    >\r\n                        <LogoutIcon/>\r\n                        <FormattedMessage\r\n                            id='web.header.logout'\r\n                            defaultMessage='Logout'\r\n                        />\r\n                    </a>\r\n                </div>\r\n                <div className='signup-team__container terms-of-service__container'>\r\n                    <div className={termsMarkdownClasses}>\r\n                        <div\r\n                            className='medium-center'\r\n                            data-testid='termsOfService'\r\n                        >\r\n                            {messageHtmlToComponent(this.formattedText(this.state.customTermsOfServiceText), {mentions: false})}\r\n                        </div>\r\n                    </div>\r\n                    <div className='terms-of-service__footer medium-center'>\r\n                        <div className='terms-of-service__button-group'>\r\n                            <Button\r\n                                bsStyle={'primary'}\r\n                                disabled={this.state.loadingAgree || this.state.loadingDisagree}\r\n                                id='acceptTerms'\r\n                                onClick={this.handleAcceptTerms}\r\n                                type='submit'\r\n                            >\r\n                                {this.state.loadingAgree && <LoadingSpinner/>}\r\n                                <FormattedMessage\r\n                                    id='terms_of_service.agreeButton'\r\n                                    defaultMessage={'I Agree'}\r\n                                />\r\n                            </Button>\r\n                            <Button\r\n                                bsStyle={'default'}\r\n                                className='btn-quaternary'\r\n                                disabled={this.state.loadingAgree || this.state.loadingDisagree}\r\n                                id='rejectTerms'\r\n                                onClick={this.handleRejectTerms}\r\n                                type='reset'\r\n                            >\r\n                                {this.state.loadingDisagree && <LoadingSpinner/>}\r\n                                <FormattedMessage\r\n                                    id='terms_of_service.disagreeButton'\r\n                                    defaultMessage={'I Disagree'}\r\n                                />\r\n                            </Button>\r\n                        </div>\r\n                        {Boolean(this.state.serverError) && (\r\n                            <div className='terms-of-service__server-error alert alert-warning'>\r\n                                <WarningIcon/>\r\n                                {' '}\r\n                                {this.state.serverError}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {connect} from 'react-redux';\r\nimport {bindActionCreators} from 'redux';\r\nimport type {Dispatch} from 'redux';\r\n\r\nimport type {GlobalState} from '@mattermost/types/store';\r\n\r\nimport {getTermsOfService, updateMyTermsOfServiceStatus} from 'mattermost-redux/actions/users';\r\nimport {getConfig} from 'mattermost-redux/selectors/entities/general';\r\nimport {getIsOnboardingFlowEnabled} from 'mattermost-redux/selectors/entities/preferences';\r\n\r\nimport {getEmojiMap} from 'selectors/emojis';\r\n\r\nimport TermsOfService from './terms_of_service';\r\n\r\nfunction mapStateToProps(state: GlobalState) {\r\n    const config = getConfig(state);\r\n    const onboardingFlowEnabled = getIsOnboardingFlowEnabled(state);\r\n    return {\r\n        onboardingFlowEnabled,\r\n        termsEnabled: config.EnableCustomTermsOfService === 'true',\r\n        emojiMap: getEmojiMap(state),\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: Dispatch) {\r\n    return {\r\n        actions: bindActionCreators({\r\n            getTermsOfService,\r\n            updateMyTermsOfServiceStatus,\r\n        }, dispatch),\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TermsOfService);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {useIntl} from 'react-intl';\r\n\r\nexport default function LogoutIcon() {\r\n    const {formatMessage} = useIntl();\r\n    return (\r\n        <i\r\n            className='fa fa-1x fa-angle-left'\r\n            title={formatMessage({id: 'generic_icons.logout', defaultMessage: 'Logout Icon'})}\r\n        />\r\n    );\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport classNames from 'classnames';\r\nimport React from 'react';\r\nimport {useIntl} from 'react-intl';\r\n\r\ntype Props = {\r\n    additionalClassName?: string;\r\n}\r\n\r\nconst WarningIcon = ({additionalClassName}: Props) => {\r\n    const {formatMessage} = useIntl();\r\n    return (\r\n        <i\r\n            className={classNames('fa fa-warning', additionalClassName)}\r\n            title={formatMessage({id: 'generic_icons.warning', defaultMessage: 'Warning Icon'})}\r\n        />\r\n    );\r\n};\r\n\r\nexport default React.memo(WarningIcon);\r\n"],"names":["TermsOfService","React","constructor","props","super","_defineProperty","async","this","setState","customTermsOfServiceId","customTermsOfServiceText","loading","data","actions","getTermsOfService","id","text","GlobalActions","concat","Constants","GET_TERMS_ERROR","e","preventDefault","loadingAgree","serverError","registerUserAction","_this$props$location","redirectTo","URLSearchParams","location","search","get","match","getHistory","push","onboardingFlowEnabled","loadingDisagree","TERMS_REJECTED","accepted","success","updateMyTermsOfServiceStatus","state","FormattedMessage","defaultMessage","formattedText","memoizeResult","formatText","emojiMap","componentDidMount","termsEnabled","render","LoadingScreen","termsMarkdownClasses","className","AnnouncementBar","href","onClick","handleLogoutClick","LogoutIcon","messageHtmlToComponent","mentions","Button","bsStyle","disabled","handleAcceptTerms","type","LoadingSpinner","handleRejectTerms","Boolean","WarningIcon","_pt","isRequired","connect","config","getConfig","getIsOnboardingFlowEnabled","EnableCustomTermsOfService","getEmojiMap","dispatch","bindActionCreators","formatMessage","useIntl","title","_ref","additionalClassName","classNames","propTypes"],"sourceRoot":""}