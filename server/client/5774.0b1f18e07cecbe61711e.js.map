{"version":3,"file":"5774.0b1f18e07cecbe61711e.js","mappings":"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","sources":["webpack://mattermost-webapp/./src/actions/views/admin.ts","webpack://mattermost-webapp/./src/components/cloud_effects/admin_cloud_effects.ts","webpack://mattermost-webapp/./src/components/common/hooks/useShowAdminLimitReached.ts","webpack://mattermost-webapp/./src/components/common/hooks/usePreference.ts","webpack://mattermost-webapp/./src/components/cloud_effects/index.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport type {ServerError} from '@mattermost/types/errors';\r\nimport type {UserReportOptions, UserReport, UserReportFilter} from '@mattermost/types/reports';\r\n\r\nimport {logError} from 'mattermost-redux/actions/errors';\r\nimport {forceLogoutIfNecessary} from 'mattermost-redux/actions/helpers';\r\nimport {Client4} from 'mattermost-redux/client';\r\n\r\nimport {ActionTypes} from 'utils/constants';\r\n\r\nimport type {ActionFuncAsync} from 'types/store';\r\nimport type {AdminConsoleUserManagementTableProperties} from 'types/store/views';\r\n\r\nexport function setNeedsLoggedInLimitReachedCheck(data: boolean) {\r\n    return {\r\n        type: ActionTypes.NEEDS_LOGGED_IN_LIMIT_REACHED_CHECK,\r\n        data,\r\n    };\r\n}\r\n\r\n/**\r\n * Action to set the properties of the admin console user management table. Only pass the properties you want to set/modify. If you pass no properties, the table properties will be cleared.\r\n */\r\nexport function setAdminConsoleUsersManagementTableProperties(data?: Partial<AdminConsoleUserManagementTableProperties>) {\r\n    if (!data) {\r\n        return {\r\n            type: ActionTypes.CLEAR_ADMIN_CONSOLE_USER_MANAGEMENT_TABLE_PROPERTIES,\r\n            data: null,\r\n        };\r\n    }\r\n\r\n    return {\r\n        type: ActionTypes.SET_ADMIN_CONSOLE_USER_MANAGEMENT_TABLE_PROPERTIES,\r\n        data,\r\n    };\r\n}\r\n\r\nexport function getUserReports(options = {} as UserReportOptions): ActionFuncAsync<UserReport[]> {\r\n    return async (dispatch, getState) => {\r\n        let data;\r\n        try {\r\n            data = await Client4.getUsersForReporting(options);\r\n        } catch (error) {\r\n            forceLogoutIfNecessary(error, dispatch, getState);\r\n            dispatch(logError(error));\r\n            return {error: error as ServerError};\r\n        }\r\n\r\n        return {data};\r\n    };\r\n}\r\n\r\nexport function getUserCountForReporting(filter = {} as UserReportFilter): ActionFuncAsync<number> {\r\n    return async (dispatch, getState) => {\r\n        let data;\r\n        try {\r\n            data = await Client4.getUserCountForReporting(filter);\r\n        } catch (error) {\r\n            forceLogoutIfNecessary(error, dispatch, getState);\r\n            dispatch(logError(error));\r\n            return {error: error as ServerError};\r\n        }\r\n\r\n        return {data};\r\n    };\r\n}\r\n\r\nexport function startUsersBatchExport(tableFilters = {} as UserReportOptions): ActionFuncAsync {\r\n    return async (dispatch, getState) => {\r\n        try {\r\n            await Client4.startUsersBatchExport(tableFilters);\r\n        } catch (error) {\r\n            forceLogoutIfNecessary(error, dispatch, getState);\r\n            dispatch(logError(error));\r\n            return {error: error as ServerError};\r\n        }\r\n\r\n        return {data: true};\r\n    };\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport useShowAdminLimitReached from 'components/common/hooks/useShowAdminLimitReached';\r\n\r\nexport default function AdminCloudEffects() {\r\n    useShowAdminLimitReached();\r\n\r\n    return null;\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\n// import React from 'react';\r\nimport {defineMessage, useIntl} from 'react-intl';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\n\r\nimport {setNeedsLoggedInLimitReachedCheck} from 'actions/views/admin';\r\nimport {closeModal, openModal} from 'actions/views/modals';\r\nimport {getNeedsLoggedInLimitReachedCheck} from 'selectors/views/admin';\r\n\r\nimport CloudUsageModal from 'components/cloud_usage_modal';\r\nimport useOpenPricingModal from 'components/common/hooks/useOpenPricingModal';\r\n\r\nimport {ModalIdentifiers, Preferences} from 'utils/constants';\r\n\r\nimport useGetLimits from './useGetLimits';\r\nimport useGetUsage from './useGetUsage';\r\nimport usePreference from './usePreference';\r\n\r\n// intended to only be run for admins of cloud instances.\r\nexport default function useShowAdminLimitReached() {\r\n    const usage = useGetUsage();\r\n    const dispatch = useDispatch();\r\n    const intl = useIntl();\r\n    const [limits, limitsLoaded] = useGetLimits();\r\n    const needsLoggedInLimitReachedCheck = useSelector(getNeedsLoggedInLimitReachedCheck);\r\n    const messageLimit = limits?.messages?.history;\r\n    const [shownLimitsReachedOnLogin, setShownLimitsReachedOnLogin] = usePreference(\r\n        Preferences.CATEGORY_CLOUD_LIMITS,\r\n        Preferences.SHOWN_LIMITS_REACHED_ON_LOGIN,\r\n    );\r\n    const {openPricingModal, isAirGapped} = useOpenPricingModal();\r\n\r\n    if (!limitsLoaded || !usage.messages.historyLoaded || messageLimit === undefined || !needsLoggedInLimitReachedCheck || shownLimitsReachedOnLogin === 'true') {\r\n        return;\r\n    }\r\n\r\n    if (usage.messages.history > messageLimit) {\r\n        setShownLimitsReachedOnLogin('true');\r\n\r\n        const modalProps: any = {\r\n            title: defineMessage({\r\n                id: 'workspace_limits.modals.limits_reached.title',\r\n                defaultMessage: '{limitName} limit reached',\r\n                values: {\r\n                    limitName: intl.formatMessage({\r\n                        id: 'workspace_limits.modals.limits_reached.title.message_history',\r\n                        defaultMessage: 'Message history',\r\n                    }),\r\n                },\r\n            }),\r\n            description: defineMessage({\r\n                id: 'workspace_limits.modals.limits_reached.description.message_history',\r\n                defaultMessage: 'Your sent message history is no longer available but you can still send messages. Upgrade to a paid plan and get unlimited access to your message history.',\r\n            }),\r\n            secondaryAction: {\r\n                message: defineMessage({\r\n                    id: 'workspace_limits.modals.close',\r\n                    defaultMessage: 'Close',\r\n                }),\r\n                onClick: () => {\r\n                    dispatch(closeModal(ModalIdentifiers.CLOUD_LIMITS));\r\n                },\r\n            },\r\n            onClose: () => {\r\n                dispatch(closeModal(ModalIdentifiers.CLOUD_LIMITS));\r\n            },\r\n        };\r\n\r\n        // Only show primary action if not air-gapped\r\n        if (!isAirGapped) {\r\n            modalProps.primaryAction = {\r\n                message: defineMessage({\r\n                    id: 'workspace_limits.modals.view_plan_options',\r\n                    defaultMessage: 'View plan options',\r\n                }),\r\n                onClick: () => {\r\n                    dispatch(closeModal(ModalIdentifiers.CLOUD_LIMITS));\r\n                    openPricingModal();\r\n                },\r\n            };\r\n        }\r\n\r\n        dispatch(openModal({\r\n            modalId: ModalIdentifiers.CLOUD_LIMITS,\r\n            dialogType: CloudUsageModal,\r\n            dialogProps: modalProps,\r\n        }));\r\n    }\r\n    dispatch(setNeedsLoggedInLimitReachedCheck(false));\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {useCallback, useMemo} from 'react';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\n\r\nimport type {PreferenceType} from '@mattermost/types/preferences';\r\n\r\nimport {savePreferences} from 'mattermost-redux/actions/preferences';\r\nimport {getCurrentUserId} from 'mattermost-redux/selectors/entities/common';\r\nimport {get as getPreference} from 'mattermost-redux/selectors/entities/preferences';\r\nimport type {ActionResult} from 'mattermost-redux/types/actions';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\nexport default function usePreference(category: string, name: string): [string | undefined, (value: string) => Promise<ActionResult>] {\r\n    const dispatch = useDispatch();\r\n\r\n    const userId = useSelector(getCurrentUserId);\r\n    const preferenceValue = useSelector((state: GlobalState) => getPreference(state, category, name));\r\n\r\n    const setPreference = useCallback((value: string) => {\r\n        const preference: PreferenceType = {\r\n            category,\r\n            name,\r\n            user_id: userId,\r\n            value,\r\n        };\r\n        return dispatch(savePreferences(userId, [preference]));\r\n    }, [category, dispatch, name, userId]);\r\n\r\n    return useMemo(() => ([preferenceValue, setPreference]), [preferenceValue, setPreference]);\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport {isCurrentLicenseCloud} from 'mattermost-redux/selectors/entities/cloud';\r\nimport {isCurrentUserSystemAdmin} from 'mattermost-redux/selectors/entities/users';\r\n\r\nimport AdminCloudEffects from './admin_cloud_effects';\r\n\r\nexport default function CloudEffectsWrapper() {\r\n    const isCloud = useSelector(isCurrentLicenseCloud);\r\n\r\n    const isAdmin = useSelector(isCurrentUserSystemAdmin);\r\n\r\n    if (!isCloud || !isAdmin) {\r\n        return null;\r\n    }\r\n\r\n    // This render can become more complex if need be, rendering multiple\r\n    // effect components according to conditions.\r\n    return <AdminCloudEffects/>;\r\n}\r\n"],"names":["setNeedsLoggedInLimitReachedCheck","data","type","ActionTypes","NEEDS_LOGGED_IN_LIMIT_REACHED_CHECK","setAdminConsoleUsersManagementTableProperties","SET_ADMIN_CONSOLE_USER_MANAGEMENT_TABLE_PROPERTIES","CLEAR_ADMIN_CONSOLE_USER_MANAGEMENT_TABLE_PROPERTIES","getUserReports","options","arguments","length","undefined","async","dispatch","getState","Client4","getUsersForReporting","error","forceLogoutIfNecessary","logError","getUserCountForReporting","filter","startUsersBatchExport","tableFilters","AdminCloudEffects","_limits$messages","usage","useGetUsage","useDispatch","intl","useIntl","limits","limitsLoaded","useGetLimits","needsLoggedInLimitReachedCheck","useSelector","getNeedsLoggedInLimitReachedCheck","messageLimit","messages","history","shownLimitsReachedOnLogin","setShownLimitsReachedOnLogin","category","name","userId","getCurrentUserId","preferenceValue","state","getPreference","setPreference","useCallback","value","preference","user_id","savePreferences","useMemo","usePreference","Preferences","CATEGORY_CLOUD_LIMITS","SHOWN_LIMITS_REACHED_ON_LOGIN","openPricingModal","isAirGapped","useOpenPricingModal","historyLoaded","modalProps","title","defineMessage","id","defaultMessage","values","limitName","formatMessage","description","secondaryAction","message","onClick","closeModal","ModalIdentifiers","CLOUD_LIMITS","onClose","primaryAction","openModal","modalId","dialogType","CloudUsageModal","dialogProps","useShowAdminLimitReached","CloudEffectsWrapper","isCloud","isCurrentLicenseCloud","isAdmin","isCurrentUserSystemAdmin","React"],"sourceRoot":""}