"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[5638],{5638:(e,t,a)=>{a.r(t),a.d(t,{default:()=>B}),a(17046);var r=a(37270),n=a(81911),s=a(32446),i=a(23739),o=a(65952),m=a(26614),l=a(77440),d=a(14776),c=a(46859),p=a(69657),u=a(49176),h=a(78451),g=(a(83931),a(29206),a(4290),a(71633)),b=a.n(g),f=a(36418),y=a.n(f),T=a(22005),v=a(14778),E=a(16983),w=a(61452),O=a(72208),I=a(62688),M=a.n(I),N=(a(1112),a(10844),a(59671)),C=a(85236),S=a(87131),P=a(61190),_=a(3295);const K=["btnClass","url","displayName","order","unread","mentions","teamIconUrl","isDraggable","switchTeam","teamIndex","teamId","tip"],k=(0,v.defineMessages)({nameUndefined:{id:"team.button.name_undefined",defaultMessage:"This team does not have a name"}});function D(e){let{btnClass:t,url:a,displayName:r,order:s,unread:i,mentions:o,teamIconUrl:m,isDraggable:l=!1,switchTeam:d,teamIndex:c,teamId:p,tip:u}=e,h=function(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;a[r]=e[r]}return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],-1===t.indexOf(a)&&{}.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}(e,K);const{formatMessage:g}=(0,v.useIntl)(),E=(0,f.useCallback)((e=>{e.preventDefault(),(0,N.Gy)(_.CU.TeamLinkClicked),d(a)}),[d,a]);let w=h.active?"active":"";const O=!a.endsWith("create_team")&&!a.endsWith("select_team");let I,M=g({id:"team.button.ariaLabel",defaultMessage:"{teamName} team"},{teamName:r});w||(i&&!h.isInProduct?(w="unread",I=y().createElement("span",{"data-testid":"team-badge-"+p,className:"unread-badge"})):w=O?"":"special",i&&O&&!h.isInProduct&&(M=g({id:"team.button.unread.ariaLabel",defaultMessage:"{teamName} team unread"},{teamName:r})),o&&O&&(M=g({id:"team.button.mentions.ariaLabel",defaultMessage:"{teamName} team, {mentionCount} mentions"},{teamName:r,mentionCount:o}),I=y().createElement("span",{"data-testid":"team-badge-"+p,className:b()("badge badge-max-number pull-right small",{urgent:h.hasUrgent})},o>99?"99+":o))),M=M.toLowerCase();const S=y().createElement(C.A,{className:w,withHover:!0,content:h.content||r||"",url:m});let P;void 0!==s&&s<10&&h.showOrder&&(P=y().createElement("div",{className:"order-indicator"},s));const k=y().createElement(U,{order:s,tip:u},y().createElement("div",{className:"team-btn "+t},!h.isInProduct&&I,S)),D=y().createElement(n.Link,{id:"".concat(a.slice(1),"TeamButton"),"aria-label":O?M:r,to:a,onClick:E},k);return l?y().createElement(T.Draggable,{draggableId:p,index:c},((e,t)=>y().createElement(n.Link,Object.assign({to:a,id:"".concat(a.slice(1),"TeamButton"),"aria-label":M,onClick:E,className:"draggable-team-container inline-block",ref:e.innerRef},e.draggableProps,e.dragHandleProps),y().createElement("div",{className:b()(["team-container ".concat(w),{isDragging:t.isDragging}])},k,P)))):y().createElement("div",{"data-testid":"team-container-"+p,className:"team-container ".concat(w)},D,P)}function U(e){let{order:t,tip:a,children:r}=e;const n=(0,v.useIntl)(),s=(0,f.useMemo)((()=>{if(t&&!(t>=10))return{default:[P.f.ctrl,P.f.alt,t.toString()],mac:[P.f.cmd,P.f.option,t.toString()]}}),[t]);return y().isValidElement(r)?y().createElement(S.A,{title:a||n.formatMessage(k.nameUndefined),shortcut:s},r):null}D.propTypes={btnClass:M().string,url:M().string.isRequired,displayName:M().string,content:M().node,tip:M().oneOfType([M().string,M().element]).isRequired,order:M().number,showOrder:M().bool,active:M().bool,unread:M().bool,mentions:M().number,placement:M().oneOf(["left","right","top","bottom"]),teamIconUrl:M().oneOfType([M().string,M().oneOf([null])]),switchTeam:M().func.isRequired,isDraggable:M().bool,teamIndex:M().number,teamId:M().string,isInProduct:M().bool,hasUrgent:M().bool};var x=a(7344),j=a(694),L=a(19513),W=a(75792),Y=a(8389),R=a(85873);function A(e,t,a){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class F extends y().PureComponent{constructor(e){super(e),A(this,"switchToPrevOrNextTeam",((e,t,a)=>{if(L.e(e,h.YM.KeyCodes.UP)||L.e(e,h.YM.KeyCodes.DOWN)){e.preventDefault();const r=L.e(e,h.YM.KeyCodes.DOWN)?1:-1,n=a.findIndex((e=>e.id===t)),s=n+r;let i;return i=-1===s?a[a.length-1]:s===a.length?a[0]:a[s],this.props.actions.switchTeam("/".concat(i.name)),!0}return!1})),A(this,"switchToTeamByNumber",((e,t,a)=>{const r=[h.YM.KeyCodes.ONE,h.YM.KeyCodes.TWO,h.YM.KeyCodes.THREE,h.YM.KeyCodes.FOUR,h.YM.KeyCodes.FIVE,h.YM.KeyCodes.SIX,h.YM.KeyCodes.SEVEN,h.YM.KeyCodes.EIGHT,h.YM.KeyCodes.NINE,h.YM.KeyCodes.ZERO];for(const n in r)if(L.e(e,r[n])&&parseInt(n,10)<a.length){if(e.preventDefault(),a[n].id===t)return!1;const r=a[n];return this.props.actions.switchTeam("/".concat(r.name)),!0}return!1})),A(this,"handleKeyDown",(e=>{if((e.ctrlKey||e.metaKey)&&e.altKey){const{currentTeamId:t}=this.props,a=(0,Y.y)(this.props.myTeams,this.props.locale,this.props.userTeamsOrderPreference);if(this.switchToPrevOrNextTeam(e,t,a))return;if(this.switchToTeamByNumber(e,t,a))return;this.setState({showOrder:!0})}})),A(this,"handleKeyUp",(e=>{(e.ctrlKey||e.metaKey)&&e.altKey||this.setState({showOrder:!1})})),A(this,"onDragEnd",(e=>{const{updateTeamsOrderForUser:t}=this.props.actions;if(!e.destination)return;const a=(0,Y.y)(this.props.myTeams,this.props.locale,this.props.userTeamsOrderPreference),r=e.source.index,n=e.destination.index,s=((e,t,r)=>[...e.slice(0,t),a.find((e=>e.id===r)),...e.slice(t,e.length)])((o=r,[...(i=a).slice(0,o),...i.slice(o+1,i.length)]),n,e.draggableId);var i,o;t(s.map((e=>e.id))),this.setState({teamsOrder:s})})),this.state={showOrder:!1,teamsOrder:[]}}componentDidUpdate(e){e.currentTeamId!==this.props.currentTeamId&&this.props.enableWebSocketEventScope&&x.A.updateActiveTeam(this.props.currentTeamId)}componentDidMount(){this.props.actions.getTeams(0,200),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}render(){const{intl:e}=this.props,t=document.querySelector("#root");if(this.props.myTeams.length<=1)return t.classList.remove("multi-teams"),null;t.classList.add("multi-teams");const a=[],r=(0,Y.y)(this.props.myTeams,this.props.locale,this.props.userTeamsOrderPreference),n=(0,W.$4)(this.props.products,this.props.location.pathname);if(n&&!n.showTeamSidebar)return null;const s=r.map(((e,t)=>y().createElement(D,{key:"switch_team_"+e.name,url:"/".concat(e.name),tip:e.display_name,active:e.id===this.props.currentTeamId,displayName:e.display_name,order:t+1,showOrder:this.state.showOrder,unread:this.props.unreadTeamsSet.has(e.id),mentions:this.props.mentionsInTeamMap.has(e.id)?this.props.mentionsInTeamMap.get(e.id):0,hasUrgent:!!this.props.teamHasUrgentMap.has(e.id)&&this.props.teamHasUrgentMap.get(e.id),teamIconUrl:R.lt(e),switchTeam:t=>this.props.actions.switchTeam(t,n?e:void 0),isDraggable:!0,teamId:e.id,teamIndex:t,isInProduct:Boolean(n)}))),i=[],o=y().createElement("i",{className:"icon icon-plus",role:"img","aria-label":e.formatMessage({id:"sidebar.team_menu.button.plusIcon",defaultMessage:"Plus Icon"})});return this.props.moreTeamsToJoin&&!this.props.experimentalPrimaryTeam?i.push(y().createElement(D,{btnClass:"team-btn__add",key:"more_teams",url:"/select_team",tip:y().createElement(v.FormattedMessage,{id:"team_sidebar.join",defaultMessage:"Other teams you can join"}),content:o,switchTeam:this.props.actions.switchTeam,displayName:e.formatMessage({id:"team_sidebar.join",defaultMessage:"Other teams you can join"})})):i.push(y().createElement(O.A,{permissions:[E.A.CREATE_TEAM],key:"more_teams"},y().createElement(D,{btnClass:"team-btn__add",url:"/create_team",tip:y().createElement(v.FormattedMessage,{id:"navbar_dropdown.create",defaultMessage:"Create a Team"}),content:o,switchTeam:this.props.actions.switchTeam,displayName:e.formatMessage({id:"navbar_dropdown.create",defaultMessage:"Create a Team"})}))),!n&&a.push(y().createElement("div",{key:"team-sidebar-bottom-plugin",className:"team-sidebar-bottom-plugin is-empty"},y().createElement(j.default,{pluggableName:"BottomTeamSidebar"}))),y().createElement("div",{className:b()("team-sidebar",{"move--right":this.props.isOpen}),role:"navigation","aria-labelledby":"teamSidebarWrapper"},y().createElement(w.A,null,y().createElement("div",{className:"team-wrapper",id:"teamSidebarWrapper"},y().createElement(T.DragDropContext,{onDragEnd:this.onDragEnd},y().createElement(T.Droppable,{droppableId:"my_teams",type:"TEAM_BUTTON"},(e=>y().createElement("div",Object.assign({ref:e.innerRef},e.droppableProps),s,e.placeholder)))),i)),a)}}const H=(0,v.injectIntl)(F),V=(0,r.connect)((function(e){const t=(0,m.zj)(e),a=t.ExperimentalPrimaryTeam,r=(0,d.sZ)(e),n=r&&r.length>0,s=e.plugins.components.Product||[],[i,c,g]=(0,o.O$)(e),b="true"===t.FeatureFlagWebSocketEventScope;return{currentTeamId:(0,d.Sy)(e),myTeams:(0,d.vt)(e),isOpen:(0,u.Cu)(e),experimentalPrimaryTeam:a,locale:(0,p.k)(e),moreTeamsToJoin:n,userTeamsOrderPreference:(0,l.Jt)(e,h.pm.TEAMS_ORDER,"",""),products:s,unreadTeamsSet:i,mentionsInTeamMap:c,teamHasUrgentMap:g,enableWebSocketEventScope:b}}),(function(e){return{actions:(0,s.zH)({getTeams:i.ZN,switchTeam:c._I,updateTeamsOrderForUser:c.uL},e)}})),B=(0,n.withRouter)(V(H))},49176:(e,t,a)=>{a.d(t,{Cu:()=>s,SM:()=>i,j4:()=>m});var r=a(8361),n=a(77440);function s(e){return e.views.lhs.isOpen}function i(e){return e.views.lhs.currentStaticPageId}const o=(0,a(67173).wV)(),m=(0,r.Mz)("getVisibleSidebarStaticPages",n.WW,o,((e,t)=>{const a=[];return e&&a.push({id:"threads",isVisible:!0}),a.push({id:"drafts",isVisible:t>0}),a.filter((e=>e.isVisible))}))}}]);
//# sourceMappingURL=5638.d127c7f745adc863e67b.js.map