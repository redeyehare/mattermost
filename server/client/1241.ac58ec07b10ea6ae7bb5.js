"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[1241],{83469:(e,t,r)=>{r.d(t,{OA:()=>i,_D:()=>s,n:()=>o});var a=r(17085),n=r(7430);function s(e){return(t,r)=>{const s=(0,n.WR)(r());return t(a.BX(s,!0,e))}}function o(){return(e,t)=>{const r=(0,n.WR)(t());return e(a.BX(r,!1))}}function i(){return(e,t)=>{const r=(0,n.WR)(t());return e(a.OA(r))}}},88153:(e,t,r)=>{r.d(t,{A:()=>d});var a=r(62688),n=r.n(a),s=r(71633),o=r.n(s),i=r(36418),c=r.n(i),l=r(14778),u=r(81911);const m=e=>{let{url:t="/",className:r,onClick:a}=e;const{formatMessage:n}=(0,l.useIntl)();return c().createElement("div",{className:o()("signup-header",r)},c().createElement(u.Link,{"data-testid":"back_button",onClick:a,to:t},c().createElement("span",{id:"back_button_icon",className:"fa fa-1x fa-angle-left",title:n({id:"generic_icons.back",defaultMessage:"Back Icon"})}),c().createElement(l.FormattedMessage,{id:"web.header.back",defaultMessage:"Back"})))};m.propTypes={url:n().string,className:n().string,onClick:n().func};const d=m},30491:(e,t,r)=>{r.d(t,{A:()=>c}),r(29206);var a=r(36418),n=r.n(a),s=r(14778);const o=["placeholder"],i=n().forwardRef(((e,t)=>{let{placeholder:r}=e,a=function(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;r[a]=e[a]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,o);const i=(0,s.useIntl)();return n().createElement("input",Object.assign({ref:t,placeholder:i.formatMessage(r)},a))}));i.displayName="LocalizedPlaceholderInput";const c=i},51241:(e,t,r)=>{r.r(t),r.d(t,{default:()=>C});var a=r(37270),n=r(26614),s=r(62688),o=r.n(s),i=(r(3188),r(6552),r(29206),r(4290),r(36418)),c=r.n(i),l=r(14778),u=r(81911),m=r(91767),d=r(88153),f=r(3708),p=r(51534),h=r(78451),g=r(19513);const v=h.Ay.KeyCodes,b=e=>{e.preventDefault(),(0,m.tc)()},E=e=>{(0,g.e)(e,v.ENTER)&&b(e)};function y(){return(0,i.useEffect)((()=>(document.body.addEventListener("keydown",E),()=>{document.body.removeEventListener("keydown",E)})),[]),c().createElement("div",null,c().createElement("form",{onSubmit:b,onKeyPress:E,className:"form-group"},c().createElement("strong",null,c().createElement(l.FormattedMessage,{id:"mfa.confirm.complete",defaultMessage:"Set up complete!"})),c().createElement("p",null,c().createElement(l.FormattedMessage,{id:"mfa.confirm.secure",defaultMessage:"Your account is now secure. Next time you sign in, you will be asked to enter a code from your authenticator app on your phone."})),c().createElement("button",{type:"submit",className:"btn btn-primary"},c().createElement(l.FormattedMessage,{id:"mfa.confirm.okay",defaultMessage:"Okay"}))))}var M=r(32446),A=r(7430),N=r(83469),w=(r(59297),r(30491));function k(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class S extends c().PureComponent{constructor(e){super(e),k(this,"submit",(e=>{var t,r;e.preventDefault();const a=null===(t=this.input)||void 0===t||null===(r=t.current)||void 0===r?void 0:r.value.replace(/\s/g,"");var n,s;if(!a||0===a.length)return this.setState({error:c().createElement(l.FormattedMessage,{id:"mfa.setup.codeError",defaultMessage:"Please enter the code from your authenticator app."})}),void(null===(n=this.input)||void 0===n||null===(s=n.current)||void 0===s||s.focus());this.setState({error:null}),this.props.actions.activateMfa(a).then((e=>{let{error:t}=e;var r,a;if(t)return"ent.mfa.activate.authenticate.app_error"===t.server_error_id?this.setState({error:c().createElement(l.FormattedMessage,{id:"mfa.setup.badCode",defaultMessage:"Invalid code. If this issue persists, contact your System Administrator."})}):this.setState({error:t.message}),void(null===(r=this.input)||void 0===r||null===(a=r.current)||void 0===a||a.focus());this.props.history.push("/mfa/confirm")}))})),this.state={error:void 0,secret:"",qrCode:""},this.input=c().createRef()}componentDidMount(){const e=this.props.currentUser;e&&!e.mfa_active?this.props.actions.generateMfaSecret().then((e=>{let{data:t,error:r}=e;r?this.setState({serverError:r.message}):this.setState({secret:t.secret,qrCode:t.qr_code})})):this.props.history.push("/")}render(){let e,t,r="form-group";return this.state.error&&(e=c().createElement("div",{id:"mfa-setup-error",className:"form-group has-error",role:"alert"},c().createElement("label",{className:"control-label"},this.state.error)),r+=" has-error"),this.props.enforceMultifactorAuthentication&&(t=c().createElement("p",null,c().createElement(l.FormattedMessage,{id:"mfa.setup.required_mfa",defaultMessage:"<strong>Multi-factor authentication is required on {siteName}.</strong>",values:{siteName:this.props.siteName,strong:e=>c().createElement("strong",null,e)}}))),c().createElement("div",null,c().createElement("form",{onSubmit:this.submit,className:r},t,c().createElement("p",null,c().createElement(l.FormattedMessage,{id:"mfa.setup.step1",defaultMessage:"1. Scan the QR code below using an authenticator app of your choice, such as Google Authenticator, Microsoft Authenticator app, or 1Password."})),c().createElement("p",null,c().createElement(l.FormattedMessage,{id:"mfa.setup.step2_secret",defaultMessage:"Alternatively, enter the secret key displayed below into the authenticator app manually."})),c().createElement("div",{className:"form-group"},c().createElement("div",{className:"col-sm-12"},c().createElement("img",{alt:"qr code image",style:q.qrCode,src:"data:image/png;base64,"+this.state.qrCode}))),c().createElement("br",null),c().createElement("div",{className:"form-group"},c().createElement("p",{className:"col-sm-12"},c().createElement(l.FormattedMessage,{id:"mfa.setup.secret",defaultMessage:"Secret: {secret}",values:{secret:this.state.secret}}))),c().createElement("p",null,c().createElement(l.FormattedMessage,{id:"mfa.setup.step3_code",defaultMessage:"2. Enter the code generated by the authenticator app in the field below.",values:{strong:e=>c().createElement("strong",null,e)}})),c().createElement("p",null,c().createElement(w.A,{ref:this.input,className:"form-control",placeholder:(0,l.defineMessage)({id:"mfa.setup.code",defaultMessage:"MFA Code"}),autoFocus:!0,"aria-describedby":this.state.error?"mfa-setup-error":void 0})),e,c().createElement("button",{type:"submit",className:"btn btn-primary"},c().createElement(l.FormattedMessage,{id:"mfa.setup.save",defaultMessage:"Save"}))))}}k(S,"propTypes",{state:o().shape({enforceMultifactorAuthentication:o().bool.isRequired}).isRequired,updateParent:o().func.isRequired,siteName:o().string,enforceMultifactorAuthentication:o().bool.isRequired,actions:o().shape({activateMfa:o().func.isRequired,generateMfaSecret:o().func.isRequired}).isRequired,history:o().shape({}).isRequired});const q={qrCode:{maxHeight:170}},R=(0,a.connect)((function(e){const t=(0,n.zj)(e),r=t.SiteName,a="true"===t.EnforceMultifactorAuthentication;return{currentUser:(0,A.HW)(e),siteName:r,enforceMultifactorAuthentication:a}}),(function(e){return{actions:(0,M.zH)({activateMfa:N._D,generateMfaSecret:N.OA},e)}}))(S);function P(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class _ extends c().PureComponent{constructor(e){super(e),P(this,"handleOnClick",(e=>{e.preventDefault(),(0,m.BN)("/login")})),P(this,"updateParent",(e=>{this.setState(e)})),this.state={enforceMultifactorAuthentication:e.enableMultifactorAuthentication}}componentDidMount(){document.body.classList.add("sticky"),document.getElementById("root").classList.add("container-fluid"),this.props.enableMultifactorAuthentication||this.props.history.push("/")}componentWillUnmount(){document.body.classList.remove("sticky"),document.getElementById("root").classList.remove("container-fluid")}render(){let e;return e=this.props.mfa&&this.props.enforceMultifactorAuthentication?c().createElement("div",{className:"signup-header"},c().createElement("button",{className:"style--none color--link",onClick:this.handleOnClick},c().createElement(f.A,null),c().createElement(l.FormattedMessage,{id:"web.header.logout",defaultMessage:"Logout"}))):c().createElement(d.A,null),c().createElement("div",{className:"inner-wrap"},c().createElement("div",{className:"row content"},c().createElement("div",null,e,c().createElement("div",{className:"col-sm-12"},c().createElement("div",{className:"signup-team__container"},c().createElement("h3",null,c().createElement(l.FormattedMessage,{id:"mfa.setupTitle",defaultMessage:"Multi-factor Authentication Setup"})),c().createElement("img",{alt:"signup team logo",className:"signup-team-logo",src:p}),c().createElement("div",{id:"mfa"},c().createElement(u.Switch,null,c().createElement(u.Route,{path:"".concat(this.props.match.url,"/setup"),render:e=>c().createElement(R,Object.assign({state:this.state,updateParent:this.updateParent},e))}),c().createElement(u.Route,{path:"".concat(this.props.match.url,"/confirm"),render:()=>c().createElement(y,null)}))))))))}}P(_,"propTypes",{location:o().shape({search:o().string.isRequired}).isRequired,children:o().node,mfa:o().bool.isRequired,enableMultifactorAuthentication:o().bool.isRequired,enforceMultifactorAuthentication:o().bool.isRequired,match:o().shape({url:o().string.isRequired}).isRequired});const C=(0,a.connect)((function(e){const t=(0,n.Ay)(e),r=(0,n.zj)(e);return{mfa:"true"===t.MFA,enableMultifactorAuthentication:"true"===r.EnableMultifactorAuthentication,enforceMultifactorAuthentication:"true"===r.EnforceMultifactorAuthentication}}))(_)},3708:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(36418),n=r.n(a),s=r(14778);function o(){const{formatMessage:e}=(0,s.useIntl)();return n().createElement("i",{className:"fa fa-1x fa-angle-left",title:e({id:"generic_icons.logout",defaultMessage:"Logout Icon"})})}},51534:(e,t,r)=>{e.exports=r.p+"files/11989c9bba9c970f1f64.png"}}]);
//# sourceMappingURL=1241.ac58ec07b10ea6ae7bb5.js.map