"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[6532],{96532:(e,t,s)=>{s.r(t),s.d(t,{default:()=>fe,makeMapStateToProps:()=>pe}),s(3188),s(30973);var r=s(37270),a=s(32446),n=s(30413),i=s(17085),o=s(26614),l=s(14776),c=s(7430),u=s(15755),d=s(59935),m=s(65357),h=s(89247),p=s(62688),f=s.n(p),g=(s(43813),s(17046),s(57406),s(55448),s(29206),s(4290),s(46177)),b=s.n(g),v=s(36418),y=s.n(v),_=s(14778),P=s(14696),M=s(30138),E=s(83007),C=s(78451),R=(s(74883),s(8361)),O=s(65952),w=s(16230),S=s(79342),T=s(79751),I=s(50375),D=s(63234),j=s(7380),U=s(71633),q=s.n(U),x=s(77828),N=s(56707),F=s(40693),k=s(73996),L=s(67277),A=s(61767),G=s(57986),H=s(19542),z=s(72429),V=s(85873);function W(e){const{currentUserId:t,option:s,status:a,actions:n}=e,i=(0,r.useSelector)((e=>s.remote_id?(0,k.un)(e,s.remote_id):null));(0,v.useEffect)((()=>{s.remote_id&&n.fetchRemoteClusterInfo(s.remote_id)}),[s.remote_id]);const{id:o,delete_at:l,is_bot:c=!1,last_picture_update:u}=s,d=(0,V.xK)(s);let m=d;return s.id===t?m=y().createElement(_.FormattedMessage,{id:"more_direct_channels.directchannel.you",defaultMessage:"{displayname} (you)",values:{displayname:d}}):s.delete_at&&(m=y().createElement(_.FormattedMessage,{id:"more_direct_channels.directchannel.deactivated",defaultMessage:"{displayname} - Deactivated",values:{displayname:d}})),y().createElement(y().Fragment,null,y().createElement(A.A,{src:F.mT.getProfilePictureUrl(o,u),status:l||c?void 0:a,size:"md"}),y().createElement("div",{className:"more-modal__details"},y().createElement("div",{className:"more-modal__name"},m,c&&y().createElement(H.A,null),(0,S.P)(s.roles)&&y().createElement(z.A,null),s.remote_id&&y().createElement(G.A,{withTooltip:!0,className:"more-modal__shared-icon",remoteNames:i?[i]:void 0}),y().createElement(L.A,{userID:s.id,showTooltip:!0,emojiSize:15,spanStyle:{display:"flex",flex:"0 0 auto",alignItems:"center"}})),!c&&y().createElement("div",{className:"more-modal__description"},s.email)))}W.propTypes={currentUserId:f().string.isRequired,status:f().string.isRequired,actions:f().shape({fetchRemoteClusterInfo:f().func.isRequired}).isRequired};const Y=(0,r.connect)((function(e,t){return{currentUserId:(0,c.WR)(e),status:(0,c.CB)(e,t.option.id)}}),(function(e){return{actions:(0,a.zH)({fetchRemoteClusterInfo:N.l8},e)}}))(W);function B(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function J(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function X(e){return"G"===(null==e?void 0:e.type)}function Q(e){return function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?B(Object(s),!0).forEach((function(t){J(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):B(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({value:e.id,label:X(e)?e.display_name:e.username},e)}const K={useTime:!1,style:"long",ranges:[{within:["minute",-1],display:["second",0]},{within:["hour",-1],display:["minute"]},{within:["hour",-24],display:["hour"]},{within:["day",-30],display:["day"]},{within:["month",-11],display:["month"]},{within:["year",-1e3],display:["year"]}]},Z=y().forwardRef(((e,t)=>{const{option:s,isMobileView:r,isSelected:a,add:n,select:i}=e,o=(0,_.useIntl)(),{last_post_at:l}=s;let c;c=X(s)?y().createElement(ee,{option:s}):y().createElement(Y,{option:s});const u=(0,v.useCallback)((()=>n(s)),[s,n]),d=(0,v.useCallback)((()=>i(s)),[s,i]);return y().createElement("div",{ref:t,className:q()("more-modal__row clickable",{"more-modal__row--selected":a}),onClick:u,onMouseEnter:d},c,r&&Boolean(l)&&y().createElement("div",{className:"more-modal__lastPostAt"},y().createElement(x.Ay,Object.assign({},K,{value:l}))),y().createElement("div",{className:"more-modal__actions"},y().createElement("button",{className:"more-modal__actions--round","aria-label":o.formatMessage({id:"more_direct_channels.new_convo_add.label",defaultMessage:"Add option {label}"},{label:s.label})},y().createElement("i",{className:"icon icon-plus"}))))}));Z.propTypes={isMobileView:f().bool.isRequired,isSelected:f().bool.isRequired,add:f().func.isRequired,select:f().func.isRequired},Z.displayName="ListItem";const $=Z;function ee(e){const{option:t}=e;return y().createElement(y().Fragment,null,y().createElement("div",{className:"more-modal__gm-icon"},t.profiles.length),y().createElement("div",{className:"more-modal__details"},y().createElement("div",{className:"more-modal__name"},y().createElement("span",null,t.profiles.map((e=>"@".concat(e.username))).join(", ")))))}const te=(0,r.connect)((function(e){return{isMobileView:(0,j.w3)(e)}}),null,null,{forwardRef:!0})($),se=C.Ay.MAX_USERS_IN_GM-1,re=y().forwardRef(((e,t)=>{const s=(0,v.useCallback)(((t,s,r,a)=>y().createElement(te,{ref:s?e.selectedItemRef:void 0,key:"more_direct_channels_list_"+t.value,option:t,isSelected:s,add:r,select:a})),[e.selectedItemRef]),a=(0,r.useDispatch)(),n=(0,v.useCallback)((t=>t.id===e.currentUserId||Boolean(t.delete_at)),[e.currentUserId]),i=(0,_.useIntl)();let o,l;e.isExistingChannel&&(o=e.values.length>=se?y().createElement(_.FormattedMessage,{id:"more_direct_channels.new_convo_note.full",defaultMessage:"You've reached the maximum number of people for this conversation. Consider creating a private channel instead."}):y().createElement(_.FormattedMessage,{id:"more_direct_channels.new_convo_note",defaultMessage:"This will start a new conversation. If you're adding a lot of people, consider creating a private channel instead."})),l=se>e.values.length?y().createElement(_.FormattedMessage,{id:"multiselect.numPeopleRemaining",defaultMessage:"Use ↑↓ to browse, ↵ to select. You can add {num, number} more {num, plural, one {person} other {people}}. ",values:{num:se-e.values.length}}):y().createElement(_.FormattedMessage,{id:"multiselect.maxPeople",defaultMessage:"Use ↑↓ to browse, ↵ to select. You can't add more than {num} people. Please <a>create a channel</a> to include more people.",values:{num:se,a:t=>y().createElement("a",{href:"#",onClick:t=>(t=>{t.preventDefault(),e.handleHide(),a((0,T.q)({modalId:C.IQ.NEW_CHANNEL_MODAL,dialogType:D.default}))})(t)},t)}});const c=(0,v.useMemo)((()=>e.options.map(Q)),[e.options]);return y().createElement(I.A,{ref:t,options:c,optionRenderer:s,intl:i,selectedItemRef:e.selectedItemRef,values:e.values,valueRenderer:ne,ariaLabelRenderer:ie,perPage:50,handlePageChange:e.handlePageChange,handleInput:e.search,handleDelete:e.handleDelete,handleAdd:e.addValue,handleSubmit:e.handleSubmit,noteText:o,maxValues:se,numRemainingText:l,buttonSubmitText:y().createElement(_.FormattedMessage,{id:"multiselect.go",defaultMessage:"Go"}),buttonSubmitLoadingText:y().createElement(_.FormattedMessage,{id:"multiselect.loading",defaultMessage:"Loading..."}),submitImmediatelyOn:n,saving:e.saving,loading:e.loading,users:e.users,totalCount:e.totalCount,placeholderText:i.formatMessage({id:"multiselect.placeholder",defaultMessage:"Search and add members"})})}));re.propTypes={addValue:f().func.isRequired,currentUserId:f().string.isRequired,handleDelete:f().func.isRequired,handlePageChange:f().func.isRequired,handleSubmit:f().func.isRequired,handleHide:f().func.isRequired,isExistingChannel:f().bool.isRequired,loading:f().bool.isRequired,options:f().array.isRequired,saving:f().bool.isRequired,search:f().func.isRequired,totalCount:f().number.isRequired,users:f().array.isRequired,values:f().array.isRequired};const ae=re;function ne(e){return e.data.username}function ie(e){var t;return null!==(t=null==e?void 0:e.username)&&void 0!==t?t:""}function oe(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function le(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(s),!0).forEach((function(t){ce(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):oe(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function ce(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ue=(0,r.connect)((function(){const e=function(){const e=(0,R.Mz)("getUsersWithDMs",c.WR,O.ou,((e,t)=>t),((e,t,s)=>{const r=Object.values(t).filter((e=>e.type===C.Ay.DM_CHANNEL)),a=[];for(const t of r){const r=(0,w.r4)(e,t.name),n=s.find((e=>e.id===r));n&&0!==t.last_post_at&&a.push(le(le({},n),{},{last_post_at:t.last_post_at}))}return a})),t=(0,R.Mz)("getFilteredGroupChannels",O.M6,(e=>e.views.search.modalSearch),((e,t)=>t),((e,t,s)=>e.filter((e=>(!t||0!==(0,S.V3)(e.profiles,t).length)&&!(s&&!s.every((t=>e.profiles.find((e=>e.id===t.id)))))&&e.last_post_at>0))));return(0,R.Mz)("makeGetOptions",e,((e,s,r)=>t(e,r)),((e,t)=>t),(e=>Boolean(e.views.search.modalSearch)),((e,t,s,r)=>{const a=[...e,...t].sort(((e,t)=>t.last_post_at-e.last_post_at));if(!r&&a.length>0)return a.slice(0,20);const n=s.filter((t=>0===t.delete_at&&!e.some((e=>e.id===t.id)))).map((e=>le(le({},e),{},{last_post_at:0})));return n.sort(((e,t)=>e.username.localeCompare(t.username))),[...a,...n]}))}();return(t,s)=>({options:e(t,s.users,s.values)})}))(ae);function de(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function me(e,t,s){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class he extends y().PureComponent{constructor(e){var t;super(e),t=this,me(this,"loadModalData",(()=>{this.getUserProfiles(),this.props.actions.getTotalUsersStats(),this.props.actions.loadProfilesMissingStatus(this.props.users),this.checkDMCapabilities(this.props.users)})),me(this,"checkDMCapabilities",(async e=>{const{currentUserId:t}=this.props,{directMessageCapabilityCache:s}=this.state,r=e.filter((e=>e.id!==t&&e.remote_id&&!(e.id in s)));if(0===r.length)return;const a=r.map((async e=>{try{var s,r;const a=await this.props.actions.canUserDirectMessage(t,e.id);return{userId:e.id,canDM:null!==(s=null===(r=a.data)||void 0===r?void 0:r.can_dm)&&void 0!==s&&s}}catch(t){return{userId:e.id,canDM:!1}}})),n=await Promise.all(a),i=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?de(Object(s),!0).forEach((function(t){me(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):de(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({},s);n.forEach((e=>{let{userId:t,canDM:s}=e;i[t]=s})),this.setState({directMessageCapabilityCache:i})})),me(this,"setUsersLoadingState",(e=>{this.setState({loadingUsers:e})})),me(this,"handleHide",(()=>{this.props.actions.setModalSearchTerm(""),this.setState({show:!1})})),me(this,"handleExit",(()=>{var e,t,s,r;null===(e=(t=this.props).onExited)||void 0===e||e.call(t),null===(s=(r=this.props).onModalDismissed)||void 0===s||s.call(r),this.exitToChannel?(0,E.J)().push(this.exitToChannel):this.props.focusOriginElement&&setTimeout((()=>{(0,M.p)(this.props.focusOriginElement,!0)}),0)})),me(this,"handleSubmit",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.state.values;const{actions:s}=t.props;if(t.state.saving)return;const r=e.map((e=>e.id));if(0===r.length)return;t.setState({saving:!0});const a=e=>{const{data:s,error:r}=e;t.setState({saving:!1}),r||(t.exitToChannel="/"+t.props.currentTeamName+"/channels/"+s.name,t.handleHide())};1===r.length?s.openDirectChannelToUserId(r[0]).then(a):s.openGroupChannelToUserIds(r).then(a)})),me(this,"addValue",(e=>{if(X(e))this.addUsers(e.profiles);else{const t=[...this.state.values];t.includes(e)||t.push(e),this.setState({values:t})}})),me(this,"addUsers",(e=>{const t=[...this.state.values],s=t.map((e=>e.id));for(const r of e)s.includes(r.id)||t.push(Q(r));this.setState({values:t})})),me(this,"getUserProfiles",(e=>{const t=e?e+1:0;"any"===this.props.restrictDirectMessage?this.props.actions.getProfiles(t,100).then((()=>{this.setUsersLoadingState(!1)})):this.props.actions.getProfilesInTeam(this.props.currentTeamId||"",t,100).then((()=>{this.setUsersLoadingState(!1)}))})),me(this,"handlePageChange",((e,t)=>{e>t&&(this.setUsersLoadingState(!0),this.getUserProfiles(e))})),me(this,"resetPaging",(()=>{var e;null===(e=this.multiselect.current)||void 0===e||e.resetPaging()})),me(this,"search",b()((e=>{this.props.actions.setModalSearchTerm(e)}),250)),me(this,"handleDelete",(e=>{this.setState({values:e})})),me(this,"getDirectMessageableUsers",(()=>{const{users:e}=this.props,{directMessageCapabilityCache:t}=this.state;return e.filter((e=>!e.remote_id||e.id in t&&t[e.id]))})),this.searchTimeoutId=0,this.multiselect=y().createRef(),this.selectedItemRef=y().createRef();const s=[];if(e.currentChannelMembers)for(let t=0;t<e.currentChannelMembers.length;t++){const r=Object.assign({},e.currentChannelMembers[t]);r.id!==e.currentUserId&&s.push(Q(r))}this.state={values:s,show:!0,search:!1,saving:!1,loadingUsers:!0,directMessageCapabilityCache:{}}}updateFromProps(e){if(e.searchTerm!==this.props.searchTerm){clearTimeout(this.searchTimeoutId);const e=this.props.searchTerm;if(""===e)this.resetPaging();else{const t="any"===this.props.restrictDirectMessage?"":this.props.currentTeamId;this.searchTimeoutId=setTimeout((async()=>{this.setUsersLoadingState(!0);const[{data:s},{data:r}]=await Promise.all([this.props.actions.searchProfiles(e,{team_id:t}),this.props.actions.searchGroupChannels(e)]);s&&this.props.actions.loadStatusesForProfilesList(s),r&&this.props.actions.loadProfilesForGroupChannels(r),this.resetPaging(),this.setUsersLoadingState(!1)}),C.Ay.SEARCH_TIMEOUT_MILLISECONDS)}}e.users.length!==this.props.users.length&&(this.props.actions.loadProfilesMissingStatus(this.props.users),this.checkDMCapabilities(this.props.users))}componentDidUpdate(e){this.updateFromProps(e)}render(){const e=this.getDirectMessageableUsers(),t=y().createElement(ue,{addValue:this.addValue,currentUserId:this.props.currentUserId,handleDelete:this.handleDelete,handlePageChange:this.handlePageChange,handleSubmit:this.handleSubmit,handleHide:this.handleHide,isExistingChannel:this.props.isExistingChannel,loading:this.state.loadingUsers,saving:this.state.saving,search:this.search,selectedItemRef:this.selectedItemRef,totalCount:this.props.totalCount,users:e,values:this.state.values}),s=y().createElement(_.FormattedMessage,{id:"more_direct_channels.title",defaultMessage:"Direct Messages"});return y().createElement(P.zW,{id:"moreDmModal",className:"a11y__modal more-modal more-direct-channels more-direct-channels-generic-modal",show:this.state.show,modalHeaderText:s,onExited:this.handleExit,onHide:this.handleExit,compassDesign:!0,bodyPadding:!1,onEntered:this.loadModalData,modalLocation:"top",delayFocusTrap:!0},y().createElement("div",{role:"application"},t))}}me(he,"propTypes",{currentUserId:f().string.isRequired,currentTeamId:f().string,currentTeamName:f().string,searchTerm:f().string.isRequired,users:f().array.isRequired,totalCount:f().number.isRequired,currentChannelMembers:f().array,isExistingChannel:f().bool.isRequired,restrictDirectMessage:f().string,onModalDismissed:f().func,onExited:f().func,actions:f().shape({getProfiles:f().func.isRequired,getProfilesInTeam:f().func.isRequired,loadProfilesMissingStatus:f().func.isRequired,getTotalUsersStats:f().func.isRequired,loadStatusesForProfilesList:f().func.isRequired,loadProfilesForGroupChannels:f().func.isRequired,openDirectChannelToUserId:f().func.isRequired,openGroupChannelToUserIds:f().func.isRequired,searchProfiles:f().func.isRequired,searchGroupChannels:f().func.isRequired,setModalSearchTerm:f().func.isRequired,canUserDirectMessage:f().func.isRequired}).isRequired,focusOriginElement:f().string.isRequired});const pe=()=>{const e=(0,c.T_)();return(t,s)=>{var r;const a=(0,c.WR)(t);let n;s.isExistingChannel&&(n=(0,c.Gv)(t));const i=(0,o.zj)(t).RestrictDirectMessage,u=t.views.search.modalSearch;let d,m;"true"===(0,o.Y6)(t,"EnableSharedChannelsDMs")||(d={exclude_remote:!0}),m=u?"any"===i?e(t,u,!1,d):(0,c.QJ)(t,u,!1,d):"any"===i?(0,c.r7)(t,d):(0,c.G1)(t,d);const h=(0,l.H7)(t),p=(0,c.ig)(t)||{total_users_count:0};return{currentTeamId:null==h?void 0:h.id,currentTeamName:null==h?void 0:h.name,searchTerm:u,users:m,currentChannelMembers:n,currentUserId:a,restrictDirectMessage:i,totalCount:null!==(r=p.total_users_count)&&void 0!==r?r:0}}},fe=(0,r.connect)(pe,(function(e){return{actions:(0,a.zH)({getProfiles:i.r7,getProfilesInTeam:i.xJ,loadProfilesMissingStatus:d.X,getTotalUsersStats:i.ig,loadStatusesForProfilesList:d.Y5,loadProfilesForGroupChannels:m.HJ,openDirectChannelToUserId:u.q6,openGroupChannelToUserIds:u.Xz,searchProfiles:i.U,searchGroupChannels:n.OW,setModalSearchTerm:h.qv,canUserDirectMessage:i.y5},e)}}))(he)}}]);
//# sourceMappingURL=6532.a0eace21c00262c45155.js.map