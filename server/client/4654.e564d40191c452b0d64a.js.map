{"version":3,"file":"4654.e564d40191c452b0d64a.js","mappings":"wVAsBWA,EAAY,SAAZA,GAAY,OAAZA,EAAY,kBAAZA,EAAY,kBAAZA,EAAY,kBAAZA,CAAY,EAAZA,GAAY,IAMvB,MA0GA,EA1GsBC,KAAM,IAAAC,EACxB,MAAM,cAACC,IAAiBC,EAAAA,EAAAA,WAClBC,GAAWC,EAAAA,EAAAA,eACXC,GAAUC,EAAAA,EAAAA,eACV,OAACC,IAAUC,EAAAA,EAAAA,eAGXC,EAA2B,QAAtBT,EADI,IAAIU,gBAAgBH,GACdI,IAAI,gBAAQ,IAAAX,EAAAA,EAAI,GAE/BY,EAAWC,SAAQC,EAAAA,EAAAA,aAAYC,EAAAA,KAC/BC,GAAwBF,EAAAA,EAAAA,aAAYG,EAAAA,KAEnCC,EAAcC,IAAmBC,EAAAA,EAAAA,UAAStB,EAAauB,UACvDC,EAAaC,IAAkBH,EAAAA,EAAAA,UAAS,KAE/CI,EAAAA,EAAAA,YAAU,KACNC,GAAa,GACd,IAEH,MAAMC,EAAiBA,KACnB,GAAId,EACA,OAAII,OAKAX,EAAQsB,KAAK,UAGjBC,EAAAA,EAAAA,MAIJ,MAAMC,EAAiB,IAAInB,gBAAgBH,GAC3CsB,EAAeC,IAAI,QAASC,EAAAA,GAAUC,iBAEtC3B,EAAQsB,KAAK,UAADM,OAAWJ,GAAiB,EAGtCJ,EAAcS,UAChB,MAAM,MAACC,SAAehC,GAASiC,EAAAA,EAAAA,IAAgB3B,IAE/C,GAAI0B,EAMA,OALAhB,EAAgBrB,EAAauC,cAC7Bd,EAAetB,EAAc,CACzBqC,GAAI,+CACJC,eAAgB,oEAQxB,GAHApB,EAAgBrB,EAAa0C,eACvBrC,GAASsC,EAAAA,EAAAA,QAEV7B,EAED,YADAc,IAIJvB,GAASuC,EAAAA,EAAAA,IAAS,CACdC,QAASC,EAAAA,GAAwBC,eACjCC,KAAMC,EAAAA,GAAqBP,SACrB,CAACQ,aAAcC,EAAAA,GAAgBC,UAEzC,MAAOf,MAAOgB,SAAoBhD,GAASiD,EAAAA,EAAAA,OAE3C,GAAID,EAMA,OALAhC,EAAgBrB,EAAauC,cAC7Bd,EAAetB,EAAc,CACzBqC,GAAI,iDACJC,eAAgB,gDAKxBb,GAAgB,EAKpB,OACIR,IAAiBpB,EAAauC,QAC1BgB,IAAAA,cAAA,OAAKC,UAAU,kBACXD,IAAAA,cAAA,OAAKC,UAAU,0BACXD,IAAAA,cAACE,EAAAA,EAAY,CACTC,MAAOvD,EAAc,CAACqC,GAAI,6CAA8CC,eAAgB,gCACxFI,QAASrB,EACTmC,aACIJ,IAAAA,cAAA,OAAKC,UAAU,2CACXD,IAAAA,cAAA,UACIC,UAAU,uCACVI,QAbEC,IAAMtD,EAAQuD,QAAQ,MAevB3D,EAAc,CAACqC,GAAI,+BAAgCC,eAAgB,2BAQ5Fc,IAAAA,cAACQ,EAAAA,EAAa,KACjB,C,0FCjHT,MAAMC,EAASC,IAA6E,IAA5E,MAACP,EAAK,QAAEb,EAAO,WAAEqB,EAAU,aAAEP,EAAY,eAAEQ,GAA4BF,EAOnF,OACIV,IAAAA,cAAA,OACIC,UAAU,wBACVY,UATsBC,IACtBF,GAAkBE,EAAEC,MAAQrC,EAAAA,GAAUsC,SAASC,MAAM,IACrDL,EAAeE,EACnB,EAOII,SAAU,GAEVlB,IAAAA,cAAA,OAAKC,UAAU,6BACVU,GAELX,IAAAA,cAAA,MAAIC,UAAU,+BACTE,GAELH,IAAAA,cAAA,KAAGC,UAAU,iCACRX,GAEJc,GACGJ,IAAAA,cAAA,OAAKC,UAAU,uCACVG,GAGP,EAEZK,EAAAU,UAAA,CApCEhB,MAAKiB,IAAAA,KAAAC,WACL/B,QAAO8B,IAAAA,KAAAC,WACPV,WAAUS,IAAAA,KACVhB,aAAYgB,IAAAA,KACZR,eAAcQ,IAAAA,MAkClB,S","sources":["webpack://mattermost-webapp/./src/components/do_verify_email/do_verify_email.tsx","webpack://mattermost-webapp/./src/components/header_footer_route/content_layouts/column.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useState, useEffect} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useSelector, useDispatch} from 'react-redux';\r\nimport {useLocation, useHistory} from 'react-router-dom';\r\n\r\nimport {clearErrors, logError, LogErrorBarMode} from 'mattermost-redux/actions/errors';\r\nimport {verifyUserEmail, getMe} from 'mattermost-redux/actions/users';\r\nimport {getIsOnboardingFlowEnabled} from 'mattermost-redux/selectors/entities/preferences';\r\nimport {getCurrentUserId} from 'mattermost-redux/selectors/entities/users';\r\n\r\nimport {redirectUserToDefaultTeam} from 'actions/global_actions';\r\n\r\nimport ColumnLayout from 'components/header_footer_route/content_layouts/column';\r\nimport LoadingScreen from 'components/loading_screen';\r\n\r\nimport {AnnouncementBarTypes, AnnouncementBarMessages, Constants} from 'utils/constants';\r\n\r\nimport './do_verify_email.scss';\r\n\r\nconst enum VerifyStatus {\r\n    PENDING = 'pending',\r\n    SUCCESS = 'success',\r\n    FAILURE = 'failure',\r\n}\r\n\r\nconst DoVerifyEmail = () => {\r\n    const {formatMessage} = useIntl();\r\n    const dispatch = useDispatch();\r\n    const history = useHistory();\r\n    const {search} = useLocation();\r\n\r\n    const params = new URLSearchParams(search);\r\n    const token = params.get('token') ?? '';\r\n\r\n    const loggedIn = Boolean(useSelector(getCurrentUserId));\r\n    const onboardingFlowEnabled = useSelector(getIsOnboardingFlowEnabled);\r\n\r\n    const [verifyStatus, setVerifyStatus] = useState(VerifyStatus.PENDING);\r\n    const [serverError, setServerError] = useState('');\r\n\r\n    useEffect(() => {\r\n        verifyEmail();\r\n    }, []);\r\n\r\n    const handleRedirect = () => {\r\n        if (loggedIn) {\r\n            if (onboardingFlowEnabled) {\r\n                // need info about whether admin or not,\r\n                // and whether admin has already completed\r\n                // first time onboarding. Instead of fetching and orchestrating that here,\r\n                // let the default root component handle it.\r\n                history.push('/');\r\n                return;\r\n            }\r\n            redirectUserToDefaultTeam();\r\n            return;\r\n        }\r\n\r\n        const newSearchParam = new URLSearchParams(search);\r\n        newSearchParam.set('extra', Constants.SIGNIN_VERIFIED);\r\n\r\n        history.push(`/login?${newSearchParam}`);\r\n    };\r\n\r\n    const verifyEmail = async () => {\r\n        const {error} = await dispatch(verifyUserEmail(token));\r\n\r\n        if (error) {\r\n            setVerifyStatus(VerifyStatus.FAILURE);\r\n            setServerError(formatMessage({\r\n                id: 'signup_user_completed.invalid_invite.message',\r\n                defaultMessage: 'Please speak with your Administrator to receive an invitation.',\r\n            }));\r\n            return;\r\n        }\r\n\r\n        setVerifyStatus(VerifyStatus.SUCCESS);\r\n        await dispatch(clearErrors());\r\n\r\n        if (!loggedIn) {\r\n            handleRedirect();\r\n            return;\r\n        }\r\n\r\n        dispatch(logError({\r\n            message: AnnouncementBarMessages.EMAIL_VERIFIED,\r\n            type: AnnouncementBarTypes.SUCCESS,\r\n        } as any, {errorBarMode: LogErrorBarMode.Always}));\r\n\r\n        const {error: getMeError} = await dispatch(getMe());\r\n\r\n        if (getMeError) {\r\n            setVerifyStatus(VerifyStatus.FAILURE);\r\n            setServerError(formatMessage({\r\n                id: 'signup_user_completed.failed_update_user_state',\r\n                defaultMessage: 'Please clear your cache and try to log in.',\r\n            }));\r\n            return;\r\n        }\r\n\r\n        handleRedirect();\r\n    };\r\n\r\n    const handleReturnButtonOnClick = () => history.replace('/');\r\n\r\n    return (\r\n        verifyStatus === VerifyStatus.FAILURE ? (\r\n            <div className='do-verify-body'>\r\n                <div className='do-verify-body-content'>\r\n                    <ColumnLayout\r\n                        title={formatMessage({id: 'signup_user_completed.invalid_invite.title', defaultMessage: 'This invite link is invalid'})}\r\n                        message={serverError}\r\n                        extraContent={(\r\n                            <div className='do-verify-body-content-button-container'>\r\n                                <button\r\n                                    className='do-verify-body-content-button-return'\r\n                                    onClick={handleReturnButtonOnClick}\r\n                                >\r\n                                    {formatMessage({id: 'signup_user_completed.return', defaultMessage: 'Return to log in'})}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    />\r\n                </div>\r\n            </div>\r\n        ) : (\r\n            <LoadingScreen/>\r\n        )\r\n    );\r\n};\r\n\r\nexport default DoVerifyEmail;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {type ReactNode} from 'react';\r\n\r\nimport Constants from 'utils/constants';\r\n\r\nimport './column.scss';\r\n\r\ntype ColumnProps = {\r\n    title: ReactNode;\r\n    message: ReactNode;\r\n    SVGElement?: React.ReactNode;\r\n    extraContent?: React.ReactNode;\r\n    onEnterKeyDown?: (e: React.KeyboardEvent<HTMLInputElement>) => void;\r\n}\r\n\r\nconst Column = ({title, message, SVGElement, extraContent, onEnterKeyDown}: ColumnProps) => {\r\n    const handleOnEnterKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n        if (onEnterKeyDown && e.key === Constants.KeyCodes.ENTER[0]) {\r\n            onEnterKeyDown(e);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className='content-layout-column'\r\n            onKeyDown={handleOnEnterKeyDown}\r\n            tabIndex={0}\r\n        >\r\n            <div className='content-layout-column-svg'>\r\n                {SVGElement}\r\n            </div>\r\n            <h1 className='content-layout-column-title'>\r\n                {title}\r\n            </h1>\r\n            <p className='content-layout-column-message'>\r\n                {message}\r\n            </p>\r\n            {extraContent && (\r\n                <div className='content-layout-column-extra-content'>\r\n                    {extraContent}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Column;\r\n"],"names":["VerifyStatus","DoVerifyEmail","_params$get","formatMessage","useIntl","dispatch","useDispatch","history","useHistory","search","useLocation","token","URLSearchParams","get","loggedIn","Boolean","useSelector","getCurrentUserId","onboardingFlowEnabled","getIsOnboardingFlowEnabled","verifyStatus","setVerifyStatus","useState","PENDING","serverError","setServerError","useEffect","verifyEmail","handleRedirect","push","redirectUserToDefaultTeam","newSearchParam","set","Constants","SIGNIN_VERIFIED","concat","async","error","verifyUserEmail","FAILURE","id","defaultMessage","SUCCESS","clearErrors","logError","message","AnnouncementBarMessages","EMAIL_VERIFIED","type","AnnouncementBarTypes","errorBarMode","LogErrorBarMode","Always","getMeError","getMe","React","className","ColumnLayout","title","extraContent","onClick","handleReturnButtonOnClick","replace","LoadingScreen","Column","_ref","SVGElement","onEnterKeyDown","onKeyDown","e","key","KeyCodes","ENTER","tabIndex","propTypes","_pt","isRequired"],"sourceRoot":""}