"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[9084],{42945:(e,t,n)=>{n.d(t,{A:()=>m});var a=n(36418),l=n.n(a),s=n(14778),r=n(37270),i=n(77440),o=n(7430),c=n(79342),d=n(72429);const u=e=>{var t;let{dmUser:n}=e;const a=(0,r.useSelector)(o.HW),u=(0,r.useSelector)(i.K3),m=(0,c.R4)(n,u);return l().createElement(l().Fragment,null,a.id!==(null==n?void 0:n.id)&&m+" ",a.id===(null==n?void 0:n.id)&&l().createElement(s.FormattedMessage,{id:"channel_header.directchannel.you",defaultMessage:"{displayName} (you) ",values:{displayName:m}}),(0,c.P)(null!==(t=null==n?void 0:n.roles)&&void 0!==t?t:"")&&l().createElement(d.A,null))},m=(0,a.memo)(u)},6281:(e,t,n)=>{n.d(t,{A:()=>g});var a=n(62688),l=n.n(a),s=(n(17046),n(36418)),r=n.n(s),i=n(37270),o=n(65952),c=n(77440),d=n(7430),u=n(79342),m=n(72429);const h=e=>{let{gmMembers:t}=e;const n=(0,i.useSelector)(d.HW),a=(0,i.useSelector)(c.K3),l=(0,i.useSelector)(o.Lw);if(!l)return null;const s={};if(t)for(const e of t){if(e.id===n.id)continue;const t=(0,u.R4)(e,a);s[t]||(s[t]=[]),s[t].push(e)}const h=l.display_name.split(", ");return r().createElement(r().Fragment,null,h.map(((e,t)=>{var n;if(!s[e])return e;const a=s[e].shift();return r().createElement(r().Fragment,{key:null==a?void 0:a.id},t>0&&", ",e,(0,u.P)(null!==(n=null==a?void 0:a.roles)&&void 0!==n?n:"")&&r().createElement(m.A,null))})))};h.propTypes={gmMembers:l().array};const g=(0,s.memo)(h)},37727:(e,t,n)=>{n.d(t,{A:()=>gn});var a=n(62688),l=n.n(a),s=n(71633),r=n.n(s),i=n(36418),o=n.n(i),c=n(14778),d=n(37270),u=n(35134),m=n.n(u),h=n(65952),g=n(26614),p=n(7430),E=n(21650),_=n(97026),b=n(70669),f=n(78451),v=(n(29206),n(85406)),y=n(79342),C=n(34086),M=n(92159),A=n(44446);const N=e=>{const{formatMessage:t}=(0,c.useIntl)(),{handleCreateLink:n,handleCreateFile:a}=(0,A.m)(e.channel.id),l=(0,_._4)(e.channel.id,"add"),s=(0,_.GX)();return(0,d.useSelector)((t=>{const n=(0,M.H)(t,e.channel.id);return n&&Object.keys(n).length>=_.PM})),l?o().createElement(b.g8,{id:"channel-menu-".concat(e.channel.id,"-bookmarks"),leadingElement:o().createElement(v.BookmarkOutlineIcon,{size:18}),labels:o().createElement(c.FormattedMessage,{id:"channel_menu.bookmarks",defaultMessage:"Bookmarks Bar"}),trailingElements:o().createElement(v.ChevronRightIcon,{size:16}),menuId:"channel-menu-".concat(e.channel.id,"-menu"),menuAriaLabel:t({id:"channel_menu.bookmarks",defaultMessage:"Bookmarks Bar"})},o().createElement(b.q7,{id:"channel-menu-".concat(e.channel.id,"-bookmarks-link"),leadingElement:o().createElement(v.LinkVariantIcon,{size:18}),labels:o().createElement(c.FormattedMessage,{id:"channel_menu.bookmarks.addLink",defaultMessage:"Add a link"}),onClick:()=>n()}),s&&o().createElement(b.q7,{id:"channel-menu-".concat(e.channel.id,"-bookmarks-file"),leadingElement:o().createElement(v.PaperclipIcon,{size:18}),labels:o().createElement(c.FormattedMessage,{id:"channel_menu.bookmarks.addFile",defaultMessage:"Attach a file"}),onClick:()=>a()})):null},S=(0,i.memo)(N);var w=n(35631),I=n(14776),k=n(25778),T=n(83007);function O(e){const t=(0,d.useDispatch)(),n=(0,d.useSelector)(I.H7),a=(0,d.useSelector)(h.UX),{id:l,channel:s}=e;let r=o().createElement(c.FormattedMessage,{id:"center_panel.direct.closeDirectMessage",defaultMessage:"Close Direct Message"});return s.type===f.YM.GM_CHANNEL&&(r=o().createElement(c.FormattedMessage,{id:"center_panel.direct.closeGroupMessage",defaultMessage:"Close Group Message"})),o().createElement(b.q7,{id:l,leadingElement:o().createElement(v.CloseIcon,{size:"18px"}),onClick:()=>{const{channel:l,currentUserID:s}=e;let r,i;l.type===f.YM.DM_CHANNEL?(i=f.YM.Preferences.CATEGORY_DIRECT_CHANNEL_SHOW,r=l.teammate_id):(i=f.YM.Preferences.CATEGORY_GROUP_CHANNEL_SHOW,r=l.id),t((0,k.iq)(l.name)),t((0,w.SF)(s,[{user_id:s,category:i,name:r,value:"false"}])),n&&(0,T.J)().push("/".concat(n.name,"/channels/").concat(a))},labels:r})}O.propTypes={currentUserID:l().string.isRequired,id:l().string};var P=n(79751),x=n(64182);const R=e=>{let{channel:t,leadingElement:n}=e;const a=(0,d.useDispatch)();return o().createElement(b.q7,{id:"channelEditHeader",leadingElement:n,onClick:()=>{a((0,P.q)({modalId:f.IQ.EDIT_CHANNEL_HEADER,dialogType:x.A,dialogProps:{channel:t}}))},labels:o().createElement(c.FormattedMessage,{id:"channel_header.setConversationHeader",defaultMessage:"Edit Header"})})};R.propTypes={leadingElement:l().node};const L=o().memo(R),F=e=>{const{formatMessage:t}=(0,c.useIntl)();return e.pluginItems&&e.pluginItems.length?o().createElement(b.g8,{id:"moreActions",labels:o().createElement(c.FormattedMessage,{id:"pluginsMenu.more_actions",defaultMessage:"More actions"}),leadingElement:o().createElement(v.AppsIcon,{size:"18px"}),trailingElements:o().createElement(v.ChevronRightIcon,{size:16}),menuId:"moreActions-menu",menuAriaLabel:t({id:"pluginsMenu.more_actions",defaultMessage:"More actions"})},e.pluginItems):o().createElement(o().Fragment,null)};F.propTypes={pluginItems:l().arrayOf(l().node).isRequired};const H=(0,i.memo)(F);var D=n(30413);const q=e=>{let{isFavorite:t,channelID:n}=e;const a=(0,d.useDispatch)();let l=o().createElement(c.FormattedMessage,{id:"channelHeader.addToFavorites",defaultMessage:"Add to Favorites"});return t&&(l=o().createElement(c.FormattedMessage,{id:"channelHeader.removeFromFavorites",defaultMessage:"Remove from Favorites"})),o().createElement(b.q7,{onClick:()=>{a(t?(0,D.XJ)(n):(0,D.yc)(n))},labels:l})};q.propTypes={channelID:l().string.isRequired,isFavorite:l().bool.isRequired};const B=(0,i.memo)(q);var G=n(2386),U=n(75270);const j=["channel"],V=e=>{let{channel:t}=e,n=function(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,j);const a=(0,d.useDispatch)();let l,s=(0,d.useSelector)(U.A);return(0,d.useSelector)(U.bM)!==f._n.CHANNEL_INFO&&(s=!1),l=s?o().createElement(c.FormattedMessage,{id:"channelHeader.hideInfo",defaultMessage:"Close Info"}):o().createElement(c.FormattedMessage,{id:"channelHeader.viewInfo",defaultMessage:"View Info"}),o().createElement(o().Fragment,null,o().createElement(b.q7,Object.assign({leadingElement:o().createElement(v.InformationOutlineIcon,{size:"18px"}),onClick:()=>{a(s?(0,G.bP)():(0,G.Vl)(t.id))},labels:l},n)))};function z(e){let{isMuted:t,channel:n,userID:a}=e;const l=(0,d.useDispatch)();let s;return s=n.type===f.YM.DM_CHANNEL||n.type===f.YM.GM_CHANNEL?t?o().createElement(c.FormattedMessage,{id:"channel_header.unmuteConversation",defaultMessage:"Unmute"}):o().createElement(c.FormattedMessage,{id:"channel_header.muteConversation",defaultMessage:"Mute"}):t?o().createElement(c.FormattedMessage,{id:"channel_header.unmute",defaultMessage:"Unmute Channel"}):o().createElement(c.FormattedMessage,{id:"channel_header.mute",defaultMessage:"Mute Channel"}),o().createElement(b.q7,{leadingElement:o().createElement(v.BellOffOutlineIcon,{size:"18px"}),id:"channelToggleMuteChannel",onClick:()=>{l((0,D.cz)(a,n.id,{mark_unread:t?f.DB.ALL:f.DB.MENTION}))},labels:s})}z.propTypes={userID:l().string.isRequired,isMuted:l().bool.isRequired};const W=e=>{let{channelID:t}=e;const n=(0,d.useDispatch)(),a=(0,d.useSelector)(U.bM)===f._n.PIN;return o().createElement(b.q7,{onClick:()=>{n(a?(0,G.bP)():(0,G.H3)(t))},labels:o().createElement(c.FormattedMessage,{id:"navbar.viewPinnedPosts",defaultMessage:"View Pinned Posts"})})};W.propTypes={channelID:l().string.isRequired};const Y=(0,i.memo)(W),Q=["channel","user","isMuted","isMobile","isFavorite","pluginItems","isChannelBookmarksEnabled"],X=e=>{let{channel:t,user:n,isMuted:a,isMobile:l,isFavorite:s,pluginItems:r,isChannelBookmarksEnabled:i}=e,c=function(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,Q);return o().createElement(o().Fragment,null,o().createElement(V,Object.assign({channel:t},c)),o().createElement(z,{userID:n.id,channel:t,isMuted:a}),l&&o().createElement(o().Fragment,null,o().createElement(B,{channelID:t.id,isFavorite:s}),o().createElement(Y,{channelID:t.id})),o().createElement(L,{leadingElement:o().createElement(v.CogOutlineIcon,{size:"18px"}),channel:t}),o().createElement(b.wv,null),!(0,y.P)(n.roles)&&i&&o().createElement(S,{channel:t}),o().createElement(C.A,{channel:t}),!l&&o().createElement(H,{pluginItems:r}),o().createElement(b.wv,null),o().createElement(O,{currentUserID:n.id,channel:t}))};X.propTypes={isMuted:l().bool.isRequired,isMobile:l().bool.isRequired,isFavorite:l().bool.isRequired,pluginItems:l().arrayOf(l().node).isRequired,isChannelBookmarksEnabled:l().bool.isRequired};const K=X;var J=n(57898),$=n(57486),Z=n(32446),ee=n(77440),te=n(52073),ne=(n(17046),n(43813),n(76685),n(14696)),ae=n(46859),le=n(11284),se=n(53654),re=n(24867);const ie=()=>{const e=(0,c.useIntl)();return o().createElement(re.A,{title:e.formatMessage({id:"sidebar_left.sidebar_channel_modal.no_common_teams_error.heading",defaultMessage:"Unable to convert to a channel because group members are part of different teams"}),text:e.formatMessage({id:"sidebar_left.sidebar_channel_modal.no_common_teams_error.body",defaultMessage:"Group Message cannot be converted to a channel because members are not a part of the same team. Add all members to a single team to convert this group message to a channel in that team."}),type:"danger"})};n(74883);var oe=n(69657),ce=n(43233);const de=e=>{const[t,n]=(0,i.useState)(),a=(0,c.useIntl)(),{formatMessage:l}=a,s=(0,i.useCallback)((t=>{const a=t.value;n(e.teamsById[a]),e.onChange(a)}),[]),r=(0,d.useSelector)(oe.k),u=Object.values(e.teamsById).map((e=>({value:e.id,label:e.display_name}))).sort(((e,t)=>e.label.localeCompare(t.label,r)));return o().createElement(ce.A,{className:"team_selector",required:!0,onChange:s,value:t?{label:t.display_name,value:t.id}:void 0,options:u,legend:l({id:"sidebar_left.sidebar_channel_modal.select_team_placeholder",defaultMessage:"Select Team"}),placeholder:l({id:"sidebar_left.sidebar_channel_modal.select_team_placeholder",defaultMessage:"Select Team"}),name:"team_selector"})};de.propTypes={onChange:l().func.isRequired};const ue=de,me=e=>{const t=(0,c.useIntl)();let n;return n=e.channelMemberNames.length>0?t.formatList(e.channelMemberNames):t.formatMessage({id:"sidebar_left.sidebar_channel_modal.warning_body_yourself",defaultMessage:"yourself"}),o().createElement(re.A,{title:t.formatMessage({id:"sidebar_left.sidebar_channel_modal.warning_header",defaultMessage:"Conversation history will be visible to any channel members"}),text:t.formatMessage({id:"sidebar_left.sidebar_channel_modal.warning_body",defaultMessage:"You are about to convert the Group Message with {memberNames} to a Channel. This cannot be undone."},{memberNames:n})})};me.propTypes={channelMemberNames:l().arrayOf(l().string).isRequired};const he=me;var ge=function(e){return e.CHANNEL_NAME_EXISTS="store.sql_channel.save_channel.exists.app_error",e}(ge||{});const pe=e=>{const t=(0,c.useIntl)(),{formatMessage:n}=t,[a,l]=(0,i.useState)(""),s=(0,i.useRef)(""),[u,m]=(0,i.useState)(""),h=(0,i.useCallback)((e=>{s.current=e,m("")}),[]),[g,p]=(0,i.useState)([]);(0,i.useEffect)((()=>{const t=e.profilesInChannel.filter((t=>t.id!==e.currentUserId&&0===t.delete_at)).map((t=>(0,y.R4)(t,e.teammateNameDisplaySetting)));p(t)}),[e.profilesInChannel,e.currentUserId,e.teammateNameDisplaySetting]);const[E,_]=(0,i.useState)({}),[b,f]=(0,i.useState)(!1),[v,C]=(0,i.useState)(!1),[M,A]=(0,i.useState)(),[N,S]=(0,i.useState)(!1),[w,I]=(0,i.useState)(),k=(0,d.useDispatch)(),T=(0,i.useRef)(!1);(0,i.useEffect)((()=>(T.current=!0,()=>{T.current=!1})),[]),(0,i.useEffect)((()=>{(async()=>{const t=await k((0,ae.fr)(e.channel.id));if(!T.current)return;if(t.error||!t.data)return;const n=t.data,a={};n.forEach((e=>{a[e.id]=e})),_(a),f(!0),1===n.length&&A(n[0].id)})(),setTimeout((()=>C(!0)),1200)}),[k,e.channel.id]);const O=(0,i.useCallback)((async()=>{if(!M)return;const{error:t}=await e.actions.convertGroupMessageToPrivateChannel(e.channel.id,M,a.trim(),s.current.trim());t?t.server_error_id===ge.CHANNEL_NAME_EXISTS?m(n({id:"channel_modal.alreadyExist",defaultMessage:"A channel with that URL already exists"})):I(t.message):(I(void 0),e.onExited())}),[M,e,a,n]),P=!b||!v,x=void 0!==M&&""!==a&&!N&&!u,R={};let L;if(P||0!==Object.keys(E).length){let t;R.handleCancel=P?void 0:e.onExited,R.isDeleteModal=!0,R.cancelButtonText=n({id:"channel_modal.cancel",defaultMessage:"Cancel"}),R.confirmButtonText=n({id:"sidebar_left.sidebar_channel_modal.confirmation_text",defaultMessage:"Convert to private channel"}),R.isConfirmDisabled=!x,t=P?o().createElement("div",{className:"loadingIndicator"},o().createElement(se.A,null)):o().createElement(o().Fragment,null,o().createElement(he,{channelMemberNames:g}),Object.keys(E).length>1&&o().createElement(ue,{teamsById:E,onChange:A}),o().createElement(le.A,{value:a,name:"convert-gm-to-channel-modal-channel-name",placeholder:n({id:"sidebar_left.sidebar_channel_modal.channel_name_placeholder",defaultMessage:"Enter a name for the channel"}),autoFocus:!1,onDisplayNameChange:l,onURLChange:h,onErrorStateChange:S,team:M?E[M]:void 0,urlError:u}),w&&o().createElement("div",{className:"conversion-error"},o().createElement("i",{className:"icon icon-alert-outline"}),o().createElement("span",null,w))),L=o().createElement("div",{className:r()({"convert-gm-to-channel-modal-body":!0,loading:P,"single-team":1===Object.keys(E).length,"multi-team":Object.keys(E).length>1})},t)}else R.confirmButtonText=n({id:"generic.okay",defaultMessage:"Okay"}),R.handleConfirm=e.onExited,L=o().createElement("div",{className:"convert-gm-to-channel-modal-body error"},o().createElement(ie,null));return o().createElement(ne.zW,Object.assign({id:"convert-gm-to-channel-modal",className:"convert-gm-to-channel-modal",modalHeaderText:n({id:"sidebar_left.sidebar_channel_modal.header",defaultMessage:"Convert to Private Channel"}),compassDesign:!0,handleConfirm:P?void 0:O,onExited:e.onExited,autoCloseOnConfirmButton:!1},R),L)};pe.propTypes={onExited:l().func.isRequired,profilesInChannel:l().array.isRequired,teammateNameDisplaySetting:l().string.isRequired,currentUserId:l().string.isRequired};const Ee=pe,_e=(0,d.connect)((function(){const e=(0,p.dH)();return(t,n)=>{const a=e(t,n.channel.id),l=(0,p.WR)(t);return{profilesInChannel:a,teammateNameDisplaySetting:(0,ee.K3)(t),currentUserId:l}}}),(function(e){return{actions:(0,Z.zH)({closeModal:P.O,convertGroupMessageToPrivateChannel:D.jr,moveChannelsInSidebar:te.nh},e)}}))(Ee),be=e=>{let{channel:t}=e;const n=(0,d.useDispatch)();return o().createElement(b.q7,{id:"convertGMPrivateChannel",onClick:()=>{n((0,P.q)({modalId:f.IQ.CONVERT_GM_TO_CHANNEL,dialogType:_e,dialogProps:{channel:t}}))},labels:o().createElement(c.FormattedMessage,{id:"sidebar_left.sidebar_channel_menu_convert_to_channel",defaultMessage:"Convert to Private Channel"})})},fe=o().memo(be);var ve=n(64109);const ye=["channel","user"],Ce=e=>{let{channel:t,user:n}=e,a=function(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,ye);const l=(0,d.useDispatch)();return o().createElement(b.q7,Object.assign({leadingElement:o().createElement(v.BellOutlineIcon,{size:"18px"}),id:"channelNotificationPreferences",onClick:()=>{l((0,P.q)({modalId:f.IQ.CHANNEL_NOTIFICATIONS,dialogType:ve.A,dialogProps:{channel:t,currentUser:n}}))},labels:o().createElement(c.FormattedMessage,{id:"navbar.preferences",defaultMessage:"Notification Preferences"})},a))},Me=o().memo(Ce),Ae=e=>{let{id:t,channel:n,text:a,editMembers:l=!1}=e;const s=(0,d.useDispatch)();let r=(0,d.useSelector)(U.A);return(0,d.useSelector)(U.bM)!==f._n.CHANNEL_MEMBERS&&(r=!1),o().createElement(b.q7,{leadingElement:o().createElement(v.AccountOutlineIcon,{size:16}),id:t,onClick:()=>{r||s((0,G.sQ)(n.id,l))},labels:a})};Ae.propTypes={id:l().string.isRequired,editMembers:l().bool,text:l().element.isRequired};const Ne=Ae,Se=["channel","user","isMuted","isMobile","isFavorite","pluginItems","isChannelBookmarksEnabled"],we=e=>{let{channel:t,user:n,isMuted:a,isMobile:l,isFavorite:s,pluginItems:r,isChannelBookmarksEnabled:i}=e,d=function(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,Se);const u=!0===(null==t?void 0:t.group_constrained),m=0!==t.delete_at,{formatMessage:h}=(0,c.useIntl)();return o().createElement(o().Fragment,null,o().createElement(V,Object.assign({channel:t},d)),o().createElement(z,{userID:n.id,channel:t,isMuted:a}),l&&o().createElement(o().Fragment,null,o().createElement(B,{channelID:t.id,isFavorite:s}),o().createElement(Y,{channelID:t.id})),!m&&o().createElement(Me,{user:n,channel:t}),!m&&(0,y.P)(n.roles)&&o().createElement(L,{leadingElement:o().createElement(v.CogOutlineIcon,{size:"18px"}),channel:t}),!m&&!u&&!(0,y.P)(n.roles)&&o().createElement(b.g8,{id:"channelSettings",labels:o().createElement(c.FormattedMessage,{id:"channel_header.settings",defaultMessage:"Settings"}),leadingElement:o().createElement(v.CogOutlineIcon,{size:18}),trailingElements:o().createElement(v.ChevronRightIcon,{size:16}),menuId:"channelSettings-menu",menuAriaLabel:h({id:"channel_header.settings",defaultMessage:"Settings"})},o().createElement(L,{channel:t}),o().createElement(fe,{channel:t})),!m&&!(0,y.P)(n.roles)&&i&&o().createElement(S,{channel:t}),o().createElement(b.wv,null),!m&&!u&&o().createElement($.A,{channelId:t.id,teamId:t.team_id,permissions:[J.xB.MANAGE_PUBLIC_CHANNEL_MEMBERS]},o().createElement(Ne,{id:"channelMembers",channel:t,text:o().createElement(c.FormattedMessage,{id:"channel_header.members",defaultMessage:"Members"})}),o().createElement(b.wv,null)),o().createElement(C.A,{channel:t}),!l&&o().createElement(H,{pluginItems:r}),o().createElement(b.wv,null),o().createElement(O,{currentUserID:n.id,channel:t}))};we.propTypes={isMuted:l().bool.isRequired,isMobile:l().bool.isRequired,isFavorite:l().bool.isRequired,pluginItems:l().arrayOf(l().node).isRequired,isChannelBookmarksEnabled:l().bool.isRequired};const Ie=we;var ke=n(27039);const Te=e=>e.isMobile?o().createElement(o().Fragment,null,o().createElement(ke.A,{channel:e.channel,isDropdown:!0}),o().createElement(b.wv,null),e.pluginItems):o().createElement(o().Fragment,null);Te.propTypes={isMobile:l().bool.isRequired,pluginItems:l().arrayOf(l().node).isRequired};const Oe=(0,i.memo)(Te);n(4290);var Pe=n(89735);function xe(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Re extends o().PureComponent{constructor(e){super(e),xe(this,"handleDelete",(()=>{this.props.channel.id.length===f.Ay.CHANNEL_ID_LENGTH&&(this.props.actions.deleteChannel(this.props.channel.id),this.onHide())})),xe(this,"onHide",(()=>{this.setState({show:!1})})),this.state={show:!0}}render(){return o().createElement(Pe.Modal,{dialogClassName:"a11y__modal",show:this.state.show,onHide:this.onHide,onExited:this.props.onExited,role:"none","aria-labelledby":"deleteChannelModalLabel",id:"deleteChannelModal"},o().createElement(Pe.Modal.Header,{closeButton:!0},o().createElement(Pe.Modal.Title,{componentClass:"h1",id:"deleteChannelModalLabel"},o().createElement(c.FormattedMessage,{id:"delete_channel.confirm",defaultMessage:"Confirm ARCHIVE Channel"}))),o().createElement(Pe.Modal.Body,null,o().createElement("div",{className:"alert alert-danger"},o().createElement("p",null,o().createElement(c.FormattedMessage,{id:"deleteChannelModal.canViewArchivedChannelsWarning",defaultMessage:"This will archive the channel from the team. Channel contents will still be accessible by channel members."})),o().createElement("p",null,o().createElement(c.FormattedMessage,{id:"deleteChannelModal.confirmArchive",defaultMessage:"Are you sure you wish to archive the <strong>{display_name}</strong> channel?",values:{display_name:this.props.channel.display_name,strong:e=>o().createElement("strong",null,e)}})))),o().createElement(Pe.Modal.Footer,null,o().createElement("button",{type:"button",className:"btn btn-tertiary",onClick:this.onHide},o().createElement(c.FormattedMessage,{id:"delete_channel.cancel",defaultMessage:"Cancel"})),o().createElement("button",{type:"button",className:"btn btn-danger","data-dismiss":"modal",onClick:this.handleDelete,autoFocus:!0,id:"deleteChannelModalDeleteButton"},o().createElement(c.FormattedMessage,{id:"delete_channel.del",defaultMessage:"Archive"}))))}}xe(Re,"propTypes",{onExited:l().func.isRequired,actions:l().shape({deleteChannel:l().func.isRequired}).isRequired});const Le=(0,d.connect)((function(e){return{currentTeamDetails:(0,I.H7)(e)}}),(function(e){return{actions:(0,Z.zH)({deleteChannel:k.D3},e)}}))(Re),Fe=e=>{let{channel:t}=e;const n=(0,d.useDispatch)();return o().createElement(b.q7,{id:"channelArchiveChannel",leadingElement:o().createElement(v.ArchiveOutlineIcon,{size:18}),onClick:()=>{n((0,P.q)({modalId:f.IQ.DELETE_CHANNEL,dialogType:Le,dialogProps:{channel:t}}))},labels:o().createElement(c.FormattedMessage,{id:"channel_header.delete",defaultMessage:"Archive Channel"}),isDestructive:!0})},He=(0,i.memo)(Fe);var De=n(8361),qe=n(80635);const Be=(0,De.Mz)("canAccessChannelSettings",(e=>e),(e=>e.entities.channels.channels),((e,t)=>t),((e,t,n)=>{const a=t[n];if(!a)return!1;const l=a.type===f.Ay.PRIVATE_CHANNEL,s=a.name===f.Ay.DEFAULT_CHANNEL,r=a.team_id,i=l?J.xB.MANAGE_PRIVATE_CHANNEL_PROPERTIES:J.xB.MANAGE_PUBLIC_CHANNEL_PROPERTIES,o=(0,qe.Ec)(e,r,n,i),c=l?J.xB.MANAGE_PRIVATE_CHANNEL_BANNER:J.xB.MANAGE_PUBLIC_CHANNEL_BANNER,d=(0,qe.Ec)(e,r,n,c),u=l?J.xB.DELETE_PRIVATE_CHANNEL:J.xB.DELETE_PUBLIC_CHANNEL,m=!s&&(0,qe.Ec)(e,r,n,u);return o||d||m}));var Ge=n(16983),Ue=n(67347),je=n(21413),Ve=n(30138),ze=n(52231),We=(n(57406),n(55448),n(54452)),Ye=n(68611),Qe=n(17461),Xe=n(44553);const Ke=e=>{let{policies:t=[],resourceType:n="channel",showPolicyNames:a=!0,variant:l="detailed",className:s="",testId:r="system-policy-indicator",onMorePoliciesClick:d}=e;const u=(0,i.useMemo)((()=>t&&Array.isArray(t)?t.filter((e=>e&&"object"==typeof e&&e.id)):[]),[t]),m=u.length>1,h=(0,i.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),d&&d()}),[d]),g=(0,i.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||h(e)}),[h]),p=(0,i.useCallback)((e=>e.name||e.id||"Unknown Policy"),[]),E=(0,i.useCallback)((()=>{if(!a||0===u.length)return"";if(1===u.length)return o().createElement("strong",null,p(u[0]));if(2===u.length)return o().createElement(o().Fragment,null,o().createElement("strong",null,p(u[0]))," and ",o().createElement("strong",null,p(u[1])));const e=u.length-2;return o().createElement(o().Fragment,null,o().createElement("strong",null,p(u[0])),", ",o().createElement("strong",null,p(u[1]))," and ",o().createElement("button",{type:"button",className:"system-policy-indicator__more-link",onClick:h,onKeyDown:g,"aria-label":"View ".concat(e," more policies"),tabIndex:0},o().createElement(c.FormattedMessage,{id:"system_policy_indicator.more_policies",defaultMessage:"{count} more",values:{count:e}})))}),[a,u,p,h,g]),_=(0,i.useCallback)((()=>o().createElement(c.FormattedMessage,{id:"system_policy_indicator.base_message",defaultMessage:"This {resourceType} has system-level access {policyText} applied",values:{resourceType:n,policyText:m?"policies":"policy"}})),[n,m]),b=(0,i.useCallback)((()=>{const e=m?o().createElement(c.FormattedMessage,{id:"system_policy_indicator.multiple_policies_title",defaultMessage:"Multiple system access policies applied to this {resourceType}",values:{resourceType:n}}):o().createElement(c.FormattedMessage,{id:"system_policy_indicator.single_policy_title",defaultMessage:"System access policy applied to this {resourceType}",values:{resourceType:n}});return o().createElement(o().Fragment,null,o().createElement("div",{className:"system-policy-indicator__title",role:"heading","aria-level":3},e),o().createElement("div",{className:"system-policy-indicator__description",role:"region","aria-label":"System policy details"},o().createElement(c.FormattedMessage,{id:"system_policy_indicator.description_with_policies",defaultMessage:"This {resourceType} has system-level access policies applied: {policyList}. Any custom access rules you set here will be applied in addition to this policy.",values:{resourceType:n,policyList:E()}})))}),[m,n,E]),f=(0,i.useCallback)((()=>"compact"===l?_():b()),[l,_,b]),v=(0,i.useMemo)((()=>f()),[f]);return 0===u.length?null:o().createElement(Xe.A,{id:r,mode:"info",className:"system-policy-indicator ".concat(s),variant:"app",message:v})};Ke.propTypes={policies:l().array,resourceType:l().oneOf(["channel","team","file"]),showPolicyNames:l().bool,variant:l().oneOf(["compact","detailed"]),className:l().string,testId:l().string,onMorePoliciesClick:l().func};const Je=Ke;var $e=n(66215),Ze=n(53779),et=n(87461),tt=n(54226);const nt=e=>{let{isOpen:t,onClose:n,onConfirm:a}=e;const[l,s]=(0,i.useState)(!1),r=(0,i.useCallback)((()=>{if(l)try{s(!1),a()}catch(e){console.error("Error confirming activity warning:",e)}}),[l,a]),d=(0,i.useCallback)((()=>{s(!1),n()}),[n]),u=(0,i.useCallback)((e=>{s(e)}),[]);return(0,i.useEffect)((()=>{s(!1)}),[t]),o().createElement(Qe.A,{id:"activityWarningModal",show:t,title:o().createElement(c.FormattedMessage,{id:"channel_settings.activity_warning.exposing_history_title",defaultMessage:"Exposing channel history"}),message:o().createElement("div",{className:"channel-activity-warning-content"},o().createElement("div",{className:"warning-description"},o().createElement(c.FormattedMessage,{id:"channel_settings.activity_warning.exposing_history_description",defaultMessage:"Everyone who gains access to this channel can view the entire message history, including messages that were sent under stricter access rules."}))),showCheckbox:!0,checkboxClass:"checkbox text-left mb-0 activity-warning-checkbox",checkboxText:o().createElement(c.FormattedMessage,{id:"channel_settings.activity_warning.acknowledge_expose_history",defaultMessage:"I acknowledge this change will expose all historical channel messages to more users"}),confirmButtonText:o().createElement(c.FormattedMessage,{id:"channel_settings.activity_warning.save_and_apply",defaultMessage:"Save and apply"}),confirmButtonClass:"btn btn-danger",confirmDisabled:!l,onConfirm:r,onCancel:d,onCheckboxChange:u,isStacked:!0})};nt.propTypes={isOpen:l().bool.isRequired,onClose:l().func.isRequired,onConfirm:l().func.isRequired};const at=nt,lt="saved",st="error",rt="confirmation_required",it=1e3;function ot(e){let{channel:t,setAreThereUnsavedChanges:n,showTabSwitchError:a}=e;const{formatMessage:l}=(0,c.useIntl)(),s=(0,d.useSelector)((e=>(0,We.Nh)(e))),r=(0,d.useSelector)(p.HW),u=(0,d.useSelector)((e=>(0,h.qQ)(e,t.id))),m=(0,d.useSelector)(p.J1),[g,E]=(0,i.useState)(""),[_,b]=(0,i.useState)(""),[f,v]=(0,i.useState)([]),[y,C]=(0,i.useState)(!1),[M,A]=(0,i.useState)(!1),[N,S]=(0,i.useState)(!1),[w,I]=(0,i.useState)(),[k,T]=(0,i.useState)(""),[O,P]=(0,i.useState)(!1),[x,R]=(0,i.useState)(!1),[L,F]=(0,i.useState)(!1),[H,D]=(0,i.useState)(0),[q,B]=(0,i.useState)(!1),[G,U]=(0,i.useState)([]),[j,V]=(0,i.useState)([]),[z,W]=(0,i.useState)(!1),Y=(0,Ze.V)(t.id),{policies:Q,loading:X}=function(e){const t=(0,d.useDispatch)(),[n,a]=(0,i.useState)([]),[l,s]=(0,i.useState)(!0),[r,o]=(0,i.useState)(null);return(0,i.useEffect)((()=>{if(!e)return a([]),void s(!1);(async()=>{s(!0),o(null);try{if(!e.policy_enforced)return a([]),void s(!1);const n=await t((0,et.Ar)(e.id));if(n.error)return a([]),void s(!1);const l=n.data;if(l&&l.imports&&l.imports.length>0){const n=l.imports.map((n=>t((0,et.Ar)(n,e.id)))),s=await Promise.all(n),r=[];for(const e of s)e&&!e.error&&e.data&&r.push(e.data);a(r)}else l&&"parent"===l.type?a([l]):a([])}catch(e){o("Failed to fetch policies"),a([])}finally{s(!1)}})()}),[e,null==e?void 0:e.id,null==e?void 0:e.policy_enforced,t]),{policies:n,loading:l,error:r}}(t);(0,i.useEffect)((()=>{(async()=>{try{const e=await Y.getAccessControlFields("",100);e.data&&v(e.data),C(!0)}catch(e){v([]);const t=e instanceof Error?e.message:String(e);(t.includes("403")||t.includes("Forbidden"))&&C(!0)}})()}),[Y]),(0,i.useEffect)((()=>{(async()=>{try{const a=await Y.getChannelPolicy(t.id);if(a.data){var e,n;const t=(null===(e=a.data.rules)||void 0===e||null===(n=e[0])||void 0===n?void 0:n.expression)||"",l=a.data.active||!1;E(t),b(t),A(l),S(l)}}catch(e){E(""),b("")}})()}),[t.id,Y]),(0,i.useEffect)((()=>{null==n||n(g!==_||M!==N)}),[g,_,M,N,n]);const K=(0,i.useCallback)((e=>{E(e),I(void 0)}),[]),J=(0,i.useCallback)((e=>{console.warn("Failed to parse expression in table editor"),null!=e&&e.includes("403")||null!=e&&e.includes("Forbidden")||T(l({id:"channel_settings.access_rules.parse_error",defaultMessage:"Invalid expression format"}))}),[l]),$=(0,i.useMemo)((()=>{const e=g&&g.trim().length>0,t=Q&&Q.length>0;return!(e||t)}),[g,Q]);(0,i.useEffect)((()=>{X||$&&M&&A(!1)}),[$,M]);const Z=(0,i.useCallback)((()=>{$||A((e=>!e))}),[$]),ee=(0,i.useCallback)((e=>{const t=Q.map((e=>{var t,n;return null===(t=e.rules)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.expression})).filter((e=>e&&e.trim())),n=[];return e.trim()&&n.push(e.trim()),t.length>0&&n.push(...t),0===n.length?"":1===n.length?n[0]:n.map((e=>"(".concat(e,")"))).join(" && ")}),[Q]),te=(0,i.useCallback)((async e=>{if(!e.trim())return!0;if(null==r||!r.id)return T(l({id:"channel_settings.access_rules.error.no_current_user",defaultMessage:"Cannot validate access rules: current user not found"})),!1;try{var t;return!(null===(t=(await Y.validateExpressionAgainstRequester(e)).data)||void 0===t||!t.requester_matches)||(P(!0),!1)}catch(e){return console.error("Failed to validate self-exclusion:",e),T(l({id:"channel_settings.access_rules.error.validation_failed",defaultMessage:"Failed to validate access rules. Please try again."})),!1}}),[null==r?void 0:r.id]),ne=(0,i.useCallback)((async(e,t)=>{try{var n,a;const l=e.trim().length>0,s=t.trim().length>0;if(!l)return!1;if(!s)return!0;const r=ee(e),i=ee(t),o=(null===(n=(await Y.searchUsers(r,"","",it)).data)||void 0===n?void 0:n.users.map((e=>e.id)))||[],c=(null===(a=(await Y.searchUsers(i,"","",it)).data)||void 0===a?void 0:a.users.map((e=>e.id)))||[];return c.filter((e=>!o.includes(e))).length>0||!(o.filter((e=>!c.includes(e))).length>0)&&e.trim()!==t.trim()}catch(e){return console.error("Failed to compare expression restrictiveness:",e),!0}}),[Y,ee]),ae=(0,i.useCallback)((async e=>{const n=ee(e);if(!n.trim())return{toAdd:[],toRemove:[],potentialToAdd:[]};try{var a,l;const e=(null===(a=(await Y.searchUsers(n,"","",it)).data)||void 0===a?void 0:a.users.map((e=>e.id)))||[],s=(null===(l=(await Y.getChannelMembers(t.id)).data)||void 0===l?void 0:l.map((e=>e.user_id)))||[],r=e.filter((e=>!s.includes(e)));return{toAdd:M?r:[],toRemove:s.filter((t=>!e.includes(t))),potentialToAdd:r}}catch(e){return console.error("Failed to calculate membership changes:",e),{toAdd:[],toRemove:[],potentialToAdd:[]}}}),[t.id,M,Y,ee]),le=(0,i.useCallback)((async()=>{try{if(W(!0),$){try{await Y.deleteChannelPolicy(t.id)}catch(e){const t=e instanceof Error?e.message:String(e);if(t&&!t.includes("not found"))throw new Error(t||"Failed to delete channel policy")}return b(""),S(!1),B(!1),U([]),V([]),!0}const e={id:t.id,name:t.display_name,type:"channel",version:"v0.2",active:!1,revision:1,created_at:Date.now(),rules:g.trim()?[{actions:["*"],expression:g.trim()}]:[],imports:Q.map((e=>e.id))},n=await Y.saveChannelPolicy(e);if(n.error)throw new Error(n.error.message||"Failed to save policy");try{await Y.updateAccessControlPoliciesActive([{id:t.id,active:M}])}catch(e){console.error("Failed to update policy active status:",e)}if(g.trim())try{await Y.createAccessControlSyncJob({policy_id:t.id})}catch(e){console.error("Failed to create access control sync job:",e)}return b(g),S(M),B(!1),U([]),V([]),!0}catch(e){return console.error("Failed to save access rules:",e),T(l({id:"channel_settings.access_rules.save_error",defaultMessage:"Failed to save access rules"})),!1}finally{W(!1)}}),[t.id,t.display_name,g,M,Q,Y,l,$]),se=(0,i.useCallback)((async()=>{try{var e;const t=(null!==(e=null==u?void 0:u.total)&&void 0!==e?e:0)>0,n=_.trim().length>0,a=g.trim().length>0,s=n&&!a;if($){if(s&&t)return F(!0),D((e=>e+1)),R(!0),rt;return await le()?lt:st}if(M&&$)return T(l({id:"channel_settings.access_rules.expression_required_for_autosync",defaultMessage:"Access rules are required when auto-add members is enabled"})),st;if(g.trim()&&!await te(g))return st;const r=await ae(g),i=await ne(_,g),o=r.toAdd.length>0,c=t&&(s||!M&&i||M&&i||M&&o)&&!(!n&&a);if(r.toAdd.length>0||r.toRemove.length>0)return U(r.toAdd),V(r.toRemove),F(c),B(!0),rt;if(c)return F(!0),D((e=>e+1)),R(!0),rt;return await le()?lt:st}catch(e){return console.error("handleSave: Caught error in save process:",e),T(l({id:"channel_settings.access_rules.save_error",defaultMessage:"Failed to save access rules"})),st}}),[g,_,M,l,te,ae,le,$,u,ne]),re=(0,i.useRef)(!1),ie=(0,i.useCallback)((async()=>{if(!re.current){if(B(!1),L)return D((e=>e+1)),void R(!0);re.current=!0;try{const e=await le();I(e?lt:st)}finally{re.current=!1}}}),[L,le]),oe=(0,i.useCallback)((async()=>{if(!re.current){re.current=!0;try{const e=await se();e===lt?I(lt):e===st&&I(st)}finally{re.current=!1}}}),[se]),ce=(0,i.useCallback)((()=>{E(_),A(N),T(""),I(void 0)}),[_,N]),de=(0,i.useCallback)((()=>{I(void 0)}),[]),ue=(0,i.useCallback)((async()=>{R(!1),re.current=!0;try{const e=await le();I(e?lt:st)}finally{re.current=!1}}),[le]),me=(0,i.useCallback)((()=>{R(!1)}),[]),he=Boolean(k)||Boolean(a),ge=(0,i.useMemo)((()=>g!==_||M!==N||w===lt),[g,_,M,N,w]);return o().createElement("div",{className:"ChannelSettingsModal__accessRulesTab"},!X&&Q.length>0&&o().createElement("div",{className:"ChannelSettingsModal__systemPolicies"},o().createElement(Je,{policies:Q,resourceType:"channel",showPolicyNames:!0,variant:"detailed"})),o().createElement("div",{className:"ChannelSettingsModal__accessRulesHeader"},o().createElement("h3",{className:"ChannelSettingsModal__accessRulesTitle"},l({id:"channel_settings.access_rules.title",defaultMessage:"Access Rules"})),o().createElement("p",{className:"ChannelSettingsModal__accessRulesSubtitle"},l({id:"channel_settings.access_rules.subtitle",defaultMessage:"Select user attributes and values as rules to restrict channel membership"}))),y&&o().createElement("div",{className:"ChannelSettingsModal__accessRulesEditor"},o().createElement(Ye.Ay,{value:g,onChange:K,onValidate:()=>T(""),userAttributes:f,onParseError:J,channelId:t.id,actions:Y,enableUserManagedAttributes:(null==s?void 0:s.EnableUserManagedAttributes)||!1,isSystemAdmin:m,validateExpressionAgainstRequester:Y.validateExpressionAgainstRequester})),o().createElement("hr",{className:"ChannelSettingsModal__divider"}),o().createElement("div",{className:"ChannelSettingsModal__autoSyncSection"},o().createElement("div",{className:"ChannelSettingsModal__autoSyncCheckboxContainer"},o().createElement("input",{type:"checkbox",className:"ChannelSettingsModal__autoSyncCheckbox",checked:M,onChange:Z,disabled:$,id:"autoSyncMembersCheckbox",name:"autoSyncMembers"}),o().createElement("label",{htmlFor:"autoSyncMembersCheckbox",className:"ChannelSettingsModal__autoSyncLabel",title:$?l({id:"channel_settings.access_rules.auto_sync_disabled_empty_state",defaultMessage:"Auto-add is disabled because no access rules are defined"}):g.trim()?void 0:l({id:"channel_settings.access_rules.auto_sync_requires_expression",defaultMessage:"Define access rules to enable auto-add members"})},o().createElement("span",{className:"ChannelSettingsModal__autoSyncText ".concat($&&0===Q.length?"disabled":"")},l({id:"channel_settings.access_rules.auto_sync",defaultMessage:"Auto-add members based on access rules"})))),o().createElement("p",{className:"ChannelSettingsModal__autoSyncDescription"},l(M?{id:"channel_settings.access_rules.auto_sync_enabled_description",defaultMessage:"Users who match the configured attribute values will be automatically added as members and those who no longer match will be removed."}:{id:"channel_settings.access_rules.auto_sync_disabled_description",defaultMessage:"Access rules will prevent unauthorized users from joining, but will not automatically add qualifying members."}))),ge&&o().createElement($e.A,{handleSubmit:oe,handleCancel:ce,handleClose:de,tabChangeError:he,state:he?st:w,customErrorMessage:k||(a?void 0:l({id:"channel_settings.access_rules.form_error",defaultMessage:"There are errors in the form above"})),cancelButtonText:l({id:"channel_settings.save_changes_panel.reset",defaultMessage:"Reset"})}),o().createElement(Qe.A,{show:O,title:o().createElement(c.FormattedMessage,{id:"channel_settings.access_rules.error.self_exclusion_title",defaultMessage:"Cannot save access rules"}),message:o().createElement(c.FormattedMessage,{id:"channel_settings.access_rules.error.self_exclusion_message",defaultMessage:"You cannot set this rule because it would remove you from the channel. Please update the access rules to make sure you satisfy them and they don't cause any unintended issues."}),confirmButtonText:o().createElement(c.FormattedMessage,{id:"channel_settings.access_rules.error.back_to_editing",defaultMessage:"Back to editing"}),onConfirm:()=>P(!1),onCancel:()=>P(!1),hideCancel:!0,confirmButtonClass:"btn btn-primary",isStacked:!0}),o().createElement(tt.A,{show:q,onHide:()=>{B(!1),U([]),V([]),w===st&&I(void 0)},onConfirm:ie,channelName:t.display_name,usersToAdd:G,usersToRemove:j,isProcessing:z,autoSyncEnabled:M,isStacked:!0,willShowActivityWarning:L}),o().createElement(at,{key:H,isOpen:x,onClose:me,onConfirm:ue}))}ot.propTypes={setAreThereUnsavedChanges:l().func,showTabSwitchError:l().bool};const ct=ot;function dt(e){let{channel:t,onHide:n}=e;const{formatMessage:a}=(0,c.useIntl)(),l=(0,d.useDispatch)(),[s,r]=(0,i.useState)(!1),u=(0,i.useCallback)((()=>{r(!0)}),[]);return o().createElement("div",{className:"ChannelSettingsModal__archiveTab"},o().createElement(c.FormattedMessage,{id:"channel_settings.archive.warning",defaultMessage:"Archiving a channel removes it from the user interface, but doesn't permanently delete the channel. New messages can't be posted to archived channels."}),o().createElement("button",{type:"button",className:"btn btn-danger",onClick:u,id:"channelSettingsArchiveChannelButton","aria-label":"Archive channel ".concat(t.display_name)},o().createElement(c.FormattedMessage,{id:"channel_settings.archive.button",defaultMessage:"Archive this channel"})),s&&o().createElement(Qe.A,{id:"archiveChannelConfirmModal",show:!0,title:a({id:"channel_settings.modal.archiveTitle",defaultMessage:"Archive channel?"}),message:o().createElement("div",null,o().createElement("p",null,o().createElement(c.FormattedMessage,{id:"deleteChannelModal.canViewArchivedChannelsWarning",defaultMessage:"Archiving a channel removes it from the user interface, but doesn't permanently delete the channel. New messages can't be posted to archived channels."})),o().createElement("p",null,o().createElement(c.FormattedMessage,{id:"deleteChannelModal.confirmArchive",defaultMessage:"Are you sure you wish to archive the <strong>{display_name}</strong> channel?",values:{display_name:t.display_name,strong:e=>o().createElement("strong",null,e)}}))),confirmButtonText:a({id:"channel_settings.modal.confirmArchive",defaultMessage:"Confirm"}),onConfirm:async()=>{await l((0,k.D3)(t.id)),n()},onCancel:()=>r(!1),confirmButtonClass:"btn btn-danger",modalClass:"archiveChannelConfirmModal",focusOriginElement:"channelSettingsArchiveChannelButton",isStacked:!0}))}dt.propTypes={onHide:l().func.isRequired};const ut=dt;var mt=n(61295),ht=n(79407),gt=n(71432);function pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(n),!0).forEach((function(t){_t(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _t(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const bt={enabled:!1,background_color:"#DDDDDD",text:""};function ft(e){let{channel:t,setAreThereUnsavedChanges:n,showTabSwitchError:a}=e;const{formatMessage:l}=(0,c.useIntl)(),s=(0,d.useDispatch)(),r=l({id:"channel_banner.label.name",defaultMessage:"Channel Banner"}),u=l({id:"channel_banner.label.subtext",defaultMessage:"When enabled, a customized banner will display at the top of the channel."}),m=l({id:"channel_banner.banner_text.label",defaultMessage:"Banner text"}),h=l({id:"channel_banner.banner_color.label",defaultMessage:"Banner color"}),g=l({id:"channel_banner.banner_text.placeholder",defaultMessage:"Channel banner text"}),p=t.banner_info||bt,[E,_]=(0,i.useState)(""),[b,f]=(0,i.useState)(!1),[v,y]=(0,i.useState)(p),[C,M]=(0,i.useState)(!1),[A,N]=(0,i.useState)(!1),[S,w]=(0,i.useState)(),I=(0,i.useCallback)((()=>{const e=!v.enabled,t=Et(Et({},v),{},{enabled:e});e||(t.text=p.text,t.background_color=p.background_color),y(t)}),[p,v]),k=(0,i.useCallback)((()=>{_(""),w(void 0)}),[]),T=(0,i.useCallback)((e=>{const t=e.target.value;y((e=>Et(Et({},e),{},{text:t}))),t.trim().length>1024?(_(l({id:"channel_settings.save_changes_panel.standard_error",defaultMessage:"There are errors in the form above"})),N(!0)):t.trim().length<=0?(_(l({id:"channel_settings.save_changes_panel.banner_text.required_error",defaultMessage:"Channel banner text cannot be empty when enabled"})),N(!0)):(k(),N(!1))}),[l,k]),O=(0,i.useCallback)((e=>{y((t=>Et(Et({},t),{},{background_color:e}))),e.trim()&&k()}),[k]),P=(0,i.useCallback)((()=>f((e=>!e))),[]),x=(0,i.useCallback)((()=>{var e,t,n,a;return((null===(e=v.text)||void 0===e?void 0:e.trim())||"")!==((null==p||null===(t=p.text)||void 0===t?void 0:t.trim())||"")||((null===(n=v.background_color)||void 0===n?void 0:n.trim())||"")!==((null==p||null===(a=p.background_color)||void 0===a?void 0:a.trim())||"")||v.enabled!==(null==p?void 0:p.enabled)}),[p,v]);(0,i.useEffect)((()=>{const e=x();M(e),null==n||n(e)}),[x,n]);const R=(0,i.useCallback)((e=>{const t=e.message||l({id:"channel_settings.unknown_error",defaultMessage:"Something went wrong."});_(t)}),[l]),L=(0,i.useCallback)((async()=>{var e,n,a,r;if(!t)return!1;if(v.enabled&&(null===(e=v.text)||void 0===e||!e.trim()))return _(l({id:"channel_settings.error_banner_text_required",defaultMessage:"Banner text is required"})),!1;if(v.enabled&&(null===(n=v.background_color)||void 0===n||!n.trim()))return _(l({id:"channel_settings.error_banner_color_required",defaultMessage:"Banner color is required"})),!1;const i=Et({},t);i.banner_info={text:(null===(a=v.text)||void 0===a?void 0:a.trim())||"",background_color:(null===(r=v.background_color)||void 0===r?void 0:r.trim())||"",enabled:v.enabled};const{error:o}=await s((0,D.ER)(t.id,i));return!o||(R(o),!1)}),[t,s,l,R,v]),F=(0,i.useCallback)((async()=>{await L()?(y((e=>{var t,n;return Et(Et({},e),{},{text:(null===(t=e.text)||void 0===t?void 0:t.trim())||"",background_color:(null===(n=e.background_color)||void 0===n?void 0:n.trim())||""})})),k(),w("saved")):w("error")}),[L,k]),H=(0,i.useCallback)((()=>{M(!1),w(void 0),f(!1),y(p),_(""),w(void 0),N(!1)}),[p]),q=(0,i.useCallback)((()=>{w(void 0),M(!1)}),[]),B=Boolean(E)||A||a,G=C||"saved"===S;return o().createElement("div",{className:"ChannelSettingsModal__configurationTab"},o().createElement("div",{className:"channel_banner_header"},o().createElement("div",{className:"channel_banner_header__text"},o().createElement("label",{className:"Input_legend","aria-label":r},r),o().createElement("label",{className:"Input_subheading","aria-label":r},u)),o().createElement("div",{className:"channel_banner_header__toggle"},o().createElement(ht.A,{id:"channelBannerToggle",ariaLabel:r,size:"btn-md",disabled:!1,onToggle:I,toggled:v.enabled,tabIndex:0,toggleClassName:"btn-toggle-primary"}))),v.enabled&&o().createElement("div",{className:"channel_banner_section_body"},o().createElement("div",{className:"setting_section"},o().createElement("span",{className:"setting_title","aria-label":m},m),o().createElement("div",{className:"setting_body"},o().createElement(gt.A,{id:"channel_banner_banner_text_textbox",value:v.text,channelId:t.id,onKeyPress:()=>{},showCharacterCount:!0,useChannelMentions:!1,onChange:T,preview:b,togglePreview:P,hasError:A,createMessage:g,maxLength:1024,minLength:0}))),o().createElement("div",{className:"setting_section"},o().createElement("span",{className:"setting_title","aria-label":h},h),o().createElement("div",{className:"setting_body"},o().createElement(mt.A,{id:"channel_banner_banner_background_color_picker",onChange:O,value:v.background_color||""})))),G&&o().createElement($e.A,{handleSubmit:F,handleCancel:H,handleClose:q,tabChangeError:B,state:B?"error":S,customErrorMessage:E,cancelButtonText:l({id:"channel_settings.save_changes_panel.reset",defaultMessage:"Reset"})}))}ft.propTypes={setAreThereUnsavedChanges:l().func,showTabSwitchError:l().bool};const vt=ft;var yt=n(50880),Ct=n(45495),Mt=n(24530);function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){St(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function St(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wt(e){var t,n,a,l,s;let{channel:r,onCancel:u,setAreThereUnsavedChanges:m,showTabSwitchError:h}=e;const{formatMessage:g}=(0,c.useIntl)(),p=(0,d.useDispatch)(),E=(0,d.useSelector)(yt.My),_=(0,d.useSelector)(yt.dm),b=(0,d.useSelector)((e=>(0,qe.Ec)(e,r.team_id,r.id,Ge.A.CONVERT_PUBLIC_CHANNEL_TO_PRIVATE))),v=(0,d.useSelector)((e=>(0,qe.Ec)(e,r.team_id,r.id,Ge.A.CONVERT_PRIVATE_CHANNEL_TO_PUBLIC))),y=r.type===f.Ay.PRIVATE_CHANNEL?Ge.A.MANAGE_PRIVATE_CHANNEL_PROPERTIES:Ge.A.MANAGE_PUBLIC_CHANNEL_PROPERTIES,C=(0,d.useSelector)((e=>(0,qe.Ec)(e,r.team_id,r.id,y))),M=1024,[A,N]=(0,i.useState)(""),[S,w]=(0,i.useState)(""),[I,k]=(0,i.useState)(!1),[T,O]=(0,i.useState)(!1),[P,x]=(0,i.useState)(null!==(t=null==r?void 0:r.display_name)&&void 0!==t?t:""),[R,L]=(0,i.useState)(null!==(n=null==r?void 0:r.name)&&void 0!==n?n:""),[F,H]=(0,i.useState)(null!==(a=r.purpose)&&void 0!==a?a:""),[q,B]=(0,i.useState)(null!==(l=null==r?void 0:r.header)&&void 0!==l?l:""),[G,U]=(0,i.useState)(null!==(s=null==r?void 0:r.type)&&void 0!==s?s:f.Ay.OPEN_CHANNEL),[j,V]=(0,i.useState)(""),[z,W]=(0,i.useState)(),Y=(0,i.useCallback)(((e,t)=>{w(t||""),e&&t?V(t):j===S&&V("")}),[S,j,V]);(0,i.useEffect)((()=>{const e=!!r&&(P.trim()!==r.display_name||R.trim()!==r.name||F.trim()!==r.purpose||q.trim()!==r.header||G!==r.type);null==m||m(e)}),[r,P,R,F,q,G,m]);const Q=(0,i.useCallback)((e=>{A&&(V(""),W(void 0),N("")),L(e.trim())}),[A]),X=(0,i.useCallback)((()=>{p((0,Ue.oL)(!E))}),[p,E]),K=(0,i.useCallback)((()=>{p((0,Ue.tR)(!_))}),[p,_]),$=(0,i.useCallback)((e=>{const t=e.target.value;B(t),t.trim().length>M?V(g({id:"edit_channel_header_modal.error",defaultMessage:"The text entered exceeds the character limit. The channel header is limited to {maxLength} characters."},{maxLength:M})):j&&!S&&V("")}),[M,j,S,V,g]),Z=(0,i.useCallback)((e=>{const t=e.target.value;H(t),t.trim().length>f.Ay.MAX_CHANNELPURPOSE_LENGTH?V(g({id:"channel_settings.error_purpose_length",defaultMessage:"The text entered exceeds the character limit. The channel purpose is limited to {maxLength} characters."},{maxLength:f.Ay.MAX_CHANNELPURPOSE_LENGTH})):j&&!S&&V("")}),[j,S,V,g]),ee=e=>{const t=e.message||g({id:"channel_settings.unknown_error",defaultMessage:"Something went wrong."});V(t),W("error"),e.message&&(e.message.toLowerCase().includes("url")||e.message.toLowerCase().includes("name")||e.message.toLowerCase().includes("already exists"))&&N(t)},te=(0,i.useCallback)((async()=>{var e,t,n,a;if(!r)return!1;if(!P.trim())return V(g({id:"channel_settings.error_display_name_required",defaultMessage:"Channel name is required"})),!1;if(r.type===f.Ay.OPEN_CHANNEL&&G===f.Ay.PRIVATE_CHANNEL){const{error:e}=await p((0,D.nr)(r.id,J.Bz.PRIVATE_CHANNEL));if(e)return ee(e),!1}const l=Nt(Nt({},r),{},{display_name:P.trim(),name:R.trim(),purpose:F.trim(),header:q.trim()}),{data:s,error:i}=await p((0,D.ER)(r.id,l));return i?(ee(i),!1):(x(null!==(e=null==s?void 0:s.display_name)&&void 0!==e?e:l.display_name),L(null!==(t=null==s?void 0:s.name)&&void 0!==t?t:l.name),H(null!==(n=null==s?void 0:s.purpose)&&void 0!==n?n:l.purpose),B(null!==(a=null==s?void 0:s.header)&&void 0!==a?a:l.header),!0)}),[r,P,R,F,q,G,V,ee]),ne=(0,i.useCallback)((async()=>{r.type!==f.Ay.OPEN_CHANNEL||G!==f.Ay.PRIVATE_CHANNEL?await te()?W("saved"):W("error"):O(!0)}),[r,G,te]),ae=(0,i.useCallback)((()=>{W(void 0)}),[]),se=(0,i.useCallback)((()=>{O(!1)}),[]),re=(0,i.useCallback)((()=>{var e,t,n,a,l;W(void 0),x(null!==(e=null==r?void 0:r.display_name)&&void 0!==e?e:""),L(null!==(t=null==r?void 0:r.name)&&void 0!==t?t:""),H(null!==(n=null==r?void 0:r.purpose)&&void 0!==n?n:""),B(null!==(a=null==r?void 0:r.header)&&void 0!==a?a:""),U(null!==(l=null==r?void 0:r.type)&&void 0!==l?l:f.Ay.OPEN_CHANNEL),N(""),V(""),k(!1),w(""),u&&u()}),[r,u,V]),ie=Boolean(j)||I||Boolean(S)||Boolean(h)||Boolean(A),oe=(0,i.useMemo)((()=>!!r&&(P.trim()!==r.display_name||R.trim()!==r.name||F.trim()!==r.purpose||q.trim()!==r.header||G!==r.type)||"saved"===z),[r,P,R,F,q,G,z]);return o().createElement("div",{className:"ChannelSettingsModal__infoTab"},o().createElement(Ct.A,{show:T,onCancel:se,onConfirm:async()=>{se(),await te()?W("saved"):W("error")},displayName:(null==r?void 0:r.display_name)||"",toPublic:!1}),o().createElement("div",{className:"ChannelSettingsModal__infoTabTitle"},g({id:"channel_settings.channel_info_tab.name",defaultMessage:"Channel Info"})),o().createElement(le.A,{value:P,name:"channel-settings-name",placeholder:g({id:"channel_settings_modal.name.placeholder",defaultMessage:"Enter a name for your channel"}),onDisplayNameChange:e=>{x(e)},onURLChange:Q,onErrorStateChange:Y,urlError:A,currentUrl:R,readOnly:!C,isEditingExistingChannel:!0}),o().createElement(Mt.A,{className:"ChannelSettingsModal__typeSelector",selected:G,publicButtonProps:{title:g({id:"channel_modal.type.public.title",defaultMessage:"Public Channel"}),description:g({id:"channel_modal.type.public.description",defaultMessage:"Anyone can join"}),disabled:r.type===f.Ay.PRIVATE_CHANNEL||!v},privateButtonProps:{title:g({id:"channel_modal.type.private.title",defaultMessage:"Private Channel"}),description:g({id:"channel_modal.type.private.description",defaultMessage:"Only invited members"}),disabled:!b},onChange:e=>{r.type===f.Ay.PRIVATE_CHANNEL&&e===f.Ay.OPEN_CHANNEL||(r.type!==f.Ay.OPEN_CHANNEL||e!==f.Ay.PRIVATE_CHANNEL||b)&&(U(e),V(""))}}),o().createElement(gt.A,{id:"channel_settings_purpose_textbox",value:F,channelId:r.id,onChange:Z,createMessage:g({id:"channel_settings_modal.purpose.placeholder",defaultMessage:"Enter a purpose for this channel"}),maxLength:f.Ay.MAX_CHANNELPURPOSE_LENGTH,preview:E,togglePreview:X,useChannelMentions:!1,onKeyPress:()=>{},descriptionMessage:g({id:"channel_settings.purpose.description",defaultMessage:"Describe how this channel should be used."}),hasError:F.length>f.Ay.MAX_CHANNELPURPOSE_LENGTH,errorMessage:F.length>f.Ay.MAX_CHANNELPURPOSE_LENGTH?g({id:"channel_settings.error_purpose_length",defaultMessage:"The channel purpose exceeds the maximum character limit of {maxLength} characters."},{maxLength:f.Ay.MAX_CHANNELPURPOSE_LENGTH}):void 0,showCharacterCount:F.length>f.Ay.MAX_CHANNELPURPOSE_LENGTH,readOnly:!C,name:g({id:"channel_settings.purpose.label",defaultMessage:"Channel Purpose"})}),o().createElement(gt.A,{id:"channel_settings_header_textbox",value:q,channelId:r.id,onChange:$,createMessage:g({id:"channel_settings_modal.header.placeholder",defaultMessage:"Enter a header description or important links"}),maxLength:M,preview:_,togglePreview:K,useChannelMentions:!1,onKeyPress:()=>{},descriptionMessage:g({id:"channel_settings.purpose.header",defaultMessage:"This is the text that will appear in the header of the channel beside the channel name. You can use markdown to include links by typing [Link Title](http://example.com)."}),hasError:q.length>M,errorMessage:q.length>M?g({id:"edit_channel_header_modal.error",defaultMessage:"The channel header exceeds the maximum character limit of {maxLength} characters."},{maxLength:M}):void 0,showCharacterCount:q.length>M,readOnly:!C,name:g({id:"channel_settings.header.label",defaultMessage:"Channel Header"})}),C&&oe&&o().createElement($e.A,Object.assign({handleSubmit:ne,handleCancel:re,handleClose:ae,tabChangeError:ie,state:ie?"error":z},!h&&{customErrorMessage:g({id:"channel_settings.save_changes_panel.standard_error",defaultMessage:"There are errors in the form above"})},{cancelButtonText:g({id:"channel_settings.save_changes_panel.reset",defaultMessage:"Reset"})})))}wt.propTypes={onCancel:l().func,setAreThereUnsavedChanges:l().func,showTabSwitchError:l().bool};const It=wt,kt=o().lazy((()=>n.e(9163).then(n.bind(n,61544))));var Tt=function(e){return e.INFO="info",e.ACCESS_RULES="access_rules",e.CONFIGURATION="configuration",e.ARCHIVE="archive",e}(Tt||{});function Ot(e){let{channelId:t,isOpen:n,onExited:a,focusOriginElement:l}=e;const{formatMessage:s}=(0,c.useIntl)(),r=(0,d.useDispatch)(),u=(0,d.useSelector)((e=>(0,h.c)(e,t))),m=(0,ze.$X)((0,d.useSelector)(g.Ay)),p=(0,d.useSelector)((e=>(0,qe.Ec)(e,u.team_id,u.id,Ge.A.MANAGE_PUBLIC_CHANNEL_BANNER))),E=(0,d.useSelector)((e=>(0,qe.Ec)(e,u.team_id,u.id,Ge.A.MANAGE_PRIVATE_CHANNEL_BANNER))),_="O"===u.type&&p||"P"===u.type&&E,b=m&&_,v=(0,d.useSelector)((e=>(0,qe.Ec)(e,u.team_id,u.id,Ge.A.DELETE_PRIVATE_CHANNEL))),y=(0,d.useSelector)((e=>(0,qe.Ec)(e,u.team_id,u.id,Ge.A.DELETE_PUBLIC_CHANNEL))),C=(0,d.useSelector)((e=>(0,qe.Ec)(e,u.team_id,u.id,Ge.A.MANAGE_CHANNEL_ACCESS_RULES))),M=(0,d.useSelector)(je.Ml)&&C&&u.type===f.Ay.PRIVATE_CHANNEL&&!u.group_constrained,[A,N]=(0,i.useState)(n),[S,w]=(0,i.useState)(Tt.INFO),[I,k]=(0,i.useState)(!1),[T,O]=(0,i.useState)(!1),[P,x]=(0,i.useState)(!1),R=(0,i.useRef)(null),L=()=>{r((0,Ue.tR)(!1)),r((0,Ue.oL)(!1)),N(!1)},F=()=>o().createElement(It,{channel:u,setAreThereUnsavedChanges:O,showTabSwitchError:I}),H=[{name:Tt.INFO,uiName:s({id:"channel_settings.tab.info",defaultMessage:"Info"}),icon:"icon icon-information-outline",iconTitle:s({id:"generic_icons.info",defaultMessage:"Info Icon"})},{name:Tt.ACCESS_RULES,uiName:s({id:"channel_settings.tab.access_control",defaultMessage:"Access Control"}),icon:"icon icon-shield-outline",iconTitle:s({id:"generic_icons.access_rules",defaultMessage:"Access Rules Icon"}),display:M},{name:Tt.CONFIGURATION,uiName:s({id:"channel_settings.tab.configuration",defaultMessage:"Configuration"}),icon:"icon icon-cog-outline",iconTitle:s({id:"generic_icons.settings",defaultMessage:"Settings Icon"}),display:b},{name:Tt.ARCHIVE,uiName:s({id:"channel_settings.tab.archive",defaultMessage:"Archive Channel"}),icon:"icon icon-archive-outline",iconTitle:s({id:"generic_icons.archive",defaultMessage:"Archive Icon"}),newGroup:!0,display:u.name!==f.Ay.DEFAULT_CHANNEL&&(u.type===f.Ay.PRIVATE_CHANNEL&&v||u.type===f.Ay.OPEN_CHANNEL&&y)}],D=s({id:"channel_settings.modal.title",defaultMessage:"Channel Settings"});return o().createElement(ne.zW,{id:"channelSettingsModal",ariaLabel:D,className:"ChannelSettingsModal settings-modal",show:A,onHide:()=>{T&&!P?(x(!0),k(!0),setTimeout((()=>{k(!1)}),3e3)):L()},preventClose:T&&!P,onExited:()=>{w(Tt.INFO),x(!1),l&&(0,Ve.p)(l,!0),a()},compassDesign:!0,modalHeaderText:D,bodyPadding:!1,modalLocation:"top",enforceFocus:!1},o().createElement("div",{className:"ChannelSettingsModal__bodyWrapper"},o().createElement("div",{ref:R,className:"settings-table"},o().createElement("div",{className:"settings-links"},o().createElement(o().Suspense,{fallback:null},o().createElement(kt,{tabs:H,activeTab:S,updateTab:e=>{if(T)return k(!0),void setTimeout((()=>{k(!1)}),3e3);w(e),R.current&&(R.current.scrollTop=0)}}))),o().createElement("div",{className:"settings-content minimize-settings"},(()=>{switch(S){case Tt.INFO:return F();case Tt.ACCESS_RULES:return o().createElement(ct,{channel:u,setAreThereUnsavedChanges:O,showTabSwitchError:I});case Tt.CONFIGURATION:return o().createElement(vt,{channel:u,setAreThereUnsavedChanges:O,showTabSwitchError:I});case Tt.ARCHIVE:return o().createElement(ut,{channel:u,onHide:L});default:return F()}})()))))}Ot.propTypes={channelId:l().string.isRequired,onExited:l().func.isRequired,isOpen:l().bool.isRequired,focusOriginElement:l().string};const Pt=Ot,xt=e=>{let{channel:t}=e;const n=(0,d.useDispatch)();return(0,d.useSelector)((e=>Be(e,t.id)))?o().createElement(b.q7,{id:"channelSettings",labels:o().createElement(c.FormattedMessage,{id:"channel_header.channel_settings",defaultMessage:"Channel Settings"}),onClick:()=>{n((0,P.q)({modalId:f.IQ.CHANNEL_SETTINGS,dialogType:Pt,dialogProps:{channelId:t.id,focusOriginElement:"channelHeaderDropdownButton",isOpen:!0}}))},leadingElement:o().createElement(v.CogOutlineIcon,{size:18})}):null},Rt=(0,i.memo)(xt),Lt=e=>{let t=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(e),e));return o().createElement(b.q7,Object.assign({onClick:k.TJ,labels:o().createElement(c.FormattedMessage,{id:"center_panel.archived.closeChannel",defaultMessage:"Close Channel"})},t))},Ft=o().memo(Lt);var Ht=n(40142),Dt=n(87373),qt=n(48774),Bt=n(1277),Gt=n(24163),Ut=n(17983),jt=n(99068),Vt=n(83873),zt=n(85873);function Wt(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Yt extends o().PureComponent{constructor(){super(...arguments),Wt(this,"loadItems",(async(e,t)=>{const{data:n}=await this.props.actions.getGroupsAssociatedToChannel(this.props.channel.id,t,e,Bt.$);return{items:n.groups,totalCount:n.totalGroupCount}})),Wt(this,"onClickRemoveGroup",((e,t)=>this.props.actions.unlinkGroupSyncable(e.id,this.props.channel.id,qt.CL.Channel).then((async()=>{t.setState({loading:!0});const{items:e,totalCount:n}=await t.props.loadItems(t.setState.page,t.state.searchTerm);t.setState({loading:!1,items:e,totalCount:n})})))),Wt(this,"onHide",(()=>{this.props.actions.closeModal(f.IQ.MANAGE_CHANNEL_GROUPS)})),Wt(this,"titleButtonOnClick",(()=>{this.onHide(),this.props.actions.openModal({modalId:f.IQ.ADD_GROUPS_TO_TEAM,dialogType:Ht.A})})),Wt(this,"setChannelMemberStatus",(async(e,t,n)=>{this.props.actions.patchGroupSyncable(e.id,this.props.channel.id,qt.CL.Channel,{scheme_admin:n}).then((async()=>{t.setState({loading:!0});const{items:e,totalCount:n}=await t.props.loadItems(t.setState.page,t.state.searchTerm);await this.props.actions.getMyChannelMember(this.props.channel.id),t.setState({loading:!1,items:e,totalCount:n})}))})),Wt(this,"renderRow",((e,t)=>{let n;return n=e.scheme_admin?o().createElement(c.FormattedMessage,{id:"channel_members_dropdown.channel_admins",defaultMessage:"Channel Admins"}):o().createElement(c.FormattedMessage,{id:"channel_members_dropdown.channel_members",defaultMessage:"Channel Members"}),o().createElement("div",{key:e.id,className:"more-modal__row"},o().createElement("img",{className:"more-modal__image",src:Vt,alt:"group picture",width:"32",height:"32"}),o().createElement("div",{className:"more-modal__details"},o().createElement("div",{className:"more-modal__name"},e.display_name," ","-"," ",o().createElement("span",{className:"more-modal__name_count"},o().createElement(c.FormattedMessage,{id:"numMembers",defaultMessage:"{num, number} {num, plural, one {member} other {members}}",values:{num:e.member_count}})))),o().createElement("div",{className:"more-modal__actions"},o().createElement(jt.A,null,o().createElement("button",{id:"teamGroupsDropdown_".concat(e.display_name),className:"dropdown-toggle theme color--link style--none",type:"button","aria-expanded":"true"},o().createElement("span",null,n," "),o().createElement(Gt.A,null)),o().createElement(Ut.A,{openLeft:!0,ariaLabel:zt.Vw({id:"channel_members_dropdown.menuAriaLabel",defaultMessage:"Change the role of channel member"})},o().createElement(Ut.A.ItemAction,{show:!e.scheme_admin,onClick:()=>this.setChannelMemberStatus(e,t,!0),text:zt.Vw({id:"channel_members_dropdown.make_channel_admins",defaultMessage:"Make Channel Admins"})}),o().createElement(Ut.A.ItemAction,{show:Boolean(e.scheme_admin),onClick:()=>this.setChannelMemberStatus(e,t,!1),text:zt.Vw({id:"channel_members_dropdown.make_channel_members",defaultMessage:"Make Channel Members"})}),o().createElement(Ut.A.ItemAction,{onClick:()=>this.onClickRemoveGroup(e,t),text:zt.Vw({id:"group_list_modal.removeGroupButton",defaultMessage:"Remove Group"})})))))}))}render(){const{formatMessage:e}=this.props.intl;return o().createElement(Bt.A,{titleText:e({id:"channel_groups",defaultMessage:"{channel} Groups"},{channel:this.props.channel.display_name}),searchPlaceholderText:e({id:"manage_channel_groups_modal.search_placeholder",defaultMessage:"Search groups"}),renderRow:this.renderRow,loadItems:this.loadItems,onHide:this.onHide,titleBarButtonText:e({id:"group_list_modal.addGroupButton",defaultMessage:"Add Groups"}),titleBarButtonOnClick:this.titleButtonOnClick})}}Wt(Yt,"propTypes",{actions:l().shape({getGroupsAssociatedToChannel:l().func.isRequired,unlinkGroupSyncable:l().func.isRequired,patchGroupSyncable:l().func.isRequired,getMyChannelMember:l().func.isRequired,closeModal:l().func.isRequired,openModal:l().func.isRequired}).isRequired});const Qt=(0,c.injectIntl)(Yt),Xt=(0,d.connect)(((e,t)=>({channel:e.entities.channels.channels[t.channelID]})),(e=>({actions:(0,Z.zH)({getGroupsAssociatedToChannel:Dt.dJ,closeModal:P.O,openModal:P.q,unlinkGroupSyncable:Dt.IC,patchGroupSyncable:Dt.r2,getMyChannelMember:D.MQ},e)})))(Qt),Kt=["channel"],Jt=e=>{let{channel:t}=e,n=function(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,Kt);const a=(0,d.useDispatch)();return o().createElement(o().Fragment,null,o().createElement(b.q7,Object.assign({id:"channelAddGroups",leadingElement:o().createElement(v.AccountMultiplePlusOutlineIcon,{size:"18px"}),onClick:()=>{a((0,P.q)({modalId:f.IQ.ADD_GROUPS_TO_CHANNEL,dialogType:Ht.A}))},labels:o().createElement(c.FormattedMessage,{id:"navbar.addGroups",defaultMessage:"Add Groups"})},n)),o().createElement(b.q7,Object.assign({id:"channelManageGroups",leadingElement:o().createElement(v.AccountMultipleOutlineIcon,{size:"18px"}),onClick:()=>{a((0,P.q)({modalId:f.IQ.MANAGE_CHANNEL_GROUPS,dialogType:Xt,dialogProps:{channelID:t.id}}))},labels:o().createElement(c.FormattedMessage,{id:"navbar_dropdown.manageGroups",defaultMessage:"Manage Groups"})},n)))},$t=o().memo(Jt);var Zt=n(69238);const en=e=>{let{channel:t,id:n}=e;const a=(0,d.useDispatch)();return o().createElement(b.q7,{id:n,leadingElement:o().createElement(v.LogoutVariantIcon,{size:"18px"}),onClick:()=>{t.type===f.YM.PRIVATE_CHANNEL?a((0,P.q)({modalId:f.IQ.LEAVE_PRIVATE_CHANNEL_MODAL,dialogType:Zt.A,dialogProps:{channel:t}})):a((0,k.nE)(t.id))},labels:o().createElement(c.FormattedMessage,{id:"channel_header.leave",defaultMessage:"Leave Channel"}),isDestructive:!0})};en.propTypes={id:l().string};const tn=(0,i.memo)(en);function nn(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class an extends o().PureComponent{constructor(e){super(e),nn(this,"handleUnarchive",(()=>{this.props.channel.id.length===f.Ay.CHANNEL_ID_LENGTH&&(this.props.actions.unarchiveChannel(this.props.channel.id),this.onHide())})),nn(this,"onHide",(()=>{this.setState({show:!1})})),this.state={show:!0}}render(){return o().createElement(Pe.Modal,{dialogClassName:"a11y__modal",show:this.state.show,onHide:this.onHide,onExited:this.props.onExited,role:"none","aria-labelledby":"unarchiveChannelModalLabel",id:"unarchiveChannelModal"},o().createElement(Pe.Modal.Header,{closeButton:!0},o().createElement(Pe.Modal.Title,{componentClass:"h1",id:"unarchiveChannelModalLabel"},o().createElement(c.FormattedMessage,{id:"unarchive_channel.confirm",defaultMessage:"Confirm UNARCHIVE Channel"}))),o().createElement(Pe.Modal.Body,null,o().createElement("div",{className:"alert alert-danger"},o().createElement(c.FormattedMessage,{id:"unarchiveChannelModal.viewArchived.question",defaultMessage:"Are you sure you wish to unarchive the <b>{display_name}</b> channel?",values:{display_name:this.props.channel.display_name,b:e=>o().createElement("b",null,e)}}))),o().createElement(Pe.Modal.Footer,null,o().createElement("button",{type:"button",className:"btn btn-tertiary",onClick:this.onHide},o().createElement(c.FormattedMessage,{id:"unarchive_channel.cancel",defaultMessage:"Cancel"})),o().createElement("button",{type:"button",className:"btn btn-danger","data-dismiss":"modal",onClick:this.handleUnarchive,autoFocus:!0,id:"unarchiveChannelModalDeleteButton"},o().createElement(c.FormattedMessage,{id:"unarchive_channel.del",defaultMessage:"Unarchive"}))))}}nn(an,"propTypes",{onExited:l().func.isRequired,actions:l().shape({unarchiveChannel:l().func.isRequired}).isRequired});const ln=(0,d.connect)(null,(function(e){return{actions:(0,Z.zH)({unarchiveChannel:D.fk},e)}}))(an),sn=e=>{let{channel:t}=e;const n=(0,d.useDispatch)();return o().createElement(o().Fragment,null,o().createElement(b.wv,null),o().createElement(b.q7,{id:"channelUnarchiveChannel",onClick:()=>{n((0,P.q)({modalId:f.IQ.UNARCHIVE_CHANNEL,dialogType:ln,dialogProps:{channel:t}}))},labels:o().createElement(c.FormattedMessage,{id:"channel_header.unarchive",defaultMessage:"Unarchive Channel"})}))},rn=(0,i.memo)(sn),on=["channel","user","isMuted","isDefault","isMobile","isFavorite","isLicensedForLDAPGroups","pluginItems","isChannelBookmarksEnabled"],cn=e=>{let{channel:t,user:n,isMuted:a,isDefault:l,isMobile:s,isFavorite:r,isLicensedForLDAPGroups:i,pluginItems:d,isChannelBookmarksEnabled:u}=e,m=function(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,on);const h=!0===(null==t?void 0:t.group_constrained),g=0!==t.delete_at,p=(null==t?void 0:t.type)===f.YM.PRIVATE_CHANNEL,E=p?J.xB.MANAGE_PRIVATE_CHANNEL_MEMBERS:J.xB.MANAGE_PUBLIC_CHANNEL_MEMBERS,_=p?J.xB.DELETE_PRIVATE_CHANNEL:J.xB.DELETE_PUBLIC_CHANNEL,v=J.xB.MANAGE_TEAM;return o().createElement(o().Fragment,null,o().createElement(V,Object.assign({channel:t},m)),o().createElement(z,{userID:n.id,channel:t,isMuted:a}),!g&&o().createElement(o().Fragment,null,o().createElement(Me,{user:n,channel:t}),o().createElement(Rt,{channel:t}),u&&o().createElement(S,{channel:t})),o().createElement(b.wv,null),s&&o().createElement(o().Fragment,null,o().createElement(B,{channelID:t.id,isFavorite:r}),o().createElement(Y,{channelID:t.id}),o().createElement(b.wv,null)),(g||l)&&o().createElement(Ne,{id:"channelMembers",channel:t,text:o().createElement(c.FormattedMessage,{id:"channel_header.members",defaultMessage:"Members"})}),!g&&!l&&o().createElement(o().Fragment,null,o().createElement($.A,{channelId:t.id,teamId:t.team_id,permissions:[E]},h&&i&&o().createElement($t,{channel:t}),o().createElement(Ne,{id:"channelMembers",channel:t,text:o().createElement(c.FormattedMessage,{id:"channel_header.members",defaultMessage:"Members"})})),o().createElement($.A,{channelId:t.id,teamId:t.team_id,permissions:[E],invert:!0},o().createElement(Ne,{id:"channelMembers",channel:t,text:o().createElement(c.FormattedMessage,{id:"channel_header.members",defaultMessage:"Members"})}))),o().createElement(b.wv,null),o().createElement(C.A,{channel:t}),!s&&o().createElement(H,{pluginItems:d}),!l&&o().createElement(b.wv,null),!l&&!(0,y.P)(n.roles)&&o().createElement(tn,{id:"channelLeaveChannel",channel:t}),g&&o().createElement(Ft,null),!g&&!l&&o().createElement($.A,{channelId:t.id,teamId:t.team_id,permissions:[_]},o().createElement(He,{channel:t})),g&&!l&&o().createElement($.A,{channelId:t.id,teamId:t.team_id,permissions:[v]},o().createElement(rn,{channel:t})))};cn.propTypes={isMuted:l().bool.isRequired,isReadonly:l().bool.isRequired,isDefault:l().bool.isRequired,isMobile:l().bool.isRequired,isFavorite:l().bool.isRequired,isLicensedForLDAPGroups:l().bool.isRequired,pluginItems:l().arrayOf(l().node).isRequired,isChannelBookmarksEnabled:l().bool.isRequired};const dn=cn;var un=n(42945),mn=n(6281),hn=n(66935);function gn(e){let{dmUser:t,gmMembers:n,isMobile:a,archivedIcon:l,sharedIcon:s}=e;const i=(0,c.useIntl)(),u=(0,d.useSelector)(p.HW),v=(0,d.useSelector)(h.Lw),y=(0,d.useSelector)(h.o2),C=(0,d.useSelector)(h.TJ),M=(0,d.useSelector)(h.cP),A="true"===(0,d.useSelector)(g.Ay).LDAPGroups,N=(0,d.useSelector)(E.V1),S=(0,d.useSelector)(_.wR),w=(0,hn.K)(null==v?void 0:v.id);if(!v)return null;const I=v.type===f.YM.DM_CHANNEL,k=v.type===f.YM.GM_CHANNEL;let T=v.display_name,O=i.formatMessage({id:"channel_header.otherchannel",defaultMessage:"{displayName} Channel Menu"},{displayName:v.display_name});I&&t?(T=o().createElement(un.A,{dmUser:t}),u.id===t.id&&(O=i.formatMessage({id:"channel_header.directchannel",defaultMessage:"{displayName} (you) Channel Menu"},{displayName:v.display_name}))):k&&(T=o().createElement(mn.A,{gmMembers:n}));let P=[];return w&&(P=N.map((e=>o().createElement(b.q7,{id:e.id+"_pluginmenuitem",key:e.id+"_pluginmenuitem",onClick:()=>{e.action&&e.action(v.id)},labels:o().createElement("span",null,e.text)})))),o().createElement(b.mc,{menuButtonTooltip:{text:T},menuButton:{id:"channelHeaderDropdownButton",class:r()("channel-header__trigger style--none"),children:o().createElement(o().Fragment,null,l,o().createElement("strong",{id:"channelHeaderTitle",className:"heading"},T),s,o().createElement(m(),{size:16})),"aria-label":O.toLowerCase()},menu:{id:"channelHeaderDropdownMenu"},transformOrigin:{horizontal:"left",vertical:"top"},anchorOrigin:{vertical:"bottom",horizontal:"left"}},I&&o().createElement(K,{channel:v,user:u,isMuted:M,pluginItems:P,isFavorite:C,isMobile:a||!1,isChannelBookmarksEnabled:S}),k&&o().createElement(Ie,{channel:v,user:u,isMuted:M,pluginItems:P,isFavorite:C,isMobile:a||!1,isChannelBookmarksEnabled:S}),!I&&!k&&o().createElement(dn,{channel:v,user:u,isMuted:M,pluginItems:P,isFavorite:C,isMobile:a||!1,isDefault:y,isReadonly:!1,isLicensedForLDAPGroups:A,isChannelBookmarksEnabled:S}),o().createElement(Oe,{isMobile:a||!1,pluginItems:P,channel:v}))}gn.propTypes={gmMembers:l().array,archivedIcon:l().element,sharedIcon:l().element,isMobile:l().bool}},27039:(e,t,n)=>{n.d(t,{A:()=>_});var a=n(62688),l=n.n(a),s=(n(43813),n(36418)),r=n.n(s),i=n(14778),o=n(37270),c=n(17651),d=n(43595),u=n(65952),m=n(31423),h=n(21650),g=n(70669),p=n(27840);const E=e=>{const t=(0,o.useSelector)(h.t9),n=(0,o.useSelector)(u.tW),a=(0,o.useSelector)((0,d.HV)(c.x5.CHANNEL_HEADER_ICON)),l=(0,i.useIntl)(),s=(0,o.useDispatch)(),E=t=>{const n=()=>f(t);return e.isDropdown?r().createElement(g.q7,{key:"mobileChannelHeaderItem"+t.app_id+t.location,onClick:n,labels:r().createElement("span",null,t.label)}):r().createElement("li",{className:"flex-parent--center"},r().createElement("button",{id:"".concat(t.app_id,"_").concat(t.location),className:"navbar-toggle navbar-right__icon",onClick:n},r().createElement("span",{className:"icon navbar-plugin-button"},r().createElement("img",{alt:"",src:t.icon,width:"16",height:"16"}))))},_=t=>{const n=()=>b(t);return e.isDropdown?r().createElement(g.q7,{key:"mobileChannelHeaderItem"+t.id,id:"mobileChannelHeaderItem"+t.id,onClick:n,labels:r().createElement("span",null,t.dropdownText),leadingElement:t.icon}):r().createElement("li",{className:"flex-parent--center"},r().createElement("button",{className:"navbar-toggle navbar-right__icon",onClick:n},r().createElement("span",{className:"icon navbar-plugin-button"},t.icon)))},b=t=>{var a;return null===(a=t.action)||void 0===a?void 0:a.call(t,e.channel,n)},f=async t=>{const{channel:n}=e,a=(0,p.aC)(t.app_id,t.location,n.id,n.team_id),r=(e,t)=>{if(t){const e=t.text||l.formatMessage({id:"apps.error.unknown",defaultMessage:"Unknown error occurred."});s((0,m.hV)(t,e,n.id))}else switch(e.type){case c.G4.OK:e.text&&s((0,m.hV)(e,e.text,n.id));break;case c.G4.NAVIGATE:break;case c.G4.FORM:e.form&&s((0,m.el)(e.form,a));break;default:{const t=l.formatMessage({id:"apps.error.responses.unknown_type",defaultMessage:"App response type not supported. Response type: {type}."},{type:e.type});s((0,m.hV)(e,t,n.id))}}},i=await s((0,m.I$)(t,a,l));i.error?r(null,i.error):r(i.data)},v=t||[],y=a||[];if(0===v.length&&0===y.length)return r().createElement(r().Fragment,null);if(1===v.length&&0===y.length)return _(v[0]);if(0===v.length&&1===y.length)return E(y[0]);if(!e.isDropdown)return r().createElement(r().Fragment,null);const C=v.map(_),M=(e=>e.map(E))(y);return r().createElement(r().Fragment,null,r().createElement(g.wv,null),M,C)};E.propTypes={isDropdown:l().bool.isRequired};const _=(0,s.memo)(E)}}]);
//# sourceMappingURL=9084.863cbff8b0f28ff436c9.js.map