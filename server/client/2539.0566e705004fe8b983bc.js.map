{"version":3,"file":"2539.0566e705004fe8b983bc.js","mappings":"qUA0BA,MAAMA,GAAiBC,EAAAA,EAAAA,MAIjBC,EACFC,IAAAA,cAAA,KACI,cAAY,oBACZC,UAAU,sDAIZC,EACFF,IAAAA,cAAA,KACI,cAAY,YACZC,UAAU,kDAIlB,SAASE,IACL,MAAMC,GAAWC,EAAAA,EAAAA,eAEXC,GAA8BC,EAAAA,EAAAA,SAAO,GAErCC,GAAgCC,EAAAA,EAAAA,aAAYC,EAAAA,IAC5CC,GAAaF,EAAAA,EAAAA,aAAYZ,GACzBe,GAASH,EAAAA,EAAAA,aAAYI,EAAAA,IACrBC,GAAyBL,EAAAA,EAAAA,cAAaM,IAAuBC,EAAAA,EAAAA,IAA6BD,EAAOH,GAAQ,KACzGK,GAAyBR,EAAAA,EAAAA,aAAYS,EAAAA,IAIrCC,EAFYR,EAAa,GAEEM,GADPH,EAAyB,EAG7CM,GAAyBX,EAAAA,EAAAA,cAAaM,IAAuBM,EAAAA,EAAAA,GAAsBN,EAAOH,MAE1F,IAACU,IAAOC,EAAAA,EAAAA,iBACRC,GAAkBD,EAAAA,EAAAA,eAAc,iBAChCE,GAA0BF,EAAAA,EAAAA,eAAc,UAAYG,EAAAA,IAEpDC,EAAaC,QAAQJ,GAAmBC,GAExCI,GAAkBC,EAAAA,EAAAA,cAAY,IAAMH,GAAY,CAACA,KAEvDI,EAAAA,EAAAA,YAAU,KACFvB,GACAJ,GAAS4B,EAAAA,EAAAA,IAAUpB,GACvB,GACD,CAACA,EAAQJ,EAA+BJ,KAE3C2B,EAAAA,EAAAA,YAAU,KACN,MAAME,GAAiB3B,EAA4B4B,QAE/CjB,GACAb,GAAS+B,EAAAA,EAAAA,IAAwBvB,EAAQqB,IAG7C3B,EAA4B4B,SAAU,CAAI,GAC3C,CAAC9B,EAAUa,EAAwBL,IAEtC,MAAMwB,EAAyBnB,GAA0BH,EAAyB,EAE5EuB,GAAcC,EAAAA,EAAAA,UAAQ,IAUpBtC,IAAAA,cAACuC,EAAAA,iBAAgB,CACbC,GAAG,qBACHC,eAAe,GACfC,OAAQ,CACJ/B,aACAgC,mBAAoB7B,EACpB8B,GAfQC,GACZlC,EAAa,GAAKG,EAAyB,EACnCd,IAAAA,cAAAA,IAAAA,SAAA,KAAEA,IAAAA,cAAA,WAAM6C,GAGb,SAcZ,CAAClC,EAAYG,IAEhB,OAAKK,GAAeQ,EAKhB3B,IAAAA,cAAA,MAAIC,UAAU,0DACVD,IAAAA,cAAA,MACIC,UAAU,iBACV6C,UAAW,EACXN,GAAG,yBAEHxC,IAAAA,cAAC+C,EAAAA,QAAO,CACJC,GAAE,GAAAC,OAAK3B,EAAG,WACVkB,GAAG,qBACHU,gBAAgB,SAChBC,UAAU,QACVlD,UAAU,2BACV6C,SAAU,EACVM,SAAUvB,GAEV7B,IAAAA,cAAA,KACI,cAAY,eACZC,UAAU,kCAEdD,IAAAA,cAAA,OAAKC,UAAU,mCACXD,IAAAA,cAAA,QAAMC,UAAU,8CACZD,IAAAA,cAACuC,EAAAA,iBAAgB,CACbC,GAAG,qBACHC,eAAe,aAI3BzC,IAAAA,cAACqD,EAAAA,EAAW,CACRC,MAAOjB,GAEPrC,IAAAA,cAAA,WAEQW,EAAa,GACbX,IAAAA,cAACuD,EAAAA,EAAmB,CAChBC,eAAgB7C,EAChB8C,KAAMvD,IAKVkC,GACApC,IAAAA,cAACuD,EAAAA,EAAmB,CAChBC,eAAgB1C,EAChB2C,KAAM1D,EACNE,UAAWyD,IAAW,qBAAsB,CAACC,WAAYvC,IACzDwC,UAAWxC,SAjDhC,IA0Df,CAEA,SAAeyC,EAAAA,EAAAA,MAAK1D,E","sources":["webpack://mattermost-webapp/./src/components/drafts/drafts_link/drafts_link.tsx"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport classNames from 'classnames';\r\nimport React, {memo, useCallback, useEffect, useMemo, useRef} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useSelector, useDispatch} from 'react-redux';\r\nimport {NavLink, useRouteMatch} from 'react-router-dom';\r\n\r\nimport {fetchTeamScheduledPosts} from 'mattermost-redux/actions/scheduled_posts';\r\nimport {syncedDraftsAreAllowedAndEnabled} from 'mattermost-redux/selectors/entities/preferences';\r\nimport {\r\n    getScheduledPostsByTeamCount, hasScheduledPostError, isScheduledPostsEnabled,\r\n} from 'mattermost-redux/selectors/entities/scheduled_posts';\r\nimport {getCurrentTeamId} from 'mattermost-redux/selectors/entities/teams';\r\n\r\nimport {getDrafts} from 'actions/views/drafts';\r\nimport {makeGetDraftsCount} from 'selectors/drafts';\r\n\r\nimport ChannelMentionBadge from 'components/sidebar/sidebar_channel/channel_mention_badge';\r\nimport WithTooltip from 'components/with_tooltip';\r\n\r\nimport {SCHEDULED_POST_URL_SUFFIX} from 'utils/constants';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\nconst getDraftsCount = makeGetDraftsCount();\r\n\r\nimport './drafts_link.scss';\r\n\r\nconst scheduleIcon = (\r\n    <i\r\n        data-testid='scheduledPostIcon'\r\n        className='icon icon-draft-indicator icon-clock-send-outline'\r\n    />\r\n);\r\n\r\nconst pencilIcon = (\r\n    <i\r\n        data-testid='draftIcon'\r\n        className='icon icon-draft-indicator icon-pencil-outline'\r\n    />\r\n);\r\n\r\nfunction DraftsLink() {\r\n    const dispatch = useDispatch();\r\n\r\n    const initialScheduledPostsLoaded = useRef(false);\r\n\r\n    const syncedDraftsAllowedAndEnabled = useSelector(syncedDraftsAreAllowedAndEnabled);\r\n    const draftCount = useSelector(getDraftsCount);\r\n    const teamId = useSelector(getCurrentTeamId);\r\n    const teamScheduledPostCount = useSelector((state: GlobalState) => getScheduledPostsByTeamCount(state, teamId, true));\r\n    const isScheduledPostEnabled = useSelector(isScheduledPostsEnabled);\r\n\r\n    const hasDrafts = draftCount > 0;\r\n    const hasScheduledPosts = teamScheduledPostCount > 0;\r\n    const itemsExist = hasDrafts || (isScheduledPostEnabled && hasScheduledPosts);\r\n\r\n    const scheduledPostsHasError = useSelector((state: GlobalState) => hasScheduledPostError(state, teamId));\r\n\r\n    const {url} = useRouteMatch();\r\n    const isDraftUrlMatch = useRouteMatch('/:team/drafts');\r\n    const isScheduledPostUrlMatch = useRouteMatch('/:team/' + SCHEDULED_POST_URL_SUFFIX);\r\n\r\n    const urlMatches = Boolean(isDraftUrlMatch || isScheduledPostUrlMatch);\r\n\r\n    const isNavLinkActive = useCallback(() => urlMatches, [urlMatches]);\r\n\r\n    useEffect(() => {\r\n        if (syncedDraftsAllowedAndEnabled) {\r\n            dispatch(getDrafts(teamId));\r\n        }\r\n    }, [teamId, syncedDraftsAllowedAndEnabled, dispatch]);\r\n\r\n    useEffect(() => {\r\n        const loadDMsAndGMs = !initialScheduledPostsLoaded.current;\r\n\r\n        if (isScheduledPostEnabled) {\r\n            dispatch(fetchTeamScheduledPosts(teamId, loadDMsAndGMs));\r\n        }\r\n\r\n        initialScheduledPostsLoaded.current = true;\r\n    }, [dispatch, isScheduledPostEnabled, teamId]);\r\n\r\n    const showScheduledPostCount = isScheduledPostEnabled && teamScheduledPostCount > 0;\r\n\r\n    const tooltipText = useMemo(() => {\r\n        const lineBreaks = (x: React.ReactNode) => {\r\n            if (draftCount > 0 && teamScheduledPostCount > 0) {\r\n                return (<><br/>{x}</>);\r\n            }\r\n\r\n            return null;\r\n        };\r\n\r\n        return (\r\n            <FormattedMessage\r\n                id='drafts.tooltipText'\r\n                defaultMessage=''\r\n                values={{\r\n                    draftCount,\r\n                    scheduledPostCount: teamScheduledPostCount,\r\n                    br: lineBreaks,\r\n                }}\r\n            />\r\n        );\r\n    }, [draftCount, teamScheduledPostCount]);\r\n\r\n    if (!itemsExist && !urlMatches) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <ul className='SidebarDrafts NavGroupContent nav nav-pills__container'>\r\n            <li\r\n                className='SidebarChannel'\r\n                tabIndex={-1}\r\n                id='sidebar-drafts-button'\r\n            >\r\n                <NavLink\r\n                    to={`${url}/drafts`}\r\n                    id='sidebarItem_drafts'\r\n                    activeClassName='active'\r\n                    draggable='false'\r\n                    className='SidebarLink sidebar-item'\r\n                    tabIndex={0}\r\n                    isActive={isNavLinkActive}\r\n                >\r\n                    <i\r\n                        data-testid='sendPostIcon'\r\n                        className='icon icon-send-post icon-send'\r\n                    />\r\n                    <div className='SidebarChannelLinkLabel_wrapper'>\r\n                        <span className='SidebarChannelLinkLabel sidebar-item__name'>\r\n                            <FormattedMessage\r\n                                id='drafts.sidebarLink'\r\n                                defaultMessage='Drafts'\r\n                            />\r\n                        </span>\r\n                    </div>\r\n                    <WithTooltip\r\n                        title={tooltipText}\r\n                    >\r\n                        <div>\r\n                            {\r\n                                draftCount > 0 &&\r\n                                <ChannelMentionBadge\r\n                                    unreadMentions={draftCount}\r\n                                    icon={pencilIcon}\r\n                                />\r\n                            }\r\n\r\n                            {\r\n                                showScheduledPostCount &&\r\n                                <ChannelMentionBadge\r\n                                    unreadMentions={teamScheduledPostCount}\r\n                                    icon={scheduleIcon}\r\n                                    className={classNames('scheduledPostBadge', {persistent: scheduledPostsHasError})}\r\n                                    hasUrgent={scheduledPostsHasError}\r\n                                />\r\n                            }\r\n                        </div>\r\n                    </WithTooltip>\r\n                </NavLink>\r\n            </li>\r\n        </ul>\r\n    );\r\n}\r\n\r\nexport default memo(DraftsLink);\r\n"],"names":["getDraftsCount","makeGetDraftsCount","scheduleIcon","React","className","pencilIcon","DraftsLink","dispatch","useDispatch","initialScheduledPostsLoaded","useRef","syncedDraftsAllowedAndEnabled","useSelector","syncedDraftsAreAllowedAndEnabled","draftCount","teamId","getCurrentTeamId","teamScheduledPostCount","state","getScheduledPostsByTeamCount","isScheduledPostEnabled","isScheduledPostsEnabled","itemsExist","scheduledPostsHasError","hasScheduledPostError","url","useRouteMatch","isDraftUrlMatch","isScheduledPostUrlMatch","SCHEDULED_POST_URL_SUFFIX","urlMatches","Boolean","isNavLinkActive","useCallback","useEffect","getDrafts","loadDMsAndGMs","current","fetchTeamScheduledPosts","showScheduledPostCount","tooltipText","useMemo","FormattedMessage","id","defaultMessage","values","scheduledPostCount","br","x","tabIndex","NavLink","to","concat","activeClassName","draggable","isActive","WithTooltip","title","ChannelMentionBadge","unreadMentions","icon","classNames","persistent","hasUrgent","memo"],"sourceRoot":""}