{"version":3,"file":"1748.bd919263c3ade32e0ba8.js","mappings":"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","sources":["webpack://mattermost-webapp/./src/components/app_bar/app_bar_binding.tsx","webpack://mattermost-webapp/./src/components/app_bar/app_bar_marketplace.tsx","webpack://mattermost-webapp/./src/components/app_bar/app_bar_plugin_component.tsx","webpack://mattermost-webapp/./src/components/app_bar/app_bar.tsx","webpack://mattermost-webapp/./src/components/app_bar/new_channel_with_board_tour_tip.tsx","webpack://mattermost-webapp/./src/packages/mattermost-redux/src/actions/boards.ts","webpack://mattermost-webapp/../node_modules/lodash/_arrayAggregator.js","webpack://mattermost-webapp/../node_modules/lodash/_baseAggregator.js","webpack://mattermost-webapp/../node_modules/lodash/_baseEach.js","webpack://mattermost-webapp/../node_modules/lodash/_createAggregator.js","webpack://mattermost-webapp/../node_modules/lodash/_createBaseEach.js","webpack://mattermost-webapp/../node_modules/lodash/partition.js"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\n\r\nimport type {AppBinding, AppCallResponse} from '@mattermost/types/apps';\r\n\r\nimport {AppCallResponseTypes} from 'mattermost-redux/constants/apps';\r\nimport {getCurrentChannelId} from 'mattermost-redux/selectors/entities/common';\r\nimport {getCurrentTeamId} from 'mattermost-redux/selectors/entities/teams';\r\n\r\nimport {handleBindingClick, openAppsModal, postEphemeralCallResponseForContext} from 'actions/apps';\r\n\r\nimport WithTooltip from 'components/with_tooltip';\r\n\r\nimport {createCallContext} from 'utils/apps';\r\n\r\nimport type {DoAppCallResult} from 'types/apps';\r\n\r\nexport const isAppBinding = (x: Record<string, any> | undefined): x is AppBinding => {\r\n    return Boolean(x?.app_id);\r\n};\r\n\r\ntype BindingComponentProps = {\r\n    binding: AppBinding;\r\n}\r\n\r\nconst AppBarBinding = (props: BindingComponentProps) => {\r\n    const {binding} = props;\r\n\r\n    const dispatch = useDispatch();\r\n    const intl = useIntl();\r\n\r\n    const channelId = useSelector(getCurrentChannelId);\r\n    const teamId = useSelector(getCurrentTeamId);\r\n\r\n    const submitAppCall = async () => {\r\n        const context = createCallContext(\r\n            binding.app_id,\r\n            binding.location,\r\n            channelId,\r\n            teamId,\r\n        );\r\n\r\n        const result = await dispatch(handleBindingClick(binding, context, intl)) as DoAppCallResult;\r\n\r\n        if (result.error) {\r\n            const errMsg = result.error.text || 'An error occurred';\r\n            dispatch(postEphemeralCallResponseForContext(result.error, errMsg, context));\r\n            return;\r\n        }\r\n\r\n        const callResp = result.data as AppCallResponse;\r\n\r\n        switch (callResp.type) {\r\n        case AppCallResponseTypes.OK:\r\n            if (callResp.text) {\r\n                dispatch(postEphemeralCallResponseForContext(callResp, callResp.text, context));\r\n            }\r\n            return;\r\n        case AppCallResponseTypes.FORM:\r\n            if (callResp.form) {\r\n                dispatch(openAppsModal(callResp.form, context));\r\n            }\r\n            return;\r\n        case AppCallResponseTypes.NAVIGATE:\r\n            return;\r\n        default: {\r\n            const errorMessage = intl.formatMessage({\r\n                id: 'apps.error.responses.unknown_type',\r\n                defaultMessage: 'App response type not supported. Response type: {type}.',\r\n            }, {\r\n                type: callResp.type,\r\n            });\r\n            dispatch(postEphemeralCallResponseForContext(callResp, errorMessage, context));\r\n        }\r\n        }\r\n    };\r\n\r\n    const id = `app-bar-icon-${binding.app_id}`;\r\n    const label = binding.label || binding.app_id;\r\n\r\n    return (\r\n        <WithTooltip\r\n            title={label}\r\n            isVertical={false}\r\n        >\r\n            <div\r\n                id={id}\r\n                aria-label={label}\r\n                className={'app-bar__icon'}\r\n                onClick={submitAppCall}\r\n            >\r\n                <div className={'app-bar__icon-inner'}>\r\n                    <img src={binding.icon}/>\r\n                </div>\r\n            </div>\r\n        </WithTooltip>\r\n    );\r\n};\r\n\r\nexport default AppBarBinding;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useCallback} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useDispatch} from 'react-redux';\r\n\r\nimport {ViewGridPlusOutlineIcon} from '@mattermost/compass-icons/components';\r\n\r\nimport {openModal} from 'actions/views/modals';\r\n\r\nimport MarketplaceModal from 'components/plugin_marketplace/marketplace_modal';\r\nimport WithTooltip from 'components/with_tooltip';\r\n\r\nimport {ModalIdentifiers} from 'utils/constants';\r\n\r\nconst AppBarMarketplace = () => {\r\n    const {formatMessage} = useIntl();\r\n    const dispatch = useDispatch();\r\n\r\n    const handleOpenMarketplace = useCallback(() => {\r\n        dispatch(\r\n            openModal({\r\n                modalId: ModalIdentifiers.PLUGIN_MARKETPLACE,\r\n                dialogType: MarketplaceModal,\r\n                dialogProps: {},\r\n            }),\r\n        );\r\n    }, [dispatch]);\r\n\r\n    const label = formatMessage({id: 'app_bar.marketplace', defaultMessage: 'App Marketplace'});\r\n\r\n    return (\r\n        <WithTooltip\r\n            title={label}\r\n            isVertical={false}\r\n        >\r\n            <button\r\n                key='app_bar_marketplace'\r\n                className='app_bar__marketplace_button'\r\n                aria-label={label}\r\n                onClick={handleOpenMarketplace}\r\n            >\r\n                <ViewGridPlusOutlineIcon size={18}/>\r\n            </button>\r\n        </WithTooltip>\r\n    );\r\n};\r\n\r\nexport default AppBarMarketplace;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport classNames from 'classnames';\r\nimport React, {useState, useEffect} from 'react';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport {getCurrentChannel, getMyCurrentChannelMembership} from 'mattermost-redux/selectors/entities/channels';\r\n\r\nimport {getActiveRhsComponent} from 'selectors/rhs';\r\n\r\nimport PluginIcon from 'components/widgets/icons/plugin_icon';\r\nimport WithTooltip from 'components/with_tooltip';\r\n\r\nimport {suitePluginIds} from 'utils/constants';\r\n\r\nimport type {AppBarAction, ChannelHeaderButtonAction} from 'types/store/plugins';\r\n\r\nimport NewChannelWithBoardTourTip from './new_channel_with_board_tour_tip';\r\n\r\ntype AppBarComponentProps = {\r\n    component: ChannelHeaderButtonAction | AppBarAction;\r\n}\r\n\r\nenum ImageLoadState {\r\n    LOADING = 'loading',\r\n    LOADED = 'loaded',\r\n    ERROR = 'error',\r\n}\r\n\r\nexport const isAppBarComponent = (x: Record<string, any> | undefined): x is (ChannelHeaderButtonAction | AppBarAction) => {\r\n    return Boolean(x?.id && x?.pluginId);\r\n};\r\n\r\nconst AppBarPluginComponent = ({\r\n    component,\r\n}: AppBarComponentProps) => {\r\n    const channel = useSelector(getCurrentChannel);\r\n    const channelMember = useSelector(getMyCurrentChannelMembership);\r\n    const activeRhsComponent = useSelector(getActiveRhsComponent);\r\n\r\n    const [imageLoadState, setImageLoadState] = useState<ImageLoadState>(ImageLoadState.LOADING);\r\n\r\n    const iconUrl = 'iconUrl' in component ? component.iconUrl : undefined;\r\n    const icon = 'icon' in component ? component.icon : undefined;\r\n    const dropdownText = 'dropdownText' in component ? component.dropdownText : undefined;\r\n    const rhsComponentId = 'rhsComponentId' in component ? component.rhsComponentId : undefined;\r\n\r\n    useEffect(() => {\r\n        setImageLoadState(ImageLoadState.LOADING);\r\n    }, [iconUrl]);\r\n\r\n    const onImageLoadComplete = () => {\r\n        setImageLoadState(ImageLoadState.LOADED);\r\n    };\r\n\r\n    const onImageLoadError = () => {\r\n        setImageLoadState(ImageLoadState.ERROR);\r\n    };\r\n\r\n    const buttonId = `app-bar-icon-${component.pluginId}`;\r\n    const tooltipText = component.tooltipText || dropdownText || component.pluginId;\r\n\r\n    let content: React.ReactNode = (\r\n        <div\r\n            role='button'\r\n            tabIndex={0}\r\n            className='app-bar__icon-inner'\r\n        >\r\n            <img\r\n                src={iconUrl}\r\n                alt={component.pluginId}\r\n                onLoad={onImageLoadComplete}\r\n                onError={onImageLoadError}\r\n            />\r\n        </div>\r\n    );\r\n\r\n    const isButtonActive = rhsComponentId ? activeRhsComponent?.id === rhsComponentId : component.pluginId === activeRhsComponent?.pluginId;\r\n\r\n    if (!iconUrl) {\r\n        content = (\r\n            <div\r\n                role='button'\r\n                tabIndex={0}\r\n                className={classNames('app-bar__old-icon app-bar__icon-inner app-bar__icon-inner--centered', {'app-bar__old-icon--active': isButtonActive})}\r\n            >\r\n                {icon}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (imageLoadState === ImageLoadState.ERROR) {\r\n        content = (\r\n            <PluginIcon className='icon__plugin'/>\r\n        );\r\n    }\r\n\r\n    const boardsEnabled = component.pluginId === suitePluginIds.focalboard;\r\n\r\n    return (\r\n        <WithTooltip\r\n            title={tooltipText}\r\n            isVertical={false}\r\n        >\r\n            <div\r\n                id={buttonId}\r\n                className={classNames('app-bar__icon', {'app-bar__icon--active': isButtonActive})}\r\n                onClick={() => {\r\n                    if (channel && channelMember) {\r\n                        component.action?.(channel, channelMember);\r\n                        return;\r\n                    }\r\n                    if ('rhsComponentId' in component) {\r\n                        component.action();\r\n                    }\r\n                }}\r\n            >\r\n                {content}\r\n                {boardsEnabled && <NewChannelWithBoardTourTip/>}\r\n            </div>\r\n        </WithTooltip>\r\n    );\r\n};\r\n\r\nexport default AppBarPluginComponent;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport partition from 'lodash/partition';\r\nimport React from 'react';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport type {GlobalState} from '@mattermost/types/store';\r\n\r\nimport {Permissions} from 'mattermost-redux/constants';\r\nimport {getAppBarAppBindings} from 'mattermost-redux/selectors/entities/apps';\r\nimport {isMarketplaceEnabled} from 'mattermost-redux/selectors/entities/general';\r\nimport {haveICurrentTeamPermission} from 'mattermost-redux/selectors/entities/roles';\r\n\r\nimport {getAppBarPluginComponents, getChannelHeaderPluginComponents, shouldShowAppBar} from 'selectors/plugins';\r\n\r\nimport {suitePluginIds} from 'utils/constants';\r\nimport {useCurrentProduct, useCurrentProductId, inScope} from 'utils/products';\r\n\r\nimport AppBarBinding, {isAppBinding} from './app_bar_binding';\r\nimport AppBarMarketplace from './app_bar_marketplace';\r\nimport AppBarPluginComponent, {isAppBarComponent} from './app_bar_plugin_component';\r\n\r\nimport './app_bar.scss';\r\n\r\nexport default function AppBar() {\r\n    const channelHeaderComponents = useSelector(getChannelHeaderPluginComponents);\r\n    const appBarPluginComponents = useSelector(getAppBarPluginComponents);\r\n    const appBarBindings = useSelector(getAppBarAppBindings);\r\n    const currentProduct = useCurrentProduct();\r\n    const currentProductId = useCurrentProductId();\r\n    const enabled = useSelector(shouldShowAppBar);\r\n    const canOpenMarketplace = useSelector((state: GlobalState) => (\r\n        isMarketplaceEnabled(state) &&\r\n        haveICurrentTeamPermission(state, Permissions.SYSCONSOLE_WRITE_PLUGINS)\r\n    ));\r\n\r\n    if (\r\n        !enabled ||\r\n        (currentProduct && !currentProduct.showAppBar)\r\n    ) {\r\n        return null;\r\n    }\r\n\r\n    const coreProductsPluginIds = [suitePluginIds.focalboard, suitePluginIds.playbooks];\r\n\r\n    const [coreProductComponents, pluginComponents] = partition(appBarPluginComponents, ({pluginId}) => {\r\n        return coreProductsPluginIds.includes(pluginId);\r\n    });\r\n\r\n    const items = [\r\n        ...coreProductComponents,\r\n        getDivider(coreProductComponents.length, (pluginComponents.length + channelHeaderComponents.length + appBarBindings.length)),\r\n        ...pluginComponents,\r\n        ...channelHeaderComponents,\r\n        ...appBarBindings,\r\n    ].map((x) => {\r\n        if (!x) {\r\n            return x;\r\n        }\r\n\r\n        if (isAppBarComponent(x)) {\r\n            const supportedProductIds = 'supportedProductIds' in x ? x.supportedProductIds : undefined;\r\n            if (!inScope(supportedProductIds ?? null, currentProductId, currentProduct?.pluginId)) {\r\n                return null;\r\n            }\r\n            return (\r\n                <AppBarPluginComponent\r\n                    key={x.id}\r\n                    component={x}\r\n                />\r\n            );\r\n        } else if (isAppBinding(x)) {\r\n            if (!inScope(x.supported_product_ids ?? null, currentProductId, currentProduct?.pluginId)) {\r\n                return null;\r\n            }\r\n            return (\r\n                <AppBarBinding\r\n                    key={`${x.app_id}_${x.label}`}\r\n                    binding={x}\r\n                />\r\n            );\r\n        }\r\n        return x;\r\n    });\r\n\r\n    return (\r\n        <div className={'app-bar'}>\r\n            <div className={'app-bar__top'}>\r\n                {items}\r\n            </div>\r\n            {canOpenMarketplace && (\r\n                <div className='app-bar__bottom'>\r\n                    <AppBarMarketplace/>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nconst getDivider = (beforeCount: number, afterCount: number) => (beforeCount && afterCount ? (\r\n    <hr\r\n        key='divider'\r\n        className='app-bar__divider'\r\n    />\r\n) : null);\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useCallback, useState} from 'react';\r\nimport {FormattedMessage} from 'react-intl';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\nimport type {Placement} from 'tippy.js';\r\n\r\nimport {TourTip, useMeasurePunchouts} from '@mattermost/components';\r\n\r\nimport {setNewChannelWithBoardPreference} from 'mattermost-redux/actions/boards';\r\nimport {Preferences} from 'mattermost-redux/constants';\r\n\r\nimport {showNewChannelWithBoardPulsatingDot} from 'selectors/plugins';\r\n\r\ntype Props = {\r\n    pulsatingDotPlacement?: Omit<Placement, 'auto'| 'auto-end'>;\r\n    pulsatingDotTranslate?: {x: number; y: number};\r\n}\r\n\r\nconst NewChannelWithBoardTourTip = ({\r\n    pulsatingDotPlacement = 'left',\r\n    pulsatingDotTranslate,\r\n}: Props): JSX.Element | null => {\r\n    const dispatch = useDispatch();\r\n    const showTip = useSelector(showNewChannelWithBoardPulsatingDot);\r\n\r\n    const title = (\r\n        <FormattedMessage\r\n            id='newChannelWithBoard.tutorialTip.title'\r\n            defaultMessage='Access linked boards from the App Bar'\r\n        />\r\n    );\r\n\r\n    const screen = (\r\n        <FormattedMessage\r\n            id='newChannelWithBoard.tutorialTip.description'\r\n            defaultMessage='The board you just created can be quickly accessed by clicking on the Boards icon in the App bar. You can view the boards that are linked to this channel in the right-hand sidebar and open one in full view.'\r\n        />\r\n    );\r\n\r\n    const [tipOpened, setTipOpened] = useState(showTip);\r\n\r\n    const handleDismiss = useCallback((e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        setTipOpened(false);\r\n        dispatch(setNewChannelWithBoardPreference({[Preferences.NEW_CHANNEL_WITH_BOARD_TOUR_SHOWED]: true}));\r\n    }, []);\r\n\r\n    const handleOpen = useCallback((e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (tipOpened) {\r\n            dispatch(setNewChannelWithBoardPreference({[Preferences.NEW_CHANNEL_WITH_BOARD_TOUR_SHOWED]: true}));\r\n            setTipOpened(false);\r\n        } else {\r\n            setTipOpened(true);\r\n        }\r\n    }, []);\r\n\r\n    const overlayPunchOut = useMeasurePunchouts(['app-bar-icon-focalboard'], [], {y: -2, height: 4, x: 0, width: 0});\r\n\r\n    if (!showTip) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <TourTip\r\n            show={true}\r\n            screen={screen}\r\n            title={title}\r\n            overlayPunchOut={overlayPunchOut}\r\n            placement='right-start'\r\n            pulsatingDotPlacement={pulsatingDotPlacement}\r\n            step={1}\r\n            singleTip={true}\r\n            showOptOut={false}\r\n            interactivePunchOut={true}\r\n            handleDismiss={handleDismiss}\r\n            handleOpen={handleOpen}\r\n            handlePrevious={handleDismiss}\r\n            offset={[-30, 5]}\r\n            pulsatingDotTranslate={pulsatingDotTranslate}\r\n        />\r\n    );\r\n};\r\n\r\nexport default NewChannelWithBoardTourTip;\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport type {PreferenceType} from '@mattermost/types/preferences';\r\n\r\nimport {getCurrentUserId} from 'mattermost-redux/selectors/entities/users';\r\nimport type {ActionFuncAsync} from 'mattermost-redux/types/actions';\r\n\r\nimport {savePreferences} from './preferences';\r\n\r\nimport {Preferences} from '../constants';\r\n\r\nexport function setNewChannelWithBoardPreference(initializationState: Record<string, boolean>): ActionFuncAsync {\r\n    return async (dispatch, getState) => {\r\n        const state = getState();\r\n        const currentUserId = getCurrentUserId(state);\r\n        const preference: PreferenceType = {\r\n            user_id: currentUserId,\r\n            category: Preferences.APP_BAR,\r\n            name: Preferences.NEW_CHANNEL_WITH_BOARD_TOUR_SHOWED,\r\n            value: JSON.stringify(initializationState),\r\n        };\r\n        await dispatch(savePreferences(currentUserId, [preference]));\r\n        return {data: true};\r\n    };\r\n}\r\n","/**\n * A specialized version of `baseAggregator` for arrays.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} setter The function to set `accumulator` values.\n * @param {Function} iteratee The iteratee to transform keys.\n * @param {Object} accumulator The initial aggregated object.\n * @returns {Function} Returns `accumulator`.\n */\nfunction arrayAggregator(array, setter, iteratee, accumulator) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    var value = array[index];\n    setter(accumulator, value, iteratee(value), array);\n  }\n  return accumulator;\n}\n\nmodule.exports = arrayAggregator;\n","var baseEach = require('./_baseEach');\n\n/**\n * Aggregates elements of `collection` on `accumulator` with keys transformed\n * by `iteratee` and values set by `setter`.\n *\n * @private\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} setter The function to set `accumulator` values.\n * @param {Function} iteratee The iteratee to transform keys.\n * @param {Object} accumulator The initial aggregated object.\n * @returns {Function} Returns `accumulator`.\n */\nfunction baseAggregator(collection, setter, iteratee, accumulator) {\n  baseEach(collection, function(value, key, collection) {\n    setter(accumulator, value, iteratee(value), collection);\n  });\n  return accumulator;\n}\n\nmodule.exports = baseAggregator;\n","var baseForOwn = require('./_baseForOwn'),\n    createBaseEach = require('./_createBaseEach');\n\n/**\n * The base implementation of `_.forEach` without support for iteratee shorthands.\n *\n * @private\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array|Object} Returns `collection`.\n */\nvar baseEach = createBaseEach(baseForOwn);\n\nmodule.exports = baseEach;\n","var arrayAggregator = require('./_arrayAggregator'),\n    baseAggregator = require('./_baseAggregator'),\n    baseIteratee = require('./_baseIteratee'),\n    isArray = require('./isArray');\n\n/**\n * Creates a function like `_.groupBy`.\n *\n * @private\n * @param {Function} setter The function to set accumulator values.\n * @param {Function} [initializer] The accumulator object initializer.\n * @returns {Function} Returns the new aggregator function.\n */\nfunction createAggregator(setter, initializer) {\n  return function(collection, iteratee) {\n    var func = isArray(collection) ? arrayAggregator : baseAggregator,\n        accumulator = initializer ? initializer() : {};\n\n    return func(collection, setter, baseIteratee(iteratee, 2), accumulator);\n  };\n}\n\nmodule.exports = createAggregator;\n","var isArrayLike = require('./isArrayLike');\n\n/**\n * Creates a `baseEach` or `baseEachRight` function.\n *\n * @private\n * @param {Function} eachFunc The function to iterate over a collection.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {Function} Returns the new base function.\n */\nfunction createBaseEach(eachFunc, fromRight) {\n  return function(collection, iteratee) {\n    if (collection == null) {\n      return collection;\n    }\n    if (!isArrayLike(collection)) {\n      return eachFunc(collection, iteratee);\n    }\n    var length = collection.length,\n        index = fromRight ? length : -1,\n        iterable = Object(collection);\n\n    while ((fromRight ? index-- : ++index < length)) {\n      if (iteratee(iterable[index], index, iterable) === false) {\n        break;\n      }\n    }\n    return collection;\n  };\n}\n\nmodule.exports = createBaseEach;\n","var createAggregator = require('./_createAggregator');\n\n/**\n * Creates an array of elements split into two groups, the first of which\n * contains elements `predicate` returns truthy for, the second of which\n * contains elements `predicate` returns falsey for. The predicate is\n * invoked with one argument: (value).\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Collection\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @returns {Array} Returns the array of grouped elements.\n * @example\n *\n * var users = [\n *   { 'user': 'barney',  'age': 36, 'active': false },\n *   { 'user': 'fred',    'age': 40, 'active': true },\n *   { 'user': 'pebbles', 'age': 1,  'active': false }\n * ];\n *\n * _.partition(users, function(o) { return o.active; });\n * // => objects for [['fred'], ['barney', 'pebbles']]\n *\n * // The `_.matches` iteratee shorthand.\n * _.partition(users, { 'age': 1, 'active': false });\n * // => objects for [['pebbles'], ['barney', 'fred']]\n *\n * // The `_.matchesProperty` iteratee shorthand.\n * _.partition(users, ['active', false]);\n * // => objects for [['barney', 'pebbles'], ['fred']]\n *\n * // The `_.property` iteratee shorthand.\n * _.partition(users, 'active');\n * // => objects for [['fred'], ['barney', 'pebbles']]\n */\nvar partition = createAggregator(function(result, value, key) {\n  result[key ? 0 : 1].push(value);\n}, function() { return [[], []]; });\n\nmodule.exports = partition;\n"],"names":["isAppBinding","x","Boolean","app_id","props","binding","dispatch","useDispatch","intl","useIntl","channelId","useSelector","getCurrentChannelId","teamId","getCurrentTeamId","id","concat","label","React","WithTooltip","title","isVertical","className","onClick","async","context","createCallContext","location","result","handleBindingClick","error","errMsg","text","postEphemeralCallResponseForContext","callResp","data","type","AppCallResponseTypes","OK","FORM","form","openAppsModal","NAVIGATE","errorMessage","formatMessage","defaultMessage","src","icon","AppBarMarketplace","handleOpenMarketplace","useCallback","openModal","modalId","ModalIdentifiers","PLUGIN_MARKETPLACE","dialogType","MarketplaceModal","dialogProps","key","ViewGridPlusOutlineIcon","size","ImageLoadState","isAppBarComponent","pluginId","_ref","component","channel","getCurrentChannel","channelMember","getMyCurrentChannelMembership","activeRhsComponent","getActiveRhsComponent","imageLoadState","setImageLoadState","useState","LOADING","iconUrl","undefined","dropdownText","rhsComponentId","useEffect","buttonId","tooltipText","content","role","tabIndex","alt","onLoad","onImageLoadComplete","LOADED","onError","onImageLoadError","ERROR","isButtonActive","classNames","PluginIcon","boardsEnabled","suitePluginIds","focalboard","_component$action","action","call","NewChannelWithBoardTourTip","AppBar","channelHeaderComponents","getChannelHeaderPluginComponents","appBarPluginComponents","getAppBarPluginComponents","appBarBindings","getAppBarAppBindings","currentProduct","useCurrentProduct","currentProductId","useCurrentProductId","enabled","shouldShowAppBar","canOpenMarketplace","state","isMarketplaceEnabled","haveICurrentTeamPermission","Permissions","SYSCONSOLE_WRITE_PLUGINS","showAppBar","coreProductsPluginIds","playbooks","coreProductComponents","pluginComponents","partition","includes","items","getDivider","length","map","supportedProductIds","inScope","AppBarPluginComponent","_x$supported_product_","supported_product_ids","AppBarBinding","beforeCount","afterCount","pulsatingDotPlacement","pulsatingDotTranslate","showTip","showNewChannelWithBoardPulsatingDot","FormattedMessage","screen","tipOpened","setTipOpened","handleDismiss","e","stopPropagation","setNewChannelWithBoardPreference","Preferences","NEW_CHANNEL_WITH_BOARD_TOUR_SHOWED","handleOpen","preventDefault","overlayPunchOut","useMeasurePunchouts","y","height","width","TourTip","show","placement","step","singleTip","showOptOut","interactivePunchOut","handlePrevious","offset","propTypes","_pt","isRequired","initializationState","getState","currentUserId","getCurrentUserId","preference","user_id","category","APP_BAR","name","value","JSON","stringify","savePreferences","module","exports","array","setter","iteratee","accumulator","index","baseEach","collection","baseForOwn","createBaseEach","arrayAggregator","baseAggregator","baseIteratee","isArray","initializer","func","isArrayLike","eachFunc","fromRight","iterable","Object","createAggregator","push"],"sourceRoot":""}